(()=>{var e={25:(e,t,i)=>{"use strict";i.d(t,{A:()=>Zn});var n={};function o(e){return"ru"==mxClient.language?s[e]:r[e]}i.r(n),i.d(n,{eU:()=>u,rK:()=>d,Gt:()=>L,wc:()=>B,i3:()=>W,k7:()=>H,Sj:()=>ht,WQ:()=>Ot,Wp:()=>oi});const s={menuItemDictionaryConstructors:"Конструкторы словарей",menuItemNodeConstructors:"Конструкторы узлов",menuItemExport:"Экспорт",menuItemEdit:"Изменить",menuItemConverNode:"Конвертация узлов",classesConstructor:"Конструктор классов",classPropertiesConstructor:"Конструктор свойств для классов и объектов",relationshipsConstructor:"Конструктор отношений",enumConstructor:"Конструктор enum",startNodeConstructor:"Создать начальный узел",TrueNodeCreate:'Создать узел "Истина"',FalseNodeCreate:'Создать узел "Ложь"',LogicNodeCreate:"Создать агрегационный узел",PredeterminingFactorsNodeCreate:'Создать узел "Mutex"',UncertaintyNodeCreate:'Создать узел "Null"',actionNodeConstructor:"Создать узел действия",cycleNodeConstructor:'Создать узел "Цикл"',whileNodeConstructor:'Создать узел "While"',conditionNodeConstructor:"Создать узел вопроса",switchCaseNodeConstructor:'Создать узел "Switch case"',exportClass:"Экспорт словаря классов",exportProperty:"Экспорт словаря свойств",exportRelationship:"Экспорт словаря отношений",exportEnum:"Экспорт словаря enum",exportTree:"Экспорт дерева",editValue:"Изменить значение",editTextInNode:"Изменить текстовое значение узла",editQuestionInfo:"Изменить информацию для вопросов",convertStartNode:"Конвертировать в стартовый узел",convertTrueNode:"Конвертировать в узел Истина",convertFalseNode:"Конвертировать в узел Ложь",convertLogicNode:"Конвертировать в агрегационный узел",convertPredeterminingFactorsNode:'Конвертировать в узел "Mutex"',convertUncertaintyNode:'Конвертировать в узел "Null"',convertActionNode:"Конвертировать в узел действия",convertCycleNode:'Конвертировать в узел "Цикл"',convertConditionNode:"Конвертировать в вопросительный узел",convertSwitchCaseNode:'Конвертировать в узел "Switch case"',TitleClassConstructorWindow:"Конструктор классов",TitleClassEditorWindow:"Редактор классов",TitleClassPropertiesConstructorWindow:"Конструктор свойств для классов и объектов",TitleClassPropertiesEditorWindow:"Редактор свойств для классов и объектов",TitleEnumConstructorWindow:"Конструктор enum",TitleEnumEditorWindow:"Редактор enum",TitleRelationshipsConstructorWindow:"Конструктор отношений",TitleRelationshipsEditorWindow:"Редактор отношений",TitleActionNodeConstructorWindow:"Конструктор узла действия",TitleActionNodeEditorWindow:"Редактор узла действия",TitleBranchResultNodeConstructorWindow:'Конструктор узлов "Истина"/"Ложь"',TitleBranchResultNodeEditorWindow:'Редактор узлов "Истина"/"Ложь"',TitleConditionNodeConstructorWindow:"Конструктор узла вопроса",TitleConditionNodeEditorWindow:"Редактор узла вопроса",TitleCycleNodeConstructorWindow:'Конструктор узла "Цикл"',TitleCycleNodeEditorWindow:'Редактор узла "Цикл"',TitleWhileNodeConstructorWindow:'Конструктор узла "Пока"',TitleWhileNodeEditorWindow:'Редактор узла "Пока"',TitleEditTextInNodeWindow:"Редактор текста в узле",TitleEditValueInOutcomeWindow:"Редактор значений в ветке",TitleLogicNodeConstructorWindow:"Конструктор агрегационного узла",TitleLogicNodeEditorWindow:"Редактор агрегационного узла",TitlePredeterminingFactorsNodeConstructorWindow:'Конструктор узла "Mutex"',TitlePredeterminingFactorsNodeEditorWindow:'Редактор узла "Mutex"',TitleEditQuestionInfoInNodeWindow:"Редактор информации для вопросов в узле",TitleEditQuestionInfoInOutcomeWindow:"Редактор информации для вопросов в ветке",TitleStartConstructorWindow:"Конструктор начального узла",TitleStartEditorWindow:"Редактор начального узла",TitleSwitchCaseNodeConstructorWindow:'Конструктор узла "Switch case"',TitleSwitchCaseNodeEditorWindow:'Редактор узла "Switch case"',Create:"Создать",Apply:"Принять",Delete:"Удалить",AddClass:"Добавить класс",OpenBlockly:"Открыть Blockly",toСode:"Перевод в код",AddPropertyClass:"Добавить свойство",AddEnum:"Добавить enum",AddRelationship:"Добавить отношение",SwitchBlockly:"Переключиться на Blockly",SwitchText:"Переключиться на текст",Save:"Сохранить",Generate:"Сгенерировать текст",AddVariable:"Добавить переменную",ExpressionInNode:"Выражение в узле: ",HumanReadableText:"Человекочитаемый текст",value:"Значение",type:"Тип",asNextStep:"Шаблон формулировки данного узла как следующего шага.",descriptionQuestion:"Шаблон описания результата данного узла.",questionQuestion:"Шаблон вопроса про данный узел.",endingCause:"Шаблон формулировки конечности данного узла.",descriptionOutcome:"Шаблон описания результата ветки.",nextStepQuestion:"Шаблон вопроса о том, с чего надо начать в ветке.",nextStepExplanation:"Шаблон объяснения того, с чего на самом деле нужно начать в ветке.",textQuestion:"Шаблон текста данного варианта ответа.",explanation:"Шаблон объяснения, почему данный ответ правильный.",nextStepQuestionOutcome:"Шаблон вопроса о том, что делать дальше при данном ответе.",nextStepBranchResult:"Шаблон формулировок для красных/зеленых узлов при данном ответе.",nextStepExplanationOutcome:"Шаблон объяснения того, что на самом деле делать дальше при данном ответе.",nameIsMissing:"В строке №%i отсутствует название; ",nameIsIncorrect:"В строке №%i название некорректно; ",extendClassIsIncorrect:"В строке №%i название наследуемого класса некорректно; ",nonUniqueClassName:"В словаре содержатся неуникальные названия классов!",ClassExists:"Словарь классов уже существует!",startValueIsMissing:"В строке №%i отсутствует начальное значение; ",endValueIsMissing:"В строке №%i отсутствует конечное значение; ",classesIsMissing:"В строке №%i отсутствуют классы; ",nonUniquePropertyName:"В словаре содержатся неуникальные названия свойств!",PropertyExists:"Словарь свойств уже существует",valueIsMissing:"В строке №%i отсутствует значение; ",valueIsIncorrect:"В строке №%i значение некорректно; ",nameRDFIsMissing:"В строке №%i отсутствует название в RDF; ",nameRDFIsIncorrect:"В строке №%i название в RDF некорректно; ",nonUniqueEnumName:"В словаре содержатся неуникальные названия enum!",EnumExists:"Словарь enum уже существует",extendRelationshipIsIncorrect:"В строке №%i название наследуемого отношения некорректно; ",nameRelationshipsIsMissing:"В строке №%i отсутствуют имена отношений; ",nameRelationshipsIsIncorrect:"В строке №%i имя отношения некорректно; ",nonUniqueRelationshipName:"В словаре содержатся неуникальные названия отношений!",RelationshipExists:"Словарь отношений уже существует",ExpressionIsMissing:"Отсутствует выражение",NameVariableIsMissing:"Отсутствует имя переменной!\n",NameVariableIsIncorrect:"Имя переменной некорректно!\n",TypeVariableIsMissing:"Отсутствует тип переменной!\n",sourceNodeIsMissing:"Исходный узел отсутствует!",EnumIsMissing:"Отсутствует enum в словаре",HumanReadableTextIsMissing:"Отсутствует человеко-читаемый текст \n",ValueOutcomeIsMissing:"Отсутствует значение для ветки \n",ValueInOutcomeIsMissing:"Ветке не задано значение!",invalidAssign:'Недопустимый тип в ASSIGN: слева от "=" ожидается TREE VAR или GET PROPERTY',InvalidType:"Недопустимый тип в %type: ожидается %inputCheck; актуальный %outputCheck",StartNodeOnlyOne:"Начальный узел должен быть один!",typeOutcomeStartNodeIsMissing:"Отсутствует тип у ветки после начального узла",typeOutcomeCycleIsMissing:"Отсутствует тип у ветки после узла цикла",bodyOnlyOne:"Ветка тела для узла цикла должна быть одна!\n",trueCycleOnlyOne:"Истинная ветка для узла цикла должна быть одна!\n",falseCycleOnlyOne:"Ложная ветка для узла цикла должна быть одна!\n",typeOutcomeLogicNodeIsMissing:"Отсутствует тип у ветки после агрегационного узла",OutcomeLogicNodeOnlyTwo:"Веток для агрегационного узла должно быть 2 и более!\n",trueLogicNodeOnlyOne:"Истинная ветка для агрегационного узла должна быть одна!\n",falseLogicNodeOnlyOne:"Ложная ветка для агрегационного узла должна быть одна!\n",typeOutcomePredIsMissing:"Отсутствует тип у ветки после независимого ветвления",predOutcomeIsMissing:"Отсутствует предрешающая ветка для узла независимое ветвление!\n",undeterminedOnlyOne:"Ветка undetermined для узла независимое ветвление должна быть одна!\n",valueInOutcomeIsMissing:"Отсутствует значение у ветки",valueEnumIsMissing:"Значение enum отсутствует в словаре",ClassInDictIsMissing:"Класс отсутствует в словаре",TypesDontMatch:"Тип ветки не совпадает с типом возвращаемого значения выражения узла",OutcomesHasSameValues:"Ветка имеет повторяющееся значение",ResultOutcomeForPredNode:"Результативный узел (Ложь/Истина) для предрешающей ветки должен быть один!",moreBlocksInWorkspace:"В рабочей области имеется более одного блока",propertyIsMissingInDict:"Свойство %propertyName не существует в словаре",hasCycleInTree:"В графе присутствуют циклы!",AssignInNode:"В исходном узле не может содержаться присвоение!",EmptyConnection:"Имеются пустые отверстия!",StartNodeIsTarget:"В начальный узел входит ветка!",TargetNodeIsMissing:"Отсутствует конечный узел!"},r={menuItemDictionaryConstructors:"Dictionary constructors",menuItemNodeConstructors:"Node constructors",menuItemExport:"Export",menuItemEdit:"Edit",menuItemConverNode:"Convert Node",classesConstructor:"Classes constructor",classPropertiesConstructor:"Class and Object properties constructor",relationshipsConstructor:"Relationships constructor",enumConstructor:"Enum constructor",startNodeConstructor:"Create start node",TrueNodeCreate:"Create true node",FalseNodeCreate:"Create false node",LogicNodeCreate:"Create agregation node",PredeterminingFactorsNodeCreate:"Create Mutex node",UncertaintyNodeCreate:"Create node Null",actionNodeConstructor:"Action Node Constructor",cycleNodeConstructor:"Cycle Node Constructor",whileNodeConstructor:"While Node Constructor",conditionNodeConstructor:"Condition Node Constructor",switchCaseNodeConstructor:"Switch case Node Constructor",exportClass:"Export class",exportProperty:"Export property",exportRelationship:"Export relationship",exportEnum:"Export enum",exportTree:"Export tree",editValue:"Edit value",editTextInNode:"Edit text in node",editQuestionInfo:"Edit question info",convertStartNode:"Convert to a Start node",convertTrueNode:"Convert to True Node",convertFalseNode:"Convert to Node False",convertLogicNode:"Convert to a agregation node",convertPredeterminingFactorsNode:"Convert to an Mutex node",convertUncertaintyNode:'Convert to node "Null"',convertActionNode:"Convert to Action Node",convertCycleNode:'Convert to a "Cycle" node',convertConditionNode:"Convert node in condition node",convertSwitchCaseNode:'Convert to a "Switch case" node',TitleClassConstructorWindow:"Classes constructor",TitleClassEditorWindow:"Classes editor",TitleClassPropertiesConstructorWindow:"Class and Object properties constructor",TitleClassPropertiesEditorWindow:"Class and Object properties editor",TitleEnumConstructorWindow:"Enum constructor",TitleEnumEditorWindow:"Enum editor",TitleRelationshipsConstructorWindow:"Relationships constructor",TitleRelationshipsEditorWindow:"Relationships editor",TitleActionNodeConstructorWindow:"Action node constructor",TitleActionNodeEditorWindow:"Action node editor",TitleBranchResultNodeConstructorWindow:"Branch result node constructor",TitleBranchResultNodeEditorWindow:"Branch result node editor",TitleConditionNodeConstructorWindow:"Condition node constructor",TitleConditionNodeEditorWindow:"Condition node editor",TitleCycleNodeConstructorWindow:"Cycle node constructor",TitleCycleNodeEditorWindow:"Cycle node editor",TitleWhileNodeConstructorWindow:"While node constructor",TitleWhileNodeEditorWindow:"While node editor",TitleEditTextInNodeWindow:"Edit text in node",TitleEditValueInOutcomeWindow:"Edit value in outcome",TitleLogicNodeConstructorWindow:"Agregation node constructor",TitleLogicNodeEditorWindow:"Agregation node editor",TitlePredeterminingFactorsNodeConstructorWindow:"Mutex node constructor",TitlePredeterminingFactorsNodeEditorWindow:"Mutex node editor",TitleEditQuestionInfoInNodeWindow:"Edit question info in node",TitleEditQuestionInfoInOutcomeWindow:"Edit question info in outcome",TitleStartConstructorWindow:"Start node constructor",TitleStartEditorWindow:"Start node editor",TitleSwitchCaseNodeConstructorWindow:"Switch case node constructor",TitleSwitchCaseNodeEditorWindow:"Switch case node editor",Create:"Create",Apply:"Apply",Delete:"Delete",AddClass:"Add Class",OpenBlockly:"Open Blockly",toСode:"Translation into code",AddPropertyClass:"Add property",AddEnum:"Add Enum",AddRelationship:"Add relationship",SwitchBlockly:"Switch to blockly",SwitchText:"Switch to text",Save:"Save",Generate:"Generate",AddVariable:"Add Variable",ExpressionInNode:"Expression in node: ",HumanReadableText:"Human-readable text",value:"Value",type:"Type",asNextStep:"Template formulation of this node as the next step.",descriptionQuestion:"Template for describing the result of this node.",questionQuestion:"Template question about this node.",endingCause:"Template formulation of the end of a particular node.",descriptionOutcome:"Template for describing the result of a branch.",nextStepQuestion:"Template question about where to start in a branch.",nextStepExplanation:"Template for explaining where you really need to start in a branch.",textQuestion:"Template the text of this answer choice.",explanation:"Template an explanation of why this answer is correct.",nextStepQuestionOutcome:"Template a question about what to do next for a given answer.",nextStepBranchResult:"Template wording for red/green nodes in this answer.",nextStepExplanationOutcome:"Template an explanation of what to actually do next for a given answer.",nameIsMissing:"In line №%i there is no name; ",nameIsIncorrect:"In line №%i the name is incorrect; ",extendClassIsIncorrect:"In line №%i the name of the extended class is incorrect; ",nonUniqueClassName:"The dictionary contains non-unique class names!",ClassExists:"Class dictionary already exists",startValueIsMissing:"In line №%i there is no start value; ",endValueIsMissing:"In line №%i there is no end value; ",classesIsMissing:"In line №%i there are no classes; ",nonUniquePropertyName:"The dictionary contains non-unique property names!",PropertyExists:"Class and Object properties dictionary already exists",valueIsMissing:"In line №%i there is no value; ",valueIsIncorrect:"In line №%i the value is incorrect; ",nameRDFIsMissing:"In line №%i there is no name in RDF; ",nameRDFIsIncorrect:"In line №%i the name in RDF is incorrect; ",nonUniqueEnumName:"The dictionary contains non-unique names of enum!",EnumExists:"Enum dictionary already exists",extendRelationshipIsIncorrect:"In line №%i the name of the inherited relationship is incorrect; ",nameRelationshipsIsMissing:"In line №%i there are no relationship names; ",nameRelationshipsIsIncorrect:"In line №%i the name of the relationship is incorrect; ",nonUniqueRelationshipName:"The dictionary contains non-unique relationship names!",RelationshipExists:"Relationships dictionary already exists",ExpressionIsMissing:"There is no expression",NameVariableIsMissing:"No variable name!\n",NameVariableIsIncorrect:"The variable name is incorrect!\n",TypeVariableIsMissing:"No variable type!\n",sourceNodeIsMissing:"Source node is missing!",EnumIsMissing:"No enum in the dictionary",HumanReadableTextIsMissing:"No human-readable text \n",ValueOutcomeIsMissing:"No value for the branch \n",ValueInOutcomeIsMissing:"The branch has no value!",invalidAssign:'Invalid type in ASSIGN: to the left of "=" is expected TREE VAR or GET PROPERTY',InvalidType:"Invalid type in %type: expected %inputCheck; actual %outputCheck",StartNodeOnlyOne:"The starting node must be one!",typeOutcomeStartNodeIsMissing:"There is no branch type after the start node",typeOutcomeCycleIsMissing:"A branch after a cycle node has no type",bodyOnlyOne:"The true branch for a cycle node must be one!\n",trueCycleOnlyOne:"There must be only one true branch for the cycle node!\n",falseCycleOnlyOne:"There must be only one false branch for the cycle node!\n",typeOutcomeLogicNodeIsMissing:"The branch after the agregation node has no type",OutcomeLogicNodeOnlyTwo:"There must be 2 or more branches for the agregation node!\n",trueLogicNodeOnlyOne:"The true branch for a agregation node must be one!\n",falseLogicNodeOnlyOne:"The false branch for a agregation node must be one!\n",typeOutcomePredIsMissing:"No branch type after an independent branch",predOutcomeIsMissing:"There is no predetermined branch for the independent branch node!\n",undeterminedOnlyOne:"The undetermined branch for an independent branch node must be one!\n",valueInOutcomeIsMissing:"The branch has no value",valueEnumIsMissing:"The value of enum is not in the dictionary",ClassInDictIsMissing:"The class is not in the dictionary",TypesDontMatch:"The branch type does not match the type of the return value of the node expression",OutcomesHasSameValues:"The branch has a repeating value",ResultOutcomeForPredNode:"The result node (False/True) for the predetermined branch must be one!",moreBlocksInWorkspace:"There is more than one block in the workspace",propertyIsMissingInDict:"Property %propertyName does not exist in the dictionary",hasCycleInTree:"There are cycles in the graph!",AssignInNode:"The source node cannot contain an assignment!",EmptyConnection:"There are empty connection!",StartNodeIsTarget:"The starting node consists of a branch!",TargetNodeIsMissing:"There is no target node!"};var l=i(500);const{Block:a,BlockFlyoutInflater:c,BlockNavigationPolicy:h,BlockSvg:u,Blocks:d,ButtonFlyoutInflater:p,COLLAPSED_FIELD_NAME:g,COLLAPSED_INPUT_NAME:m,COLLAPSE_CHARS:b,CodeGenerator:f,CollapsibleToolboxCategory:E,ComponentManager:y,Connection:v,ConnectionChecker:C,ConnectionDB:_,ConnectionNavigationPolicy:T,ConnectionType:w,ContextMenu:I,ContextMenuItems:k,ContextMenuRegistry:x,Css:N,DELETE_VARIABLE_ID:S,DeleteArea:A,DragTarget:R,DropDownDiv:$,Events:O,Extensions:D,Field:M,FieldCheckbox:L,FieldDropdown:B,FieldImage:P,FieldLabel:F,FieldLabelSerializable:V,FieldNavigationPolicy:U,FieldNumber:W,FieldTextInput:H,FieldVariable:G,Flyout:z,FlyoutButton:j,FlyoutButtonNavigationPolicy:X,FlyoutItem:K,FlyoutMetricsManager:Y,FlyoutNavigationPolicy:J,FlyoutNavigator:q,FlyoutSeparator:Q,FlyoutSeparatorNavigationPolicy:Z,FocusManager:ee,FocusableTreeTraverser:te,Generator:ie,Gesture:ne,Grid:oe,HorizontalFlyout:se,INPUT_VALUE:re,Input:le,InsertionMarkerPreviewer:ae,KeyboardNavigationController:ce,LabelFlyoutInflater:he,LineCursor:ue,Marker:de,MarkerManager:pe,Menu:ge,MenuItem:me,MetricsManager:be,Msg:fe,NEXT_STATEMENT:Ee,Names:ye,Navigator:ve,OPPOSITE_TYPE:Ce,OUTPUT_VALUE:_e,Options:Te,PREVIOUS_STATEMENT:we,PROCEDURE_CATEGORY_NAME:Ie,Procedures:ke,RENAME_VARIABLE_ID:xe,RenderedConnection:Ne,Scrollbar:Se,ScrollbarPair:Ae,SeparatorFlyoutInflater:Re,ShortcutItems:$e,ShortcutRegistry:Oe,TOOLBOX_AT_BOTTOM:De,TOOLBOX_AT_LEFT:Me,TOOLBOX_AT_RIGHT:Le,TOOLBOX_AT_TOP:Be,Theme:Pe,ThemeManager:Fe,Themes:Ve,Toast:Ue,Toolbox:We,ToolboxCategory:He,ToolboxItem:Ge,ToolboxSeparator:ze,Tooltip:je,Touch:Xe,Trashcan:Ke,UnattachedFieldError:Ye,VARIABLE_CATEGORY_NAME:Je,VARIABLE_DYNAMIC_CATEGORY_NAME:qe,VERSION:Qe,VariableMap:Ze,VariableModel:et,Variables:tt,VariablesDynamic:it,VerticalFlyout:nt,WidgetDiv:ot,Workspace:st,WorkspaceAudio:rt,WorkspaceDragger:lt,WorkspaceNavigationPolicy:at,WorkspaceSvg:ct,Xml:ht,ZoomControls:ut,blockAnimations:dt,blockRendering:pt,browserEvents:gt,bubbles:mt,bumpObjects:bt,clipboard:ft,comments:Et,common:yt,config:vt,constants:Ct,defineBlocksWithJsonArray:_t,dialog:Tt,dragging:wt,fieldRegistry:It,geras:kt,getFocusManager:xt,getMainWorkspace:Nt,getSelected:St,hasBubble:At,hideChaff:Rt,icons:$t,inject:Ot,inputs:Dt,isCopyable:Mt,isDeletable:Lt,isDraggable:Bt,isIcon:Pt,isObservable:Ft,isPaster:Vt,isRenderedElement:Ut,isSelectable:Wt,isSerializable:Ht,isVariableBackedParameterModel:Gt,keyboardNavigationController:zt,layers:jt,navigateBlock:Xt,navigateStacks:Kt,procedures:Yt,registry:Jt,renderManagement:qt,serialization:Qt,setLocale:Zt,setParentContainer:ei,svgResize:ti,thrasos:ii,uiPosition:ni,utils:oi,zelos:si}=l;var ri=i(449);const{JavascriptGenerator:li,Order:ai,javascriptGenerator:ci}=ri;var hi={kind:"categoryToolbox",contents:[{kind:"category",name:"Types",colour:"300",contents:[{kind:"block",type:"object"},{kind:"block",type:"class"},{kind:"block",type:"property"},{kind:"block",type:"relationship"},{kind:"block",type:"string"},{kind:"block",type:"boolean"},{kind:"block",type:"integer"},{kind:"block",type:"double"},{kind:"block",type:"enum"},{kind:"block",type:"ref_to_decision_tree_var"},{kind:"block",type:"variable"}]},{kind:"category",name:"Operators 'get'",colour:"60",contents:[{kind:"block",type:"get_class"},{kind:"block",type:"get_property_value"},{kind:"block",type:"get_relationship_object"},{kind:"block",type:"get_condition_object"},{kind:"block",type:"get_extr_object"}]},{kind:"category",name:"Operators 'set'",colour:"120",contents:[{kind:"block",type:"assign_value_to_property"},{kind:"block",type:"assign_value_to_variable_decision_tree"},{kind:"block",type:"cast_object_to_class"},{kind:"block",type:"add_relationship_to_object"}]},{kind:"category",name:"Operators 'check'",colour:"195",contents:[{kind:"block",type:"check_object_class"},{kind:"block",type:"check_relationship"}]},{kind:"category",name:"Logical operators",colour:"230",contents:[{kind:"block",type:"and"},{kind:"block",type:"or"},{kind:"block",type:"not"},{kind:"block",type:"comparison"},{kind:"block",type:"three_digit_comparison"}]},{kind:"category",name:"Quantifiers",colour:"75",contents:[{kind:"block",type:"quantifier_of_existence"},{kind:"block",type:"quantifier_of_generality"}]},{kind:"category",name:"Block",colour:"75",contents:[{kind:"block",type:"block"},{kind:"block",type:"if_then_stmt"},{kind:"block",type:"with_stmt"}]}]},ui=function(e){return/^[a-zA-Z_][A-Za-z0-9_]*$/.test(e)?e:null};function di(e){return e.style.width="100%",e.style.height="80%",e.style.overflow="scroll",e.style.display="block",e.style.borderCollapse="separate",e.style.borderSpacing="10px 0",e}function pi(e){return e.style.display="flex",e.style.height="20%",e.style.alignItems="center",e.style.gap="5px",e.style.justifyContent="center",e}function gi(e){return e.style.minHeight="50%",e.style.fontSize="18px",e}function mi(e){return e.style.width="100%",e.style.fontSize="20px",e}function bi(e){return e.style.width="100%",e.style.fontSize="20px",e}function fi(e){return e.style.fontSize="20px",e}function Ei(e){return e.style.fontSize="30px",e.style.width="100%",e.style.resize="none",e.style.height="80%",e}function yi(e,t,i){return e.style.width=t+"px",e.style.height=.78*i+"px",e}d.object={init:function(){this.appendDummyInput().appendField(new H("object",ui),"object_name"),this.setOutput(!0,"Object"),this.setColour(120),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.object=function(e){return["obj:"+e.getFieldValue("object_name"),ci.ORDER_ATOMIC]},d.class={init:function(){this.appendDummyInput().appendField(new H("className",ui),"class_name"),this.setOutput(!0,"Class"),this.setColour(315),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.class=function(e){return["class:"+e.getFieldValue("class_name"),ci.ORDER_ATOMIC]},d.property={init:function(){this.appendDummyInput().appendField(new H("property",ui),"property_name"),this.setOutput(!0,"Property"),this.setColour(60),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.property=function(e){return[e.getFieldValue("property_name"),ci.ORDER_ATOMIC]},d.relationship={init:function(){this.appendDummyInput().appendField(new H("relationship",ui),"relationship_name"),this.setOutput(!0,"Relationship"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.relationship=function(e){return[e.getFieldValue("relationship_name"),ci.ORDER_ATOMIC]},d.string={init:function(){this.appendDummyInput().appendField(new H("string"),"value"),this.setOutput(!0,"String"),this.setColour(0),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.string=function(e){return['"'+e.getFieldValue("value").replaceAll("\\","\\\\").replaceAll('"','\\"').replaceAll("\n","\\n").replaceAll("\t","\\t")+'"',ci.ORDER_ATOMIC]},d.boolean={init:function(){this.appendDummyInput().appendField(new L("TRUE"),"value"),this.setOutput(!0,"Boolean"),this.setColour(0),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.boolean=function(e){return["TRUE"===e.getFieldValue("value"),ci.ORDER_ATOMIC]},d.integer={init:function(){this.appendDummyInput().appendField(new W(0,-1/0,1/0,1),"value"),this.setOutput(!0,"Integer"),this.setColour(0),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.integer=function(e){return[e.getFieldValue("value"),ci.ORDER_ATOMIC]},d.double={init:function(){this.appendDummyInput().appendField(new W(0),"value"),this.setOutput(!0,"Double"),this.setColour(0),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.double=function(e){return[e.getFieldValue("value"),ci.ORDER_ATOMIC]},d.get_class={init:function(){this.appendValueInput("object").setCheck("Object").appendField("get class"),this.setOutput(!0,"Class"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.get_class=function(e){return[ci.valueToCode(e,"object",ci.ORDER_NONE)+".getClass()",ci.ORDER_ATOMIC]},d.get_property_value={init:function(){this.appendDummyInput().appendField("get property value"),this.appendValueInput("object").setCheck("Object").appendField("object"),this.appendValueInput("property").setCheck("Property").appendField("property"),this.setOutput(!0,["Boolean","String","Integer","Double","Enum"]),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.get_property_value=function(e){return[ci.valueToCode(e,"object",ci.ORDER_NONE)+"."+ci.valueToCode(e,"property",ci.ORDER_NONE),ci.ORDER_ATOMIC]},d.if_then_stmt={init:function(){this.appendDummyInput().appendField("If Then"),this.appendValueInput("condition").setCheck("Boolean").appendField("condition"),this.appendValueInput("body").setCheck(["Object","Class","Relationship","Property","Boolean","String","Integer","Double","Enum","Statement"]).appendField("body"),this.setInputsInline(!1),this.setOutput(!0,"Statement"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.if_then_stmt=function(e){return["if ( "+ci.valueToCode(e,"condition",ci.ORDER_NONE)+" ) "+ci.valueToCode(e,"body",ci.ORDER_NONE),ci.ORDER_ATOMIC]},d.with_stmt={init:function(){this.appendDummyInput().appendField("With"),this.appendDummyInput().appendField(new H("var",ui),"name_var"),this.appendValueInput("expression").setCheck("Object").appendField("expression"),this.appendValueInput("body").setCheck(["Object","Class","Relationship","Property","Boolean","String","Integer","Double","Enum","Statement"]).appendField("body"),this.setInputsInline(!1),this.setOutput(!0,"Statement"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.with_stmt=function(e){return["with ( "+e.getFieldValue("name_var")+" = "+ci.valueToCode(e,"expression",ci.ORDER_NONE)+" ) "+ci.valueToCode(e,"body",ci.ORDER_NONE),ci.ORDER_ATOMIC]},d.get_relationship_object={init:function(){this.appendDummyInput().appendField("get relationship object"),this.appendValueInput("object").setCheck("Object").appendField("subject"),this.appendValueInput("relationship").setCheck("Relationship").appendField("relationship"),this.setInputsInline(!1),this.setOutput(!0,["Object"]),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.get_relationship_object=function(e){return[ci.valueToCode(e,"object",ci.ORDER_NONE)+"->"+ci.valueToCode(e,"relationship",ci.ORDER_NONE),ci.ORDER_ATOMIC]},d.get_condition_object={init:function(){this.appendDummyInput().appendField("get object by condition"),this.appendValueInput("condition").setCheck("Boolean").appendField("condition"),this.appendDummyInput().appendField(new H("type",ui),"type_var"),this.appendDummyInput().appendField(new H("var",ui),"name_var"),this.setInputsInline(!1),this.setOutput(!0,["Object"]),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.get_condition_object=function(e){var t=ci.valueToCode(e,"condition",ci.ORDER_NONE),i=e.getFieldValue("name_var");return["find "+e.getFieldValue("type_var")+" "+i+" { "+t+" } ",ci.ORDER_ATOMIC]},d.get_extr_object={init:function(){this.appendDummyInput().appendField("get extreme object"),this.appendDummyInput().appendField(new H("var1",ui),"name_var1"),this.appendValueInput("extreme_condition").setCheck("Boolean").appendField("extreme condition"),this.appendDummyInput().appendField(new H("type2",ui),"type_var2"),this.appendDummyInput().appendField(new H("var2",ui),"name_var2"),this.appendValueInput("general_condition").setCheck("Boolean").appendField("general condition"),this.setInputsInline(!1),this.setOutput(!0,["Object"]),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.get_extr_object=function(e){return["findExtreme "+e.getFieldValue("name_var1")+" [ "+ci.valueToCode(e,"extreme_condition",ci.ORDER_NONE)+" ] among "+e.getFieldValue("type_var2")+" "+e.getFieldValue("name_var2")+" { "+ci.valueToCode(e,"general_condition",ci.ORDER_NONE)+" } ",ci.ORDER_ATOMIC]},d.assign_value_to_property={init:function(){this.appendDummyInput().appendField("Assign a value to a property"),this.appendValueInput("object").setCheck("Object").appendField("object"),this.appendValueInput("property").setCheck("Property").appendField("property"),this.appendValueInput("new_value").setCheck(["Boolean","String","Integer","Double","Enum"]).appendField("new value"),this.setOutput(!0,"Statement"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.assign_value_to_property=function(e){return[ci.valueToCode(e,"object",ci.ORDER_ASSIGNMENT)+"."+ci.valueToCode(e,"property",ci.ORDER_ASSIGNMENT)+" = "+ci.valueToCode(e,"new_value",ci.ORDER_ASSIGNMENT),ci.ORDER_ATOMIC]},d.assign_value_to_variable_decision_tree={init:function(){this.appendDummyInput().appendField("Assign a value to a variable decision tree"),this.appendValueInput("ref_to_object").setCheck("VarObject").appendField("reference to object"),this.appendValueInput("new_object").setCheck("Object").appendField("new object"),this.setOutput(!0,"Statement"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.assign_value_to_variable_decision_tree=function(e){return[ci.valueToCode(e,"ref_to_object",ci.ORDER_ASSIGNMENT)+" = "+ci.valueToCode(e,"new_object",ci.ORDER_ASSIGNMENT),ci.ORDER_ATOMIC]},d.add_relationship_to_object={init:function(){this.itemCount_=2,this.appendDummyInput().appendField("Add relationship to object"),this.appendValueInput("relationship").setCheck("Relationship").appendField("relationship"),this.appendValueInput("object").setCheck("Object").appendField("subject"),this.setInputsInline(!1),this.setOutput(!0,"Statement"),this.setMutator(new n.Mutator(["check_relationship_item"])),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")},mutationToDom:function(){const e=oi.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("check_relationship_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("check_relationship_item");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){let t=e.getInputTargetBlock("STACK");const i=[];for(;t&&!t.isInsertionMarker();)i.push(t.valueConnection_),t=t.nextConnection&&t.nextConnection.targetBlock();for(let e=0;e<this.itemCount_;e++){const t=this.getInput("object"+e).connection.targetConnection;t&&-1===i.indexOf(t)&&t.disconnect()}this.itemCount_=i.length,this.updateShape_();for(let e=0;e<this.itemCount_;e++)n.Mutator.reconnect(i[e],this,"object"+e)},saveConnections:function(e){let t=e.getInputTargetBlock("STACK"),i=0;for(;t;){const e=this.getInput("object"+i);t.valueConnection_=e&&e.connection.targetConnection,t=t.nextConnection&&t.nextConnection.targetBlock(),i++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField("objects");for(let e=0;e<this.itemCount_;e++)this.getInput("object"+e)||this.appendValueInput("object"+e).setCheck("Object").appendField("object"+e);for(let e=this.itemCount_;this.getInput("object"+e);e++)this.removeInput("object"+e)}},ci.forBlock.add_relationship_to_object=function(e){var t=ci.valueToCode(e,"object",ci.ORDER_NONE)+" +=> "+ci.valueToCode(e,"relationship",ci.ORDER_NONE)+" (";let i=[];for(var n=0;n<e.itemCount_;n++){let t=ci.valueToCode(e,"object"+n,ci.ORDER_NONE);t&&i.push(t)}return[t+=i.join(", ")+")",ci.ORDER_ATOMIC]},d.cast_object_to_class={init:function(){this.appendDummyInput().appendField("Cast the object to class"),this.appendValueInput("class").setCheck("Class").appendField("class"),this.appendValueInput("object").setCheck("Object").appendField("object"),this.setOutput(!0,"Object"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.cast_object_to_class=function(e){return[ci.valueToCode(e,"object",ci.ORDER_INSTANCEOF)+" as "+ci.valueToCode(e,"class",ci.ORDER_INSTANCEOF),ci.ORDER_ATOMIC]},d.check_object_class={init:function(){this.appendDummyInput().appendField("Check the object class"),this.appendValueInput("object").setCheck("Object").appendField("object"),this.appendValueInput("class").setCheck("Class").appendField("class"),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.check_object_class=function(e){return[ci.valueToCode(e,"object",ci.ORDER_INSTANCEOF)+" is "+ci.valueToCode(e,"class",ci.ORDER_INSTANCEOF),ci.ORDER_INSTANCEOF]},d.check_relationship={init:function(){this.itemCount_=2,this.appendDummyInput().appendField("Check for a relationship"),this.appendValueInput("relationship").setCheck("Relationship").appendField("relationship"),this.appendValueInput("object").setCheck("Object").appendField("subject"),this.setInputsInline(!1),this.setOutput(!0,"Boolean"),this.setMutator(new n.Mutator(["check_relationship_item"])),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")},mutationToDom:function(){const e=oi.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("check_relationship_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("check_relationship_item");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){let t=e.getInputTargetBlock("STACK");const i=[];for(;t&&!t.isInsertionMarker();)i.push(t.valueConnection_),t=t.nextConnection&&t.nextConnection.targetBlock();for(let e=0;e<this.itemCount_;e++){const t=this.getInput("object"+e).connection.targetConnection;t&&-1===i.indexOf(t)&&t.disconnect()}this.itemCount_=i.length,this.updateShape_();for(let e=0;e<this.itemCount_;e++)n.Mutator.reconnect(i[e],this,"object"+e)},saveConnections:function(e){let t=e.getInputTargetBlock("STACK"),i=0;for(;t;){const e=this.getInput("object"+i);t.valueConnection_=e&&e.connection.targetConnection,t=t.nextConnection&&t.nextConnection.targetBlock(),i++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField("objects");for(let e=0;e<this.itemCount_;e++)this.getInput("object"+e)||this.appendValueInput("object"+e).setCheck("Object").appendField("object"+e);for(let e=this.itemCount_;this.getInput("object"+e);e++)this.removeInput("object"+e)}},ci.forBlock.check_relationship=function(e){var t=ci.valueToCode(e,"object",ci.ORDER_NONE)+"->"+ci.valueToCode(e,"relationship",ci.ORDER_NONE)+"(";let i=[];for(var n=0;n<e.itemCount_;n++){let t=ci.valueToCode(e,"object"+n,ci.ORDER_NONE);t&&i.push(t)}return[t+=i.join(", ")+")",ci.ORDER_ATOMIC]},d.check_relationship_item={init:function(){this.setColour(240),this.appendDummyInput().appendField("Object"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(""),this.contextMenu=!1}},d.check_relationship_container={init:function(){this.setColour(240),this.appendDummyInput().appendField("list objects"),this.appendStatementInput("STACK"),this.setTooltip(""),this.contextMenu=!1}},d.and={init:function(){this.appendDummyInput().appendField("And"),this.appendValueInput("operand1").setCheck("Boolean").appendField("operand1"),this.appendValueInput("operand2").setCheck("Boolean").appendField("operand2"),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.and=function(e){return[ci.valueToCode(e,"operand1",ci.ORDER_LOGICAL_AND)+" and "+ci.valueToCode(e,"operand2",ci.ORDER_LOGICAL_AND),ci.ORDER_LOGICAL_AND]},d.or={init:function(){this.appendDummyInput().appendField("Or"),this.appendValueInput("operand1").setCheck("Boolean").appendField("operand1"),this.appendValueInput("operand2").setCheck("Boolean").appendField("operand2"),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.or=function(e){return[ci.valueToCode(e,"operand1",ci.ORDER_LOGICAL_OR)+" or "+ci.valueToCode(e,"operand2",ci.ORDER_LOGICAL_OR),ci.ORDER_LOGICAL_OR]},d.not={init:function(){this.appendDummyInput().appendField("Not"),this.appendValueInput("operand").setCheck("Boolean").appendField("operand"),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.not=function(e){return["not "+ci.valueToCode(e,"operand",ci.ORDER_LOGICAL_NOT),ci.ORDER_LOGICAL_NOT]},d.comparison={init:function(){this.appendDummyInput().appendField("comparison"),this.appendValueInput("operand1").setCheck(["String","Integer","Double","Enum","Object","Boolean","Class"]).appendField("operand1"),this.appendDummyInput().appendField(new B([["greater","GREATER"],["less","LESS"],["equal","EQUAL"],["not equal","NOT_EQUAL"],["greater or equal","GE"],["less or equal","LE"]]),"operator"),this.appendValueInput("operand2").setCheck(["String","Integer","Double","Enum","Object","Boolean","Class"]).appendField("operand2"),this.setInputsInline(!1),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.comparison=function(e){var t=ci.valueToCode(e,"operand1",ci.ORDER_RELATIONAL),i=e.getFieldValue("operator"),n=ci.valueToCode(e,"operand2",ci.ORDER_RELATIONAL);return[t+" "+{GREATER:">",LESS:"<",EQUAL:"==",NOT_EQUAL:"!=",GE:">=",LE:"<="}[i]+" "+n,ci.ORDER_RELATIONAL]},d.three_digit_comparison={init:function(){this.appendDummyInput().appendField("three-digit comparison"),this.appendValueInput("operand1").setCheck(["String","Integer","Double","Enum","Object","Boolean","Class"]).appendField("operand1"),this.appendValueInput("operand2").setCheck(["String","Integer","Double","Enum","Object","Boolean","Class"]).appendField("operand2"),this.setOutput(!0,"Enum"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.three_digit_comparison=function(e){return[ci.valueToCode(e,"operand1",ci.ORDER_NONE)+".compare("+ci.valueToCode(e,"operand2",ci.ORDER_NONE)+")",ci.ORDER_ATOMIC]},d.quantifier_of_existence={init:function(){this.appendDummyInput().appendField("∃"),this.appendValueInput("definition_area").setCheck("Boolean").appendField("definition area"),this.appendValueInput("verification_condition").setCheck("Boolean").appendField("verification condition"),this.appendDummyInput().appendField(new H("type",ui),"type_var"),this.appendDummyInput().appendField(new H("var",ui),"name_var"),this.setInputsInline(!1),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.quantifier_of_existence=function(e){var t=ci.valueToCode(e,"definition_area",ci.ORDER_NONE),i=ci.valueToCode(e,"verification_condition",ci.ORDER_NONE);return["exist "+e.getFieldValue("type_var")+" "+e.getFieldValue("name_var")+" [ "+t+" ] { "+i+" }",ci.ORDER_ATOMIC]},d.quantifier_of_generality={init:function(){this.appendDummyInput().appendField("∀"),this.appendValueInput("definition_area").setCheck("Boolean").appendField("definition area"),this.appendValueInput("verification_condition").setCheck("Boolean").appendField("verification condition"),this.appendDummyInput().appendField(new H("type",ui),"type_var"),this.appendDummyInput().appendField(new H("var",ui),"name_var"),this.setInputsInline(!1),this.setOutput(!0,"Boolean"),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.quantifier_of_generality=function(e){var t=ci.valueToCode(e,"definition_area",ci.ORDER_NONE),i=ci.valueToCode(e,"verification_condition",ci.ORDER_NONE);return["forall "+e.getFieldValue("type_var")+" "+e.getFieldValue("name_var")+" [ "+t+" ] { "+i+" } ",ci.ORDER_ATOMIC]},d.ref_to_decision_tree_var={init:function(){this.appendDummyInput().appendField(new H("decision_tree_var",ui),"var_name"),this.setOutput(!0,["Object","VarObject"]),this.setColour(60),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.ref_to_decision_tree_var=function(e){return[e.getFieldValue("var_name"),ci.ORDER_ATOMIC]},d.variable={init:function(){this.appendDummyInput().appendField(new H("variable",ui),"var_name"),this.setOutput(!0,"Object"),this.setColour(45),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.variable=function(e){return["$"+e.getFieldValue("var_name"),ci.ORDER_ATOMIC]},d.enum={init:function(){this.appendDummyInput().appendField(new H("owner",ui),"owner_name"),this.appendDummyInput().appendField(new H("value",ui),"value"),this.setOutput(!0,"Enum"),this.setColour(0),this.setTooltip(""),this.setHelpUrl("")}},ci.forBlock.enum=function(e){return[e.getFieldValue("owner_name")+"::"+e.getFieldValue("value"),ci.ORDER_ATOMIC]},d.block={init:function(){this.itemCount_=2,this.appendDummyInput().appendField("Block"),this.appendValueInput("statement0").setCheck(["String","Integer","Double","Enum","Object","Boolean","Statement"]).appendField("statement0"),this.setInputsInline(!1),this.setMutator(new n.Mutator(["check_statement_item"])),this.setColour(240),this.setTooltip(""),this.setHelpUrl("")},mutationToDom:function(){const e=oi.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("check_statement_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("check_statement_item");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){let t=e.getInputTargetBlock("STACK");const i=[];for(;t&&!t.isInsertionMarker();)i.push(t.valueConnection_),t=t.nextConnection&&t.nextConnection.targetBlock();for(let e=0;e<this.itemCount_;e++){const t=this.getInput("statement"+e).connection.targetConnection;t&&-1===i.indexOf(t)&&t.disconnect()}this.itemCount_=i.length,this.updateShape_();for(let e=0;e<this.itemCount_;e++)n.Mutator.reconnect(i[e],this,"statement"+e)},saveConnections:function(e){let t=e.getInputTargetBlock("STACK"),i=0;for(;t;){const e=this.getInput("statement"+i);t.valueConnection_=e&&e.connection.targetConnection,t=t.nextConnection&&t.nextConnection.targetBlock(),i++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField("statements");for(let e=0;e<this.itemCount_;e++)this.getInput("statement"+e)||this.appendValueInput("statement"+e).setCheck(["String","Integer","Double","Enum","Object","Boolean","Statement"]).appendField("statement"+e);for(let e=this.itemCount_;this.getInput("statement"+e);e++)this.removeInput("statement"+e)}},ci.forBlock.block=function(e){for(var t="{\n",i=0;i<e.itemCount_;i++){let n=ci.valueToCode(e,"statement"+i,ci.ORDER_NONE);n&&(t+=n+";\n")}return t+"}"},d.check_statement_item={init:function(){this.setColour(240),this.appendDummyInput().appendField("Statement"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(""),this.contextMenu=!1}},d.check_statement_container={init:function(){this.setColour(240),this.appendDummyInput().appendField("list statements"),this.appendStatementInput("STACK"),this.setTooltip(""),this.contextMenu=!1}};var vi=i(79),Ci=i(470);function _i(e){var t=e.editor.graph.getModel().cells;let i=[];return Object.keys(t).forEach((function(e){var n=t[e].value;"string"==typeof n&&n.startsWith('<font color="#000000"><b>Enum</b></font>')&&(n=n.replace('<font color="#000000"><b>Enum</b></font><br>',"")).split("<br>").forEach((e=>{var t=e.slice(e.indexOf('<font color="#ff66b3">')+22,e.indexOf("</font>")),n=(e=e.slice(e.indexOf("</font>")+7)).slice(e.indexOf('<font color="#ff6666">')+22,e.indexOf("</font>")).split(", "),o=(e=e.slice(e.indexOf("</font>")+7)).slice(e.indexOf('<font color="#123123">')+22,e.indexOf("</font>")),s="";"true"==o&&(s=(e=e.slice(e.indexOf("</font>")+7)).slice(e.indexOf('<font color="#fff123">')+22,e.indexOf("</font>")));var r={nameEnum:t,values:n,isLinear:o,nameRDF:s};i.push(r)}))})),i}function Ti(e){var t=e.editor.graph.getModel().cells;let i=[];return Object.keys(t).forEach((function(e){var n=t[e].value;if(n&&"object"==typeof n&&n.getAttribute("label").startsWith('<font color="#000000"><b>Classes</b></font>')){var o=n.getAttribute("label");(o=o.replace('<font color="#000000"><b>Classes</b></font><br>',"")).split("<br>").forEach(((e,t)=>{var o=e.slice(e.indexOf('<font color="#ff66b3">')+22,e.indexOf("</font>")),s="";-1!=(e=e.slice(e.indexOf("</font>")+7)).indexOf('(<font color="#ff66b3">')&&(s=e.slice(e.indexOf('(<font color="#ff66b3">')+23,e.indexOf("</font>)")),e=e.slice(e.indexOf("</font>)")+8));var r={name:o,extend:s,expression:n.getAttribute("expression_"+t)};i.push(r)}))}})),i}function wi(e){var t=e.editor.graph.getModel().cells;let i=[];return Object.keys(t).forEach((function(e){var n=t[e].value;"string"==typeof n&&n.startsWith('<b><font color="#000000">Class and Object properties</font></b>')&&(n=n.replace('<b><font color="#000000">Class and Object properties</font></b><br>',"")).split("<br>").forEach((e=>{var t=e.slice(e.indexOf('<font color="#')+22,e.indexOf("</font>"));let n=[];n=(e=e.slice(e.indexOf("</font>")+7)).slice(e.indexOf('(<font color="#fc49a4">')+23,e.indexOf("</font>")).split(", ");var o=(e=e.slice(e.indexOf("</font>)")+8)).slice(e.indexOf('<font color="#000000">')+22,e.indexOf("</font>"));e=e.slice(e.indexOf("</font>")+7);var s="";"Integer"!=o&&"Double"!=o||(s=e.slice(e.indexOf('<font color="#000000">: ')+24,e.indexOf("</font>")),e=e.slice(e.indexOf("</font>")+7));let r=(e=e.slice(e.indexOf('<font color="#19c3c0">isStatic:</font>')+38)).slice(e.indexOf('<font color="#000000">')+22,e.indexOf("</font>"));e=e.slice(e.indexOf("</font>")+7);var l={name:t,type:o,range:s,isStatic:r,classes:n};i.push(l)}))})),i}function Ii(e,t){e.isBlock||null==e.stmt?e.isBlock&&null!=e.block&&function(e,t){var i=new u(t,"block");i.initSvg(),i.itemCount_=0,i.render();for(var n=e.statementSeq.first;null!=n;){i.itemCount_++,i.updateShape_();let e=ki(n,t);i.getInput("statement"+(i.itemCount_-1)).connection.connect(e.outputConnection),n=n.next}}(e.block,t):ki(e.stmt,t)}function ki(e,t){if(null==e.secondExpr)return xi(e.firstExpr,t);if(null!=e.secondExpr&&e.firstExpr.type==Ci.ky.ID){(s=new u(t,"assign_value_to_variable_decision_tree")).initSvg(),s.render();var i=xi(e.firstExpr,t);Ni(s,i,"ref_to_object"),s.getInput("ref_to_object").connection.connect(i.outputConnection);var n=xi(e.secondExpr,t);return Ni(s,n,"new_object"),s.getInput("new_object").connection.connect(n.outputConnection),s}if(null!=e.secondExpr&&e.firstExpr.type==Ci.ky.PROPERTY){var s;(s=new u(t,"assign_value_to_property")).initSvg(),s.render();var r=xi(e.firstExpr.firstOperand,t);Ni(s,r,"object"),s.getInput("object").connection.connect(r.outputConnection);var l=new u(t,"property");l.initSvg(),l.render(),l.inputList[0].fieldRow[0].setValue(e.firstExpr.ident),Ni(s,l,"property"),s.getInput("property").connection.connect(l.outputConnection);var a=xi(e.secondExpr,t);return Ni(s,a,"new_value"),s.getInput("new_value").connection.connect(a.outputConnection),s}if(e.type==Ci.v2.ADD_RELATION){var c=new u(t,"add_relationship_to_object");c.initSvg(),c.itemCount_=0,c.render();let i=new u(t,"relationship");i.initSvg(),i.render(),i.inputList[0].fieldRow[0].setValue(e.ident),Ni(c,i,"relationship"),c.getInput("relationship").connection.connect(i.outputConnection),Ni(c,r=xi(e.firstExpr,t),"object"),c.getInput("object").connection.connect(r.outputConnection);for(var h=e.secondExpr.objectSeq.first;null!=h;){c.itemCount_++,c.updateShape_();let e=xi(h,t);Ni(c,e,"object"+(c.itemCount_-1)),c.getInput("object"+(c.itemCount_-1)).connection.connect(e.outputConnection),h=h.next}return c}if(null!=e.secondExpr&&e.firstExpr.type!=Ci.ky.PROPERTY&&e.firstExpr.type!=Ci.ky.ID&&e.type!=Ci.v2.ADD_RELATION)throw new Error(o("invalidAssign"))}function xi(e,t){switch(e.type){case Ci.ky.OBJ_VAR:return(f=new u(t,"object")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.ident),f;case Ci.ky.CLASS:return(s=new u(t,"class")).initSvg(),s.render(),s.inputList[0].fieldRow[0].setValue(e.ident),s;case Ci.ky.STRING:return(f=new u(t,"string")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.string),f;case Ci.ky.INT:return(f=new u(t,"integer")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.int),f;case Ci.ky.DOUBLE:return(f=new u(t,"double")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.double),f;case Ci.ky.BOOLEAN:return(f=new u(t,"boolean")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.boolean),f;case Ci.ky.ID:return(f=new u(t,"ref_to_decision_tree_var")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.ident),f;case Ci.ky.VAR:return(f=new u(t,"variable")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.ident),f;case Ci.ky.ENUM:return(f=new u(t,"enum")).initSvg(),f.render(),f.inputList[0].fieldRow[0].setValue(e.ident),f.inputList[1].fieldRow[0].setValue(e.identValue),f;case Ci.ky.GET_BY_RELATIONSHIP:(f=new u(t,"get_relationship_object")).initSvg(),f.render();var i=new u(t,"relationship");i.initSvg(),i.render(),i.inputList[0].fieldRow[0].setValue(e.rel),Ni(f,i,"relationship"),f.getInput("relationship").connection.connect(i.outputConnection);var n=xi(e.firstOperand,t);return Ni(f,n,"object"),f.getInput("object").connection.connect(n.outputConnection),f;case Ci.ky.PROPERTY:(f=new u(t,"get_property_value")).initSvg(),f.render();var o=new u(t,"property");return o.initSvg(),o.render(),o.inputList[0].fieldRow[0].setValue(e.ident),Ni(f,o,"property"),f.getInput("property").connection.connect(o.outputConnection),Ni(f,n=xi(e.firstOperand,t),"object"),f.getInput("object").connection.connect(n.outputConnection),f;case Ci.ky.IS:if((f=new u(t,"check_object_class")).initSvg(),f.render(),Ni(f,n=xi(e.firstOperand,t),"object"),f.getInput("object").connection.connect(n.outputConnection),e.secondOperand.type==Ci.ky.CLASS)(s=new u(t,"class")).initSvg(),s.render(),s.inputList[0].fieldRow[0].setValue(e.secondOperand.ident);else var s=xi(e.secondOperand,t);return Ni(f,s,"class"),f.getInput("class").connection.connect(s.outputConnection),f;case Ci.ky.GREATER:(f=new u(t,"comparison")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue("GREATER");var r=xi(e.firstOperand,t);Ni(f,r,"operand1"),f.getInput("operand1").connection.connect(r.outputConnection);var l=xi(e.secondOperand,t);return Ni(f,l,"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.LESS:return(f=new u(t,"comparison")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue("LESS"),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.EQUAL:return(f=new u(t,"comparison")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue("EQUAL"),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.NOT_EQUAL:return(f=new u(t,"comparison")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue("NOT_EQUAL"),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.GE:return(f=new u(t,"comparison")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue("GE"),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.LE:return(f=new u(t,"comparison")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue("LE"),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.COMPARE:return(f=new u(t,"three_digit_comparison")).initSvg(),f.render(),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.AND:return(f=new u(t,"and")).initSvg(),f.render(),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.OR:return(f=new u(t,"or")).initSvg(),f.render(),Ni(f,r=xi(e.firstOperand,t),"operand1"),f.getInput("operand1").connection.connect(r.outputConnection),Ni(f,l=xi(e.secondOperand,t),"operand2"),f.getInput("operand2").connection.connect(l.outputConnection),f;case Ci.ky.NOT:(f=new u(t,"not")).initSvg(),f.render();var a=xi(e.firstOperand,t);return Ni(f,a,"operand"),f.getInput("operand").connection.connect(a.outputConnection),f;case Ci.ky.CHECK_REL:(f=new u(t,"check_relationship")).initSvg(),f.itemCount_=0,f.render(),(i=new u(t,"relationship")).initSvg(),i.render(),i.inputList[0].fieldRow[0].setValue(e.rel),Ni(f,i,"relationship"),f.getInput("relationship").connection.connect(i.outputConnection),Ni(f,n=xi(e.firstOperand,t),"object"),f.getInput("object").connection.connect(n.outputConnection);for(var c=e.objectSeq.first;null!=c;){f.itemCount_++,f.updateShape_();var h=xi(c,t);Ni(f,h,"object"+(f.itemCount_-1)),f.getInput("object"+(f.itemCount_-1)).connection.connect(h.outputConnection),c=c.next}return f;case Ci.ky.GET_CLASS:return(f=new u(t,"get_class")).initSvg(),f.render(),Ni(f,n=xi(e.firstOperand,t),"object"),f.getInput("object").connection.connect(n.outputConnection),f;case Ci.ky.FIND:(f=new u(t,"get_condition_object")).initSvg(),f.render(),f.inputList[2].fieldRow[0].setValue(e.typeIdent),f.inputList[3].fieldRow[0].setValue(e.ident);var d=xi(e.firstOperand,t);return Ni(f,d,"condition"),f.getInput("condition").connection.connect(d.outputConnection),f;case Ci.ky.FIND_EXTREM:(f=new u(t,"get_extr_object")).initSvg(),f.render(),f.inputList[1].fieldRow[0].setValue(e.extremeIdent),f.inputList[3].fieldRow[0].setValue(e.typeIdent),f.inputList[4].fieldRow[0].setValue(e.ident);var p=xi(e.firstOperand,t);return Ni(f,p,"extreme_condition"),f.getInput("extreme_condition").connection.connect(p.outputConnection),Ni(f,d=xi(e.secondOperand,t),"general_condition"),f.getInput("general_condition").connection.connect(d.outputConnection),f;case Ci.ky.EXIST:(f=new u(t,"quantifier_of_existence")).initSvg(),f.render(),f.inputList[3].fieldRow[0].setValue(e.typeIdent),f.inputList[4].fieldRow[0].setValue(e.ident);var g=xi(e.firstOperand,t);Ni(f,g,"definition_area"),f.getInput("definition_area").connection.connect(g.outputConnection);var m=xi(e.secondOperand,t);return Ni(f,m,"verification_condition"),f.getInput("verification_condition").connection.connect(m.outputConnection),f;case Ci.ky.FORALL:return(f=new u(t,"quantifier_of_generality")).initSvg(),f.render(),f.inputList[3].fieldRow[0].setValue(e.typeIdent),f.inputList[4].fieldRow[0].setValue(e.ident),Ni(f,g=xi(e.firstOperand,t),"definition_area"),f.getInput("definition_area").connection.connect(g.outputConnection),Ni(f,m=xi(e.secondOperand,t),"verification_condition"),f.getInput("verification_condition").connection.connect(m.outputConnection),f;case Ci.ky.CAST:return(f=new u(t,"cast_object_to_class")).initSvg(),f.render(),Ni(f,n=xi(e.firstOperand,t),"object"),f.getInput("object").connection.connect(n.outputConnection),e.cast.type==Ci.ky.CLASS?((s=new u(t,"class")).initSvg(),s.render(),s.inputList[0].fieldRow[0].setValue(e.cast.ident)):s=xi(e.cast,t),Ni(f,s,"class"),f.getInput("class").connection.connect(s.outputConnection),f;case Ci.ky.IF:(f=new u(t,"if_then_stmt")).initSvg(),f.render(),Ni(f,d=xi(e.firstOperand,t),"condition"),f.getInput("condition").connection.connect(d.outputConnection);var b=xi(e.secondOperand,t);return Ni(f,b,"body"),f.getInput("body").connection.connect(b.outputConnection),f;case Ci.ky.WITH:var f;(f=new u(t,"with_stmt")).initSvg(),f.render(),f.inputList[1].fieldRow[0].setValue(e.ident);var E=xi(e.firstOperand,t);return Ni(f,E,"expression"),f.getInput("expression").connection.connect(E.outputConnection),Ni(f,b=xi(e.secondOperand,t),"body"),f.getInput("body").connection.connect(b.outputConnection),f}}function Ni(e,t,i){let n=t.outputConnection.getCheck(),s=e.getInput(i).connection.getCheck();if(0==n.filter((e=>s.includes(e))).length)throw new Error(o("InvalidType").replace("%type",e.type).replace("%inputCheck",s).replace("%outputCheck",n))}function Si(e,t){return e.clear(),vi.K.parse(t),Ii(vi.z,e),function(e){let t=ht.workspaceToDom(e),i=(o=Ai,(new DOMParser).parseFromString(o,"application/xml")),n=new XSLTProcessor;var o;n.importStylesheet(i);let s=n.transformToFragment(t,document);return(new XMLSerializer).serializeToString(s).replace(/(?<=>)[\s]+(?=<)/g,"")}(e)}const Ai='<?xml version="1.0"?>\n<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">\n\n    <xsl:output method="xml" indent="yes"/>\n\n    <xsl:template match="block[@type=\'object\']">\n        <Object>\n        <xsl:attribute name="name">\n            <xsl:value-of select="field[@name=\'object_name\']" />\n        </xsl:attribute>\n        </Object>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'class\']">\n        <Class>\n        <xsl:attribute name="name">\n            <xsl:value-of select="field[@name=\'class_name\']" />\n        </xsl:attribute>\n        </Class>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'property\']">\n        <Property>\n        <xsl:attribute name="name">\n            <xsl:value-of select="field[@name=\'property_name\']" />\n        </xsl:attribute>\n        </Property>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'relationship\']">\n        <Relationship>\n        <xsl:attribute name="name">\n            <xsl:value-of select="field[@name=\'relationship_name\']" />\n        </xsl:attribute>\n        </Relationship>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'string\']">\n        <String>\n            <xsl:attribute name="value">\n                <xsl:value-of select="field[@name=\'value\']" />\n            </xsl:attribute>\n        </String>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'boolean\']">\n        <Boolean>\n            <xsl:attribute name="value">\n                <xsl:value-of select="field[@name=\'value\']" />\n            </xsl:attribute>\n        </Boolean>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'integer\']">\n        <Integer>\n            <xsl:attribute name="value">\n                <xsl:value-of select="field[@name=\'value\']" />\n            </xsl:attribute>\n        </Integer>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'double\']">\n        <Double>\n            <xsl:attribute name="value">\n                <xsl:value-of select="field[@name=\'value\']" />\n            </xsl:attribute>\n        </Double>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'enum\']">\n        <Enum>\n            <xsl:attribute name="owner">\n                <xsl:value-of select="field[@name=\'owner_name\']" />\n            </xsl:attribute>\n            <xsl:attribute name="value">\n                <xsl:value-of select="field[@name=\'value\']" />\n            </xsl:attribute>\n        </Enum>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'ref_to_decision_tree_var\']">\n        <DecisionTreeVar>\n            <xsl:attribute name="name">\n                <xsl:value-of select="field[@name=\'var_name\']" />\n            </xsl:attribute>\n        </DecisionTreeVar>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'variable\']">\n        <Variable>\n            <xsl:attribute name="name">\n                <xsl:value-of select="field[@name=\'var_name\']" />\n            </xsl:attribute>\n        </Variable>\n    </xsl:template>\n\n\n\n    <xsl:template match="block[@type=\'get_class\']">\n        <GetClass>\n            <xsl:apply-templates/>\n        </GetClass>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'get_property_value\']">\n        <GetPropertyValue>\n            <xsl:apply-templates/>\n        </GetPropertyValue>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'get_relationship_object\']">\n        <GetByRelationship>\n            <xsl:attribute name="varName">\n                <xsl:value-of select="field[@name=\'name_var\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'object\']" />\n            <xsl:apply-templates select="value[@name=\'relationship\']" />\n            <xsl:apply-templates select="value[@name=\'boolean\']" />\n        </GetByRelationship>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'get_condition_object\']">\n        <GetByCondition>\n            <xsl:attribute name="type">\n                <xsl:value-of select="field[@name=\'type_var\']" />\n            </xsl:attribute>\n            <xsl:attribute name="varName">\n                <xsl:value-of select="field[@name=\'name_var\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'condition\']" />\n        </GetByCondition>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'if_then_stmt\']">\n        <IfThen>\n            <xsl:apply-templates select="value[@name=\'condition\']" />\n            <xsl:apply-templates select="value[@name=\'body\']" />\n        </IfThen>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'with_stmt\']">\n        <With>\n            <xsl:attribute name="varName">\n                <xsl:value-of select="field[@name=\'name_var\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'expression\']" />\n            <xsl:apply-templates select="value[@name=\'body\']" />\n        </With>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'get_extr_object\']">\n        <GetExtreme>\n            <xsl:attribute name="extremeVarName">\n                <xsl:value-of select="field[@name=\'name_var1\']" />\n            </xsl:attribute>\n            <xsl:attribute name="type">\n                <xsl:value-of select="field[@name=\'type_var2\']" />\n            </xsl:attribute>\n            <xsl:attribute name="varName">\n                <xsl:value-of select="field[@name=\'name_var2\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'extreme_condition\']" />\n            <xsl:apply-templates select="value[@name=\'general_condition\']" />\n        </GetExtreme>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'assign_value_to_property\']">\n        <AssignToProperty>\n            <xsl:apply-templates select="value[@name=\'object\']" />\n            <xsl:apply-templates select="value[@name=\'property\']" />\n            <xsl:apply-templates select="value[@name=\'new_value\']" />\n        </AssignToProperty>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'assign_value_to_variable_decision_tree\']">\n        <AssignToDecisionTreeVar>\n            <xsl:apply-templates select="value[@name=\'ref_to_object\']" />\n            <xsl:apply-templates select="value[@name=\'new_object\']" />\n        </AssignToDecisionTreeVar>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'add_relationship_to_object\']">\n        <AddRelationshipLink>\n            <xsl:apply-templates select="value" />\n        </AddRelationshipLink>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'cast_object_to_class\']">\n        <Cast>\n            <xsl:apply-templates select="value[@name=\'object\']" />\n            <xsl:apply-templates select="value[@name=\'class\']" />\n        </Cast>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'check_object_class\']">\n        <CheckClass>\n            <xsl:apply-templates select="value[@name=\'object\']" />\n            <xsl:apply-templates select="value[@name=\'class\']" />\n        </CheckClass>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'check_relationship\']">\n        <CheckRelationship>\n            <xsl:apply-templates select="value" />\n        </CheckRelationship>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'and\']">\n        <LogicalAnd>\n            <xsl:apply-templates select="value[@name=\'operand1\']" />\n            <xsl:apply-templates select="value[@name=\'operand2\']" />\n        </LogicalAnd>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'or\']">\n        <LogicalOr>\n            <xsl:apply-templates select="value[@name=\'operand1\']" />\n            <xsl:apply-templates select="value[@name=\'operand2\']" />\n        </LogicalOr>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'not\']">\n        <LogicalNot>\n            <xsl:apply-templates select="value[@name=\'operand\']" />\n        </LogicalNot>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'comparison\']">\n        <Compare>\n            <xsl:attribute name="operator">\n                <xsl:value-of select="field[@name=\'operator\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'operand1\']" />\n            <xsl:apply-templates select="value[@name=\'operand2\']" />\n        </Compare>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'three_digit_comparison\']">\n        <Compare>\n            <xsl:apply-templates select="value[@name=\'operand1\']" />\n            <xsl:apply-templates select="value[@name=\'operand2\']" />\n        </Compare>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'quantifier_of_existence\']">\n        <ExistenceQuantifier>\n            <xsl:attribute name="type">\n                <xsl:value-of select="field[@name=\'type_var\']" />\n            </xsl:attribute>\n            <xsl:attribute name="varName">\n                <xsl:value-of select="field[@name=\'name_var\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'definition_area\']" />\n            <xsl:apply-templates select="value[@name=\'verification_condition\']" />\n        </ExistenceQuantifier>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'quantifier_of_generality\']">\n        <ForAllQuantifier>\n            <xsl:attribute name="type">\n                <xsl:value-of select="field[@name=\'type_var\']" />\n            </xsl:attribute>\n            <xsl:attribute name="varName">\n                <xsl:value-of select="field[@name=\'name_var\']" />\n            </xsl:attribute>\n            <xsl:apply-templates select="value[@name=\'definition_area\']" />\n            <xsl:apply-templates select="value[@name=\'verification_condition\']" />\n        </ForAllQuantifier>\n    </xsl:template>\n\n    <xsl:template match="block[@type=\'block\']">\n        <Block>\n            <xsl:apply-templates select="value" />\n        </Block>\n    </xsl:template>\n\n</xsl:stylesheet>';var Ri;function $i(e,t,i){let n=null;return"rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;editable=0;"==t.style?n=Oi(e,t,!0):"rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;editable=0;"==t.style?n=Oi(e,t,!1):"ellipse;whiteSpace=wrap;html=1;rounded=0;editable=0;"==t.style?n=Di(e,t,!1,i):"rhombus;whiteSpace=wrap;html=1;editable=0;"==t.style?n=Di(e,t,!0,i):"rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;editable=0;"==t.style?n=function(e,t,i){let n=e.createElement("FindActionNode");n.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&n.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&n.setAttribute("_alias",t.value.getAttribute("label")),n=Fi(n,t,!1);let o=e.createElement("Expression");try{o.innerHTML=Si(Zn,t.value.getAttribute("expression"))}catch(e){throw new Error(e.message+"\nУзел с текстом: "+t.value.getAttribute("label"))}n.appendChild(o);let s=t.value.getAttribute("typeVar"),r=e.createElement("DecisionTreeVarDecl");return r.setAttribute("name",zi(t.value.getAttribute("nameVar"))),r.setAttribute("type",zi(s)),n.appendChild(r),n=Mi(e,n,t,i),n}(e,t,i):"object"!=typeof t.value||"AND"!=t.value.getAttribute("type")&&"OR"!=t.value.getAttribute("type")&&"HYP"!=t.value.getAttribute("type")?"object"==typeof t.value&&"predetermining"==t.value.getAttribute("type")?n=function(e,t,i){let n=e.createElement("BranchAggregationNode");if(n.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&n.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&n.setAttribute("_alias",t.value.getAttribute("label")),n.setAttribute("operator","MUTEX"),n=Fi(n,t,!1),t.edges)for(let s=0;s<t.edges.length;s++)if(t.edges[s].target!=t){let r=t.edges[s].value;if(null==r||"object"!=typeof r||!r.getAttribute("type")||"Correct"!=r.getAttribute("type")&&"Error"!=r.getAttribute("type")&&"Null"!=r.getAttribute("type")&&"Branch"!=r.getAttribute("type"))throw Li(i.editor.graph,t.edges[s]),new Error(o("typeOutcomeLogicNodeIsMissing")+"\nУзел с текстом: "+t.value.getAttribute("label"));if("Correct"==r.getAttribute("type")||"Error"==r.getAttribute("type")||"Null"==r.getAttribute("type")){let o=e.createElement("Outcome");o.setAttribute("value",zi(r.getAttribute("type"))),o=Pi(o,t.edges[s]),o.appendChild($i(e,t.edges[s].target,i)),n.appendChild(o)}else if("Branch"==r.getAttribute("type")){let o=e.createElement("ThoughtBranch");o.setAttribute("_alias",r.getAttribute("label")),o.setAttribute("type","bool"),o=Bi(o,t.edges[s]),o.appendChild($i(e,t.edges[s].target,i)),n.appendChild(o)}}return n}(e,t,i):"object"!=typeof t.value||"AND"!=t.value.getAttribute("operator")&&"OR"!=t.value.getAttribute("operator")&&"HYP"!=t.value.getAttribute("type")||"while"!=t.value.getAttribute("typeCycle")?"object"!=typeof t.value||"AND"!=t.value.getAttribute("operator")&&"OR"!=t.value.getAttribute("operator")&&"HYP"!=t.value.getAttribute("type")||null!=t.value.getAttribute("typeCycle")?"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;"==t.style&&(n=Oi(e,t,null)):n=function(e,t,i){let n=e.createElement("CycleAggregationNode");n.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&n.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&n.setAttribute("_alias",t.value.getAttribute("label")),n.setAttribute("operator",t.value.getAttribute("operator")),n=Fi(n,t,!1);let s=e.createElement("SelectorExpression");try{s.innerHTML=Si(Zn,t.value.getAttribute("expression"))}catch(e){throw new Error(e.message+"\nУзел с текстом: "+t.value.getAttribute("label"))}n.appendChild(s);let r=t.value.getAttribute("typeVar"),l=e.createElement("DecisionTreeVarDecl");l.setAttribute("name",zi(t.value.getAttribute("nameVar"))),l.setAttribute("type",zi(r)),n.appendChild(l);let a=0;if(t.edges)for(let s=0;s<t.edges.length;s++)if(t.edges[s].target!=t){let r=t.edges[s].value;if(null==r||"object"!=typeof r||!r.getAttribute("type")||"Correct"!=r.getAttribute("type")&&"Error"!=r.getAttribute("type")&&"Null"!=r.getAttribute("type")&&"Body"!=r.getAttribute("type"))throw Li(i.editor.graph,t.edges[s]),new Error(o("typeOutcomeCycleIsMissing")+"\nУзел с текстом: "+t.value.getAttribute("label"));if("Correct"==r.getAttribute("type")||"Error"==r.getAttribute("type")||"Null"==r.getAttribute("type")){let o=e.createElement("Outcome");o.setAttribute("value",zi(r.getAttribute("type"))),o=Pi(o,t.edges[s]),o.appendChild($i(e,t.edges[s].target,i)),n.appendChild(o)}else if("Body"==r.getAttribute("type")){let o=e.createElement("ThoughtBranch");o.setAttribute("_alias",r.getAttribute("label")),o.setAttribute("type","bool"),o.setAttribute("paramName",zi(t.value.getAttribute("nameVar"))),o=Bi(o,t.edges[s]),o.appendChild($i(e,t.edges[s].target,i)),n.appendChild(o),a++}}let c="";if(a>1&&(c+=o("bodyOnlyOne")),c)throw new Error(c+"\nУзел с текстом: "+t.value.getAttribute("label"));return n}(e,t,i):n=function(e,t,i){let n=e.createElement("WhileCycleNode");n.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&n.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&n.setAttribute("_alias",t.value.getAttribute("label")),n.setAttribute("operator",t.value.getAttribute("operator")),n=Fi(n,t,!1);let s=e.createElement("SelectorExpression");try{s.innerHTML=Si(Zn,t.value.getAttribute("expression"))}catch(e){throw new Error(e.message+"\nУзел с текстом: "+t.value.getAttribute("label"))}n.appendChild(s);let r=t.value.getAttribute("typeVar"),l=e.createElement("DecisionTreeVarDecl");l.setAttribute("name",zi(t.value.getAttribute("nameVar"))),l.setAttribute("type",zi(r)),n.appendChild(l);let a=0;if(t.edges)for(let s=0;s<t.edges.length;s++)if(t.edges[s].target!=t){let r=t.edges[s].value;if(null==r||"object"!=typeof r||!r.getAttribute("type")||"Correct"!=r.getAttribute("type")&&"Error"!=r.getAttribute("type")&&"Null"!=r.getAttribute("type")&&"Body"!=r.getAttribute("type"))throw Li(i.editor.graph,t.edges[s]),new Error(o("typeOutcomeCycleIsMissing")+"\nУзел с текстом: "+t.value.getAttribute("label"));if("Correct"==r.getAttribute("type")||"Error"==r.getAttribute("type")||"Null"==r.getAttribute("type")){let o=e.createElement("Outcome");o.setAttribute("value",zi(r.getAttribute("type"))),o=Pi(o,t.edges[s]),o.appendChild($i(e,t.edges[s].target,i)),n.appendChild(o)}else if("Body"==r.getAttribute("type")){let o=e.createElement("ThoughtBranch");o.setAttribute("_alias",r.getAttribute("label")),o.setAttribute("type","bool"),o.setAttribute("paramName",zi(t.value.getAttribute("nameVar"))),o=Bi(o,t.edges[s]),o.appendChild($i(e,t.edges[s].target,i)),n.appendChild(o),a++}}let c="";if(a>1&&(c+=o("bodyOnlyOne")),c)throw new Error(c+"\nУзел с текстом: "+t.value.getAttribute("label"));return n}(e,t,i):n=function(e,t,i){let n=e.createElement("BranchAggregationNode");n.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&n.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&n.setAttribute("_alias",t.value.getAttribute("label")),n.setAttribute("operator",t.value.getAttribute("type").toLowerCase()),n=Fi(n,t,!0);let s=0;if(t.edges)for(let r=0;r<t.edges.length;r++)if(t.edges[r].target!=t){let l=t.edges[r].value;if(null==l||"object"!=typeof l||!l.getAttribute("type")||"Correct"!=l.getAttribute("type")&&"Error"!=l.getAttribute("type")&&"Null"!=l.getAttribute("type")&&"Branch"!=l.getAttribute("type"))throw Li(i.editor.graph,t.edges[r]),new Error(o("typeOutcomeLogicNodeIsMissing")+"\nУзел с текстом: "+t.value.getAttribute("label"));if("Correct"==l.getAttribute("type")||"Error"==l.getAttribute("type")||"Null"==l.getAttribute("type")){let o=e.createElement("Outcome");o.setAttribute("value",zi(l.getAttribute("type"))),o=Pi(o,t.edges[r]),o.appendChild($i(e,t.edges[r].target,i)),n.appendChild(o)}else if("Branch"==l.getAttribute("type")){let o=e.createElement("ThoughtBranch");o.setAttribute("_alias",l.getAttribute("label")),o.setAttribute("type","bool"),o=Bi(o,t.edges[r]),o.appendChild($i(e,t.edges[r].target,i)),n.appendChild(o),s++}}let r="";if(s<2&&(r+=o("OutcomeLogicNodeOnlyTwo")),r)throw new Error(r+"\nУзел с текстом: "+t.value.getAttribute("label"));return n}(e,t,i),n}function Oi(e,t,i){let n=e.createElement("BranchResultNode");if(n.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&n.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&(n.setAttribute("_alias",t.value.getAttribute("label")),n.setAttribute("_RU_explanation",t.value.getAttribute("label"))),null==i?n.setAttribute("value","null"):i?n.setAttribute("value","correct"):n.setAttribute("value","error"),""!=t.value.getAttribute("expression")){let i=e.createElement("Expression");try{i.innerHTML=Si(Zn,t.value.getAttribute("expression"))}catch(e){throw new Error(e.message+"\nУзел с текстом: "+t.value.getAttribute("label"))}n.appendChild(i)}return n}function Di(e,t,i,n){let o=e.createElement("QuestionNode");o.setAttribute("_id",Ri++),t.value.getAttribute("skill")&&o.setAttribute("_skill",t.value.getAttribute("skill")),t.value.getAttribute("label")&&o.setAttribute("_alias",t.value.getAttribute("label"));try{o.setAttribute("type",zi(Hi(t.value.getAttribute("expression"),n).type))}catch(e){throw new Error(e.message+"\nУзел с текстом: "+t.value.getAttribute("label"))}o.setAttribute("isSwitch",i),o=Fi(o,t,!1);let s=e.createElement("Expression");try{s.innerHTML=Si(Zn,t.value.getAttribute("expression"))}catch(e){throw new Error(e.message+"\nУзел с текстом: "+t.value.getAttribute("label"))}return o.appendChild(s),o=Mi(e,o,t,n),o}function Mi(e,t,i,n){let s=new Set;if(i.edges)for(let r=0;r<i.edges.length;r++)if(i.edges[r].target!=i){let l,a=i.edges[r].value;if(null==a||"object"!=typeof a||!a.getAttribute("value"))throw Li(n.editor.graph,i.edges[r]),new Error(o("valueInOutcomeIsMissing")+"\nИсходит из узла с текстом: "+i.value.getAttribute("label"));try{l=Hi(i.value.getAttribute("expression"),n)}catch(e){throw new Error(e.message+"\nУзел с текстом: "+i.value.getAttribute("label")+"\nСтрелка с текстом: "+a.getAttribute("value"))}if(l.type==a.getAttribute("typeValue")){if("enum"==a.getAttribute("typeValue")){let e=_i(n).filter((e=>e.nameEnum==l.enum)),t=a.getAttribute("value").split(":");if(null==e[0])throw new Error(o("EnumIsMissing")+"\nИсходит из узла с текстом: "+i.value.getAttribute("label"));if(-1==e[0].values.indexOf(t[1]))throw Li(n.editor.graph,i.edges[r]),new Error(o("valueEnumIsMissing")+"\nИсходит из узла с текстом: "+i.value.getAttribute("label"))}else if("class"==a.getAttribute("typeValue")&&0==Ti(n).filter((e=>e.name==a.getAttribute("value"))).length)throw Li(n.editor.graph,i.edges[r]),new Error(o("ClassInDictIsMissing")+"\nИсходит из узла с текстом: "+i.value.getAttribute("label"))}else if(a.getAttribute("typeValue")&&l.type!=a.getAttribute("typeValue"))throw Li(n.editor.graph,i.edges[r]),new Error(o("TypesDontMatch")+"\nИсходит из узла с текстом: "+i.value.getAttribute("label"));if(s.has(a.getAttribute("value")))throw Li(n.editor.graph,i.edges[r]),new Error(o("OutcomesHasSameValues")+"\nИсходит из узла с текстом: "+i.value.getAttribute("label"));s.add(a.getAttribute("value"));let c=e.createElement("Outcome");c=Pi(c,i.edges[r]),c.setAttribute("value",zi(a.getAttribute("value"))),c.appendChild($i(e,i.edges[r].target,n)),t.appendChild(c)}return t}function Li(e,t){e.getModel().beginUpdate(),t.style.includes("strokeColor=#FF0000;")||(t.style+="strokeColor=#FF0000;"),e.getModel().endUpdate(),e.refresh()}function Bi(e,t){return t.value.getAttribute("_description")&&e.setAttribute("_RU_description",zi(t.value.getAttribute("_description"))),t.value.getAttribute("_nextStepQuestion")&&e.setAttribute("_RU_nextStepQuestion",zi(t.value.getAttribute("_nextStepQuestion"))),t.value.getAttribute("_nextStepExplanation")&&e.setAttribute("_RU_nextStepExplanation",zi(t.value.getAttribute("_nextStepExplanation"))),e}function Pi(e,t){return t.value.getAttribute("_text")&&e.setAttribute("_RU_text",zi(t.value.getAttribute("_text"))),t.value.getAttribute("_explanation")&&e.setAttribute("_RU_explanation",zi(t.value.getAttribute("_explanation"))),t.value.getAttribute("_nextStepBranchResult")&&e.setAttribute("_RU_nextStepBranchResult",zi(t.value.getAttribute("_nextStepBranchResult"))),t.value.getAttribute("_nextStepQuestion")&&e.setAttribute("_RU_nextStepQuestion",zi(t.value.getAttribute("_nextStepQuestion"))),t.value.getAttribute("_nextStepExplanation")&&e.setAttribute("_RU_nextStepExplanation",zi(t.value.getAttribute("_nextStepExplanation"))),e}function Fi(e,t,i){return i?t.value.getAttribute("_description")&&e.setAttribute("_RU_description",zi(t.value.getAttribute("_description"))):t.value.getAttribute("_question")&&e.setAttribute("_RU_question",zi(t.value.getAttribute("_question"))),t.value.getAttribute("_asNextStep")&&e.setAttribute("_RU_asNextStep",zi(t.value.getAttribute("_asNextStep"))),t.value.getAttribute("_endingCause")&&e.setAttribute("_RU_endingCause",zi(t.value.getAttribute("_endingCause"))),e}const Vi={OBJECT:"object",CLASS:"class",STRING:"string",BOOLEAN:"bool",INT:"int",DOUBLE:"double",COMPARISON_RESULT:"comparison",ENUM:"enum",ASSIGN:"assign",PROPERTY_VALUE:"propertyValue",BLOCK:"block"};function Ui(e){return e.isBlock&&e.block?Vi.BLOCK:!e.isBlock&&e.stmt?Ui(e.stmt):!e.secondExpr&&e.firstExpr?Ui(e.firstExpr):e.secondExpr&&e.firstExpr||e.type&&e.type==Ci.ky.IF||e.type&&e.type==Ci.ky.WITH?Vi.ASSIGN:e.type&&e.type==Ci.ky.STRING?Vi.STRING:e.type&&e.type==Ci.ky.INT?Vi.INT:e.type&&e.type==Ci.ky.DOUBLE?Vi.DOUBLE:e.type&&e.type==Ci.ky.ENUM?Vi.ENUM:!e.type||e.type!=Ci.ky.BOOLEAN&&e.type!=Ci.ky.IS&&e.type!=Ci.ky.CHECK_REL&&e.type!=Ci.ky.AND&&e.type!=Ci.ky.OR&&e.type!=Ci.ky.NOT&&e.type!=Ci.ky.GREATER&&e.type!=Ci.ky.LESS&&e.type!=Ci.ky.GE&&e.type!=Ci.ky.LE&&e.type!=Ci.ky.EQUAL&&e.type!=Ci.ky.NOT_EQUAL&&e.type!=Ci.ky.EXIST&&e.type!=Ci.ky.FORALL?!e.type||e.type!=Ci.ky.VAR&&e.type!=Ci.ky.ID&&e.type!=Ci.ky.GET_BY_RELATIONSHIP&&e.type!=Ci.ky.FIND&&e.type!=Ci.ky.FIND_EXTREM&&e.type!=Ci.ky.OBJ_VAR&&e.type!=Ci.ky.CAST?!e.type||e.type!=Ci.ky.GET_CLASS&&e.type!=Ci.ky.CLASS?e.type&&e.type==Ci.ky.PROPERTY?Vi.PROPERTY_VALUE:e.type&&e.type==Ci.ky.COMPARE?Vi.COMPARISON_RESULT:void alert("Error: "+e.type):Vi.CLASS:Vi.OBJECT:Vi.BOOLEAN}function Wi(e){if(e.getTopBlocks().length>1)throw new Error(o("moreBlocksInWorkspace"));let t=ci.workspaceToCode(e);return"\n"==t.slice(-1)&&(t=t.slice(0,-2)),t}function Hi(e,t){vi.K.parse(e);let i={type:Ui(vi.z)};if(i.type==Vi.PROPERTY_VALUE){let e=vi.z.stmt.firstExpr.ident,n=wi(t).filter((t=>t.name==e));if(void 0===n[0])throw new Error(o("propertyIsMissingInDict").replace("%propertyName",e));i=n[0];let s=i.type;"Integer"!=s&&"Double"!=s&&"Boolean"!=s&&"String"!=s&&(i.enum=s.slice(6),s=s.slice(0,4)),"Integer"==s&&(s="int"),"Boolean"==s&&(s="bool"),i.type=s.toLowerCase()}else i.type==Vi.COMPARISON_RESULT?(i.enum="comparisonResult",i.type="enum"):i.type==Vi.ENUM&&vi.z.stmt.firstExpr.type==Ci.ky.ENUM&&(i.enum=vi.z.stmt.firstExpr.ident);return i}function Gi(e){return""==e?"":"True"==e?"Yes":"False"==e?"No":e}function zi(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function ji(e){return/^[a-zA-Z_][A-Za-z0-9_]*$/.test(e)}function Xi(e){let t=new Set(e);return Array.from(t).length==e.length}var Ki=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%",r.style.width="100%";var l=document.createElement("table");l=di(l);var a=document.createElement("tbody");a.style.height="100%";var c=Yi();a.appendChild(c),l.appendChild(a),r.appendChild(l);var h=mxUtils.button(o("Create"),(function(){Ji(l);for(var t=0;t<l.rows.length;t++){var i=l.rows.item(t).getElementsByTagName("td").item(2).getElementsByTagName("textarea").item(0).value;i&&vi.K.parse(i)}var n,s=e.editor.graph;if(n=s.getModel().cells,Object.keys(n).forEach((function(e){var t=n[e].value;if(t&&"object"==typeof t&&t.getAttribute("label").startsWith('<font color="#000000"><b>Classes</b></font>'))throw new Error(o("ClassExists"))})),s.isEnabled()&&!s.isCellLocked(s.getDefaultParent())){var r=s.getInsertPoint(),a=new mxCell("",new mxGeometry(r.x,r.y,267,17*(l.rows.length+1)),"shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fontColor=#6666FF;align=center;editable=0;");let e=qi(l);a.value=e,a.vertex=!0,s.setSelectionCell(s.addCell(a));for(let e=0;e<l.rows.length;e++){let t=l.rows.item(e).getElementsByTagName("td").item(2).getElementsByTagName("textarea").item(0).value;s.setAttributeForCell(a,"expression_"+e,t)}}g.destroy()})),u=mxUtils.button(o("AddClass"),(function(){var e=Yi(),t=document.createElement("td"),i=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));i=gi(i),t.appendChild(i),e.appendChild(t),a.appendChild(e)})),d=mxUtils.button(o("OpenBlockly"),(function(){var e=window.screen.width-400,t=window.screen.height-300,i=document.createElement("div"),n=document.createElement("div");n.id="classCreateBlocklyDiv",n.style.width=e+"px",n.style.height=.83*t+"px",i.appendChild(n);var s=document.createElement("div");s.style.width="100%";var r=document.createElement("input");(r=mi(r)).id="outputCode",s.appendChild(r),i.appendChild(s);var l=mxUtils.button(o("toСode"),(function(){let e=ci.workspaceToCode(h);r.value=e})),a=document.createElement("div");a=pi(a),(l=gi(l)).style.marginTop="5px",a.appendChild(l),i.appendChild(a);var c=new mxWindow("Blockly",i,document.body.offsetLeft+100,document.body.offsetTop+100,e,t,!0,!0);c.destroyOnClose=!0,c.setMaximizable(!1),c.setResizable(!1),c.setClosable(!0),c.setVisible(!0);var h=Ot("classCreateBlocklyDiv",{toolbox:hi})})),p=document.createElement("div");p=pi(p),u=gi(u),h=gi(h),d=gi(d),p.appendChild(u),p.appendChild(h),p.appendChild(d),r.appendChild(p);var g=new mxWindow(o("TitleClassConstructorWindow"),r,t,i,n,s,!0,!0);this.window=g,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)};function Yi(){var e=document.createElement("tr");e.style.width="100%";var t=document.createElement("td");t.style.width="25%";var i=document.createElement("input");i.type="text",(i=mi(i)).placeholder="Class name",t.appendChild(i);var n=document.createElement("td");n.style.width="25%";var o=document.createElement("input");o.type="text",(o=mi(o)).placeholder="Extend",n.appendChild(o);var s=document.createElement("td");s.style.width="25%";var r=document.createElement("textarea");return(r=mi(r)).style.resize="vertical",r.placeholder="Expression",s.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(s),e}function Ji(e){let t="",i=[];for(var n=0;n<e.rows.length;n++){let s=e.rows.item(n).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value;i.push(s);let r=e.rows.item(n).getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value;""==s?t+=o("nameIsMissing").replace("%i",n+1):ji(s)||(t+=o("nameIsIncorrect").replace("%i",n+1)),""==r||ji(r)||(t+=o("extendClassIsIncorrect").replace("%i",n+1))}if(0==i.length||Xi(i)||(t+=o("nonUniqueClassName")),""!=t)throw new Error(t)}function qi(e){let t='<font color="#000000"><b>Classes</b></font>';for(var i=0;i<e.rows.length;i++){var n=e.rows.item(i).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value,o=e.rows.item(i).getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value;t+='<br><font color="#ff66b3">'+n+"</font>",""!=o&&(t+=' (<font color="#ff66b3">'+o+"</font>)")}return t}var Qi=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%",l.style.width="100%";var a=document.createElement("table");a=di(a);var c=document.createElement("tbody");c.style.height="100%",function(e,t){let i=t.value;var n=i.getAttribute("label");(n=n.replace('<font color="#000000"><b>Classes</b></font><br>',"")).split("<br>").forEach(((t,n)=>{var s=t.slice(t.indexOf('<font color="#ff66b3">')+22,t.indexOf("</font>")),r="";-1!=(t=t.slice(t.indexOf("</font>")+7)).indexOf('(<font color="#ff66b3">')&&(r=t.slice(t.indexOf('(<font color="#ff66b3">')+23,t.indexOf("</font>)")),t=t.slice(t.indexOf("</font>)")+8));var l=i.getAttribute("expression_"+n),a=Yi();if(a.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value=s,a.getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value=r,a.getElementsByTagName("td").item(2).getElementsByTagName("textarea").item(0).value=l,0!=n){var c=document.createElement("td"),h=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));h=gi(h),c.appendChild(h),a.appendChild(c)}e.appendChild(a)}))}(c,e),a.appendChild(c),l.appendChild(a);var h=mxUtils.button(o("Apply"),(function(){Ji(a);for(var i=0;i<a.rows.length;i++){var n=a.rows.item(i).getElementsByTagName("td").item(2).getElementsByTagName("textarea").item(0).value;n&&vi.K.parse(n)}let o=qi(a);var s=t.editor.graph;s.getModel().beginUpdate(),e.geometry.height=17*(a.rows.length+1),e.value.setAttribute("label",o);for(let t=0;t<a.rows.length;t++){let i=a.rows.item(t).getElementsByTagName("td").item(2).getElementsByTagName("textarea").item(0).value;e.value.setAttribute("expression_"+t,i)}s.getModel().endUpdate(),s.refresh(),g.destroy()})),u=mxUtils.button(o("AddClass"),(function(){var e=Yi(),t=document.createElement("td"),i=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));i=gi(i),t.appendChild(i),e.appendChild(t),c.appendChild(e)})),d=mxUtils.button(o("OpenBlockly"),(function(){var e=document.createElement("div"),t=document.createElement("div");t.id="classUpdateBlocklyDiv",t.style.width="850px",t.style.height="500px",e.appendChild(t);var i=document.createElement("div");i.style.width="850px";var n=document.createElement("input");n.style.width="100%",n.id="outputCode",i.appendChild(n),e.appendChild(i);var s=mxUtils.button(o("toСode"),(function(){let e=ci.workspaceToCode(r);n.value=e}));e.appendChild(s),this.window2=new mxWindow("Blockly",e,(document.body.offsetWidth-880)/2,120,900,580,!0,!0),this.window2.destroyOnClose=!0,this.window2.setMaximizable(!1),this.window2.setResizable(!1),this.window2.setClosable(!0),this.window2.setVisible(!0);var r=Ot("classUpdateBlocklyDiv",{toolbox:hi})})),p=document.createElement("div");p=pi(p),u=gi(u),h=gi(h),d=gi(d),p.appendChild(u),p.appendChild(h),p.appendChild(d),l.appendChild(p);var g=new mxWindow(o("TitleClassEditorWindow"),l,i,n,s,r,!0,!0);this.window=g,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)},Zi=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("table");l=di(l);var a=document.createElement("tbody");a.style.height="100%";var c=en(e);a.appendChild(c),l.appendChild(a),r.appendChild(l);var h=mxUtils.button(o("Create"),(function(){tn(l);var t,i=e.editor.graph;if(t=i.getModel().cells,Object.keys(t).forEach((function(e){var i=t[e].value;if("string"==typeof i&&i.startsWith('<b><font color="#000000">Class and Object properties</font></b>'))throw new Error(o("PropertyExists"))})),i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),s=new mxCell("",new mxGeometry(n.x,n.y,267,17*(l.rows.length+1)),"shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fontColor=#00CCCC;align=center;editable=0;");let e=nn(l);s.value=e,s.vertex=!0,i.setSelectionCell(i.addCell(s))}p.destroy()})),u=mxUtils.button(o("AddPropertyClass"),(function(){var t=en(e),i=document.createElement("td");i.classList="delete";var n=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));n=gi(n),i.appendChild(n),t.appendChild(i),a.appendChild(t)})),d=document.createElement("div");d=pi(d),h=gi(h),u=gi(u),d.appendChild(u),d.appendChild(h),r.appendChild(d);var p=new mxWindow(o("TitleClassPropertiesConstructorWindow"),r,t,i,n,s,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)};function en(e){var t=document.createElement("tr"),i=document.createElement("td");i.style.minWidth="200px";var n=document.createElement("input");n.type="text",n.placeholder="Name",n=mi(n),i.appendChild(n),t.appendChild(i);var o=document.createElement("td");o.style.minWidth="150px";var s=document.createElement("select");s=bi(s);var r=["Integer","Double","Boolean","String"];_i(e).forEach((e=>{r.push("enum: "+e.nameEnum)})),r.forEach((e=>{var t=new Option(e,e);s.options[s.options.length]=t})),s.addEventListener("change",(e=>{if("Integer"==e.currentTarget.value||"Double"==e.currentTarget.value){if("range"!=e.currentTarget.parentElement.nextElementSibling.classList){var t=document.createElement("td");t.style.minWidth="200px",t.classList="range";var i=document.createElement("input");i.type="number",i.placeholder="0",(i=mi(i)).style.width="45%",t.appendChild(i);var n=document.createElement("span");n.innerText="-",(n=fi(n)).style.width="30%",t.appendChild(n);var o=document.createElement("input");o.type="number",o.placeholder="9",(o=mi(o)).style.width="45%",t.appendChild(o),e.currentTarget.parentElement.parentElement.insertBefore(t,e.currentTarget.parentElement.nextElementSibling)}}else"range"==e.currentTarget.parentElement.nextElementSibling.classList&&e.currentTarget.parentElement.nextElementSibling.remove()})),o.appendChild(s);var l=document.createElement("td");l.style.minWidth="200px",l.classList="range";var a=document.createElement("input");a.type="number",a.placeholder="0",(a=mi(a)).style.width="45%",l.appendChild(a);var c=document.createElement("span");c.innerText="-",(c=fi(c)).style.width="30%",l.appendChild(c);var h=document.createElement("input");h.type="number",h.placeholder="9",(h=mi(h)).style.width="45%",l.appendChild(h),t.appendChild(o),t.appendChild(l);var u=document.createElement("td");u.style.minWidth="120px";var d=document.createElement("span");(d=fi(d)).innerText="is static";var p=document.createElement("input");p.type="checkbox",u.appendChild(d),u.appendChild(p),t.appendChild(u);var g=document.createElement("td");g.style.minWidth="150px";var m=document.createElement("select");m=bi(m),Ti(e).forEach((e=>{var t=new Option(e.name,e.name);m.options[m.options.length]=t})),g.appendChild(m);var b=document.createElement("td");b.style.minWidth="50px";var f=mxUtils.button("+",(function(t){let i=document.createElement("td");i.style.minWidth="200px";var n=document.createElement("select");(n=bi(n)).style.marginRight="4px",n.style.width="85%",n.style.float="left",Ti(e).forEach((e=>{var t=new Option(e.name,e.name);n.options[n.options.length]=t}));var o=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(o=gi(o)).style.float="left",o.style.width="10%",i.appendChild(n),i.appendChild(o),t.target.parentElement.parentElement.insertBefore(i,t.target.parentElement)}));return f=gi(f),b.appendChild(f),t.appendChild(g),t.appendChild(b),t}function tn(e){let t="",i=[];for(var n=0;n<e.rows.length;n++){let l=e.rows.item(n).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value;i.push(l),""==l?t+=o("nameIsMissing").replace("%i",n+1):ji(l)||(t+=o("nameIsIncorrect").replace("%i",n+1));var s=e.rows.item(n).getElementsByTagName("td").item(1).getElementsByTagName("select").item(0),r=s.options[s.options.selectedIndex].value;let a=2;"Integer"!=r&&"Double"!=r||(""==e.rows.item(n).getElementsByTagName("td").item(a).getElementsByTagName("input").item(0).value&&(t+=o("startValueIsMissing").replace("%i",n+1)),""==e.rows.item(n).getElementsByTagName("td").item(a).getElementsByTagName("input").item(1).value&&(t+=o("endValueIsMissing").replace("%i",n+1)),a++),a++;let c=e.rows.item(n).getElementsByTagName("td").item(a).getElementsByTagName("select").item(0);for(;null!=c;){if(void 0===c.options[c.options.selectedIndex]){t+=o("classesIsMissing").replace("%i",n+1);break}a++,c=e.rows.item(n).getElementsByTagName("td").item(a).getElementsByTagName("select").item(0)}}if(0==i.length||Xi(i)||(t+=o("nonUniquePropertyName")),""!=t)throw new Error(t)}function nn(e){let t='<b><font color="#000000">Class and Object properties</font></b>';for(var i=0;i<e.rows.length;i++){var n=e.rows.item(i).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value,o=e.rows.item(i).getElementsByTagName("td").item(1).getElementsByTagName("select").item(0),s=o.options[o.options.selectedIndex].value;let u=2;if("Integer"==s||"Double"==s){var r=e.rows.item(i).getElementsByTagName("td").item(u).getElementsByTagName("input").item(0).value,l=e.rows.item(i).getElementsByTagName("td").item(u).getElementsByTagName("input").item(1).value;u++}var a=e.rows.item(i).getElementsByTagName("td").item(u).getElementsByTagName("input").item(0).checked;u++;var c=[],h=e.rows.item(i).getElementsByTagName("td").item(u).getElementsByTagName("select").item(0);c[0]=h.options[h.options.selectedIndex].value,u++;let d=e.rows.item(i).getElementsByTagName("td").item(u).getElementsByTagName("select").item(0);for(;null!=d;)c.push(d.options[d.options.selectedIndex].value),u++,d=e.rows.item(i).getElementsByTagName("td").item(u).getElementsByTagName("select").item(0);t+=a?'<br><font color="#FF8000">'+n+"</font>":'<br><font color="#00CC00">'+n+"</font>",t+=' (<font color="#fc49a4">'+c[0];for(let e=1;e<c.length;e++)t+=", "+c[e];t+='</font>) <font color="#000000">'+s+"</font>","Integer"!=s&&"Double"!=s||(t+='<font color="#000000">: '+r+"-"+l+"</font>"),t+=' <font color="#19c3c0">isStatic:</font> <font color="#000000">'+a+"</font>"}return t}var on=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("table");a=di(a);var c=document.createElement("tbody");c.style.height="100%",function(e,t,i){let n=t.value;n=n.replace('<b><font color="#000000">Class and Object properties</font></b><br>',""),n.split("<br>").forEach(((t,n)=>{var s=t.slice(t.indexOf('<font color="#')+22,t.indexOf("</font>"));let r=[];r=(t=t.slice(t.indexOf("</font>")+7)).slice(t.indexOf('(<font color="#fc49a4">')+23,t.indexOf("</font>")).split(", ");var l=(t=t.slice(t.indexOf("</font>)")+8)).slice(t.indexOf('<font color="#000000">')+22,t.indexOf("</font>"));t=t.slice(t.indexOf("</font>")+7);var a="";"Integer"!=l&&"Double"!=l||(a=t.slice(t.indexOf('<font color="#000000">: ')+24,t.indexOf("</font>")),t=t.slice(t.indexOf("</font>")+7));let c=(t=t.slice(t.indexOf('<font color="#19c3c0">isStatic:</font>')+38)).slice(t.indexOf('<font color="#000000">')+22,t.indexOf("</font>"));t=t.slice(t.indexOf("</font>")+7);var h=en(i);h.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value=s;var u=h.getElementsByTagName("td").item(1).getElementsByTagName("select").item(0);for(let e=0;e<u.options.length;++e)u.options[e].value==l&&(u.options[e].selected=!0);let d=2;if("Integer"==l||"Double"==l||0==u.options.selectedIndex){let e=a.split("-");h.getElementsByTagName("td").item(d).getElementsByTagName("input").item(0).value=e[0],h.getElementsByTagName("td").item(d).getElementsByTagName("input").item(1).value=e[1],d++}else h.getElementsByTagName("td").item(d).remove();if(h.getElementsByTagName("td").item(d).getElementsByTagName("input").item(0).checked="true"==c,d++,r.forEach(((e,t)=>{if(0!=t){let e=document.createElement("td");e.style.minWidth="200px";var n=document.createElement("select");(n=bi(n)).style.marginRight="4px",n.style.width="85%",n.style.float="left",Ti(i).forEach((e=>{var t=new Option(e.name,e.name);n.options[n.options.length]=t}));var o=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(o=gi(o)).style.float="left",o.style.width="10%",e.appendChild(n),e.appendChild(o),h.insertBefore(e,h.getElementsByTagName("td").item(d))}var s=h.getElementsByTagName("td").item(d).getElementsByTagName("select").item(0);for(let t=0;t<s.options.length;++t)s.options[t].value==e&&(s.options[t].selected=!0);d++})),0!=n){var p=document.createElement("td"),g=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));g=gi(g),p.appendChild(g),h.appendChild(p)}e.appendChild(h)}))}(c,e,t),a.appendChild(c),l.appendChild(a);var h=mxUtils.button(o("Apply"),(function(){tn(a);let i=nn(a);var n=t.editor.graph;n.getModel().beginUpdate(),e.geometry.height=17*(a.rows.length+1),e.value=i,n.getModel().endUpdate(),n.refresh(),p.destroy()})),u=mxUtils.button(o("AddPropertyClass"),(function(){var e=en(t),i=document.createElement("td");i.classList="delete";var n=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));n=gi(n),i.appendChild(n),e.appendChild(i),c.appendChild(e)})),d=document.createElement("div");d=pi(d),h=gi(h),u=gi(u),d.appendChild(u),d.appendChild(h),l.appendChild(d);var p=new mxWindow(o("TitleClassPropertiesEditorWindow"),l,i,n,s,r,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)},sn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("table");l=di(l);var a=document.createElement("tbody");a.style.height="100%";var c=rn();!function(e){e.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value="comparisonResult",e.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).disabled=!0;let t=1;["greater","less","equal","undetermined"].forEach((i=>{if(1!=t){let i=document.createElement("td");i.style.minWidth="200px";let n=document.createElement("input");n.type="text",n=mi(n),n.style.width="100%",n.style.float="left",n.placeholder="Value",i.appendChild(n),e.insertBefore(i,e.getElementsByTagName("td").item(t))}e.getElementsByTagName("td").item(t).getElementsByTagName("input").item(0).value=i,e.getElementsByTagName("td").item(t).getElementsByTagName("input").item(0).disabled=!0,t++})),e.getElementsByTagName("td").item(t).style.display="none",e.getElementsByTagName("td").item(t+1).getElementsByTagName("input").item(0).checked=!1,e.getElementsByTagName("td").item(t+1).getElementsByTagName("input").item(0).disabled=!0}(c),a.appendChild(c),l.appendChild(a),r.appendChild(l);var h=mxUtils.button(o("Create"),(function(){ln(a);var t,i=e.editor.graph;if(t=i.getModel().cells,Object.keys(t).forEach((function(e){var i=t[e].value;if("string"==typeof i&&i.startsWith('<font color="#000000"><b>Enum</b></font>'))throw new Error("Enum dictionary already exists")})),i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),o=new mxCell("",new mxGeometry(n.x,n.y,267,17*(l.rows.length+1)),"shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fontColor=#6666FF;align=center;editable=0;");let e=an(a);o.value=e,o.vertex=!0,i.setSelectionCell(i.addCell(o))}p.destroy()})),u=mxUtils.button(o("AddEnum"),(function(){var e=rn(),t=document.createElement("td"),i=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));i=gi(i),t.appendChild(i),e.appendChild(t),a.appendChild(e)})),d=document.createElement("div");d=pi(d),h=gi(h),u=gi(u),d.appendChild(u),d.appendChild(h),r.appendChild(d);var p=new mxWindow(o("TitleEnumConstructorWindow"),r,t,i,n,s,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)};function rn(){var e=document.createElement("tr"),t=document.createElement("td");t.style.minWidth="200px";var i=document.createElement("input");i.type="text",(i=mi(i)).placeholder="Name enum",t.appendChild(i),e.appendChild(t);var n=document.createElement("td");n.style.minWidth="150px";var o=document.createElement("input");o.type="text",(o=mi(o)).placeholder="Value",n.appendChild(o),e.appendChild(n);var s=document.createElement("td");s.style.minWidth="50px";var r=mxUtils.button("+",(function(e){let t=document.createElement("td");t.style.minWidth="200px";let i=document.createElement("input");i.type="text",i=mi(i),i.style.marginRight="4px",i.style.width="85%",i.style.float="left",i.placeholder="Value";var n=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(n=gi(n)).style.float="left",n.style.width="10%",t.appendChild(i),t.appendChild(n),e.target.parentElement.parentElement.insertBefore(t,e.target.parentElement)}));r=gi(r),s.appendChild(r),e.appendChild(s);var l=document.createElement("td");l.style.minWidth="100px";var a=document.createElement("span");(a=fi(a)).innerText="is linear";var c=document.createElement("input");return c.type="checkbox",c.addEventListener("change",(e=>{if(e.currentTarget.checked){var t=document.createElement("td");t.style.minWidth="150px";var i=document.createElement("input");(i=mi(i)).type="text",i.style.width="90%",i.placeholder="Name in RDF",t.appendChild(i),e.currentTarget.parentElement.parentElement.insertBefore(t,e.currentTarget.parentElement.nextElementSibling)}else e.currentTarget.parentElement.nextElementSibling.remove()})),l.appendChild(a),l.appendChild(c),e.appendChild(l),e}function ln(e){let t="",i=[];for(var n=0;n<e.rows.length;n++){let r=e.rows.item(n).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value;i.push(r),""==r?t+=o("nameIsMissing").replace("%i",n+1):ji(r)||(t+=o("nameIsIncorrect").replace("%i",n+1));let l=1,a=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0),c=!1;for(;null!=a;)""!=a.value||c?ji(a.value)||c||(t+=o("valueIsIncorrect").replace("%i",n+1),c=!0):(t+=o("valueIsMissing").replace("%i",n+1),c=!0),l++,a=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0);l++;var s=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0).checked;let h;s&&(h=e.rows.item(n).getElementsByTagName("td").item(l+1).getElementsByTagName("input").item(0).value),s&&""==h?t+=o("nameRDFIsMissing").replace("%i",n+1):s&&!ji(h)&&(t+=o("nameRDFIsIncorrect").replace("%i",n+1))}if(0==i.length||Xi(i)||(t+=o("nonUniqueEnumName")),""!=t)throw new Error(t)}function an(e){let t='<font color="#000000"><b>Enum</b></font>';for(var i=0;i<e.rows.length;i++){var n=e.rows.item(i).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value,o=[];o[0]=e.rows.item(i).getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value;let l=2,a=e.rows.item(i).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0);for(;null!=a;)o.push(a.value),l++,a=e.rows.item(i).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0);l++;var s=e.rows.item(i).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0).checked;if(s)var r=e.rows.item(i).getElementsByTagName("td").item(l+1).getElementsByTagName("input").item(0).value;t+='<br><font color="#ff66b3">'+n+'</font> values:(<font color="#ff6666">'+o[0];for(let e=1;e<o.length;e++)t+=", "+o[e];t+='</font>) isLinear: <font color="#123123">',t+=s+"</font>",s&&(t+=' nameRDF: <font color="#fff123">'+r+"</font>")}return t}var cn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("table");a=di(a);var c=document.createElement("tbody");c.style.height="100%",function(e,t){let i=t.value;i=i.replace('<font color="#000000"><b>Enum</b></font><br>',""),i.split("<br>").forEach(((t,i)=>{var n=t.slice(t.indexOf('<font color="#ff66b3">')+22,t.indexOf("</font>")),s=(t=t.slice(t.indexOf("</font>")+7)).slice(t.indexOf('<font color="#ff6666">')+22,t.indexOf("</font>")).split(", "),r=(t=t.slice(t.indexOf("</font>")+7)).slice(t.indexOf('<font color="#123123">')+22,t.indexOf("</font>")),l="";"true"==r&&(l=(t=t.slice(t.indexOf("</font>")+7)).slice(t.indexOf('<font color="#fff123">')+22,t.indexOf("</font>")));var a=rn();a.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value=n,0==i&&(a.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).disabled=!0);let c=1;if(s.forEach((e=>{if(1!=c){let e=document.createElement("td");e.style.minWidth="200px";let n=document.createElement("input");n.type="text",n=mi(n),n.style.marginRight="4px",n.style.width="85%",n.style.float="left",n.placeholder="Value";var t=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(t=gi(t)).style.float="left",t.style.width="10%",e.appendChild(n),0!=i&&e.appendChild(t),a.insertBefore(e,a.getElementsByTagName("td").item(c))}a.getElementsByTagName("td").item(c).getElementsByTagName("input").item(0).value=e,0==i&&(a.getElementsByTagName("td").item(c).getElementsByTagName("input").item(0).disabled=!0,a.getElementsByTagName("td").item(c).getElementsByTagName("input").item(0).style.width="100%"),c++})),0==i&&(a.getElementsByTagName("td").item(c).style.display="none"),c++,a.getElementsByTagName("td").item(c).getElementsByTagName("input").item(0).checked="true"==r,0==i&&(a.getElementsByTagName("td").item(c).getElementsByTagName("input").item(0).disabled=!0),"true"==r){var h=document.createElement("td");h.style.minWidth="150px";var u=document.createElement("input");(u=mi(u)).type="text",u.style.width="90%",u.placeholder="Name in RDF",h.appendChild(u),a.insertBefore(h,a.getElementsByTagName("td").item(c).nextElementSibling),a.getElementsByTagName("td").item(c+1).getElementsByTagName("input").item(0).value=l}if(0!=i){var d=document.createElement("td"),p=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));p=gi(p),d.appendChild(p),a.appendChild(d)}e.appendChild(a)}))}(c,e),a.appendChild(c),l.appendChild(a);var h=mxUtils.button(o("Apply"),(function(){ln(c);let i=an(c);var n=t.editor.graph;n.getModel().beginUpdate(),e.geometry.height=17*(a.rows.length+1),e.value=i,n.getModel().endUpdate(),n.refresh(),p.destroy()})),u=mxUtils.button(o("AddEnum"),(function(){var e=rn(),t=document.createElement("td"),i=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));i=gi(i),t.appendChild(i),e.appendChild(t),c.appendChild(e)})),d=document.createElement("div");d=pi(d),h=gi(h),u=gi(u),d.appendChild(u),d.appendChild(h),l.appendChild(d);var p=new mxWindow(o("TitleEnumEditorWindow"),l,i,n,s,r,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)},hn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("table");l=di(l);var a=document.createElement("tbody");a.style.height="100%";var c=un(e);a.appendChild(c),l.appendChild(a),r.appendChild(l);var h=mxUtils.button(o("Create"),(function(){dn(l);var t,i=e.editor.graph;if(t=i.getModel().cells,Object.keys(t).forEach((function(e){var i=t[e].value;if(i&&"object"==typeof i&&i.getAttribute("label").startsWith('<b><font color="#000000">Relationships between objects</font></b>'))throw new Error(o("RelationshipExists"))})),i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),s=new mxCell("",new mxGeometry(n.x,n.y,267,17*(l.rows.length+1)),"shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fontColor=#000000;align=center;editable=0;");let e=pn(l);s.value=e[0],s.vertex=!0,i.setSelectionCell(i.addCell(s));for(var r=0;r<e[1].length;r++)i.setAttributeForCell(s,"namesRels_"+r,e[1][r]),i.setAttributeForCell(s,"binFlags_"+r,e[2][r])}p.destroy()})),u=mxUtils.button(o("AddRelationship"),(function(){var t=un(e),i=document.createElement("td");i.classList="delete";var n=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));n=gi(n),i.appendChild(n),t.appendChild(i),a.appendChild(t)})),d=document.createElement("div");d=pi(d),h=gi(h),u=gi(u),d.appendChild(u),d.appendChild(h),r.appendChild(d);var p=new mxWindow(o("TitleRelationshipsConstructorWindow"),r,t,i,n,s,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)};function un(e){var t=document.createElement("tr"),i=document.createElement("td");i.style.minWidth="200px";var n=document.createElement("input");n.type="text",(n=mi(n)).placeholder="Relationship name",n.style.width="100%",i.appendChild(n),t.appendChild(i);var o=document.createElement("td");o.style.minWidth="200px";var s=document.createElement("input");s.type="text",(s=mi(s)).placeholder="Extend",o.appendChild(s),t.appendChild(o);var r=document.createElement("td");r.style.minWidth="150px";var l=document.createElement("select");l=bi(l),Ti(e).forEach((e=>{var t=new Option(e.name,e.name);l.options[l.options.length]=t})),r.appendChild(l);var a=document.createElement("td");a.style.minWidth="50px";var c=mxUtils.button("+",(function(t){let i=document.createElement("td");i.style.minWidth="200px";var n=document.createElement("select");(n=bi(n)).style.marginRight="4px",n.style.width="85%",n.style.float="left",Ti(e).forEach((e=>{var t=new Option(e.name,e.name);n.options[n.options.length]=t}));var o=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(o=gi(o)).style.float="left",o.style.width="10%",i.appendChild(n),i.appendChild(o),t.target.parentElement.parentElement.insertBefore(i,t.target.parentElement)}));c=gi(c),a.appendChild(c),t.appendChild(r),t.appendChild(a);var h=document.createElement("td");h.style.minWidth="150px";var u=document.createElement("select");u=bi(u),["None","Linear","Partially linear"].forEach((e=>{var t=new Option(e,e);u.options[u.options.length]=t})),u.addEventListener("change",(e=>{if(gn(e.target.parentElement.parentElement,e.target.options[e.target.options.selectedIndex].value),"Linear"!=e.target.options[e.target.options.selectedIndex].value&&"Partially linear"!=e.target.options[e.target.options.selectedIndex].value||e.currentTarget.parentElement.nextElementSibling.classList.contains("names")){if("None"==e.target.options[e.target.options.selectedIndex].value&&e.currentTarget.parentElement.nextElementSibling.classList.contains("names")){for(var t=e.currentTarget.parentElement.nextElementSibling;"addNames"!=t.classList;)t.remove(),t=e.currentTarget.parentElement.nextElementSibling;t.remove()}}else{var i=document.createElement("td");i.classList="names",i.style.minWidth="150px";var n=document.createElement("input");n.type="text",(n=mi(n)).placeholder="Name",i.appendChild(n);var o=document.createElement("td");o.classList="addNames",o.style.minWidth="50px";var s=mxUtils.button("+",(function(e){let t=document.createElement("td");t.style.minWidth="200px";var i=document.createElement("input");i.type="text",(i=mi(i)).style.marginRight="4px",i.style.width="85%",i.style.float="left",i.placeholder="Name";var n=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(n=gi(n)).style.float="left",n.style.width="10%",t.appendChild(i),t.appendChild(n),e.target.parentElement.parentElement.insertBefore(t,e.target.parentElement)}));s=gi(s),o.appendChild(s),e.currentTarget.parentElement.parentElement.insertBefore(o,e.currentTarget.parentElement.nextElementSibling),e.currentTarget.parentElement.parentElement.insertBefore(i,e.currentTarget.parentElement.nextElementSibling)}})),h.appendChild(u),t.appendChild(h);var d=document.createElement("td");d.style.minWidth="200px",d.style.display="flex";var p=document.createElement("span");(p=fi(p)).innerText="is relationship between classes";var g=document.createElement("input");g.type="checkbox",g.addEventListener("change",(e=>{if(e.currentTarget.checked){var t=document.createElement("td");t.style.minWidth="150px";var i=document.createElement("select");i=bi(i),["One to one","One to many","Many to one","Many to many"].forEach((e=>{var t=new Option(e,e);i.options[i.options.length]=t})),t.appendChild(i),e.currentTarget.parentElement.parentElement.insertBefore(t,e.currentTarget.parentElement.nextElementSibling)}else e.currentTarget.parentElement.nextElementSibling.remove()})),d.appendChild(p),d.appendChild(g),t.appendChild(d);var m=document.createElement("td");m.style.minWidth="120px",m.classList="symmetry";var b=document.createElement("span");(b=fi(b)).innerText="symmetry";var f=document.createElement("input");f.type="checkbox",m.appendChild(b),m.appendChild(f),t.appendChild(m);var E=document.createElement("td");E.style.minWidth="140px",E.classList="antisymmetry";var y=document.createElement("span");(y=fi(y)).innerText="antisymmetry";var v=document.createElement("input");v.type="checkbox",E.appendChild(y),E.appendChild(v),t.appendChild(E);var C=document.createElement("td");C.style.minWidth="120px",C.classList="reflexivity";var _=document.createElement("span");(_=fi(_)).innerText="reflexivity";var T=document.createElement("input");T.type="checkbox",C.appendChild(_),C.appendChild(T),t.appendChild(C);var w=document.createElement("td");w.style.minWidth="160px",w.classList="antireflexivity";var I=document.createElement("span");(I=fi(I)).innerText="anti - reflexivity";var k=document.createElement("input");k.type="checkbox",w.appendChild(I),w.appendChild(k),t.appendChild(w);var x=document.createElement("td");x.style.minWidth="120px",x.classList="transitivity";var N=document.createElement("span");(N=fi(N)).innerText="transitivity";var S=document.createElement("input");S.type="checkbox",x.appendChild(N),x.appendChild(S),t.appendChild(x);var A=document.createElement("td");A.style.minWidth="140px",A.classList="antitransivity";var R=document.createElement("span");(R=fi(R)).innerText="antitransivity";var $=document.createElement("input");return $.type="checkbox",A.appendChild(R),A.appendChild($),t.appendChild(A),t}function dn(e){let t="",i=[];for(var n=0;n<e.rows.length;n++){let s=e.rows.item(n).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value;i.push(s);let r=e.rows.item(n).getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value;""==s?t+=o("nameIsMissing").replace("%i",n+1):ji(s)||(t+=o("nameIsIncorrect").replace("%i",n+1)),""==r||ji(r)||(t+=o("extendRelationshipIsIncorrect").replace("%i",n+1));let l=2,a=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("select").item(0),c=!1;for(;null!=a;)void 0!==a.options[a.options.selectedIndex]||c||(t+=o("classesIsMissing").replace("%i",n+1),c=!0),l++,a=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("select").item(0);if(l++,a=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("select").item(0),"Linear"==a.options[a.options.selectedIndex].value||"Partially linear"==a.options[a.options.selectedIndex].value){l++;let i=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0);for(;null!=i;){if(""==i.value){t+=o("nameRelationshipsIsMissing").replace("%i",n+1);break}if(!ji(i.value)){t+=o("nameRelationshipsIsIncorrect").replace("%i",n+1);break}l++,i=e.rows.item(n).getElementsByTagName("td").item(l).getElementsByTagName("input").item(0)}}}if(0==i.length||Xi(i)||(t+=o("nonUniqueRelationshipName")),""!=t)throw new Error(t)}function pn(e){let t='<b><font color="#000000">Relationships between objects</font></b>',i=[],n=[];for(var o=0;o<e.rows.length;o++){var s=e.rows.item(o).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value,r=e.rows.item(o).getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value,l=[],a=e.rows.item(o).getElementsByTagName("td").item(2).getElementsByTagName("select").item(0);l[0]=a.options[a.options.selectedIndex].value;let g=3,m=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("select").item(0);for(;null!=m;)l.push(m.options[m.options.selectedIndex].value),g++,m=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("select").item(0);g++;var c=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("select").item(0),h=c.options[c.options.selectedIndex].value;let b=[];if("Linear"==h||"Partially linear"==h){g++;let t=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("input").item(0);for(;null!=t;)b.push(t.value),g++,t=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("input").item(0)}i.push(b.join(";")),g++;var u=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("input").item(0).checked,d="";if(u){g++;var p=e.rows.item(o).getElementsByTagName("td").item(g).getElementsByTagName("select").item(0);d=p.options[p.options.selectedIndex].value}n.push(mn(e.rows.item(o))),t+='<br><font color="#00cccc">'+s+"</font>",""!=r&&(t+=' (<font color="#00cccc">'+r+"</font>)"),t+=' <font color="#6666FF">classes:</font> <font color="#ff66b3">'+l[0];for(let e=1;e<l.length;e++)t+=", "+l[e];t+="</font>","None"!=h&&(t+=' <font color="#6666FF">scale:</font> <font color="#000000">'+h+"</font>"),t+=' <font color="#6666FF">is relationship between classes:</font> <font color="#000000">'+u+"</font>",u&&(t+=' <font color="#6666FF">type:</font> <font color="#000000">'+d+"</font>")}return[t,i,n]}function gn(e,t){let i=e.getElementsByClassName("symmetry")[0],n=e.getElementsByClassName("antisymmetry")[0],o=e.getElementsByClassName("reflexivity")[0],s=e.getElementsByClassName("antireflexivity")[0],r=e.getElementsByClassName("transitivity")[0],l=e.getElementsByClassName("antitransivity")[0];"Linear"==t?(i.getElementsByTagName("input").item(0).checked=!1,i.getElementsByTagName("input").item(0).disabled=!0,n.getElementsByTagName("input").item(0).checked=!0,n.getElementsByTagName("input").item(0).disabled=!0,o.getElementsByTagName("input").item(0).checked=!0,o.getElementsByTagName("input").item(0).disabled=!0,s.getElementsByTagName("input").item(0).checked=!1,s.getElementsByTagName("input").item(0).disabled=!0,r.getElementsByTagName("input").item(0).checked=!1,r.getElementsByTagName("input").item(0).disabled=!0,l.getElementsByTagName("input").item(0).checked=!1,l.getElementsByTagName("input").item(0).disabled=!0):"Partially linear"==t?(i.getElementsByTagName("input").item(0).checked=!1,i.getElementsByTagName("input").item(0).disabled=!0,n.getElementsByTagName("input").item(0).checked=!0,n.getElementsByTagName("input").item(0).disabled=!0,o.getElementsByTagName("input").item(0).checked=!0,o.getElementsByTagName("input").item(0).disabled=!0,s.getElementsByTagName("input").item(0).checked=!1,s.getElementsByTagName("input").item(0).disabled=!0,r.getElementsByTagName("input").item(0).checked=!0,r.getElementsByTagName("input").item(0).disabled=!0,l.getElementsByTagName("input").item(0).checked=!1,l.getElementsByTagName("input").item(0).disabled=!0):"None"==t&&(i.getElementsByTagName("input").item(0).checked=!1,i.getElementsByTagName("input").item(0).disabled=!1,n.getElementsByTagName("input").item(0).checked=!1,n.getElementsByTagName("input").item(0).disabled=!1,o.getElementsByTagName("input").item(0).checked=!1,o.getElementsByTagName("input").item(0).disabled=!1,s.getElementsByTagName("input").item(0).checked=!1,s.getElementsByTagName("input").item(0).disabled=!1,r.getElementsByTagName("input").item(0).checked=!1,r.getElementsByTagName("input").item(0).disabled=!1,l.getElementsByTagName("input").item(0).checked=!1,l.getElementsByTagName("input").item(0).disabled=!1)}function mn(e){let t=e.getElementsByClassName("symmetry")[0].getElementsByTagName("input").item(0).checked,i=e.getElementsByClassName("antisymmetry")[0].getElementsByTagName("input").item(0).checked,n=e.getElementsByClassName("reflexivity")[0].getElementsByTagName("input").item(0).checked,o=e.getElementsByClassName("antireflexivity")[0].getElementsByTagName("input").item(0).checked,s=e.getElementsByClassName("transitivity")[0].getElementsByTagName("input").item(0).checked,r=e.getElementsByClassName("antitransivity")[0].getElementsByTagName("input").item(0).checked;return String(Number(t))+String(Number(i))+String(Number(n))+String(Number(o))+String(Number(s))+String(Number(r))}var bn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("table");a=di(a);var c=document.createElement("tbody");c.style.height="100%",function(e,t,i){let n=t.value;var s=n.getAttribute("label");(s=s.replace('<b><font color="#000000">Relationships between objects</font></b><br>',"")).split("<br>").forEach(((t,s)=>{var r=t.slice(t.indexOf('<font color="#00cccc">')+22,t.indexOf("</font>")),l="";-1!=(t=t.slice(t.indexOf("</font>")+7)).indexOf(' (<font color="#00cccc">')&&(l=t.slice(t.indexOf('(<font color="#00cccc">')+23,t.indexOf("</font>)")),t=t.slice(t.indexOf("</font>)")+8));var a=(t=t.slice(t.indexOf("classes:</font>")+15)).slice(t.indexOf('<font color="#ff66b3">')+22,t.indexOf("</font>")).split(", "),c="";-1!=(t=t.slice(t.indexOf("</font>")+7)).indexOf('<font color="#6666FF">scale:</font>')&&(c=(t=t.slice(t.indexOf("scale:</font>")+13)).slice(t.indexOf('<font color="#000000">')+22,t.indexOf("</font>")),t=t.slice(t.indexOf("</font>")+7));let h=(t=t.slice(t.indexOf("classes:</font>")+15)).slice(t.indexOf('<font color="#000000">')+22,t.indexOf("</font>"));t=t.slice(t.indexOf("</font>")+7);var u="";"true"==h&&(u=(t=t.slice(t.indexOf("type:</font>")+12)).slice(t.indexOf('<font color="#000000">')+22,t.indexOf("</font>")));let d=n.getAttribute("namesRels_"+s),p=n.getAttribute("binFlags_"+s);var g=un(i);g.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value=r,g.getElementsByTagName("td").item(1).getElementsByTagName("input").item(0).value=l;let m=2;a.forEach((e=>{if(2!=m){let e=document.createElement("td");e.style.minWidth="200px";var t=document.createElement("select");(t=bi(t)).style.marginRight="4px",t.style.width="85%",t.style.float="left",Ti(i).forEach((e=>{var i=new Option(e.name,e.name);t.options[t.options.length]=i}));var n=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(n=gi(n)).style.float="left",n.style.width="10%",e.appendChild(t),e.appendChild(n),g.insertBefore(e,g.getElementsByTagName("td").item(m))}var o=g.getElementsByTagName("td").item(m).getElementsByTagName("select").item(0);for(let t=0;t<o.options.length;++t)o.options[t].value==e&&(o.options[t].selected=!0);m++})),m++;var b=g.getElementsByTagName("td").item(m).getElementsByTagName("select").item(0);for(let e=0;e<b.options.length;++e)b.options[e].value==c&&(b.options[e].selected=!0);gn(g,c);let f=d.split(";");if("Linear"==c||"Partially linear"==c){var E=document.createElement("td");E.classList="names",E.style.minWidth="150px";var y=document.createElement("input");y.type="text",(y=mi(y)).placeholder="Name",E.appendChild(y);var v=document.createElement("td");v.classList="addNames",v.style.minWidth="50px";var C=mxUtils.button("+",(function(e){let t=document.createElement("td");t.style.minWidth="200px";var i=document.createElement("input");i.type="text",(i=mi(i)).style.marginRight="4px",i.style.width="85%",i.style.float="left",i.placeholder="Name";var n=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(n=gi(n)).style.float="left",n.style.width="10%",t.appendChild(i),t.appendChild(n),e.target.parentElement.parentElement.insertBefore(t,e.target.parentElement)}));C=gi(C),v.appendChild(C),g.insertBefore(v,g.getElementsByTagName("td").item(m).nextElementSibling),g.insertBefore(E,g.getElementsByTagName("td").item(m).nextElementSibling),m++,f.forEach(((e,t)=>{if(0!=t){let e=document.createElement("td");e.style.minWidth="200px";var i=document.createElement("input");i.type="text",(i=mi(i)).style.marginRight="4px",i.style.width="85%",i.style.float="left",i.placeholder="Name";var n=mxUtils.button("-",(function(e){e.target.parentElement.remove()}));(n=gi(n)).style.float="left",n.style.width="10%",e.appendChild(i),e.appendChild(n),g.insertBefore(e,g.getElementsByTagName("td").item(m))}g.getElementsByTagName("td").item(m).getElementsByTagName("input").item(0).value=e,m++}))}if(c||function(e,t){let i=t.split("");e.getElementsByClassName("symmetry")[0].getElementsByTagName("input").item(0).checked="1"==i[0],e.getElementsByClassName("antisymmetry")[0].getElementsByTagName("input").item(0).checked="1"==i[1],e.getElementsByClassName("reflexivity")[0].getElementsByTagName("input").item(0).checked="1"==i[2],e.getElementsByClassName("antireflexivity")[0].getElementsByTagName("input").item(0).checked="1"==i[3],e.getElementsByClassName("transitivity")[0].getElementsByTagName("input").item(0).checked="1"==i[4],e.getElementsByClassName("antitransivity")[0].getElementsByTagName("input").item(0).checked="1"==i[5]}(g,p),m++,g.getElementsByTagName("td").item(m).getElementsByTagName("input").item(0).checked="true"==h,"true"==h){var _=document.createElement("td");_.style.minWidth="150px";var T=document.createElement("select");(T=bi(T)).style.width="100%",["One to one","One to many","Many to one","Many to many"].forEach((e=>{var t=new Option(e,e);T.options[T.options.length]=t})),_.appendChild(T),g.insertBefore(_,g.getElementsByTagName("td").item(m).nextElementSibling),m++;var w=g.getElementsByTagName("td").item(m).getElementsByTagName("select").item(0);for(let e=0;e<w.options.length;++e)w.options[e].value==u&&(w.options[e].selected=!0)}if(0!=s){var I=document.createElement("td"),k=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));k=gi(k),I.appendChild(k),g.appendChild(I)}e.appendChild(g)}))}(c,e,t),a.appendChild(c),l.appendChild(a);var h=mxUtils.button(o("Apply"),(function(){dn(a);let i=pn(a);var n=t.editor.graph;n.getModel().beginUpdate(),e.geometry.height=17*(a.rows.length+1),e.value.setAttribute("label",i[0]);for(var o=0;o<i[1].length;o++)e.value.setAttribute("namesRels_"+o,i[1][o]),e.value.setAttribute("binFlags_"+o,i[2][o]);n.getModel().endUpdate(),n.refresh(),p.destroy()})),u=mxUtils.button(o("AddRelationship"),(function(){var e=un(t),i=document.createElement("td");i.classList="delete";var n=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));n=gi(n),i.appendChild(n),e.appendChild(i),c.appendChild(e)})),d=document.createElement("div");d=pi(d),h=gi(h),u=gi(u),d.appendChild(u),d.appendChild(h),l.appendChild(d);var p=new mxWindow(o("TitleRelationshipsEditorWindow"),l,i,n,s,r,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)},fn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%",r.style.width="100%";var l=document.createElement("table");l=di(l);var a=document.createElement("tbody");a.style.height="100%";var c=En(e);a.appendChild(c),l.appendChild(a),r.appendChild(l);var h=mxUtils.button(o("Create"),(function(){yn(l);var t=e.editor.graph;if(t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())){var i=t.getInsertPoint(),n=new mxCell("",new mxGeometry(i.x,i.y,165,60),"shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;editable=0;");let e=vn(l);n.value=e,n.vertex=!0,t.setSelectionCell(t.addCell(n)),t.setAttributeForCell(n,"type","START")}p.destroy()})),u=mxUtils.button(o("AddVariable"),(function(){var t=En(e),i=document.createElement("td"),n=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));n=gi(n),i.appendChild(n),t.appendChild(i),l.appendChild(t)})),d=document.createElement("div");d=pi(d),u=gi(u),h=gi(h),d.appendChild(u),d.appendChild(h),r.appendChild(d);var p=new mxWindow(o("TitleStartConstructorWindow"),r,t,i,n,s,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)};function En(e){var t=document.createElement("tr"),i=document.createElement("td"),n=document.createElement("input");n.type="text",(n=mi(n)).placeholder="Variable name",i.appendChild(n);var o=document.createElement("td"),s=document.createElement("select");return s=bi(s),Ti(e).forEach((e=>{var t=new Option(e.name,e.name);s.options[s.options.length]=t})),o.appendChild(s),t.appendChild(i),t.appendChild(o),t}function yn(e){let t="";for(var i=0;i<e.rows.length;i++){let s=e.rows.item(i).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value;""==s?t+=o("nameIsMissing").replace("%i",i+1):ji(s)||(t+=o("nameIsIncorrect").replace("%i",i+1));var n=e.rows.item(i).getElementsByTagName("td").item(1).getElementsByTagName("select").item(0);void 0===n.options[n.options.selectedIndex]&&(t+=o("classesIsMissing").replace("%i",i+1))}if(""!=t)throw new Error(t)}function vn(e){let t="";for(var i=0;i<e.rows.length;i++){var n=e.rows.item(i).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value,o=e.rows.item(i).getElementsByTagName("td").item(1).getElementsByTagName("select").item(0);t+=n+" - "+o.options[o.options.selectedIndex].value+"\n"}return t.slice(0,-1)}var Cn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%",l.style.width="100%";var a=document.createElement("table");a=di(a);var c=document.createElement("tbody");c.style.height="100%",function(e,t,i){t.value.getAttribute("label").split("\n").forEach(((t,n)=>{let s=t.split(" - ");var r=En(i);r.getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value=s[0];var l=r.getElementsByTagName("td").item(1).getElementsByTagName("select").item(0);for(let e=0;e<l.options.length;++e)l.options[e].value==s[1]&&(l.options[e].selected=!0);if(0!=n){var a=document.createElement("td"),c=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));c=gi(c),a.appendChild(c),r.appendChild(a)}e.appendChild(r)}))}(c,e,t),a.appendChild(c),l.appendChild(a);var h=mxUtils.button(o("Apply"),(function(){yn(a);let i=vn(a);var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("label",i),n.getModel().endUpdate(),n.refresh(),p.destroy()})),u=mxUtils.button(o("AddVariable"),(function(){var e=En(t),i=document.createElement("td"),n=mxUtils.button(o("Delete"),(function(e){e.target.parentElement.parentElement.remove()}));n=gi(n),i.appendChild(n),e.appendChild(i),a.appendChild(e)})),d=document.createElement("div");d=pi(d),u=gi(u),h=gi(h),d.appendChild(u),d.appendChild(h),l.appendChild(d);var p=new mxWindow(o("TitleStartEditorWindow"),l,i,n,s,r,!0,!0);this.window=p,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!0),this.window.setClosable(!0),this.window.setVisible(!0)},_n=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%",a.style.display="none";var c=document.createElement("textarea");c=Ei(c);var h,u=mxUtils.button(o("Create"),(function(){var t=l.getElementsByTagName("textarea").item(0).value;if(!t)throw new Error(o("ExpressionIsMissing"));vi.K.parse(t);let i="";if(p.value?ji(p.value)||(i+=o("NameVariableIsIncorrect")):i+=o("NameVariableIsMissing"),void 0!==m.options[m.options.selectedIndex]&&m.options[m.options.selectedIndex].value||(i+=o("TypeVariableIsMissing")),i)throw new Error(i);var n=e.editor.graph;if(n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())){var s=n.getInsertPoint(),r=new mxCell("",new mxGeometry(s.x,s.y,120,60),"rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;editable=0;");r.vertex=!0,n.setSelectionCell(n.addCell(r));var a=m.options[m.options.selectedIndex].value;n.setAttributeForCell(r,"expression",t),n.setAttributeForCell(r,"typeVar",a),n.setAttributeForCell(r,"nameVar",p.value)}T.destroy()})),d=mxUtils.button(o("SwitchBlockly"),(function(){var e=l.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),l.style.display="none",a.style.display="block",f.innerHTML="",(h=Ot("actionCreateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,h)),v.value=p.value,C.options.selectedIndex=m.options.selectedIndex})),p=document.createElement("input");p.type="text",(p=mi(p)).style.height="5%",p.placeholder="New variable";var g=Ti(e),m=document.createElement("select");(m=bi(m)).style.height="5%",g.forEach((e=>{var t=new Option(e.name,e.name);m.options[m.options.length]=t})),l.appendChild(c);var b=document.createElement("div");(b=pi(b)).style.height="10%",u=gi(u),d=gi(d),l.appendChild(p),l.appendChild(m),b.appendChild(u),b.appendChild(d),l.appendChild(b),r.appendChild(l);var f=document.createElement("div");f.id="actionCreateBlocklyDiv",f=yi(f,n,s);var E=mxUtils.button(o("Create"),(function(){var t=Wi(h);if(!t)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(t)}catch(e){throw new Error(o("EmptyConnection"))}let i="";if(v.value?ji(v.value)||(i+=o("NameVariableIsIncorrect")):i+=o("NameVariableIsMissing"),void 0!==C.options[C.options.selectedIndex]&&C.options[C.options.selectedIndex].value||(i+=o("TypeVariableIsMissing")),i)throw new Error(i);var n=e.editor.graph;if(n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())){var s=n.getInsertPoint(),r=new mxCell("",new mxGeometry(s.x,s.y,120,60),"rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;editable=0;");r.vertex=!0,n.setSelectionCell(n.addCell(r));var l=C.options[C.options.selectedIndex].value;n.setAttributeForCell(r,"expression",t),n.setAttributeForCell(r,"typeVar",l),n.setAttributeForCell(r,"nameVar",v.value)}T.destroy()})),y=mxUtils.button(o("SwitchText"),(function(){var e=Wi(h);a.style.display="none",l.style.display="block",l.getElementsByTagName("textarea").item(0).value=e,p.value=v.value,m.options.selectedIndex=C.options.selectedIndex})),v=document.createElement("input");v.type="text",(v=mi(v)).style.height="5%",v.placeholder="New variable";var C=document.createElement("select");(C=bi(C)).style.height="5%",g.forEach((e=>{var t=new Option(e.name,e.name);C.options[C.options.length]=t})),a.appendChild(f);var _=document.createElement("div");(_=pi(_)).style.height="8%",E=gi(E),y=gi(y),a.appendChild(v),a.appendChild(C),_.appendChild(E),_.appendChild(y),a.appendChild(_),r.appendChild(a);var T=new mxWindow(o("TitleActionNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=T,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Tn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=document.createElement("textarea");(h=Ei(h)).value=e.value.getAttribute("expression");var u,d=mxUtils.button(o("Apply"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;if(!i)throw new Error(o("ExpressionIsMissing"));vi.K.parse(i);let n="";if(g.value?ji(g.value)||(n+=o("NameVariableIsIncorrect")):n+=o("NameVariableIsMissing"),void 0!==b.options[b.options.selectedIndex]&&b.options[b.options.selectedIndex].value||(n+=o("TypeVariableIsMissing")),n)throw new Error(n);var s=b.options[b.options.selectedIndex].value,r=t.editor.graph;r.getModel().beginUpdate(),e.value.setAttribute("expression",i),e.value.setAttribute("typeVar",s),e.value.setAttribute("nameVar",g.value),r.getModel().endUpdate(),r.refresh(),I.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",y.innerHTML="",(u=Ot("actionUpdateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u)),_.value=g.value,T.options.selectedIndex=b.options.selectedIndex})),g=document.createElement("input");g.type="text",(g=mi(g)).style.height="5%",g.placeholder="New variable",g.value=e.value.getAttribute("nameVar");var m=Ti(t),b=document.createElement("select");(b=bi(b)).style.height="5%",m.forEach((e=>{var t=new Option(e.name,e.name);b.options[b.options.length]=t}));let f=e.value.getAttribute("typeVar");for(let e=0;e<b.options.length;++e)b.options[e].value==f&&(b.options[e].selected=!0);a.appendChild(h);var E=document.createElement("div");(E=pi(E)).style.height="10%",d=gi(d),p=gi(p),a.appendChild(g),a.appendChild(b),E.appendChild(d),E.appendChild(p),a.appendChild(E),l.appendChild(a);var y=document.createElement("div");y.id="actionUpdateBlocklyDiv",y=yi(y,s,r);var v=mxUtils.button(o("Apply"),(function(){var i=Wi(u);if(!i)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}let n="";if(_.value?ji(_.value)||(n+=o("NameVariableIsIncorrect")):n+=o("NameVariableIsMissing"),void 0!==T.options[T.options.selectedIndex]&&T.options[T.options.selectedIndex].value||(n+=o("TypeVariableIsMissing")),n)throw new Error(n);var s=T.options[T.options.selectedIndex].value,r=t.editor.graph;r.getModel().beginUpdate(),e.value.setAttribute("expression",i),e.value.setAttribute("typeVar",s),e.value.setAttribute("nameVar",_.value),r.getModel().endUpdate(),r.refresh(),I.destroy()})),C=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e,g.value=_.value,b.options.selectedIndex=T.options.selectedIndex})),_=document.createElement("input");_.type="text",(_=mi(_)).style.height="5%",_.placeholder="New variable";var T=document.createElement("select");(T=bi(T)).style.height="5%",m.forEach((e=>{var t=new Option(e.name,e.name);T.options[T.options.length]=t})),c.appendChild(y);var w=document.createElement("div");(w=pi(w)).style.height="8%",v=gi(v),C=gi(C),c.appendChild(_),c.appendChild(T),w.appendChild(v),w.appendChild(C),c.appendChild(w),l.appendChild(c);var I=new mxWindow(o("TitleActionNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=I,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},wn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=document.createElement("textarea");(h=Ei(h)).style.height="90%";var u,d=mxUtils.button(o("Create"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;i&&vi.K.parse(i);var n=e.editor.graph;if(n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())){var o,s=n.getInsertPoint();(o=null==t?new mxCell("",new mxGeometry(s.x,s.y,66,30),"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;"):t?new mxCell("",new mxGeometry(s.x,s.y,66,30),"rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;editable=0;"):new mxCell("",new mxGeometry(s.x,s.y,66,30),"rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;editable=0;")).vertex=!0,n.setSelectionCell(n.addCell(o)),n.setAttributeForCell(o,"expression",i)}y.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",m.innerHTML="",(u=Ot("branchResultCreateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u))}));a.appendChild(h);var g=document.createElement("div");(g=pi(g)).style.height="10%",d=gi(d),p=gi(p),g.appendChild(d),g.appendChild(p),a.appendChild(g),l.appendChild(a);var m=document.createElement("div");m.id="branchResultCreateBlocklyDiv",(m=yi(m,s,r)).style.height=.88*r+"px";var b=mxUtils.button(o("Create"),(function(){var i=Wi(u);if(i)try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}var n=e.editor.graph;if(n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())){var s,r=n.getInsertPoint();(s=null==t?new mxCell("",new mxGeometry(r.x,r.y,66,30),"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;"):t?new mxCell("",new mxGeometry(r.x,r.y,66,30),"rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;editable=0;"):new mxCell("",new mxGeometry(r.x,r.y,66,30),"rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;editable=0;")).vertex=!0,n.setSelectionCell(n.addCell(s)),n.setAttributeForCell(s,"expression",i)}y.destroy()})),f=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e}));c.appendChild(m);var E=document.createElement("div");(E=pi(E)).style.height="8%",b=gi(b),f=gi(f),E.appendChild(b),E.appendChild(f),c.appendChild(E),l.appendChild(c);var y=new mxWindow(o("TitleBranchResultNodeConstructorWindow"),l,i,n,s,r,!0,!0);this.window=y,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},In=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=document.createElement("textarea");(h=Ei(h)).style.height="90%",h.value=e.value.getAttribute("expression");var u,d=mxUtils.button(o("Apply"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;i&&vi.K.parse(i);var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("expression",i),n.getModel().endUpdate(),n.refresh(),y.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",m.innerHTML="",(u=Ot("branchResultUpdateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u))}));a.appendChild(h);var g=document.createElement("div");(g=pi(g)).style.height="10%",d=gi(d),p=gi(p),g.appendChild(d),g.appendChild(p),a.appendChild(g),l.appendChild(a);var m=document.createElement("div");m.id="branchResultUpdateBlocklyDiv",(m=yi(m,s,r)).style.height=.88*r+"px";var b=mxUtils.button(o("Apply"),(function(){var i=Wi(u);if(i)try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("expression",i),n.getModel().endUpdate(),n.refresh(),y.destroy()})),f=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e}));c.appendChild(m);var E=document.createElement("div");(E=pi(E)).style.height="8%",b=gi(b),f=gi(f),E.appendChild(b),E.appendChild(f),c.appendChild(E),l.appendChild(c);var y=new mxWindow(o("TitleBranchResultNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=y,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},kn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%",a.style.display="none";var c=document.createElement("textarea");(c=Ei(c)).style.height="90%";var h,u=mxUtils.button(o("Create"),(function(){var t=l.getElementsByTagName("textarea").item(0).value;if(!t)throw new Error(o("ExpressionIsMissing"));vi.K.parse(t);var i=e.editor.graph;if(i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),s=new mxCell("",new mxGeometry(n.x,n.y,120,60),"ellipse;whiteSpace=wrap;html=1;rounded=0;editable=0;");s.vertex=!0,i.setSelectionCell(i.addCell(s)),i.setAttributeForCell(s,"expression",t)}E.destroy()})),d=mxUtils.button(o("SwitchBlockly"),(function(){var e=l.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),l.style.display="none",a.style.display="block",g.innerHTML="",(h=Ot("conditionCreateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,h))}));l.appendChild(c);var p=document.createElement("div");(p=pi(p)).style.height="10%",u=gi(u),d=gi(d),p.appendChild(u),p.appendChild(d),l.appendChild(p),r.appendChild(l);var g=document.createElement("div");g.id="conditionCreateBlocklyDiv",(g=yi(g,n,s)).style.height=.88*s+"px";var m=mxUtils.button(o("Create"),(function(){var t=Wi(h);if(!t)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(t)}catch(e){throw new Error(o("EmptyConnection"))}var i=e.editor.graph;if(i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),s=new mxCell("",new mxGeometry(n.x,n.y,120,60),"ellipse;whiteSpace=wrap;html=1;rounded=0;editable=0;");s.vertex=!0,i.setSelectionCell(i.addCell(s)),i.setAttributeForCell(s,"expression",t)}E.destroy()})),b=mxUtils.button(o("SwitchText"),(function(){var e=Wi(h);a.style.display="none",l.style.display="block",l.getElementsByTagName("textarea").item(0).value=e}));a.appendChild(g);var f=document.createElement("div");(f=pi(f)).style.height="8%",m=gi(m),b=gi(b),f.appendChild(m),f.appendChild(b),a.appendChild(f),r.appendChild(a);var E=new mxWindow(o("TitleConditionNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=E,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},xn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=document.createElement("textarea");(h=Ei(h)).style.height="90%",h.value=e.value.getAttribute("expression");var u,d=mxUtils.button(o("Apply"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;if(!i)throw new Error(o("ExpressionIsMissing"));vi.K.parse(i);var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("expression",i),n.getModel().endUpdate(),n.refresh(),y.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",m.innerHTML="",(u=Ot("conditionUpdateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u))}));a.appendChild(h);var g=document.createElement("div");(g=pi(g)).style.height="10%",d=gi(d),p=gi(p),g.appendChild(d),g.appendChild(p),a.appendChild(g),l.appendChild(a);var m=document.createElement("div");m.id="conditionUpdateBlocklyDiv",(m=yi(m,s,r)).style.height=.88*r+"px";var b=mxUtils.button(o("Apply"),(function(){var i=Wi(u);if(!i)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("expression",i),n.getModel().endUpdate(),n.refresh(),y.destroy()})),f=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e}));c.appendChild(m);var E=document.createElement("div");(E=pi(E)).style.height="8%",b=gi(b),f=gi(f),E.appendChild(b),E.appendChild(f),c.appendChild(E),l.appendChild(c);var y=new mxWindow(o("TitleConditionNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=y,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Nn=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"expression",""),r.setAttributeForCell(a,"typeVar",""),r.setAttributeForCell(a,"nameVar",""),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Sn=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"expression",""),r.setAttributeForCell(a,"typeVar",""),r.setAttributeForCell(a,"nameVar",""),r.setAttributeForCell(a,"operator","AND"),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},An=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"expression",""),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Rn=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),"OR"==l?(r.setAttributeForCell(a,"type","OR"),r.setAttributeForCell(a,"label","OR")):(r.setAttributeForCell(a,"type","AND"),r.setAttributeForCell(a,"label","AND")),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},$n=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"type","predetermining"),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},On=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"ellipse;whiteSpace=wrap;html=1;rounded=0;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"expression",""),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Dn=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"type","START"),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Mn=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"rhombus;whiteSpace=wrap;html=1;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"expression",""),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Ln=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;editable=0;");a.vertex=!0,r.setSelectionCell(r.addCell(a)),r.setAttributeForCell(a,"expression",""),r.setAttributeForCell(a,"label",l),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Bn=function(e,t,i,n,o,s){var r=t.editor.graph;if("object"==typeof e.value)var l=e.value.getAttribute("label");else l=e.value;if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){r.getInsertPoint();var a=new mxCell("",new mxGeometry(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;");a.vertex=!0,a.value=l,r.setSelectionCell(r.addCell(a)),r.getModel().beginUpdate();var c=e.edges;c&&c.forEach(((t,i)=>{var n=null,o=null;t.source==e?(t.source=a,n=t.target):(t.target=a,o=t.source),a.edges?a.edges.push(t):a.edges=[t],n?a.edges[i].target=n:a.edges[i].source=o})),e.edges=null,r.removeCells([e]),r.getModel().endUpdate(),r.refresh()}},Pn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%",a.style.display="none";var c=["And","Or","Mutex","HYP"],h=document.createElement("textarea");(h=Ei(h)).style.height="74%";var u,d=mxUtils.button(o("Create"),(function(){var t=l.getElementsByTagName("textarea").item(0).value;if(!t)throw new Error(o("ExpressionIsMissing"));vi.K.parse(t);let i="";if(g.value?ji(g.value)||(i+=o("NameVariableIsIncorrect")):i+=o("NameVariableIsMissing"),void 0!==b.options[b.options.selectedIndex]&&b.options[b.options.selectedIndex].value||(i+=o("TypeVariableIsMissing")),i)throw new Error(i);var n=f.options[f.options.selectedIndex].value,s=e.editor.graph;if(s.isEnabled()&&!s.isCellLocked(s.getDefaultParent())){var r=s.getInsertPoint(),a=new mxCell("",new mxGeometry(r.x,r.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");a.vertex=!0,s.setSelectionCell(s.addCell(a));var c=b.options[b.options.selectedIndex].value;s.setAttributeForCell(a,"expression",t),s.setAttributeForCell(a,"typeVar",c),s.setAttributeForCell(a,"nameVar",g.value),s.setAttributeForCell(a,"operator",n)}k.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=l.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),l.style.display="none",a.style.display="block",y.innerHTML="",(u=Ot("cycleCreateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u)),_.value=g.value,w.options.selectedIndex=f.options.selectedIndex,T.options.selectedIndex=b.options.selectedIndex})),g=document.createElement("input");g.type="text",(g=mi(g)).style.height="5%",g.placeholder="New variable";var m=Ti(e),b=document.createElement("select");(b=bi(b)).style.height="5%",m.forEach((e=>{var t=new Option(e.name,e.name);b.options[b.options.length]=t}));var f=document.createElement("select");(f=bi(f)).style.height="5%",c.forEach((e=>{var t=new Option(e,e.toUpperCase());f.options[f.options.length]=t})),l.appendChild(h);var E=document.createElement("div");(E=pi(E)).style.height="10%",d=gi(d),p=gi(p),l.appendChild(g),l.appendChild(b),l.appendChild(f),E.appendChild(d),E.appendChild(p),l.appendChild(E),r.appendChild(l);var y=document.createElement("div");y.id="cycleCreateBlocklyDiv",(y=yi(y,n,s)).style.height=.72*s+"px";var v=mxUtils.button(o("Create"),(function(){var t=Wi(u);if(!t)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(t)}catch(e){throw new Error(o("EmptyConnection"))}let i="";if(_.value?ji(_.value)||(i+=o("NameVariableIsIncorrect")):i+=o("NameVariableIsMissing"),void 0!==T.options[T.options.selectedIndex]&&T.options[T.options.selectedIndex].value||(i+=o("TypeVariableIsMissing")),i)throw new Error(i);var n=w.options[w.options.selectedIndex].value,s=e.editor.graph;if(s.isEnabled()&&!s.isCellLocked(s.getDefaultParent())){var r=s.getInsertPoint(),l=new mxCell("",new mxGeometry(r.x,r.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");l.vertex=!0,s.setSelectionCell(s.addCell(l));var a=T.options[T.options.selectedIndex].value;s.setAttributeForCell(l,"expression",t),s.setAttributeForCell(l,"typeVar",a),s.setAttributeForCell(l,"nameVar",_.value),s.setAttributeForCell(l,"operator",n)}k.destroy()})),C=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);a.style.display="none",l.style.display="block",l.getElementsByTagName("textarea").item(0).value=e,g.value=_.value,f.options.selectedIndex=w.options.selectedIndex,b.options.selectedIndex=T.options.selectedIndex})),_=document.createElement("input");_.type="text",(_=mi(_)).style.height="5%",_.placeholder="New variable";var T=document.createElement("select");(T=bi(T)).style.height="5%",m.forEach((e=>{var t=new Option(e.name,e.name);T.options[T.options.length]=t}));var w=document.createElement("select");(w=bi(w)).style.height="5%",c.forEach((e=>{var t=new Option(e,e.toUpperCase());w.options[w.options.length]=t})),a.appendChild(y);var I=document.createElement("div");(I=pi(I)).style.height="8%",v=gi(v),C=gi(C),a.appendChild(_),a.appendChild(T),a.appendChild(w),I.appendChild(v),I.appendChild(C),a.appendChild(I),r.appendChild(a);var k=new mxWindow(o("TitleCycleNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=k,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Fn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=["And","Or","Mutex","HYP"],u=document.createElement("textarea");(u=Ei(u)).style.height="74%",u.value=e.value.getAttribute("expression");var d,p=mxUtils.button(o("Apply"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;if(!i)throw new Error(o("ExpressionIsMissing"));vi.K.parse(i);let n="";if(m.value?ji(m.value)||(n+=o("NameVariableIsIncorrect")):n+=o("NameVariableIsMissing"),void 0!==f.options[f.options.selectedIndex]&&f.options[f.options.selectedIndex].value||(n+=o("TypeVariableIsMissing")),n)throw new Error(n);var s=y.options[y.options.selectedIndex].value,r=f.options[f.options.selectedIndex].value,l=t.editor.graph;l.getModel().beginUpdate(),e.value.setAttribute("expression",i),e.value.setAttribute("typeVar",r),e.value.setAttribute("nameVar",m.value),e.value.setAttribute("operator",s),l.getModel().endUpdate(),l.refresh(),S.destroy()})),g=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",_.innerHTML="",(d=Ot("cycleUpdateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,d)),I.value=m.value,x.options.selectedIndex=y.options.selectedIndex,k.options.selectedIndex=f.options.selectedIndex})),m=document.createElement("input");m.type="text",(m=mi(m)).style.height="5%",m.placeholder="New variable",m.value=e.value.getAttribute("nameVar");var b=Ti(t),f=document.createElement("select");(f=bi(f)).style.height="5%",b.forEach((e=>{var t=new Option(e.name,e.name);f.options[f.options.length]=t}));let E=e.value.getAttribute("typeVar");for(let e=0;e<f.options.length;++e)f.options[e].value==E&&(f.options[e].selected=!0);var y=document.createElement("select");(y=bi(y)).style.height="5%",h.forEach((e=>{var t=new Option(e,e.toUpperCase());y.options[y.options.length]=t}));let v=e.value.getAttribute("operator");for(let e=0;e<y.options.length;++e)y.options[e].value==v&&(y.options[e].selected=!0);a.appendChild(u);var C=document.createElement("div");(C=pi(C)).style.height="10%",p=gi(p),g=gi(g),a.appendChild(m),a.appendChild(f),a.appendChild(y),C.appendChild(p),C.appendChild(g),a.appendChild(C),l.appendChild(a);var _=document.createElement("div");_.id="cycleUpdateBlocklyDiv",(_=yi(_,s,r)).style.height=.72*r+"px";var T=mxUtils.button(o("Apply"),(function(){var i=Wi(d);if(!i)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}let n="";if(I.value?ji(I.value)||(n+=o("NameVariableIsIncorrect")):n+=o("NameVariableIsMissing"),void 0!==k.options[k.options.selectedIndex]&&k.options[k.options.selectedIndex].value||(n+=o("TypeVariableIsMissing")),n)throw new Error(n);var s=x.options[x.options.selectedIndex].value,r=k.options[k.options.selectedIndex].value,l=t.editor.graph;l.getModel().beginUpdate(),e.value.setAttribute("expression",i),e.value.setAttribute("typeVar",r),e.value.setAttribute("nameVar",I.value),e.value.setAttribute("operator",s),l.getModel().endUpdate(),l.refresh(),S.destroy()})),w=mxUtils.button(o("SwitchText"),(function(){var e=Wi(d);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e,m.value=I.value,y.options.selectedIndex=x.options.selectedIndex,f.options.selectedIndex=k.options.selectedIndex})),I=document.createElement("input");I.type="text",(I=mi(I)).style.height="5%",I.placeholder="New variable";var k=document.createElement("select");(k=bi(k)).style.height="5%",b.forEach((e=>{var t=new Option(e.name,e.name);k.options[k.options.length]=t}));var x=document.createElement("select");(x=bi(x)).style.height="5%",h.forEach((e=>{var t=new Option(e,e.toUpperCase());x.options[x.options.length]=t})),c.appendChild(_);var N=document.createElement("div");(N=pi(N)).style.height="8%",T=gi(T),w=gi(w),c.appendChild(I),c.appendChild(k),c.appendChild(x),N.appendChild(T),N.appendChild(w),c.appendChild(N),l.appendChild(c);var S=new mxWindow(o("TitleCycleNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=S,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Vn=function(e,t,i,n,s,r){var l=t.editor.graph,a=document.createElement("div"),c=document.createElement("div"),h=document.createElement("textarea");h.style.width="100%",h.style.resize="none",h.style.height="400px",h.style.fontSize="30px","object"==typeof e.value?h.value=e.value.getAttribute("label"):h.value=e.value;var u=e.value.getAttribute("expression"),d=mxUtils.button(o("Save"),(function(){var t=c.getElementsByTagName("textarea").item(0).value;l.getModel().beginUpdate(),"object"==typeof e.value?e.value.setAttribute("label",t):e.setValue(t),l.getModel().endUpdate(),l.refresh(),b.destroy()})),p=mxUtils.button(o("Generate"),(function(){let i="";"object"==typeof e.value&&(i=e.value.getAttribute("expression"));let n=function(e,t){if(""==e)return"";let i=Hi(e,t);return"int"==i.type||"double"==i.type?"How many ":"bool"==i.type?"Is ":"enum"==i.type&&"comparisonResult"!=i.enum?"What is ":"enum"==i.type&&"comparisonResult"==i.enum?"Compare ":""}(i,t);""!=n&&(h.value=n)})),g=document.createElement("div");g.innerHTML=o("ExpressionInNode")+u,g.style.height="60px",g.style.overflow="scroll",g.style.fontSize="20px",c.appendChild(g),c.appendChild(h);var m=document.createElement("div");(m=pi(m)).style.marginTop="10px",d=gi(d),p=gi(p),m.appendChild(d),m.appendChild(p),a.appendChild(c),a.appendChild(m);var b=new mxWindow(o("TitleEditTextInNodeWindow"),a,i,n,s,r,!0,!0);this.window=b,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Un=function(e,t,i,n,s,r){var l=t.editor.graph,a=document.createElement("div"),c=document.createElement("div"),h=document.createElement("label");h.innerHTML=o("HumanReadableText"),h.style.fontSize="20px";var u=document.createElement("input");u.type="text",(u=mi(u)).placeholder="Human-readable text",h.appendChild(u),c.appendChild(h);let d=e.source;if(null==d)throw new Error(o("sourceNodeIsMissing"));let p="";if("object"==typeof d.value&&d.value.getAttribute("expression")){let e=Hi(d.value.getAttribute("expression"),t);if("rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;editable=0;"==d.style){let e=document.createElement("label");e.innerHTML=o("value"),e.style.fontSize="20px";let t=document.createElement("select");t=bi(t),t.id="value_input",t.style.width="100%",["Found","Not found"].forEach((e=>{var i=new Option(e,e);t.options[t.options.length]=i})),e.appendChild(t),c.appendChild(e)}else if("int"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator")){p="int";var g=document.createElement("label");g.innerHTML=o("value"),g.style.fontSize="20px";var m=document.createElement("input");if((m=mi(m)).id="value_input",m.type="number",e.range){let t=e.range.split("-");m.min=t[0],m.max=t[1]}m.style.width="100%",g.appendChild(m),c.appendChild(g)}else if("bool"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator")){p="bool";let e=document.createElement("label");e.innerHTML=o("value"),e.style.fontSize="20px";let t=document.createElement("select");t=bi(t),t.id="value_input",t.style.width="100%";let i=new Option("True","True");t.options[t.options.length]=i;let n=new Option("False","False");t.options[t.options.length]=n,e.appendChild(t),c.appendChild(e)}else if("class"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator")){p="class";let e=document.createElement("label");e.innerHTML=o("value"),e.style.fontSize="20px";let i=document.createElement("select");i=bi(i),i.id="value_input",i.style.width="100%",Ti(t).forEach((e=>{var t=new Option(e.name,e.name);i.options[i.options.length]=t})),e.appendChild(i),c.appendChild(e)}else if("double"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator")){p="double";let t=document.createElement("label");t.innerHTML=o("value"),t.style.fontSize="20px";let i=document.createElement("input");if(i=mi(i),i.id="value_input",i.type="number",i.step="0.01",e.range){let t=e.range.split("-");i.min=t[0],i.max=t[1]}i.style.width="100%",t.appendChild(i),c.appendChild(t)}else if("string"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator")){p="string";let e=document.createElement("label");e.innerHTML=o("value"),e.style.fontSize="20px";let t=document.createElement("input");t=mi(t),t.id="value_input",t.type="text",t.style.width="100%",t.placeholder="value string",e.appendChild(t),c.appendChild(e)}else if("enum"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator")){p="enum";let i=document.createElement("label");i.innerHTML=o("value"),i.style.fontSize="20px";let n=document.createElement("select");n=bi(n),n.id="value_input",n.style.width="100%";let s=_i(t).filter((t=>t.nameEnum==e.enum));if(null==s[0])throw new Error(o("EnumIsMissing"));s[0].values.forEach((t=>{var i=new Option(e.enum+":"+t,e.enum+":"+t);n.options[n.options.length]=i})),i.appendChild(n),c.appendChild(i)}else if("assign"==e.type&&"AND"!=d.value.getAttribute("operator")&&"OR"!=d.value.getAttribute("operator")&&"HYP"!=d.value.getAttribute("operator"))throw new Error(o("AssignInNode"))}if("object"==typeof d.value&&"START"==d.value.getAttribute("type")){let e=document.createElement("label");e.innerHTML=o("type"),e.style.fontSize="20px";let t=document.createElement("select");t=bi(t),t.id="type_input",t.style.width="100%",["int","bool","double","object","enum"].forEach((e=>{var i=new Option(e,e);t.options[t.options.length]=i})),e.appendChild(t),c.appendChild(e)}else if("object"==typeof d.value&&"predetermining"==d.value.getAttribute("type")){let e=document.createElement("label");e.innerHTML=o("type"),e.style.fontSize="20px";let t=document.createElement("select");t=bi(t),t.id="type_input",t.style.width="100%",["Branch","Correct","Error","Null"].forEach((e=>{var i=new Option(e,e);t.options[t.options.length]=i})),e.appendChild(t),c.appendChild(e)}else if("object"!=typeof d.value||"AND"!=d.value.getAttribute("type")&&"OR"!=d.value.getAttribute("type")&&"HYP"!=d.value.getAttribute("type")){if("object"==typeof d.value&&("AND"==d.value.getAttribute("operator")||"OR"==d.value.getAttribute("operator")||"HYP"==d.value.getAttribute("operator"))){let e=document.createElement("label");e.innerHTML=o("type"),e.style.fontSize="20px";let t=document.createElement("select");t=bi(t),t.id="type_input",t.style.width="100%",["Body","Correct","Error","Null"].forEach((e=>{var i=new Option(e,e);t.options[t.options.length]=i})),e.appendChild(t),c.appendChild(e)}}else{let e=document.createElement("label");e.innerHTML=o("type"),e.style.fontSize="20px";let t=document.createElement("select");t=bi(t),t.id="type_input",t.style.width="100%",["Branch","Correct","Error","Null"].forEach((e=>{var i=new Option(e,e);t.options[t.options.length]=i})),e.appendChild(t),c.appendChild(e)}var b=mxUtils.button(o("Save"),(function(){!function(e,t){let i="";if(""==e.getElementsByTagName("input").item(0).value&&"object"==typeof t&&"START"!=t.getAttribute("type")&&(i+=o("HumanReadableTextIsMissing")),null!=document.getElementById("value_input")&&""==document.getElementById("value_input").value&&(i+=o("ValueOutcomeIsMissing")),""!=i)throw new Error(i)}(c,e.source.value);var t=u.value;l.getModel().beginUpdate(),l.setAttributeForCell(e,"label",t);let i=document.getElementById("value_input"),n="";null!=i&&"SELECT"==i.tagName?(n=i.options[i.options.selectedIndex].value,l.setAttributeForCell(e,"typeValue",p)):null!=i&&"INPUT"==i.tagName&&(n=i.value,l.setAttributeForCell(e,"typeValue",p)),l.setAttributeForCell(e,"value",n);let s=document.getElementById("type_input");if(s){let t=s.options[s.options.selectedIndex].value;l.setAttributeForCell(e,"type",t)}e.style.includes("editable=0;")||(e.style+="editable=0;"),e.style=e.style.replace("strokeColor=#FF0000;",""),l.getModel().endUpdate(),l.refresh(),y.destroy()})),f=mxUtils.button(o("Generate"),(function(){let t=document.getElementById("value_input"),i=document.getElementById("type_input");var n="";null!=t&&"SELECT"==t.tagName?n=Gi(t.options[t.options.selectedIndex].value):null!=t&&"INPUT"==t.tagName?n=Gi(t.value):null==t&&"object"==typeof e.source.value&&"START"!=e.source.value.getAttribute("type")&&i&&(n=i.options[i.options.selectedIndex].value),u.value=n})),E=document.createElement("div");(E=pi(E)).style.marginTop="10px",gi(b),gi(f),E.appendChild(b),E.appendChild(f),a.appendChild(c),a.appendChild(E);var y=new mxWindow(o("TitleEditValueInOutcomeWindow"),a,i,n,s,r,!0,!0);if(this.window=y,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0),null!=e.value&&"object"==typeof e.value){u.value=e.value.getAttribute("label");let t=document.getElementById("value_input");if(null!=t&&"SELECT"==t.tagName){let i=e.value.getAttribute("value");for(let e=0;e<t.options.length;++e)t.options[e].value==i&&(t.options[e].selected=!0)}else null!=t&&"INPUT"==t.tagName&&(t.value=e.value.getAttribute("value"));let i=e.value.getAttribute("type"),n=document.getElementById("type_input");if(i&&n)for(let e=0;e<n.options.length;++e)n.options[e].value==i&&(n.options[e].selected=!0)}},Wn=function(e,t,i,n,s){var r=document.createElement("div");r.style.width="300px",r.style.height="150px",r.style.display="flex",r.style.alignItems="center",r.style.gap="5px",r.style.justifyContent="center";var l=mxUtils.button("And",(function(){var t=e.editor.graph;if(t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())){var i=t.getInsertPoint(),n=new mxCell("",new mxGeometry(i.x,i.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");n.value="AND",n.vertex=!0,t.setSelectionCell(t.addCell(n)),t.setAttributeForCell(n,"type","AND")}h.destroy()})),a=mxUtils.button("Or",(function(){var t=e.editor.graph;if(t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())){var i=t.getInsertPoint(),n=new mxCell("",new mxGeometry(i.x,i.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");n.value="OR",n.vertex=!0,t.setSelectionCell(t.addCell(n)),t.setAttributeForCell(n,"type","OR")}h.destroy()})),c=mxUtils.button("HYP",(function(){var t=e.editor.graph;if(t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())){var i=t.getInsertPoint(),n=new mxCell("",new mxGeometry(i.x,i.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");n.value="HYP",n.vertex=!0,t.setSelectionCell(t.addCell(n)),t.setAttributeForCell(n,"type","HYP")}h.destroy()}));(l=gi(l)).style.minWidth="32%",(a=gi(a)).style.minWidth="32%",(c=gi(c)).style.minWidth="32%",r.appendChild(l),r.appendChild(a),r.appendChild(c);var h=new mxWindow(o("TitleLogicNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=h,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Hn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.width="300px",l.style.height="150px",l.style.display="flex",l.style.alignItems="center",l.style.gap="5px",l.style.justifyContent="center";var a=mxUtils.button("And",(function(){var i=t.editor.graph;i.getModel().beginUpdate(),e.value.setAttribute("label","AND"),e.value.setAttribute("type","AND"),i.getModel().endUpdate(),i.refresh(),u.destroy()})),c=mxUtils.button("Or",(function(){var i=t.editor.graph;i.getModel().beginUpdate(),e.value.setAttribute("label","OR"),e.value.setAttribute("type","OR"),i.getModel().endUpdate(),i.refresh(),u.destroy()})),h=mxUtils.button("HYP",(function(){var i=t.editor.graph;i.getModel().beginUpdate(),e.value.setAttribute("label","HYP"),e.value.setAttribute("type","HYP"),i.getModel().endUpdate(),i.refresh(),u.destroy()}));(a=gi(a)).style.minWidth="32%",(c=gi(c)).style.minWidth="32%",(h=gi(h)).style.minWidth="32%",l.appendChild(a),l.appendChild(c),l.appendChild(h);var u=new mxWindow(o("TitleLogicNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=u,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Gn=function(e,t,i,n,s){var r=document.createElement("div"),l=document.createElement("table");l.style.width="100%",l.style.height="100%";var a=document.createElement("tbody"),c=document.createElement("tr"),h=document.createElement("td"),u=document.createElement("input");u.type="text",(u=mi(u)).placeholder="Value",h.appendChild(u),c.appendChild(h),a.appendChild(c),l.appendChild(a),r.appendChild(l);var d=mxUtils.button(o("Create"),(function(){var t=e.editor.graph;if(t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())){var i=t.getInsertPoint(),n=new mxCell("",new mxGeometry(i.x,i.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;editable=0;");n.value=l.rows.item(0).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value,n.vertex=!0,t.setSelectionCell(t.addCell(n)),l.rows.item(0).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value="",t.setAttributeForCell(n,"type","predetermining")}g.destroy()})),p=document.createElement("div");p=pi(p),d=gi(d),p.appendChild(d),r.appendChild(p);var g=new mxWindow(o("TitlePredeterminingFactorsNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=g,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},zn=function(e,t,i,n,s,r){var l=document.createElement("div"),a=document.createElement("table");a.style.width="100%",a.style.height="100%";var c=document.createElement("tbody"),h=document.createElement("tr"),u=document.createElement("td"),d=document.createElement("input");d.type="text",(d=mi(d)).placeholder="Value",d.value=e.value.getAttribute("label"),u.appendChild(d),h.appendChild(u),c.appendChild(h),a.appendChild(c),l.appendChild(a);var p=mxUtils.button(o("Apply"),(function(){var i=t.editor.graph,n=a.rows.item(0).getElementsByTagName("td").item(0).getElementsByTagName("input").item(0).value;i.getModel().beginUpdate(),e.value.setAttribute("label",n),i.getModel().endUpdate(),i.refresh(),m.destroy()})),g=document.createElement("div");g=pi(g),p=gi(p),g.appendChild(p),l.appendChild(g);var m=new mxWindow(o("TitlePredeterminingFactorsNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=m,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},jn=function(e,t,i,n,s,r){var l=t.editor.graph;let a="AND"==e.value.getAttribute("type")||"OR"==e.value.getAttribute("type");var c=document.createElement("div"),h=document.createElement("div");h.style.height="450px",h.style.overflow="scroll";var u=document.createElement("textarea");u.style.width="95%",u.style.height="100px",u.style.fontSize="20px",u.style.resize="vertical",e.value.getAttribute("_asNextStep")&&(u.value=e.value.getAttribute("_asNextStep"));var d=document.createElement("div");d.innerHTML=o("asNextStep"),d.style.fontSize="20px",h.appendChild(d),h.appendChild(u);var p=document.createElement("textarea");p.style.width="95%",p.style.height="100px",p.style.fontSize="20px",p.style.resize="vertical",a&&e.value.getAttribute("_description")?p.value=e.value.getAttribute("_description"):!a&&e.value.getAttribute("_question")&&(p.value=e.value.getAttribute("_question"));var g=document.createElement("div");g.innerHTML=o(a?"descriptionQuestion":"questionQuestion"),g.style.fontSize="20px",h.appendChild(g),h.appendChild(p);var m=document.createElement("textarea");m.style.width="95%",m.style.height="100px",m.style.fontSize="20px",m.style.resize="vertical",e.value.getAttribute("_endingCause")&&(m.value=e.value.getAttribute("_endingCause"));var b=document.createElement("div");b.innerHTML=o("endingCause"),b.style.fontSize="20px",h.appendChild(b),h.appendChild(m);var f=mxUtils.button(o("Save"),(function(){l.getModel().beginUpdate(),e.value.setAttribute("_asNextStep",u.value),a?e.value.setAttribute("_description",p.value):e.value.setAttribute("_question",p.value),e.value.setAttribute("_endingCause",m.value),l.getModel().endUpdate(),l.refresh(),y.destroy()})),E=document.createElement("div");E.style.display="flex",E.style.gap="5px",E.style.height="10%",E.style.alignItems="center",E.style.justifyContent="center",f=gi(f),E.appendChild(f),c.appendChild(h),c.appendChild(E);var y=new mxWindow(o("TitleEditQuestionInfoInNodeWindow"),c,i,n,s,r,!0,!0);this.window=y,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Xn=function(e,t,i,n,s,r){var l=t.editor.graph;let a=e.source;if(null==a)throw new Error(o("sourceNodeIsMissing"));if(!e.value||"object"!=typeof e.value)throw new Error(o("ValueInOutcomeIsMissing"));var c=document.createElement("div"),h=document.createElement("div");h.style.height="450px",h.style.overflow="scroll";let u="object"==typeof a.value&&("START"==a.value.getAttribute("type")||("AND"==a.value.getAttribute("type")||"OR"==a.value.getAttribute("type"))&&"object"==typeof e.value&&"Branch"==e.value.getAttribute("type")||("AND"==a.value.getAttribute("operator")||"OR"==a.value.getAttribute("operator"))&&"object"==typeof e.value&&"Body"==e.value.getAttribute("type")),d="object"==typeof e.value&&"predeterminingBranch"==e.value.getAttribute("type");if(u&&!d)(b=document.createElement("textarea")).id="_description",b.style.width="95%",b.style.height="100px",b.style.fontSize="20px",b.style.resize="vertical",e.value.getAttribute("_description")&&(b.value=e.value.getAttribute("_description")),(f=document.createElement("div")).innerHTML=o("descriptionOutcome"),f.style.fontSize="20px",h.appendChild(f),h.appendChild(b),(x=document.createElement("textarea")).id="_nextStepQuestion",x.style.width="95%",x.style.height="100px",x.style.fontSize="20px",x.style.resize="vertical",e.value.getAttribute("_nextStepQuestion")&&(x.value=e.value.getAttribute("_nextStepQuestion")),(N=document.createElement("div")).innerHTML=o("nextStepQuestion"),N.style.fontSize="20px",h.appendChild(N),h.appendChild(x),(R=document.createElement("textarea")).id="_nextStepExplanation",R.style.width="95%",R.style.height="100px",R.style.fontSize="20px",R.style.resize="vertical",e.value.getAttribute("_nextStepExplanation")&&(R.value=e.value.getAttribute("_nextStepExplanation")),($=document.createElement("div")).innerHTML=o("nextStepExplanation"),$.style.fontSize="20px",h.appendChild($),h.appendChild(R);else if(!u&&d){(T=document.createElement("textarea")).id="_text",T.style.width="95%",T.style.height="100px",T.style.fontSize="20px",T.style.resize="vertical",e.value.getAttribute("_text")&&(T.value=e.value.getAttribute("_text")),(w=document.createElement("div")).innerHTML=o("textQuestion"),w.style.fontSize="20px",h.appendChild(w),h.appendChild(T),(I=document.createElement("textarea")).id="_explanation",I.style.width="95%",I.style.height="100px",I.style.fontSize="20px",I.style.resize="vertical",e.value.getAttribute("_explanation")&&(I.value=e.value.getAttribute("_explanation")),(k=document.createElement("div")).innerHTML=o("explanation"),k.style.fontSize="20px",h.appendChild(k),h.appendChild(I);var p=document.createElement("textarea");p.id="_nextStepQuestionOutcome",p.style.width="95%",p.style.height="100px",p.style.fontSize="20px",p.style.resize="vertical",e.value.getAttribute("_nextStepQuestionOutcome")&&(p.value=e.value.getAttribute("_nextStepQuestionOutcome"));var g=document.createElement("div");g.innerHTML=o("nextStepQuestionOutcome"),g.style.fontSize="20px",h.appendChild(g),h.appendChild(p),(S=document.createElement("textarea")).id="_nextStepBranchResult",S.style.width="95%",S.style.height="100px",S.style.fontSize="20px",S.style.resize="vertical",e.value.getAttribute("_nextStepBranchResult")&&(S.value=e.value.getAttribute("_nextStepBranchResult")),(A=document.createElement("div")).innerHTML=o("nextStepBranchResult"),A.style.fontSize="20px",h.appendChild(A),h.appendChild(S);var m=document.createElement("textarea");m.id="_nextStepExplanationOutcome",m.style.width="95%",m.style.height="100px",m.style.fontSize="20px",m.style.resize="vertical",e.value.getAttribute("_nextStepExplanationOutcome")&&(m.value=e.value.getAttribute("_nextStepExplanationOutcome"));var b,f,E=document.createElement("div");E.innerHTML=o("nextStepExplanationOutcome"),E.style.fontSize="20px",h.appendChild(E),h.appendChild(m),(b=document.createElement("textarea")).id="_description",b.style.width="95%",b.style.height="100px",b.style.fontSize="20px",b.style.resize="vertical",e.value.getAttribute("_description")&&(b.value=e.value.getAttribute("_description")),(f=document.createElement("div")).innerHTML=o("descriptionOutcome"),f.style.fontSize="20px",h.appendChild(f),h.appendChild(b);var y=document.createElement("textarea");y.id="_nextStepQuestionThoughtBranch",y.style.width="95%",y.style.height="100px",y.style.fontSize="20px",y.style.resize="vertical",e.value.getAttribute("_nextStepQuestionThoughtBranch")&&(y.value=e.value.getAttribute("_nextStepQuestionThoughtBranch"));var v=document.createElement("div");v.innerHTML=o("nextStepQuestion"),v.style.fontSize="20px",h.appendChild(v),h.appendChild(y);var C=document.createElement("textarea");C.id="_nextStepExplanationThoughtBranch",C.style.width="95%",C.style.height="100px",C.style.fontSize="20px",C.style.resize="vertical",e.value.getAttribute("_nextStepExplanationThoughtBranch")&&(C.value=e.value.getAttribute("_nextStepExplanationThoughtBranch"));var _=document.createElement("div");_.innerHTML=o("nextStepExplanation"),_.style.fontSize="20px",h.appendChild(_),h.appendChild(C)}else if(!u&&!d){var T,w,I,k,x,N,S,A,R,$;(T=document.createElement("textarea")).id="_text",T.style.width="95%",T.style.height="100px",T.style.fontSize="20px",T.style.resize="vertical",e.value.getAttribute("_text")&&(T.value=e.value.getAttribute("_text")),(w=document.createElement("div")).innerHTML=o("textQuestion"),w.style.fontSize="20px",h.appendChild(w),h.appendChild(T),(I=document.createElement("textarea")).id="_explanation",I.style.width="95%",I.style.height="100px",I.style.fontSize="20px",I.style.resize="vertical",e.value.getAttribute("_explanation")&&(I.value=e.value.getAttribute("_explanation")),(k=document.createElement("div")).innerHTML=o("explanation"),k.style.fontSize="20px",h.appendChild(k),h.appendChild(I),(x=document.createElement("textarea")).id="_nextStepQuestion",x.style.width="95%",x.style.height="100px",x.style.fontSize="20px",x.style.resize="vertical",e.value.getAttribute("_nextStepQuestion")&&(x.value=e.value.getAttribute("_nextStepQuestion")),(N=document.createElement("div")).innerHTML=o("nextStepQuestionOutcome"),N.style.fontSize="20px",h.appendChild(N),h.appendChild(x),(S=document.createElement("textarea")).id="_nextStepBranchResult",S.style.width="95%",S.style.height="100px",S.style.fontSize="20px",S.style.resize="vertical",e.value.getAttribute("_nextStepBranchResult")&&(S.value=e.value.getAttribute("_nextStepBranchResult")),(A=document.createElement("div")).innerHTML=o("nextStepBranchResult"),A.style.fontSize="20px",h.appendChild(A),h.appendChild(S),(R=document.createElement("textarea")).id="_nextStepExplanation",R.style.width="95%",R.style.height="100px",R.style.fontSize="20px",R.style.resize="vertical",e.value.getAttribute("_nextStepExplanation")&&(R.value=e.value.getAttribute("_nextStepExplanation")),($=document.createElement("div")).innerHTML=o("nextStepExplanationOutcome"),$.style.fontSize="20px",h.appendChild($),h.appendChild(R)}var O=mxUtils.button(o("Save"),(function(){l.getModel().beginUpdate(),u&&!d?(e.value.setAttribute("_description",h.querySelector("#_description").value),e.value.setAttribute("_nextStepQuestion",h.querySelector("#_nextStepQuestion").value),e.value.setAttribute("_nextStepExplanation",h.querySelector("#_nextStepExplanation").value)):!u&&d?(e.value.setAttribute("_text",h.querySelector("#_text").value),e.value.setAttribute("_explanation",h.querySelector("#_explanation").value),e.value.setAttribute("_nextStepBranchResult",h.querySelector("#_nextStepBranchResult").value),e.value.setAttribute("_nextStepQuestionOutcome",h.querySelector("#_nextStepQuestionOutcome").value),e.value.setAttribute("_nextStepExplanationOutcome",h.querySelector("#_nextStepExplanationOutcome").value),e.value.setAttribute("_description",h.querySelector("#_description").value),e.value.setAttribute("_nextStepQuestionThoughtBranch",h.querySelector("#_nextStepQuestionThoughtBranch").value),e.value.setAttribute("_nextStepExplanationThoughtBranch",h.querySelector("#_nextStepExplanationThoughtBranch").value)):u||d||(e.value.setAttribute("_text",h.querySelector("#_text").value),e.value.setAttribute("_explanation",h.querySelector("#_explanation").value),e.value.setAttribute("_nextStepBranchResult",h.querySelector("#_nextStepBranchResult").value),e.value.setAttribute("_nextStepQuestion",h.querySelector("#_nextStepQuestion").value),e.value.setAttribute("_nextStepExplanation",h.querySelector("#_nextStepExplanation").value)),l.getModel().endUpdate(),l.refresh(),M.destroy()})),D=document.createElement("div");D.style.display="flex",D.style.gap="5px",D.style.height="10%",D.style.alignItems="center",D.style.justifyContent="center",O=gi(O),D.appendChild(O),c.appendChild(h),c.appendChild(D);var M=new mxWindow(o("TitleEditQuestionInfoInOutcomeWindow"),c,i,n,s,r,!0,!0);this.window=M,this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Kn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%",a.style.display="none";var c=document.createElement("textarea");(c=Ei(c)).style.height="90%";var h,u=mxUtils.button(o("Create"),(function(){var t=l.getElementsByTagName("textarea").item(0).value;if(!t)throw new Error(o("ExpressionIsMissing"));vi.K.parse(t);var i=e.editor.graph;if(i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),s=new mxCell("",new mxGeometry(n.x,n.y,80,80),"rhombus;whiteSpace=wrap;html=1;editable=0;");s.vertex=!0,i.setSelectionCell(i.addCell(s)),i.setAttributeForCell(s,"expression",t)}E.destroy()})),d=mxUtils.button(o("SwitchBlockly"),(function(){var e=l.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),l.style.display="none",a.style.display="block",g.innerHTML="",(h=Ot("switchCaseCreateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,h))}));l.appendChild(c);var p=document.createElement("div");(p=pi(p)).style.height="10%",u=gi(u),d=gi(d),p.appendChild(u),p.appendChild(d),l.appendChild(p),r.appendChild(l);var g=document.createElement("div");g.id="switchCaseCreateBlocklyDiv",(g=yi(g,n,s)).style.height=.88*s+"px";var m=mxUtils.button(o("Create"),(function(){var t=Wi(h);if(!t)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(t)}catch(e){throw new Error(o("EmptyConnection"))}var i=e.editor.graph;if(i.isEnabled()&&!i.isCellLocked(i.getDefaultParent())){var n=i.getInsertPoint(),s=new mxCell("",new mxGeometry(n.x,n.y,80,80),"rhombus;whiteSpace=wrap;html=1;editable=0;");s.vertex=!0,i.setSelectionCell(i.addCell(s)),i.setAttributeForCell(s,"expression",t)}E.destroy()})),b=mxUtils.button(o("SwitchText"),(function(){var e=Wi(h);a.style.display="none",l.style.display="block",l.getElementsByTagName("textarea").item(0).value=e}));a.appendChild(g);var f=document.createElement("div");(f=pi(f)).style.height="8%",m=gi(m),b=gi(b),f.appendChild(m),f.appendChild(b),a.appendChild(f),r.appendChild(a);var E=new mxWindow(o("TitleSwitchCaseNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=E,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Yn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=document.createElement("textarea");(h=Ei(h)).style.height="90%",h.value=e.value.getAttribute("expression");var u,d=mxUtils.button(o("Apply"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;if(!i)throw new Error(o("ExpressionIsMissing"));vi.K.parse(i);var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("expression",i),n.getModel().endUpdate(),n.refresh(),y.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",m.innerHTML="",(u=Ot("switchCaseUpdateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u))}));a.appendChild(h);var g=document.createElement("div");(g=pi(g)).style.height="10%",d=gi(d),p=gi(p),g.appendChild(d),g.appendChild(p),a.appendChild(g),l.appendChild(a);var m=document.createElement("div");m.id="switchCaseUpdateBlocklyDiv",(m=yi(m,s,r)).style.height=.88*r+"px";var b=mxUtils.button(o("Apply"),(function(){var i=Wi(u);if(!i)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}var n=t.editor.graph;n.getModel().beginUpdate(),e.value.setAttribute("expression",i),n.getModel().endUpdate(),n.refresh(),y.destroy()})),f=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e}));c.appendChild(m);var E=document.createElement("div");(E=pi(E)).style.height="8%",b=gi(b),f=gi(f),E.appendChild(b),E.appendChild(f),c.appendChild(E),l.appendChild(c);var y=new mxWindow(o("TitleSwitchCaseNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=y,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Jn=function(e,t,i,n,s){var r=document.createElement("div");r.style.height="100%";var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%",a.style.display="none";var c=["And","Or"],h=document.createElement("textarea");(h=Ei(h)).style.height="74%";var u,d=mxUtils.button(o("Create"),(function(){var t=l.getElementsByTagName("textarea").item(0).value;if(!t)throw new Error(o("ExpressionIsMissing"));vi.K.parse(t);let i="";if(g.value?ji(g.value)||(i+=o("NameVariableIsIncorrect")):i+=o("NameVariableIsMissing"),void 0!==b.options[b.options.selectedIndex]&&b.options[b.options.selectedIndex].value||(i+=o("TypeVariableIsMissing")),i)throw new Error(i);var n=f.options[f.options.selectedIndex].value,s=e.editor.graph;if(s.isEnabled()&&!s.isCellLocked(s.getDefaultParent())){var r=s.getInsertPoint(),a=new mxCell("",new mxGeometry(r.x,r.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");a.vertex=!0,s.setSelectionCell(s.addCell(a));var c=b.options[b.options.selectedIndex].value;s.setAttributeForCell(a,"expression",t),s.setAttributeForCell(a,"typeVar",c),s.setAttributeForCell(a,"nameVar",g.value),s.setAttributeForCell(a,"operator",n),s.setAttributeForCell(a,"typeCycle","while")}k.destroy()})),p=mxUtils.button(o("SwitchBlockly"),(function(){var e=l.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),l.style.display="none",a.style.display="block",y.innerHTML="",(u=Ot("cycleCreateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,u)),_.value=g.value,w.options.selectedIndex=f.options.selectedIndex,T.options.selectedIndex=b.options.selectedIndex})),g=document.createElement("input");g.type="text",(g=mi(g)).style.height="5%",g.placeholder="New variable";var m=Ti(e),b=document.createElement("select");(b=bi(b)).style.height="5%",m.forEach((e=>{var t=new Option(e.name,e.name);b.options[b.options.length]=t}));var f=document.createElement("select");(f=bi(f)).style.height="5%",c.forEach((e=>{var t=new Option(e,e.toUpperCase());f.options[f.options.length]=t})),l.appendChild(h);var E=document.createElement("div");(E=pi(E)).style.height="10%",d=gi(d),p=gi(p),l.appendChild(g),l.appendChild(b),l.appendChild(f),E.appendChild(d),E.appendChild(p),l.appendChild(E),r.appendChild(l);var y=document.createElement("div");y.id="cycleCreateBlocklyDiv",(y=yi(y,n,s)).style.height=.72*s+"px";var v=mxUtils.button(o("Create"),(function(){var t=Wi(u);if(!t)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(t)}catch(e){throw new Error(o("EmptyConnection"))}let i="";if(_.value?ji(_.value)||(i+=o("NameVariableIsIncorrect")):i+=o("NameVariableIsMissing"),void 0!==T.options[T.options.selectedIndex]&&T.options[T.options.selectedIndex].value||(i+=o("TypeVariableIsMissing")),i)throw new Error(i);var n=w.options[w.options.selectedIndex].value,s=e.editor.graph;if(s.isEnabled()&&!s.isCellLocked(s.getDefaultParent())){var r=s.getInsertPoint(),l=new mxCell("",new mxGeometry(r.x,r.y,120,80),"shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontColor=#000000;align=center;editable=0;");l.vertex=!0,s.setSelectionCell(s.addCell(l));var a=T.options[T.options.selectedIndex].value;s.setAttributeForCell(l,"expression",t),s.setAttributeForCell(l,"typeVar",a),s.setAttributeForCell(l,"nameVar",_.value),s.setAttributeForCell(l,"operator",n),s.setAttributeForCell(l,"typeCycle","while")}k.destroy()})),C=mxUtils.button(o("SwitchText"),(function(){var e=Wi(u);a.style.display="none",l.style.display="block",l.getElementsByTagName("textarea").item(0).value=e,g.value=_.value,f.options.selectedIndex=w.options.selectedIndex,b.options.selectedIndex=T.options.selectedIndex})),_=document.createElement("input");_.type="text",(_=mi(_)).style.height="5%",_.placeholder="New variable";var T=document.createElement("select");(T=bi(T)).style.height="5%",m.forEach((e=>{var t=new Option(e.name,e.name);T.options[T.options.length]=t}));var w=document.createElement("select");(w=bi(w)).style.height="5%",c.forEach((e=>{var t=new Option(e,e.toUpperCase());w.options[w.options.length]=t})),a.appendChild(y);var I=document.createElement("div");(I=pi(I)).style.height="8%",v=gi(v),C=gi(C),a.appendChild(_),a.appendChild(T),a.appendChild(w),I.appendChild(v),I.appendChild(C),a.appendChild(I),r.appendChild(a);var k=new mxWindow(o("TitleWhileNodeConstructorWindow"),r,t,i,n,s,!0,!0);this.window=k,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},qn=function(e,t,i,n,s,r){var l=document.createElement("div");l.style.height="100%";var a=document.createElement("div");a.style.height="100%";var c=document.createElement("div");c.style.height="100%",c.style.display="none";var h=["And","Or"],u=document.createElement("textarea");(u=Ei(u)).style.height="74%",u.value=e.value.getAttribute("expression");var d,p=mxUtils.button(o("Apply"),(function(){var i=a.getElementsByTagName("textarea").item(0).value;if(!i)throw new Error(o("ExpressionIsMissing"));vi.K.parse(i);let n="";if(m.value?ji(m.value)||(n+=o("NameVariableIsIncorrect")):n+=o("NameVariableIsMissing"),void 0!==f.options[f.options.selectedIndex]&&f.options[f.options.selectedIndex].value||(n+=o("TypeVariableIsMissing")),n)throw new Error(n);var s=y.options[y.options.selectedIndex].value,r=f.options[f.options.selectedIndex].value,l=t.editor.graph;l.getModel().beginUpdate(),e.value.setAttribute("expression",i),e.value.setAttribute("typeVar",r),e.value.setAttribute("nameVar",m.value),e.value.setAttribute("operator",s),l.getModel().endUpdate(),l.refresh(),S.destroy()})),g=mxUtils.button(o("SwitchBlockly"),(function(){var e=a.getElementsByTagName("textarea").item(0).value;e&&vi.K.parse(e),a.style.display="none",c.style.display="block",_.innerHTML="",(d=Ot("cycleUpdateBlocklyDiv",{toolbox:hi})).clear(),e&&(vi.K.parse(e),Ii(vi.z,d)),I.value=m.value,x.options.selectedIndex=y.options.selectedIndex,k.options.selectedIndex=f.options.selectedIndex})),m=document.createElement("input");m.type="text",(m=mi(m)).style.height="5%",m.placeholder="New variable",m.value=e.value.getAttribute("nameVar");var b=Ti(t),f=document.createElement("select");(f=bi(f)).style.height="5%",b.forEach((e=>{var t=new Option(e.name,e.name);f.options[f.options.length]=t}));let E=e.value.getAttribute("typeVar");for(let e=0;e<f.options.length;++e)f.options[e].value==E&&(f.options[e].selected=!0);var y=document.createElement("select");(y=bi(y)).style.height="5%",h.forEach((e=>{var t=new Option(e,e.toUpperCase());y.options[y.options.length]=t}));let v=e.value.getAttribute("operator");for(let e=0;e<y.options.length;++e)y.options[e].value==v&&(y.options[e].selected=!0);a.appendChild(u);var C=document.createElement("div");(C=pi(C)).style.height="10%",p=gi(p),g=gi(g),a.appendChild(m),a.appendChild(f),a.appendChild(y),C.appendChild(p),C.appendChild(g),a.appendChild(C),l.appendChild(a);var _=document.createElement("div");_.id="cycleUpdateBlocklyDiv",(_=yi(_,s,r)).style.height=.72*r+"px";var T=mxUtils.button(o("Apply"),(function(){var i=Wi(d);if(!i)throw new Error(o("ExpressionIsMissing"));try{vi.K.parse(i)}catch(e){throw new Error(o("EmptyConnection"))}let n="";if(I.value?ji(I.value)||(n+=o("NameVariableIsIncorrect")):n+=o("NameVariableIsMissing"),void 0!==k.options[k.options.selectedIndex]&&k.options[k.options.selectedIndex].value||(n+=o("TypeVariableIsMissing")),n)throw new Error(n);var s=x.options[x.options.selectedIndex].value,r=k.options[k.options.selectedIndex].value,l=t.editor.graph;l.getModel().beginUpdate(),e.value.setAttribute("expression",i),e.value.setAttribute("typeVar",r),e.value.setAttribute("nameVar",I.value),e.value.setAttribute("operator",s),l.getModel().endUpdate(),l.refresh(),S.destroy()})),w=mxUtils.button(o("SwitchText"),(function(){var e=Wi(d);c.style.display="none",a.style.display="block",a.getElementsByTagName("textarea").item(0).value=e,m.value=I.value,y.options.selectedIndex=x.options.selectedIndex,f.options.selectedIndex=k.options.selectedIndex})),I=document.createElement("input");I.type="text",(I=mi(I)).style.height="5%",I.placeholder="New variable";var k=document.createElement("select");(k=bi(k)).style.height="5%",b.forEach((e=>{var t=new Option(e.name,e.name);k.options[k.options.length]=t}));var x=document.createElement("select");(x=bi(x)).style.height="5%",h.forEach((e=>{var t=new Option(e,e.toUpperCase());x.options[x.options.length]=t})),c.appendChild(_);var N=document.createElement("div");(N=pi(N)).style.height="8%",T=gi(T),w=gi(w),c.appendChild(I),c.appendChild(k),c.appendChild(x),N.appendChild(T),N.appendChild(w),c.appendChild(N),l.appendChild(c);var S=new mxWindow(o("TitleWhileNodeEditorWindow"),l,i,n,s,r,!0,!0);this.window=S,this.window.contentWrapper.style.height="100%",this.window.destroyOnClose=!0,this.window.setMaximizable(!1),this.window.setResizable(!1),this.window.setClosable(!0),this.window.setVisible(!0)},Qn=document.createElement("div");Qn.id="globalWS",document.body.appendChild(Qn);var Zn=Ot("globalWS",{toolbox:hi});Draw.loadPlugin((function(e){var t=e.editor.graph,i=(t.getModel(),e.sidebar.container);i.firstChild.click(),i.insertBefore(i.lastChild,i.firstChild),i.insertBefore(i.lastChild,i.firstChild),e.menubar.addMenu(o("menuItemDictionaryConstructors"),(function(t,i){e.menus.addMenuItem(t,"classesConstructor"),e.menus.addMenuItem(t,"classPropertiesConstructor"),e.menus.addMenuItem(t,"relationshipsConstructor"),e.menus.addMenuItem(t,"enumConstructor")}),e.menubar.editorUi.statusContainer),e.menubar.addMenu(o("menuItemNodeConstructors"),(function(t,i){e.menus.addMenuItem(t,"startNodeConstructor"),e.menus.addMenuItem(t,"TrueNodeCreate"),e.menus.addMenuItem(t,"FalseNodeCreate"),e.menus.addMenuItem(t,"LogicNodeCreate"),e.menus.addMenuItem(t,"PredeterminingFactorsNodeCreate"),e.menus.addMenuItem(t,"UncertaintyNodeCreate"),e.menus.addMenuItem(t,"actionNodeConstructor"),e.menus.addMenuItem(t,"cycleNodeConstructor"),e.menus.addMenuItem(t,"whileNodeConstructor"),e.menus.addMenuItem(t,"conditionNodeConstructor"),e.menus.addMenuItem(t,"switchCaseNodeConstructor")}),e.menubar.editorUi.statusContainer),e.menubar.addMenu(o("menuItemExport"),(function(t,i){e.menus.addMenuItem(t,"exportClass"),e.menus.addMenuItem(t,"exportProperty"),e.menus.addMenuItem(t,"exportRelationship"),e.menus.addMenuItem(t,"exportEnum"),e.menus.addMenuItem(t,"exportTree")}),e.menubar.editorUi.statusContainer),e.menubar.addMenu(o("menuItemEdit"),(function(t,i){e.menus.addMenuItem(t,"editValue"),e.menus.addMenuItem(t,"editTextInNode"),e.menus.addMenuItem(t,"editQuestionInfo")}),e.menubar.editorUi.statusContainer),e.menubar.addMenu(o("menuItemConverNode"),(function(t,i){e.menus.addMenuItem(t,"convertStartNode"),e.menus.addMenuItem(t,"convertTrueNode"),e.menus.addMenuItem(t,"convertFalseNode"),e.menus.addMenuItem(t,"convertLogicNode"),e.menus.addMenuItem(t,"convertPredeterminingFactorsNode"),e.menus.addMenuItem(t,"convertUncertaintyNode"),e.menus.addMenuItem(t,"convertActionNode"),e.menus.addMenuItem(t,"convertCycleNode"),e.menus.addMenuItem(t,"convertConditionNode"),e.menus.addMenuItem(t,"convertSwitchCaseNode")}),e.menubar.editorUi.statusContainer),mxResources.parse("classesConstructor="+o("classesConstructor")),mxResources.parse("classPropertiesConstructor="+o("classPropertiesConstructor")),mxResources.parse("relationshipsConstructor="+o("relationshipsConstructor")),mxResources.parse("enumConstructor="+o("enumConstructor")),mxResources.parse("actionNodeConstructor="+o("actionNodeConstructor")),mxResources.parse("cycleNodeConstructor="+o("cycleNodeConstructor")),mxResources.parse("whileNodeConstructor="+o("whileNodeConstructor")),mxResources.parse("conditionNodeConstructor="+o("conditionNodeConstructor")),mxResources.parse("switchCaseNodeConstructor="+o("switchCaseNodeConstructor")),mxResources.parse("exportEnum="+o("exportEnum")),mxResources.parse("exportClass="+o("exportClass")),mxResources.parse("exportProperty="+o("exportProperty")),mxResources.parse("exportRelationship="+o("exportRelationship")),mxResources.parse("TrueNodeCreate="+o("TrueNodeCreate")),mxResources.parse("FalseNodeCreate="+o("FalseNodeCreate")),mxResources.parse("LogicNodeCreate="+o("LogicNodeCreate")),mxResources.parse("PredeterminingFactorsNodeCreate="+o("PredeterminingFactorsNodeCreate")),mxResources.parse("UncertaintyNodeCreate="+o("UncertaintyNodeCreate")),mxResources.parse("startNodeConstructor="+o("startNodeConstructor")),mxResources.parse("exportTree="+o("exportTree")),mxResources.parse("editValue="+o("editValue")),mxResources.parse("editTextInNode="+o("editTextInNode")),mxResources.parse("editQuestionInfo="+o("editQuestionInfo")),mxResources.parse("convertStartNode="+o("convertStartNode")),mxResources.parse("convertTrueNode="+o("convertTrueNode")),mxResources.parse("convertFalseNode="+o("convertFalseNode")),mxResources.parse("convertLogicNode="+o("convertLogicNode")),mxResources.parse("convertPredeterminingFactorsNode="+o("convertPredeterminingFactorsNode")),mxResources.parse("convertUncertaintyNode="+o("convertUncertaintyNode")),mxResources.parse("convertActionNode="+o("convertActionNode")),mxResources.parse("convertCycleNode="+o("convertCycleNode")),mxResources.parse("convertConditionNode="+o("convertConditionNode")),mxResources.parse("convertSwitchCaseNode="+o("convertSwitchCaseNode")),e.actions.addAction("classesConstructor",(function(){this.classConstructorWindow&&this.classConstructorWindow.window.content||(this.classConstructorWindow=new Ki(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.classConstructorWindow.window.setVisible(!0))})),e.actions.addAction("classPropertiesConstructor",(function(){this.classPropertiesConstructorWindow&&this.classPropertiesConstructorWindow.window.content||(this.classPropertiesConstructorWindow=new Zi(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.classPropertiesConstructorWindow.window.setVisible(!0))})),e.actions.addAction("enumConstructor",(function(){this.enumConstructorWindow&&this.enumConstructorWindow.window.content||(this.enumConstructorWindow=new sn(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.enumConstructorWindow.window.setVisible(!0))})),e.actions.addAction("relationshipsConstructor",(function(){this.relationshipsConstructorWindow&&this.relationshipsConstructorWindow.window.content||(this.relationshipsConstructorWindow=new hn(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.relationshipsConstructorWindow.window.setVisible(!0))})),e.actions.addAction("startNodeConstructor",(function(){this.startConstructorWindow&&this.startConstructorWindow.window.content||(this.startConstructorWindow=new fn(e,(document.body.offsetWidth-880)/2,120,900,550),this.startConstructorWindow.window.setVisible(!0))})),e.actions.addAction("TrueNodeCreate",(function(){this.branchResultNodeConstructorWindow&&this.branchResultNodeConstructorWindow.window.content||(this.branchResultNodeConstructorWindow=new wn(e,!0,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.branchResultNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("FalseNodeCreate",(function(){this.branchResultNodeConstructorWindow&&this.branchResultNodeConstructorWindow.window.content||(this.branchResultNodeConstructorWindow=new wn(e,!1,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.branchResultNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("LogicNodeCreate",(function(){this.logicNodeConstructorWindow&&this.logicNodeConstructorWindow.window.content||(this.logicNodeConstructorWindow=new Wn(e,(document.body.offsetWidth-880)/2,120,300,150),this.logicNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("PredeterminingFactorsNodeCreate",(function(){this.predeterminingFactorsNodeConstructorWindow&&this.predeterminingFactorsNodeConstructorWindow.window.content||(this.predeterminingFactorsNodeConstructorWindow=new Gn(e,(document.body.offsetWidth-880)/2,120,600,150),this.predeterminingFactorsNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("UncertaintyNodeCreate",(function(){this.branchResultNodeConstructorWindow&&this.branchResultNodeConstructorWindow.window.content||(this.branchResultNodeConstructorWindow=new wn(e,null,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.branchResultNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("actionNodeConstructor",(function(){this.actionNodeConstructorWindow&&this.actionNodeConstructorWindow.window.content||(this.actionNodeConstructorWindow=new _n(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.actionNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("cycleNodeConstructor",(function(){this.cycleNodeConstructorWindow&&this.cycleNodeConstructorWindow.window.content||(this.cycleNodeConstructorWindow=new Pn(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.cycleNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("whileNodeConstructor",(function(){this.whileNodeConstructorWindow&&this.whileNodeConstructorWindow.window.content||(this.whileNodeConstructorWindow=new Jn(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.whileNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("conditionNodeConstructor",(function(){this.conditionNodeConstructorWindow&&this.conditionNodeConstructorWindow.window.content||(this.conditionNodeConstructorWindow=new kn(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.conditionNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("switchCaseNodeConstructor",(function(){this.switchCaseNodeConstructorWindow&&this.switchCaseNodeConstructorWindow.window.content||(this.switchCaseNodeConstructorWindow=new Kn(e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.switchCaseNodeConstructorWindow.window.setVisible(!0))})),e.actions.addAction("exportEnum",(function(){var t,i;!function(e){let t=document.createElement("a"),i=new Blob([e],{type:"text/csv"});t.href=URL.createObjectURL(i),t.download="enums.csv",t.click()}((t=_i(e),i="",t.forEach((e=>{i+=e.nameEnum+"|"+e.values[0];for(var t=1;t<e.values.length;t++)i+=";"+e.values[t];"true"==e.isLinear?i+="|TRUE|"+e.nameRDF+"\n":i+="|FALSE|"+e.nameRDF+"\n"})),i))})),e.actions.addAction("exportClass",(function(){var t,i,n;!function(e){let t=document.createElement("a"),i=new Blob([e],{type:"text/csv"});t.href=URL.createObjectURL(i),t.download="classes.csv",t.click()}((t=Ti(e),i=Zn,n="",t.forEach((e=>{n+=e.name+"|"+e.extend+"|",e.expression&&(n+=Si(i,e.expression)),n+="\n"})),n))})),e.actions.addAction("exportProperty",(function(){var t,i;!function(e){let t=document.createElement("a"),i=new Blob([e],{type:"text/csv"});t.href=URL.createObjectURL(i),t.download="properties.csv",t.click()}((t=wi(e),i="",t.forEach((e=>{if(i+=e.name+"|","Integer"!=e.type&&"Double"!=e.type&&"Boolean"!=e.type&&"String"!=e.type?i+="ENUM|"+e.type.slice(6)+"|":i+=e.type.toUpperCase()+"||","true"==e.isStatic){i+="TRUE|"+e.classes[0];for(var t=1;t<e.classes.length;t++)i+=";"+e.classes[t];i+="|"}else{for(i+="FALSE|"+e.classes[0],t=1;t<e.classes.length;t++)i+=";"+e.classes[t];i+="|"}i+=e.range+"\n"})),i))})),e.actions.addAction("exportRelationship",(function(){var t,i;!function(e){let t=document.createElement("a"),i=new Blob([e],{type:"text/csv"});t.href=URL.createObjectURL(i),t.download="relationships.csv",t.click()}((t=function(e){var t=e.editor.graph.getModel().cells;let i=[];return Object.keys(t).forEach((function(e){var n=t[e].value;if(n&&"object"==typeof n&&n.getAttribute("label").startsWith('<b><font color="#000000">Relationships between objects</font></b>')){var o=n.getAttribute("label");(o=o.replace('<b><font color="#000000">Relationships between objects</font></b><br>',"")).split("<br>").forEach(((e,t)=>{var o=e.slice(e.indexOf('<font color="#00cccc">')+22,e.indexOf("</font>")),s="";-1!=(e=e.slice(e.indexOf("</font>")+7)).indexOf(' (<font color="#00cccc">')&&(s=e.slice(e.indexOf('(<font color="#00cccc">')+23,e.indexOf("</font>)")),e=e.slice(e.indexOf("</font>)")+8));var r=(e=e.slice(e.indexOf("classes:</font>")+15)).slice(e.indexOf('<font color="#ff66b3">')+22,e.indexOf("</font>")).split(", "),l="";-1!=(e=e.slice(e.indexOf("</font>")+7)).indexOf('<font color="#6666FF">scale:</font>')&&("partially linear"==(l=(l=(e=e.slice(e.indexOf("scale:</font>")+13)).slice(e.indexOf('<font color="#000000">')+22,e.indexOf("</font>"))).toLowerCase())&&(l="partial"),e=e.slice(e.indexOf("</font>")+7));let a=(e=e.slice(e.indexOf("classes:</font>")+15)).slice(e.indexOf('<font color="#000000">')+22,e.indexOf("</font>"));e=e.slice(e.indexOf("</font>")+7);var c="";"true"==a&&(c=(c=(e=e.slice(e.indexOf("type:</font>")+12)).slice(e.indexOf('<font color="#000000">')+22,e.indexOf("</font>"))).toLowerCase().replaceAll(" ",""));let h=n.getAttribute("namesRels_"+t),u=n.getAttribute("binFlags_"+t);var d={name:o,extend:s,classes:r,scale:l,isBetween:a,type:c,namesRels:h,binFlags:u,decFlags:parseInt(u.split("").reverse().join(""),2)};i.push(d)}))}})),i}(e),i="",t.forEach((e=>{i+=e.name+"|"+e.extend+"|"+e.classes[0];for(var t=1;t<e.classes.length;t++)i+=";"+e.classes[t];i+="|"+e.scale+"|"+e.namesRels+"|","true"==e.isBetween&&(i+=e.type),i+="\n"})),i))})),e.actions.addAction("exportTree",(function(){!function(e){let t=document.createElement("a"),i=new Blob([e],{type:"application/xml"});t.href=URL.createObjectURL(i),t.download="tree.xml",t.click()}(function(e){var t=new XMLSerializer;const i=document.implementation.createDocument("","",null);var n=e.editor.graph.getModel().cells;let s=0;if(Ri=0,Object.keys(n).forEach((function(t){var r=n[t];if(null!=r.value&&"object"==typeof r.value&&"START"==r.value.getAttribute("type"))return s++,void i.appendChild(function(e,t,i){let n=e.createElement("StartNode");if(n.appendChild(function(e,t){let i=e.createElement("InputVariables");return t.split("\n").forEach((t=>{let n=t.split(" - "),o=e.createElement("DecisionTreeVarDecl");o.setAttribute("name",zi(n[0])),o.setAttribute("type",zi(n[1])),i.appendChild(o)})),i}(e,t.value.getAttribute("label"))),t.edges)for(let s=0;s<t.edges.length;s++){if(t.edges[s].target==t)throw new Error(o("StartNodeIsTarget"));if(null==t.edges[s].value||"object"!=typeof t.edges[s].value||!t.edges[s].value.getAttribute("type"))throw Li(i.editor.graph,t.edges[s]),new Error(o("typeOutcomeStartNodeIsMissing"));let r=e.createElement("ThoughtBranch");r.setAttribute("_alias","startThought"),r.setAttribute("type",t.edges[s].value.getAttribute("type")),r=Bi(r,t.edges[s]),t.edges[s].target!=t&&r.appendChild($i(e,t.edges[s].target,i)),n.appendChild(r)}return n}(i,r,e))})),1!=s)throw new Error(o("StartNodeOnlyOne"));return'<?xml version="1.0"?>'+t.serializeToString(i)}(e))})),e.actions.addAction("editValue",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();null==i.value||"object"!=typeof i.value||"ellipse;whiteSpace=wrap;html=1;rounded=0;editable=0;"!=i.style||this.conditionNodeEditorWindow&&this.conditionNodeEditorWindow.window.content?null==i.value||"object"!=typeof i.value||"rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;editable=0;"!=i.style||this.actionNodeEditorWindow&&this.actionNodeEditorWindow.window.content?null==i.value||"object"!=typeof i.value||!i.value.getAttribute("operator")||!i.value.getAttribute("typeCycle")||this.whileNodeEditorWindow&&this.whileNodeEditorWindow.window.content?null==i.value||"object"!=typeof i.value||!i.value.getAttribute("operator")||this.cycleNodeEditorWindow&&this.cycleNodeEditorWindow.window.content?null==i.value||"object"!=typeof i.value||"rhombus;whiteSpace=wrap;html=1;editable=0;"!=i.style||this.switchCaseNodeEditorWindow&&this.switchCaseNodeEditorWindow.window.content?null==i.value||"object"!=typeof i.value||"START"!=i.value.getAttribute("type")||this.startEditorWindow&&this.startEditorWindow.window.content?null==i.value||"object"!=typeof i.value||"predetermining"!=i.value.getAttribute("type")||this.predeterminingFactorsNodeEditorWindow&&this.predeterminingFactorsNodeEditorWindow.window.content?null==i.value||"object"!=typeof i.value||"AND"!=i.value.getAttribute("type")&&"OR"!=i.value.getAttribute("type")||this.logicNodeEditorWindow&&this.logicNodeEditorWindow.window.content?(null==i.value||"object"!=typeof i.value||"rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;editable=0;"!=i.style||this.branchResultNodeEditorWindow&&this.branchResultNodeEditorWindow.window.content)&&(null==i.value||"object"!=typeof i.value||"rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;editable=0;"!=i.style||this.branchResultNodeEditorWindow&&this.branchResultNodeEditorWindow.window.content)&&(null==i.value||"object"!=typeof i.value||"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;"!=i.style||this.branchResultNodeEditorWindow&&this.branchResultNodeEditorWindow.window.content)?null==i.value||"object"!=typeof i.value||!i.value.getAttribute("label").startsWith('<font color="#000000"><b>Classes</b></font>')||this.classEditorWindow&&this.classEditorWindow.window.content?null==i.value||"string"!=typeof i.value||!i.value.startsWith('<font color="#000000"><b>Enum</b></font>')||this.enumEditorWindow&&this.enumEditorWindow.window.content?null==i.value||"string"!=typeof i.value||!i.value.startsWith('<b><font color="#000000">Class and Object properties</font></b>')||this.classPropertiesEditorWindow&&this.classPropertiesEditorWindow.window.content?null==i.value||"object"!=typeof i.value||!i.value.getAttribute("label").startsWith('<b><font color="#000000">Relationships between objects</font></b>')||this.relationshipsEditorWindow&&this.relationshipsEditorWindow.window.content?i.edge&&(this.editValueInOutcomeWindow=new Un(i,e,(document.body.offsetWidth-880)/2,120,900,200),this.editValueInOutcomeWindow.window.setVisible(!0)):(this.relationshipsEditorWindow=new bn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.relationshipsEditorWindow.window.setVisible(!0)):(this.classPropertiesEditorWindow=new on(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.classPropertiesEditorWindow.window.setVisible(!0)):(this.enumEditorWindow=new cn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.enumEditorWindow.window.setVisible(!0)):(this.classEditorWindow=new Qi(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.classEditorWindow.window.setVisible(!0)):(this.branchResultNodeEditorWindow=new In(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.branchResultNodeEditorWindow.window.setVisible(!0)):(this.logicNodeEditorWindow=new Hn(i,e,(document.body.offsetWidth-880)/2,120,300,150),this.logicNodeEditorWindow.window.setVisible(!0)):(this.predeterminingFactorsNodeEditorWindow=new zn(i,e,(document.body.offsetWidth-880)/2,120,600,150),this.predeterminingFactorsNodeEditorWindow.window.setVisible(!0)):(this.startEditorWindow=new Cn(i,e,(document.body.offsetWidth-880)/2,120,900,550),this.startEditorWindow.window.setVisible(!0)):(this.switchCaseNodeEditorWindow=new Yn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.switchCaseNodeEditorWindow.window.setVisible(!0)):(this.cycleNodeEditorWindow=new Fn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.cycleNodeEditorWindow.window.setVisible(!0)):(this.whileNodeEditorWindow=new qn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.whileNodeEditorWindow.window.setVisible(!0)):(this.actionNodeEditorWindow=new Tn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.actionNodeEditorWindow.window.setVisible(!0)):(this.conditionNodeEditorWindow=new xn(i,e,document.body.offsetLeft+100,document.body.offsetTop+100,window.screen.width-200,window.screen.height-300),this.conditionNodeEditorWindow.window.setVisible(!0))}})),e.actions.addAction("editTextInNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();(null==i.value||""==i.value||"object"==typeof i.value||i.value.startsWith('<font color="#000000"><b>Enum</b></font>')||i.value.startsWith('<b><font color="#000000">Class and Object properties</font></b>')||"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;"==i.style||i.edge)&&(null==i.value||"object"!=typeof i.value||i.value.getAttribute("label").startsWith('<font color="#000000"><b>Classes</b></font>')||i.value.getAttribute("label").startsWith('<b><font color="#000000">Relationships between objects</font></b>')||"AND"==i.value.getAttribute("type")||"OR"==i.value.getAttribute("type")||"predetermining"==i.value.getAttribute("type")||"START"==i.value.getAttribute("type")||i.edge)||(this.editTextInNodeWindow=new Vn(i,e,(document.body.offsetWidth-880)/2,120,900,550),this.editTextInNodeWindow.window.setVisible(!0))}})),e.actions.addAction("editQuestionInfo",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();(null==i.value||""==i.value||"object"==typeof i.value||i.value.startsWith('<font color="#000000"><b>Enum</b></font>')||i.value.startsWith('<b><font color="#000000">Class and Object properties</font></b>')||"rounded=1;whiteSpace=wrap;html=1;fillColor=#e6e6e6;strokeColor=#666666;editable=0;"==i.style||i.edge)&&(null==i.value||"object"!=typeof i.value||"rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;editable=0;"==i.style||"rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;editable=0;"==i.style||i.value.getAttribute("label").startsWith('<font color="#000000"><b>Classes</b></font>')||i.value.getAttribute("label").startsWith('<b><font color="#000000">Relationships between objects</font></b>')||"START"==i.value.getAttribute("type")||i.edge)?i.edge&&(this.editQuestionInfoInOutcomeWindow=new Xn(i,e,(document.body.offsetWidth-880)/2,120,900,550),this.editQuestionInfoInOutcomeWindow.window.setVisible(!0)):(this.editQuestionInfoInNodeWindow=new jn(i,e,(document.body.offsetWidth-880)/2,120,900,550),this.editQuestionInfoInNodeWindow.window.setVisible(!0))}})),e.actions.addAction("convertStartNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Dn(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertTrueNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Ln(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertFalseNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new An(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertLogicNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Rn(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertPredeterminingFactorsNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new $n(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertUncertaintyNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Bn(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertActionNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Nn(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertCycleNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Sn(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertConditionNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new On(i,e,(document.body.offsetWidth-880)/2,120,900,550)}})),e.actions.addAction("convertSwitchCaseNode",(function(){if(t.isEnabled()&&1==t.getSelectionCount()){var i=t.getSelectionCell();this.convertToQuestionNode=new Mn(i,e,(document.body.offsetWidth-880)/2,120,900,550)}}))}))},79:(e,t,i)=>{"use strict";i.d(t,{K:()=>r,z:()=>n});var n,o,s=i(470);e=i.hmd(e);var r=function(){var e=function(e,t,i,n){for(i=i||{},n=e.length;n--;i[e[n]]=t);return i},t=[1,6],i=[1,15],r=[1,7],l=[1,8],a=[1,9],c=[1,10],h=[1,11],u=[1,12],d=[1,13],p=[1,14],g=[1,16],m=[1,17],b=[1,18],f=[1,19],E=[1,20],y=[1,21],v=[1,22],C=[1,25],_=[1,26],T=[1,27],w=[1,28],I=[1,29],k=[1,30],x=[1,31],N=[1,32],S=[1,33],A=[1,34],R=[1,35],$=[1,36],O=[1,8,9,11,12,16,27,28,29,30,31,32,33,34,35,37,38,39,45,51],D=[1,8,9,11,12,16,29,30,31,32,33,34,35,38,39,45,51],M=[1,8,9,11,12,16,29,32,33,38,39,45,51],L=[8,13,14,17,19,20,21,22,23,24,25,40,42,43,47,48,49,50],B=[1,100],P=[16,51],F=[1,8,9,11,12,16,45,51],V={trace:function(){},yy:{},symbols_:{error:2,program:3,stmt:4,block:5,"{":6,stmt_seq:7,"}":8,";":9,exp:10,"=":11,"+=>":12,ID:13,"(":14,object_seq:15,")":16,CLASS_LITERAL:17,":":18,STRING:19,INT:20,DOUBLE:21,TRUE:22,FALSE:23,OBJ_VAR:24,VAR:25,"::":26,"->":27,".":28,IS:29,">":30,"<":31,"==":32,"!=":33,">=":34,"<=":35,COMPARE:36,AS:37,AND:38,OR:39,NOT:40,CLASS:41,FIND:42,FIND_EXTREM:43,"[":44,"]":45,AMONG:46,EXIST:47,FORALL:48,IF:49,WITH:50,",":51,$accept:0,$end:1},terminals_:{2:"error",6:"{",8:"}",9:";",11:"=",12:"+=>",13:"ID",14:"(",16:")",17:"CLASS_LITERAL",18:":",19:"STRING",20:"INT",21:"DOUBLE",22:"TRUE",23:"FALSE",24:"OBJ_VAR",25:"VAR",26:"::",27:"->",28:".",29:"IS",30:">",31:"<",32:"==",33:"!=",34:">=",35:"<=",36:"COMPARE",37:"AS",38:"AND",39:"OR",40:"NOT",41:"CLASS",42:"FIND",43:"FIND_EXTREM",44:"[",45:"]",46:"AMONG",47:"EXIST",48:"FORALL",49:"IF",50:"WITH",51:","},productions_:[0,[3,1],[3,1],[5,3],[7,2],[7,3],[4,1],[4,3],[4,6],[10,1],[10,3],[10,1],[10,1],[10,1],[10,1],[10,1],[10,1],[10,1],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,6],[10,3],[10,3],[10,3],[10,3],[10,2],[10,6],[10,5],[10,6],[10,11],[10,9],[10,9],[10,5],[10,7],[15,1],[15,3]],performAction:function(e,t,i,o,r,l,a){var c=l.length-1;switch(r){case 1:return n=new s.ze(l[c],!1),l[c];case 2:return n=new s.ze(l[c],!0),l[c];case 3:this.$=new s.ub(l[c-1]);break;case 4:this.$=(0,s.gk)(l[c-1]);break;case 5:this.$=(0,s.Go)(l[c-2],l[c-1]);break;case 6:this.$=new s.ar(s.v2.EXPR,l[c],null);break;case 7:this.$=new s.ar(s.v2.ASSIGNMENT,l[c-2],l[c]);break;case 8:this.$=(0,s.cf)(l[c-5],l[c-3],l[c-1]);break;case 9:this.$=(0,s.KW)(s.ky.ID,l[c]);break;case 10:this.$=(0,s.KW)(s.ky.CLASS,l[c]);break;case 11:this.$=(0,s.KW)(s.ky.STRING,l[c]);break;case 12:this.$=(0,s.KW)(s.ky.INT,l[c]);break;case 13:this.$=(0,s.KW)(s.ky.DOUBLE,l[c]);break;case 14:this.$=(0,s.KW)(s.ky.BOOLEAN,!0);break;case 15:this.$=(0,s.KW)(s.ky.BOOLEAN,!1);break;case 16:this.$=(0,s.KW)(s.ky.OBJ_VAR,l[c]);break;case 17:this.$=(0,s.KW)(s.ky.VAR,l[c]);break;case 18:this.$=(0,s.WS)(l[c-2],l[c]);break;case 19:this.$=(0,s.iu)(l[c-2],l[c]);break;case 20:this.$=(0,s.HV)(s.ky.PROPERTY,l[c-2],l[c]);break;case 21:this.$=(0,s.HV)(s.ky.IS,l[c-2],l[c]);break;case 22:this.$=(0,s.HV)(s.ky.GREATER,l[c-2],l[c]);break;case 23:this.$=(0,s.HV)(s.ky.LESS,l[c-2],l[c]);break;case 24:this.$=(0,s.HV)(s.ky.EQUAL,l[c-2],l[c]);break;case 25:this.$=(0,s.HV)(s.ky.NOT_EQUAL,l[c-2],l[c]);break;case 26:this.$=(0,s.HV)(s.ky.GE,l[c-2],l[c]);break;case 27:this.$=(0,s.HV)(s.ky.LE,l[c-2],l[c]);break;case 28:this.$=(0,s.HV)(s.ky.COMPARE,l[c-5],l[c-1]);break;case 29:this.$=l[c-1];break;case 30:this.$=(0,s.VQ)(l[c],l[c-2]);break;case 31:this.$=(0,s.HV)(s.ky.AND,l[c-2],l[c]);break;case 32:this.$=(0,s.HV)(s.ky.OR,l[c-2],l[c]);break;case 33:this.$=(0,s.Jp)(s.ky.NOT,l[c]);break;case 34:this.$=(0,s.fD)(l[c-5],l[c-3],l[c-1]);break;case 35:this.$=(0,s.Jp)(s.ky.GET_CLASS,l[c-4]);break;case 36:this.$=(0,s.Ep)(s.ky.FIND,l[c-4],l[c-3],l[c-1]);break;case 37:this.$=(0,s.np)(l[c-9],l[c-7],l[c-4],l[c-3],l[c-1]);break;case 38:this.$=(0,s.i$)(s.ky.EXIST,l[c-7],l[c-6],l[c-4],l[c-1]);break;case 39:this.$=(0,s.i$)(s.ky.FORALL,l[c-7],l[c-6],l[c-4],l[c-1]);break;case 40:this.$=(0,s.tG)(l[c-2],l[c]);break;case 41:this.$=(0,s.ok)(l[c-4],l[c-2],l[c]);break;case 42:this.$=(0,s.hc)(l[c]);break;case 43:this.$=(0,s.oR)(l[c-2],l[c])}},table:[{3:1,4:2,5:3,6:[1,5],10:4,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{1:[3]},{1:[2,1]},{1:[2,2]},e(a,[2,6],{11:[1,23],12:[1,24],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$}),{4:38,7:37,10:4,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},e(O,[2,9],{26:[1,39]}),{18:[1,40]},e(O,[2,11]),e(O,[2,12]),e(O,[2,13]),e(O,[2,14]),e(O,[2,15]),e(O,[2,16]),e(O,[2,17]),{10:41,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:42,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{13:[1,43]},{13:[1,44]},{13:[1,45]},{13:[1,46]},{14:[1,47]},{14:[1,48]},{10:49,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{13:[1,50]},{13:[1,51]},{13:[1,52],36:[1,53],41:[1,54]},{10:55,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:56,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:57,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:58,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:59,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:60,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:61,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:62,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:63,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:64,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{4:66,8:[1,65],10:4,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{9:[1,67]},{13:[1,68]},{13:[1,69]},{16:[1,70],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},e(D,[2,33],{27:C,28:_,37:A}),{13:[1,71]},{44:[1,72]},{13:[1,73]},{13:[1,74]},{10:75,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{13:[1,76]},e(a,[2,7],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$}),{14:[1,77]},e(O,[2,19],{14:[1,78]}),e(O,[2,20]),{14:[1,79]},{14:[1,80]},e([1,8,9,11,12,16,29,38,39,45,51],[2,21],{27:C,28:_,30:w,31:I,32:k,33:x,34:N,35:S,37:A}),e(D,[2,22],{27:C,28:_,37:A}),e(D,[2,23],{27:C,28:_,37:A}),e(M,[2,24],{27:C,28:_,30:w,31:I,34:N,35:S,37:A}),e(M,[2,25],{27:C,28:_,30:w,31:I,34:N,35:S,37:A}),e(D,[2,26],{27:C,28:_,37:A}),e(D,[2,27],{27:C,28:_,37:A}),e(O,[2,30]),e([1,8,9,11,12,16,38,39,45,51],[2,31],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A}),e([1,8,9,11,12,16,39,45,51],[2,32],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R}),{1:[2,3]},{9:[1,81]},e(L,[2,4]),e(O,[2,18]),e(O,[2,10]),e(O,[2,29]),{6:[1,82]},{10:83,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{44:[1,84]},{44:[1,85]},{16:[1,86],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},{11:[1,87]},{10:89,13:t,14:i,15:88,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:89,13:t,14:i,15:90,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:91,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{16:[1,92]},e(L,[2,5]),{10:93,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$,45:[1,94]},{10:95,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:96,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:97,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:98,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{16:[1,99],51:B},e(P,[2,42],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$}),{16:[1,101],51:B},{16:[1,102],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},e(O,[2,35]),{8:[1,103],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},{46:[1,104]},{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$,45:[1,105]},{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$,45:[1,106]},e(F,[2,40],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$}),{16:[1,107],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},e(a,[2,8]),{10:108,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},e(O,[2,34]),e(O,[2,28]),e(O,[2,36]),{13:[1,109]},{6:[1,110]},{6:[1,111]},{10:112,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},e(P,[2,43],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$}),{13:[1,113]},{10:114,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},{10:115,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},e(F,[2,41],{27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$}),{6:[1,116]},{8:[1,117],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},{8:[1,118],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},{10:119,13:t,14:i,17:r,19:l,20:a,21:c,22:h,23:u,24:d,25:p,40:g,42:m,43:b,47:f,48:E,49:y,50:v},e(O,[2,38]),e(O,[2,39]),{8:[1,120],27:C,28:_,29:T,30:w,31:I,32:k,33:x,34:N,35:S,37:A,38:R,39:$},e(O,[2,37])],defaultActions:{2:[2,1],3:[2,2],65:[2,3]},parseError:function(e,t){if(!t.recoverable){var i=new Error(e);throw i.hash=t,i}this.trace(e)},parse:function(e){var t=this,i=[0],n=[null],o=[],s=this.table,r="",l=0,a=0,c=0,h=o.slice.call(arguments,1),u=Object.create(this.lexer),d={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(d.yy[p]=this.yy[p]);u.setInput(e,d.yy),d.yy.lexer=u,d.yy.parser=this,void 0===u.yylloc&&(u.yylloc={});var g=u.yylloc;o.push(g);var m,b=u.options&&u.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var f,E,y,v,C,_,T,w,I,k={};;){if(y=i[i.length-1],this.defaultActions[y]?v=this.defaultActions[y]:(null==f&&(m=void 0,"number"!=typeof(m=u.lex()||1)&&(m=t.symbols_[m]||m),f=m),v=s[y]&&s[y][f]),void 0===v||!v.length||!v[0]){var x;for(_ in I=[],s[y])this.terminals_[_]&&_>2&&I.push("'"+this.terminals_[_]+"'");x=u.showPosition?"Parse error on line "+(l+1)+":\n"+u.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.terminals_[f]||f)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==f?"end of input":"'"+(this.terminals_[f]||f)+"'"),this.parseError(x,{text:u.match,token:this.terminals_[f]||f,line:u.yylineno,loc:g,expected:I})}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+f);switch(v[0]){case 1:i.push(f),n.push(u.yytext),o.push(u.yylloc),i.push(v[1]),f=null,E?(f=E,E=null):(a=u.yyleng,r=u.yytext,l=u.yylineno,g=u.yylloc,c>0&&c--);break;case 2:if(T=this.productions_[v[1]][1],k.$=n[n.length-T],k._$={first_line:o[o.length-(T||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(T||1)].first_column,last_column:o[o.length-1].last_column},b&&(k._$.range=[o[o.length-(T||1)].range[0],o[o.length-1].range[1]]),void 0!==(C=this.performAction.apply(k,[r,a,l,d.yy,v[1],n,o].concat(h))))return C;T&&(i=i.slice(0,-1*T*2),n=n.slice(0,-1*T),o=o.slice(0,-1*T)),i.push(this.productions_[v[1]][0]),n.push(k.$),o.push(k._$),w=s[i[i.length-2]][i[i.length-1]],i.push(w);break;case 3:return!0}}return!0}},U={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var i,n,o;if(this.options.backtrack_lexer&&(o={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(o.yylloc.range=this.yylloc.range.slice(0))),(n=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],i=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var s in o)this[s]=o[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,i,n;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),s=0;s<o.length;s++)if((i=this._input.match(this.rules[o[s]]))&&(!t||i[0].length>t[0].length)){if(t=i,n=s,this.options.backtrack_lexer){if(!1!==(e=this.test_match(i,o[s])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,o[n]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,i,n){switch(i){case 0:return 22;case 1:return 23;case 2:return 41;case 3:return 42;case 4:return 43;case 5:return 29;case 6:return 38;case 7:return 39;case 8:return 40;case 9:return 36;case 10:return 47;case 11:return 48;case 12:return"WHERE";case 13:return 46;case 14:return 49;case 15:return 50;case 16:return 37;case 17:return 17;case 18:return 27;case 19:return 6;case 20:return 8;case 21:return 44;case 22:return 45;case 23:return 32;case 24:return 33;case 25:return 34;case 26:return 35;case 27:return 11;case 28:return 14;case 29:return 16;case 30:return 51;case 31:return 9;case 32:return 30;case 33:return 31;case 34:return 26;case 35:return 12;case 36:return 18;case 37:return 24;case 38:return 13;case 39:return 25;case 40:o="",this.begin("STRING");break;case 41:o+=t.yytext;break;case 42:o+="\n";break;case 43:o+="\t";break;case 44:o+="\\";break;case 45:throw new Error("Error: invalid escape\n");case 46:throw new Error("Error: unfinished string.\n");case 47:o+='"';break;case 48:o+="'";break;case 49:return this.begin("INITIAL"),t.yytext=o,19;case 50:throw this.begin("INITIAL"),new Error('Error: expected ".\n');case 51:return 21;case 52:return 20;case 53:return 28}},rules:[/^(?:true\b)/,/^(?:false\b)/,/^(?:getClass\b)/,/^(?:find\b)/,/^(?:findExtreme\b)/,/^(?:is\b)/,/^(?:and\b)/,/^(?:or\b)/,/^(?:not\b)/,/^(?:compare\b)/,/^(?:exist\b)/,/^(?:forall\b)/,/^(?:where\b)/,/^(?:among\b)/,/^(?:if\b)/,/^(?:with\b)/,/^(?:as\b)/,/^(?:class\b)/,/^(?:->)/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:==)/,/^(?:!=)/,/^(?:>=)/,/^(?:<=)/,/^(?:=)/,/^(?:\()/,/^(?:\))/,/^(?:,)/,/^(?:;)/,/^(?:>)/,/^(?:<)/,/^(?:::)/,/^(?:\+=>)/,/^(?::)/,/^(?:obj:[a-zA-Z_][A-Za-z0-9_]*)/,/^(?:[a-zA-Z_][A-Za-z0-9_]*)/,/^(?:\$[a-zA-Z_][A-Za-z0-9_]*)/,/^(?:")/,/^(?:[^\\\"\n]+)/,/^(?:\\n)/,/^(?:\\t)/,/^(?:\\\\)/,/^(?:\\[^nt\"\'\\])/,/^(?:\n)/,/^(?:\\")/,/^(?:\\')/,/^(?:")/,/^(?:$)/,/^(?:([0-9]+\.[0-9]*|[0-9]*\.[0-9]+))/,/^(?:[0-9]+)/,/^(?:\.)/,/^(?:\s+)/],conditions:{STRING:{rules:[41,42,43,44,45,46,47,48,49,50],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,51,52,53,54],inclusive:!0}}};function W(){this.yy={}}return V.lexer=U,W.prototype=V,V.Parser=W,new W}();"undefined"!=typeof exports&&(exports.parser=r,exports.Parser=r.Parser,exports.parse=function(){return r.parse.apply(r,arguments)},exports.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));var t=i(497).readFileSync(i(975).normalize(e[1]),"utf8");return exports.parser.parse(t)},i.c[i.s]===e&&exports.main(process.argv.slice(1)))},449:function(e,t,i){var n,o,s;o=[i(500)],void 0===(s="function"==typeof(n=function(e){var t,i,n=e.__namespace__,o=function(e,i){var n=0;let o="";i.STATEMENT_PREFIX&&(o+=i.injectId(i.STATEMENT_PREFIX,e));do{const s=i.valueToCode(e,"IF"+n,t.NONE)||"false";let r=i.statementToCode(e,"DO"+n);i.STATEMENT_SUFFIX&&(r=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+r),o+=(0<n?" else ":"")+"if ("+s+") {\n"+r+"}",n++}while(e.getInput("IF"+n));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(n=e.getInput("ELSE")?i.statementToCode(e,"ELSE"):"",i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),o+=" else {\n"+n+"}"),o+"\n"},s=function(e,i){let o;o=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.valueToCode(e,"TIMES",t.ASSIGNMENT)||"0";let s=i.statementToCode(e,"DO");s=i.addLoopTrap(s,e),e="";const r=i.nameDB_.getDistinctName("count",n.NameType$$module$build$src$core$names.VARIABLE);let l=o;return o.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(o)||(l=i.nameDB_.getDistinctName("repeat_end",n.NameType$$module$build$src$core$names.VARIABLE),e+="var "+l+" = "+o+";\n"),e+"for (var "+r+" = 0; "+r+" < "+l+"; "+r+"++) {\n"+s+"}\n"},r=function(e,i){const n=e.getFieldValue("OP");let o;if("NEG"===n)return"-"===(e=i.valueToCode(e,"NUM",t.UNARY_NEGATION)||"0")[0]&&(e=" "+e),["-"+e,t.UNARY_NEGATION];switch(e="SIN"===n||"COS"===n||"TAN"===n?i.valueToCode(e,"NUM",t.DIVISION)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",n){case"ABS":o="Math.abs("+e+")";break;case"ROOT":o="Math.sqrt("+e+")";break;case"LN":o="Math.log("+e+")";break;case"EXP":o="Math.exp("+e+")";break;case"POW10":o="Math.pow(10,"+e+")";break;case"ROUND":o="Math.round("+e+")";break;case"ROUNDUP":o="Math.ceil("+e+")";break;case"ROUNDDOWN":o="Math.floor("+e+")";break;case"SIN":o="Math.sin("+e+" / 180 * Math.PI)";break;case"COS":o="Math.cos("+e+" / 180 * Math.PI)";break;case"TAN":o="Math.tan("+e+" / 180 * Math.PI)"}if(o)return[o,t.FUNCTION_CALL];switch(n){case"LOG10":o="Math.log("+e+") / Math.log(10)";break;case"ASIN":o="Math.asin("+e+") / Math.PI * 180";break;case"ACOS":o="Math.acos("+e+") / Math.PI * 180";break;case"ATAN":o="Math.atan("+e+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+n)}return[o,t.DIVISION]},l=function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME"));var o="";i.STATEMENT_PREFIX&&(o+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(o+=i.injectId(i.STATEMENT_SUFFIX,e)),o&&(o=i.prefixLines(o,i.INDENT));let s="";i.INFINITE_LOOP_TRAP&&(s=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));let r="";e.getInput("STACK")&&(r=i.statementToCode(e,"STACK"));let l="";e.getInput("RETURN")&&(l=i.valueToCode(e,"RETURN",t.NONE)||"");let a="";r&&l&&(a=o),l&&(l=i.INDENT+"return "+l+";\n");const c=[],h=e.getVars();for(let e=0;e<h.length;e++)c[e]=i.getVariableName(h[e]);return o="function "+n+"("+c.join(", ")+") {\n"+o+s+r+a+l+"}",o=i.scrub_(e,o),i.definitions_["%"+n]=o,null},a=function(e,i){return i="window.prompt("+(e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''")+")","NUMBER"===e.getFieldValue("TYPE")&&(i="Number("+i+")"),[i,t.FUNCTION_CALL]},c=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},h=function(e,i){const n=i.valueToCode(e,"VALUE",t.ASSIGNMENT)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+n+";\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.NEW=1.1]="NEW",i[i.MEMBER=1.2]="MEMBER",i[i.FUNCTION_CALL=2]="FUNCTION_CALL",i[i.INCREMENT=3]="INCREMENT",i[i.DECREMENT=3]="DECREMENT",i[i.BITWISE_NOT=4.1]="BITWISE_NOT",i[i.UNARY_PLUS=4.2]="UNARY_PLUS",i[i.UNARY_NEGATION=4.3]="UNARY_NEGATION",i[i.LOGICAL_NOT=4.4]="LOGICAL_NOT",i[i.TYPEOF=4.5]="TYPEOF",i[i.VOID=4.6]="VOID",i[i.DELETE=4.7]="DELETE",i[i.AWAIT=4.8]="AWAIT",i[i.EXPONENTIATION=5]="EXPONENTIATION",i[i.MULTIPLICATION=5.1]="MULTIPLICATION",i[i.DIVISION=5.2]="DIVISION",i[i.MODULUS=5.3]="MODULUS",i[i.SUBTRACTION=6.1]="SUBTRACTION",i[i.ADDITION=6.2]="ADDITION",i[i.BITWISE_SHIFT=7]="BITWISE_SHIFT",i[i.RELATIONAL=8]="RELATIONAL",i[i.IN=8]="IN",i[i.INSTANCEOF=8]="INSTANCEOF",i[i.EQUALITY=9]="EQUALITY",i[i.BITWISE_AND=10]="BITWISE_AND",i[i.BITWISE_XOR=11]="BITWISE_XOR",i[i.BITWISE_OR=12]="BITWISE_OR",i[i.LOGICAL_AND=13]="LOGICAL_AND",i[i.LOGICAL_OR=14]="LOGICAL_OR",i[i.CONDITIONAL=15]="CONDITIONAL",i[i.ASSIGNMENT=16]="ASSIGNMENT",i[i.YIELD=17]="YIELD",i[i.COMMA=18]="COMMA",i[i.NONE=99]="NONE";var u=class extends n.CodeGenerator$$module$build$src$core$generator{constructor(e="JavaScript"){super(e),this.ORDER_OVERRIDES=[[t.FUNCTION_CALL,t.MEMBER],[t.FUNCTION_CALL,t.FUNCTION_CALL],[t.MEMBER,t.MEMBER],[t.MEMBER,t.FUNCTION_CALL],[t.LOGICAL_NOT,t.LOGICAL_NOT],[t.MULTIPLICATION,t.MULTIPLICATION],[t.ADDITION,t.ADDITION],[t.LOGICAL_AND,t.LOGICAL_AND],[t.LOGICAL_OR,t.LOGICAL_OR]],this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new n.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const t=[];var i=n.allDeveloperVariables$$module$build$src$core$variables(e);for(let e=0;e<i.length;e++)t.push(this.nameDB_.getName(i[e],n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(e=n.allUsedVarModels$$module$build$src$core$variables(e),i=0;i<e.length;i++)t.push(this.nameDB_.getName(e[i].getId(),n.NameType$$module$build$src$core$names.VARIABLE));t.length&&(this.definitions_.variables="var "+t.join(", ")+";"),this.isInitialized=!0}finish(e){const t=Object.values(this.definitions_);return super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),t.join("\n\n")+"\n\n\n"+e}scrubNakedValue(e){return e+";\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" + '\\n' +\n")}scrub_(e,t,i=!1){let o="";if(!e.outputConnection||!e.outputConnection.targetConnection){var s=e.getCommentText();s&&(s=n.wrap$$module$build$src$core$utils$string(s,this.COMMENT_WRAP-3),o+=this.prefixLines(s+"\n","// "));for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(s=e.inputList[t].connection.targetBlock())&&(s=this.allNestedComments(s))&&(o+=this.prefixLines(s,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),o+t+(i?"":this.blockToCode(e))}getAdjusted(e,i,o=0,s=!1,r=t.NONE){e.workspace.options.oneBasedIndex&&o--;const l=e.workspace.options.oneBasedIndex?"1":"0";let a=r;return 0<o?a=t.ADDITION:0>o?a=t.SUBTRACTION:s&&(a=t.UNARY_NEGATION),e=this.valueToCode(e,i,a)||l,0!==o||s?n.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+o),s&&(e=String(-Number(e))),e):(0<o?e=`${e} + ${o}`:0>o&&(e=`${e} - ${-o}`),s&&(e=o?`-(${e})`:`-${e}`),Math.floor(r)>=Math.floor(a)&&(e=`(${e})`),e):e}},d={};d.JavascriptGenerator=u,d.Order=t;var p=function(e,t,i){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+i:"LAST"===t?e+".length - 1":i},g={lists_create_empty:function(e,i){return["[]",t.ATOMIC]},lists_create_with:function(e,i){const n=Array(e.itemCount_);for(let o=0;o<e.itemCount_;o++)n[o]=i.valueToCode(e,"ADD"+o,t.NONE)||"null";return["["+n.join(", ")+"]",t.ATOMIC]},lists_getIndex:function(e,i){const n=e.getFieldValue("MODE")||"GET",o=e.getFieldValue("WHERE")||"FROM_START";var s=i.valueToCode(e,"VALUE","RANDOM"===o?t.NONE:t.MEMBER)||"[]";switch(o){case"FIRST":if("GET"===n)return[s+"[0]",t.MEMBER];if("GET_REMOVE"===n)return[s+".shift()",t.MEMBER];if("REMOVE"===n)return s+".shift();\n";break;case"LAST":if("GET"===n)return[s+".slice(-1)[0]",t.MEMBER];if("GET_REMOVE"===n)return[s+".pop()",t.MEMBER];if("REMOVE"===n)return s+".pop();\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"GET"===n)return[s+"["+e+"]",t.MEMBER];if("GET_REMOVE"===n)return[s+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===n)return s+".splice("+e+", 1);\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!0),"GET"===n)return[s+".slice("+e+")[0]",t.FUNCTION_CALL];if("GET_REMOVE"===n)return[s+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===n)return s+".splice("+e+", 1);";break;case"RANDOM":if(s=i.provideFunction_("listsGetRandomItem",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`)+"("+s+", "+("GET"!==n)+")","GET"===n||"GET_REMOVE"===n)return[s,t.FUNCTION_CALL];if("REMOVE"===n)return s+";\n"}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,i){var n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},o=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const s=e.getFieldValue("WHERE1"),r=e.getFieldValue("WHERE2");if("FIRST"===s&&"LAST"===r)o+=".slice(0)";else if(o.match(/^\w+$/)||"FROM_END"!==s&&"FROM_START"===r){switch(s){case"FROM_START":n=i.getAdjusted(e,"AT1");break;case"FROM_END":n=o+".length - "+(n=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":i=i.getAdjusted(e,"AT2",1);break;case"FROM_END":i=o+".length - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":i=o+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}o=o+".slice("+n+", "+i+")"}else{const t=i.getAdjusted(e,"AT1");e=i.getAdjusted(e,"AT2"),o=i.provideFunction_("subsequence"+n[s]+n[r],`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===s||"FROM_START"===s?", at1":""}${"FROM_END"===r||"FROM_START"===r?", at2":""}) {\n  var start = ${p("sequence",s,"at1")};\n  var end = ${p("sequence",r,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+o+("FROM_END"===s||"FROM_START"===s?", "+t:"")+("FROM_END"===r||"FROM_START"===r?", "+e:"")+")"}return[o,t.FUNCTION_CALL]},lists_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",o=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+"."+n+"("+o+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITION]:[i,t.FUNCTION_CALL]},lists_isEmpty:function(e,i){return["!"+(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.LOGICAL_NOT]},lists_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.MEMBER]},lists_repeat:function(e,i){return[i.provideFunction_("listsRepeat",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`)+"("+(i.valueToCode(e,"ITEM",t.NONE)||"null")+", "+(e=i.valueToCode(e,"NUM",t.NONE)||"0")+")",t.FUNCTION_CALL]},lists_reverse:function(e,i){return[(i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]")+".slice().reverse()",t.FUNCTION_CALL]},lists_setIndex:function(e,i){function o(){if(s.match(/^\w+$/))return"";const e=i.nameDB_.getDistinctName("tmpList",n.NameType$$module$build$src$core$names.VARIABLE),t="var "+e+" = "+s+";\n";return s=e,t}let s=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const r=e.getFieldValue("MODE")||"GET";var l=e.getFieldValue("WHERE")||"FROM_START";const a=i.valueToCode(e,"TO",t.ASSIGNMENT)||"null";switch(l){case"FIRST":if("SET"===r)return s+"[0] = "+a+";\n";if("INSERT"===r)return s+".unshift("+a+");\n";break;case"LAST":if("SET"===r)return o()+(s+"[")+s+".length - 1] = "+a+";\n";if("INSERT"===r)return s+".push("+a+");\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"SET"===r)return s+"["+e+"] = "+a+";\n";if("INSERT"===r)return s+".splice("+e+", 0, "+a+");\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!1,t.SUBTRACTION),l=o(),"SET"===r)return l+(s+"[")+s+".length - "+e+"] = "+a+";\n";if("INSERT"===r)return l+(s+".splice(")+s+".length - "+e+", 0, "+a+");\n";break;case"RANDOM":if(e=o(),e+="var "+(l=i.nameDB_.getDistinctName("tmpX",n.NameType$$module$build$src$core$names.VARIABLE))+" = Math.floor(Math.random() * "+s+".length);\n","SET"===r)return e+(s+"[")+l+"] = "+a+";\n";if("INSERT"===r)return e+(s+".splice(")+l+", 0, "+a+");\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,i){const n=i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]",o="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[n+".slice().sort("+(i=i.provideFunction_("listsGetSortCompare",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return String(a) > String(b) ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `))+'("'+e+'", '+o+"))",t.FUNCTION_CALL]},lists_split:function(e,i){let n=i.valueToCode(e,"INPUT",t.MEMBER);if(i=i.valueToCode(e,"DELIM",t.NONE)||"''","SPLIT"===(e=e.getFieldValue("MODE")))n||(n="''"),e="split";else{if("JOIN"!==e)throw Error("Unknown mode: "+e);n||(n="[]"),e="join"}return[n+"."+e+"("+i+")",t.FUNCTION_CALL]}},m={};m.controls_if=o,m.controls_ifelse=o,m.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},m.logic_compare=function(e,i){const n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],o="=="===n||"!="===n?t.EQUALITY:t.RELATIONAL;return[(i.valueToCode(e,"A",o)||"0")+" "+n+" "+(e=i.valueToCode(e,"B",o)||"0"),o]},m.logic_negate=function(e,i){const n=t.LOGICAL_NOT;return["!"+(i.valueToCode(e,"BOOL",n)||"true"),n]},m.logic_null=function(e,i){return["null",t.ATOMIC]},m.logic_operation=function(e,i){const n="AND"===e.getFieldValue("OP")?"&&":"||",o="&&"===n?t.LOGICAL_AND:t.LOGICAL_OR;let s=i.valueToCode(e,"A",o);return e=i.valueToCode(e,"B",o),s||e?(i="&&"===n?"true":"false",s||(s=i),e||(e=i)):e=s="false",[s+" "+n+" "+e,o]},m.logic_ternary=function(e,i){return[(i.valueToCode(e,"IF",t.CONDITIONAL)||"false")+" ? "+(i.valueToCode(e,"THEN",t.CONDITIONAL)||"null")+" : "+(e=i.valueToCode(e,"ELSE",t.CONDITIONAL)||"null"),t.CONDITIONAL]};var b={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const n=e.getSurroundLoop();n&&!n.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,n))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break;\n";case"CONTINUE":return i+"continue;\n"}throw Error("Unknown flow statement.")},controls_for:function(e,i){var o=i.getVariableName(e.getFieldValue("VAR")),s=i.valueToCode(e,"FROM",t.ASSIGNMENT)||"0",r=i.valueToCode(e,"TO",t.ASSIGNMENT)||"0";const l=i.valueToCode(e,"BY",t.ASSIGNMENT)||"1";let a=i.statementToCode(e,"DO");if(a=i.addLoopTrap(a,e),n.isNumber$$module$build$src$core$utils$string(s)&&n.isNumber$$module$build$src$core$utils$string(r)&&n.isNumber$$module$build$src$core$utils$string(l))e="for ("+o+" = "+s+"; "+o+((i=Number(s)<=Number(r))?" <= ":" >= ")+r+"; "+o,e=1===(o=Math.abs(Number(l)))?e+(i?"++":"--"):e+(i?" += ":" -= ")+o,e+=") {\n"+a+"}\n";else{e="";let t=s;s.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(s)||(t=i.nameDB_.getDistinctName(o+"_start",n.NameType$$module$build$src$core$names.VARIABLE),e+="var "+t+" = "+s+";\n"),s=r,r.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(r)||(e+="var "+(s=i.nameDB_.getDistinctName(o+"_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+";\n"),e+="var "+(r=i.nameDB_.getDistinctName(o+"_inc",n.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=n.isNumber$$module$build$src$core$utils$string(l)?e+(Math.abs(Number(l))+";\n"):e+"Math.abs("+l+");\n",e+="if ("+t+" > "+s+") {\n",e=(e+=i.INDENT+r+" = -"+r+";\n")+"}\nfor ("+o+" = "+t+"; "+r+" >= 0 ? "+o+" <= "+s+" : "+o+" >= "+s+"; "+o+" += "+r+") {\n"+a+"}\n"}return e},controls_forEach:function(e,i){const o=i.getVariableName(e.getFieldValue("VAR"));var s=i.valueToCode(e,"LIST",t.ASSIGNMENT)||"[]";let r=i.statementToCode(e,"DO");r=i.addLoopTrap(r,e),e="";let l=s;return s.match(/^\w+$/)||(l=i.nameDB_.getDistinctName(o+"_list",n.NameType$$module$build$src$core$names.VARIABLE),e+="var "+l+" = "+s+";\n"),s=i.nameDB_.getDistinctName(o+"_index",n.NameType$$module$build$src$core$names.VARIABLE),r=i.INDENT+o+" = "+l+"["+s+"];\n"+r,e+"for (var "+s+" in "+l+") {\n"+r+"}\n"}};b.controls_repeat=s,b.controls_repeat_ext=s,b.controls_whileUntil=function(e,i){const n="UNTIL"===e.getFieldValue("MODE");let o=i.valueToCode(e,"BOOL",n?t.LOGICAL_NOT:t.NONE)||"false",s=i.statementToCode(e,"DO");return s=i.addLoopTrap(s,e),n&&(o="!"+o),"while ("+o+") {\n"+s+"}\n"};var f={math_arithmetic:function(e,i){var n={ADD:[" + ",t.ADDITION],MINUS:[" - ",t.SUBTRACTION],MULTIPLY:[" * ",t.MULTIPLICATION],DIVIDE:[" / ",t.DIVISION],POWER:[null,t.NONE]}[e.getFieldValue("OP")];const o=n[0];n=n[1];const s=i.valueToCode(e,"A",n)||"0";return e=i.valueToCode(e,"B",n)||"0",o?[s+o+e,n]:["Math.pow("+s+", "+e+")",t.FUNCTION_CALL]},math_atan2:function(e,i){const n=i.valueToCode(e,"X",t.NONE)||"0";return["Math.atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+n+") / Math.PI * 180",t.DIVISION]},math_change:function(e,i){const n=i.valueToCode(e,"DELTA",t.ADDITION)||"0";return(e=i.getVariableName(e.getFieldValue("VAR")))+" = (typeof "+e+" === 'number' ? "+e+" : 0) + "+n+";\n"},math_constant:function(e,i){return{PI:["Math.PI",t.MEMBER],E:["Math.E",t.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",t.DIVISION],SQRT2:["Math.SQRT2",t.MEMBER],SQRT1_2:["Math.SQRT1_2",t.MEMBER],INFINITY:["Infinity",t.ATOMIC]}[e.getFieldValue("CONSTANT")]},math_constrain:function(e,i){return["Math.min(Math.max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"Infinity")+")",t.FUNCTION_CALL]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MODULUS)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0"),t.MODULUS]},math_number:function(e,i){return e=Number(e.getFieldValue("NUM")),[String(e),0<=e?t.ATOMIC:t.UNARY_NEGATION]},math_number_property:function(e,i){var n={EVEN:[" % 2 === 0",t.MODULUS,t.EQUALITY],ODD:[" % 2 === 1",t.MODULUS,t.EQUALITY],WHOLE:[" % 1 === 0",t.MODULUS,t.EQUALITY],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MODULUS,t.EQUALITY],PRIME:[null,t.NONE,t.FUNCTION_CALL]};const o=e.getFieldValue("PROPERTY"),[s,r,l]=n[o];return n=i.valueToCode(e,"NUMBER_TO_CHECK",r)||"0",[e="PRIME"===o?i.provideFunction_("mathIsPrime",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+"("+n+")":"DIVISIBLE_BY"===o?n+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0")+" === 0":n+s,l]},math_on_list:function(e,i){var n=e.getFieldValue("OP");switch(n){case"SUM":e=i.valueToCode(e,"LIST",t.MEMBER)||"[]",e+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":e="Math.min.apply(null, "+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MAX":e="Math.max.apply(null, "+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"AVERAGE":e=(n=i.provideFunction_("mathMean",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MEDIAN":e=(n=i.provideFunction_("mathMedian",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MODE":e=(n=i.provideFunction_("mathModes",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n      modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"STD_DEV":e=(n=i.provideFunction_("mathStandardDeviation",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance /= n;\n  return Math.sqrt(variance);\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"RANDOM":e=(n=i.provideFunction_("mathRandomList",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+n)}return[e,t.FUNCTION_CALL]},math_random_float:function(e,i){return["Math.random()",t.FUNCTION_CALL]},math_random_int:function(e,i){const n=i.valueToCode(e,"FROM",t.NONE)||"0";return e=i.valueToCode(e,"TO",t.NONE)||"0",[i.provideFunction_("mathRandomInt",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`)+"("+n+", "+e+")",t.FUNCTION_CALL]}};f.math_round=r,f.math_single=r,f.math_trig=r;var E={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+";\n"},procedures_callreturn:function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME")),o=[],s=e.getVars();for(let n=0;n<s.length;n++)o[n]=i.valueToCode(e,"ARG"+n,t.NONE)||"null";return[n+"("+o.join(", ")+")",t.FUNCTION_CALL]}};E.procedures_defnoreturn=l,E.procedures_defreturn=l,E.procedures_ifreturn=function(e,i){let n="if ("+(i.valueToCode(e,"CONDITION",t.NONE)||"false")+") {\n";return i.STATEMENT_SUFFIX&&(n+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"null",n+=i.INDENT+"return "+e+";\n"):n+=i.INDENT+"return;\n",n+"}\n"};var y=/^\s*'([^']|\\')*'\s*$/,v=function(e){return y.test(e)?[e,t.ATOMIC]:["String("+e+")",t.FUNCTION_CALL]},C=function(e,t,i){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+i:"LAST"===t?e+".length - 1":i},_={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR"));return e=i.valueToCode(e,"TEXT",t.NONE)||"''",n+" += "+v(e)[0]+";\n"},text_changeCase:function(e,i){const n={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=i.valueToCode(e,"TEXT",n?t.MEMBER:t.NONE)||"''",[n?e+n:i.provideFunction_("textToTitleCase",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`)+"("+e+")",t.FUNCTION_CALL]},text_charAt:function(e,i){const n=e.getFieldValue("WHERE")||"FROM_START",o=i.valueToCode(e,"VALUE","RANDOM"===n?t.NONE:t.MEMBER)||"''";switch(n){case"FIRST":return[o+".charAt(0)",t.FUNCTION_CALL];case"LAST":return[o+".slice(-1)",t.FUNCTION_CALL];case"FROM_START":return[o+".charAt("+(e=i.getAdjusted(e,"AT"))+")",t.FUNCTION_CALL];case"FROM_END":return[o+".slice("+(e=i.getAdjusted(e,"AT",1,!0))+").charAt(0)",t.FUNCTION_CALL];case"RANDOM":return[i.provideFunction_("textRandomLetter",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`)+"("+o+")",t.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''";return e=i.valueToCode(e,"SUB",t.NONE)||"''",[i.provideFunction_("textCount",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`)+"("+n+", "+e+")",t.FUNCTION_CALL]},text_getSubstring:function(e,i){var n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const o=e.getFieldValue("WHERE1"),s=e.getFieldValue("WHERE2");var r="FROM_END"!==o&&"LAST"!==o&&"FROM_END"!==s&&"LAST"!==s,l=i.valueToCode(e,"STRING",r?t.MEMBER:t.NONE)||"''";if("FIRST"===o&&"LAST"===s)return[l,t.NONE];if(l.match(/^'?\w+'?$/)||r){switch(o){case"FROM_START":n=i.getAdjusted(e,"AT1");break;case"FROM_END":n=l+".length - "+(n=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(s){case"FROM_START":i=i.getAdjusted(e,"AT2",1);break;case"FROM_END":i=l+".length - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":i=l+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}l=l+".slice("+n+", "+i+")"}else r=i.getAdjusted(e,"AT1"),e=i.getAdjusted(e,"AT2"),l=i.provideFunction_("subsequence"+n[o]+n[s],`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===o||"FROM_START"===o?", at1":""}${"FROM_END"===s||"FROM_START"===s?", at2":""}) {\n  var start = ${C("sequence",o,"at1")};\n  var end = ${C("sequence",s,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+l+("FROM_END"===o||"FROM_START"===o?", "+r:"")+("FROM_END"===s||"FROM_START"===s?", "+e:"")+")";return[l,t.FUNCTION_CALL]},text_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",o=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+"."+n+"("+o+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITION]:[i,t.FUNCTION_CALL]},text_isEmpty:function(e,i){return["!"+(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.LOGICAL_NOT]},text_join:function(e,i){switch(e.itemCount_){case 0:return["''",t.ATOMIC];case 1:return e=i.valueToCode(e,"ADD0",t.NONE)||"''",v(e);case 2:var n=i.valueToCode(e,"ADD0",t.NONE)||"''";return e=i.valueToCode(e,"ADD1",t.NONE)||"''",[v(n)[0]+" + "+v(e)[0],t.ADDITION];default:n=Array(e.itemCount_);for(let o=0;o<e.itemCount_;o++)n[o]=i.valueToCode(e,"ADD"+o,t.NONE)||"''";return["["+n.join(",")+"].join('')",t.FUNCTION_CALL]}},text_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.MEMBER]},text_print:function(e,i){return"window.alert("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+");\n"}};_.text_prompt=a,_.text_prompt_ext=a,_.text_replace=function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''",o=i.valueToCode(e,"FROM",t.NONE)||"''";return e=i.valueToCode(e,"TO",t.NONE)||"''",[i.provideFunction_("textReplace",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')\n                 .replace(/\\x08/g, '\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`)+"("+n+", "+o+", "+e+")",t.FUNCTION_CALL]},_.text_reverse=function(e,i){return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+".split('').reverse().join('')",t.FUNCTION_CALL]},_.text_trim=function(e,i){const n={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+n,t.FUNCTION_CALL]};var T={};T.variables_get=c,T.variables_set=h;var w={};w.variables_get_dynamic=c,w.variables_set_dynamic=h;var I=new u,k=Object.assign({},g,m,b,f,E,_,T,w);for(const e in k)I.forBlock[e]=k[e];var x={};return x.JavascriptGenerator=u,x.Order=t,x.javascriptGenerator=I,x.__namespace__=n,x})?n.apply(t,o):n)||(e.exports=s)},470:(e,t,i)=>{"use strict";i.d(t,{Ep:()=>C,Go:()=>u,HV:()=>g,Jp:()=>b,KW:()=>E,VQ:()=>f,WS:()=>y,ar:()=>l,cf:()=>c,fD:()=>v,gk:()=>h,hc:()=>x,i$:()=>T,iu:()=>m,ky:()=>d,np:()=>_,oR:()=>N,ok:()=>I,tG:()=>w,ub:()=>s,v2:()=>r,ze:()=>o});var n=0;function o(e,t){this.isBlock=t,t?(this.block=e,this.stmt=null):(this.block=null,this.stmt=e),this.id=n++}function s(e){this.statementSeq=e,this.id=n++}const r={EXPR:"expr",ASSIGNMENT:"assignment",ADD_RELATION:"add_relation"};function l(e,t,i){this.firstExpr=t,this.secondExpr=i,this.type=e,this.next=null,this.id=n++}function a(e,t){this.first=e,this.last=t}function c(e,t,i){let n=new p;return n.type=d.ID,n.ident=t,n.objectSeq=i,new l(r.ADD_RELATION,e,n)}function h(e){return new a(e,e)}function u(e,t){return e.last.next=t,e.last=t,e}const d={ID:"id",STRING:"string",INT:"int",DOUBLE:"double",BOOLEAN:"boolean",CLASS:"class",OBJ_VAR:"obj_var",VAR:"var",ENUM:"enum",GET_BY_RELATIONSHIP:"get by relationship",PROPERTY:"property",IS:"is",GREATER:"greater",LESS:"less",EQUAL:"equal",NOT_EQUAL:"not equal",GE:"ge",LE:"le",COMPARE:"compare",AND:"and",OR:"or",NOT:"not",CHECK_REL:"check_rel",GET_CLASS:"get_class",FIND:"find",FIND_EXTREM:"find extreme",EXIST:"exist",FORALL:"forall",CAST:"cast",IF:"if",WITH:"with"};function p(){this.id=n++,this.type=null,this.typeIdent=null,this.ident=null,this.rel=null,this.extremeIdent=null,this.string=null,this.int=null,this.double=null,this.boolean=null,this.identValue=null,this.cast=null,this.firstOperand=null,this.secondOperand=null,this.objectSeq=null,this.next=null}function g(e,t,i){let n=new p;return n.type=e,n.firstOperand=t,e==d.PROPERTY?n.ident=i:n.secondOperand=i,n}function m(e,t){let i=new p;return i.type=d.GET_BY_RELATIONSHIP,i.rel=t,i.firstOperand=e,i}function b(e,t){let i=new p;return i.type=e,i.firstOperand=t,i}function f(e,t){let i=new p;return i.type=d.CAST,i.firstOperand=t,i.cast=e,i}function E(e,t){let i=new p;return i.type=e,e==d.ID||e==d.CLASS?i.ident=t:e==d.OBJ_VAR?i.ident=t.substring(4):e==d.VAR?i.ident=t.substring(1):e==d.STRING?i.string=t:e==d.INT?i.int=Number(t):e==d.DOUBLE?i.double=Number(t):e==d.BOOLEAN&&(i.boolean=t),i}function y(e,t){let i=new p;return i.type=d.ENUM,i.ident=e,i.identValue=t,i}function v(e,t,i){let n=new p;return n.type=d.CHECK_REL,n.firstOperand=e,n.rel=t,n.objectSeq=i,n}function C(e,t,i,n){let o=new p;return o.type=e,o.firstOperand=n,o.typeIdent=t,o.ident=i,o}function _(e,t,i,n,o){let s=new p;return s.type=d.FIND_EXTREM,s.extremeIdent=e,s.firstOperand=t,s.typeIdent=i,s.ident=n,s.secondOperand=o,s}function T(e,t,i,n,o){let s=new p;return s.type=e,s.firstOperand=n,s.secondOperand=o,s.typeIdent=t,s.ident=i,s}function w(e,t){let i=new p;return i.type=d.IF,i.firstOperand=e,i.secondOperand=t,i}function I(e,t,i){let n=new p;return n.type=d.WITH,n.firstOperand=t,n.secondOperand=i,n.ident=e,n}function k(e,t){this.first=e,this.last=t}function x(e){return new k(e,e)}function N(e,t){return e.last.next=t,e.last=t,e}},497:()=>{},500:function(e,t,i){var n,o;void 0===(o="function"==typeof(n=function(){var e,t,n,o,s,r,l,a,c,h,u,d,p,g,m,b,f,E,y,v,C,_,T,w,I,k,x,N,S,A,R,$,O,D,M,L,B,P,F,V,U,W,H,G,z,j,X,K,Y,J,q,Q,Z,ee,te,ie,ne,oe,se,re,le,ae,ce,he,ue,de,pe,ge,me,be,fe,Ee,ye,ve,Ce,_e,Te,we,Ie,ke,xe,Ne,Se,Ae,Re,$e,Oe,De,Me,Le,Be,Pe,Fe,Ve,Ue,We,He,Ge,ze,je,Xe,Ke,Ye,Je,qe,Qe,Ze,et,tt,it,nt,ot,st,rt,lt,at,ct,ht,ut,dt,pt,gt,mt,bt,ft,Et,yt,vt,Ct,_t,Tt,wt,It,kt,xt,Nt,St,At,Rt,$t,Ot,Dt,Mt,Lt,Bt,Pt,Ft,Vt,Ut,Wt,Ht,Gt,zt,jt,Xt,Kt,Yt,Jt,qt,Qt,Zt,ei,ti,ii,ni,oi,si,ri,li,ai,ci,hi,ui,di,pi,gi,mi,bi,fi,Ei,yi,vi,Ci,_i,Ti,wi,Ii,ki,xi,Ni,Si,Ai,Ri,$i,Oi,Di,Mi,Li,Bi,Pi,Fi,Vi,Ui,Wi,Hi,Gi,zi,ji,Xi,Ki,Yi,Ji,qi,Qi,Zi,en,tn,nn,on,sn,rn,ln,an,cn,hn,un,dn,pn,gn,mn,bn,fn,En,yn,vn,Cn,_n,Tn,wn,In,kn,xn,Nn,Sn,An,Rn,$n,On,Dn,Mn,Ln,Bn,Pn,Fn,Vn,Un,Wn,Hn,Gn,zn,jn,Xn,Kn,Yn,Jn,qn,Qn,Zn,eo,to,io,no,oo,so,ro,lo,ao,co,ho,uo,po,go,mo,bo,fo,Eo,yo,vo,Co,_o,To,wo,Io,ko,xo,No,So,Ao,Ro,$o,Oo,Do,Mo,Lo,Bo,Po,Fo,Vo,Uo,Wo,Ho,Go,zo,jo,Xo,Ko,Yo,Jo,qo,Qo,Zo,es,ts,is,ns,os,ss,rs,ls,as,cs,hs,us,ds,ps,gs,ms,bs,fs,Es,ys,vs,Cs,_s,Ts,ws,Is,ks,xs,Ns,Ss,As,Rs,$s,Os,Ds,Ms,Ls,Bs,Ps,Fs,Vs,Us,Ws,Hs,Gs,zs,js,Xs,Ks,Ys,Js,qs,Qs,Zs,er,tr,ir,nr,or,sr,rr,lr,ar,cr,hr,ur,dr,pr,gr,mr,br,fr,Er,yr,vr,Cr,_r,Tr,wr,Ir,kr,xr,Nr,Sr,Ar,Rr,$r,Or,Dr,Mr,Lr,Br,Pr,Fr,Vr,Ur,Wr,Hr,Gr,zr,jr,Xr,Kr,Yr,Jr,qr,Qr,Zr,el,tl,il,nl,ol,sl,rl,ll,al,cl,hl,ul,dl,pl,gl,ml,bl,fl,El,yl,vl,Cl,_l,Tl,wl,Il,kl,xl,Nl,Sl,Al,Rl,$l={};e=function(e,i,n,o){if(!(e instanceof Bl)&&"string"!=typeof e||""===`${e}`.trim())throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=`${e}`.toLowerCase(),"string"!=typeof i||""===i.trim())throw Error('Invalid name "'+i+'". The name must be a non-empty string.');const s=i.toLowerCase();if(!n)throw Error("Can not register a null value");let r=Ol[e],l=Ml[e];if(r||(r=Ol[e]=Object.create(null),l=Ml[e]=Object.create(null)),t(e,n),!o&&r[s]&&r[s]!==n)throw Error('Name "'+s+'" with type "'+e+'" already registered.');r[s]=n,l[s]=i},t=function(e,t){if(e===String(Bl.FIELD)&&"function"!=typeof t.fromJson)throw Error('Type "'+e+'" must have a fromJson function')},n=function(e,t){e=`${e}`.toLowerCase(),t=t.toLowerCase();const i=Ol[e];i&&i[t]?(delete Ol[e][t],delete Ml[e][t]):console.warn("Unable to unregister ["+t+"]["+e+"] from the registry.")},o=function(e,t,i){e=`${e}`.toLowerCase(),t=t.toLowerCase();const n=Ol[e];if(!n||!n[t]){if(t="Unable to find ["+t+"]["+e+"] in the registry.",i)throw Error(t+" You must require or register a "+e+" plugin.");return console.warn(t),null}return n[t]},s=function(e,t){return e=`${e}`.toLowerCase(),t=t.toLowerCase(),!!(e=Ol[e])&&!!e[t]},r=function(e,t,i){return o(e,t,i)},l=function(e,t,i){return o(e,t,i)},a=function(e,t,i){e=`${e}`.toLowerCase();var n=Ol[e];if(!n){if(n=`Unable to find [${e}] in the registry.`,i)throw Error(`${n} You must require or register a ${e} plugin.`);return console.warn(n),null}if(!t)return n;e=Ml[e],i=Object.create(null);for(const t of Object.keys(n))i[e[t]]=n[t];return i},c=function(e,t,i){return"function"==typeof(t=t.plugins[String(e)]||Ll)?t:r(e,t,i)},h=function(e,t){u(),ea=setTimeout((function(){t&&t.handleRightClick(e)}),Jl)},u=function(){ea&&(clearTimeout(ea),ea=0)},d=function(){Ql=null},p=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&m(e)},g=function(e){return`${e.pointerId}`},m=function(e){const t=g(e);return Ql?Ql===t:"pointerdown"===e.type&&(Ql=t,!0)},b=function(e,t,i,n,o){function s(e){(o||p(e))&&(i?n.call(i,e):n(e))}const r=[];if(t in Zl)for(let i=0;i<Zl[t].length;i++){const n=Zl[t][i];e.addEventListener(n,s,!1),r.push([e,n,s])}else e.addEventListener(t,s,!1),r.push([e,t,s]);return r},f=function(e,t,i,n){function o(e){i?n.call(i,e):n(e)}const s=[];if(t in Zl)for(let i=0;i<Zl[t].length;i++){const n=Zl[t][i];e.addEventListener(n,o,!1),s.push([e,n,o])}else e.addEventListener(t,o,!1),s.push([e,t,o]);return s},E=function(e){const t=e[e.length-1][2];for(;e.length;){const[t,i,n]=e.pop();t.removeEventListener(i,n,!1)}return t},y=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||"true"===e.target.getAttribute("data-is-text-input"))return!0;if(e.target instanceof HTMLInputElement)return"text"===(e=e.target).type||"number"===e.type||"email"===e.type||"password"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type;if(e.target instanceof HTMLTextAreaElement)return!0}return!1},v=function(e){return!(!e.ctrlKey||!ca)||2===e.button},C=function(e,t,i){const n=t.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,i||(i=t.getScreenCTM().inverse()),n.matrixTransform(i)},_=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*da,y:e.deltaY*da};case 2:return{x:e.deltaX*pa,y:e.deltaY*pa}}},T=function(){return"blockly-"+(Ea++).toString(36)},w=function(){return fa.genUid()},I=function(e){return e.type===ia.BLOCK_CREATE},k=function(e){return e.type===ia.BLOCK_DELETE},x=function(e){return e.type===ia.BLOCK_CHANGE},N=function(e){return e.type===ia.BLOCK_FIELD_INTERMEDIATE_CHANGE},S=function(e){return e.type===ia.BLOCK_MOVE},A=function(e){return e.type===ia.VAR_CREATE},R=function(e){return e.type===ia.VAR_DELETE},$=function(e){return e.type===ia.VAR_RENAME},O=function(e){return e.type===ia.BLOCK_DRAG},D=function(e){return e.type===ia.SELECTED},M=function(e){return e.type===ia.CLICK},L=function(e){return e.type===ia.BUBBLE_OPEN},B=function(e){return e.type===ia.TRASHCAN_OPEN},P=function(e){return e.type===ia.TOOLBOX_ITEM_SELECT},F=function(e){return e.type===ia.THEME_CHANGE},V=function(e){return e.type===ia.VIEWPORT_CHANGE},U=function(e){return e.type===ia.COMMENT_CREATE},W=function(e){return e.type===ia.COMMENT_DELETE},H=function(e){return e.type===ia.COMMENT_CHANGE},G=function(e){return e.type===ia.COMMENT_MOVE},z=function(e){return e.type===ia.COMMENT_RESIZE},j=function(e){return e.type===ia.COMMENT_DRAG},X=function(e){return e.type===ia.COMMENT_COLLAPSE},K=function(e){return e.type===ia.FINISHED_LOADING},$l.setRecordUndo$$module$build$src$core$events$utils=function(e){_a=e},Y=function(){return _a},J=function(e){ka.fireInternal(e)},q=function(e){if(ie()){if(!Ia.length)try{requestAnimationFrame((()=>{setTimeout(Q,0)}))}catch(e){setTimeout(Q,0)}Z(e)}},Q=function(){const e=ee(Ia);Ia.length=0;for(const t of e){if(!t.workspaceId)continue;let e;null==(e=Ie(t.workspaceId))||e.fireChangeListener(t)}},Z=function(e){if(x(e)&&"mutation"===e.element){let t;for(t=Ia.length;0<t;t--){const i=Ia[t-1];if(i.group!==e.group||i.workspaceId!==e.workspaceId||!S(i)||i.newParentId!==e.blockId)break}Ia.splice(t,0,e)}else Ia.push(e)},ee=function(e){const t=[];for(const i of e)if(e=t[t.length-1],!i.isNull())if(e&&e.workspaceId===i.workspaceId&&e.group===i.group)if(S(i)&&S(e)&&i.blockId===e.blockId){if(e.newParentId=i.newParentId,e.newInputName=i.newInputName,e.newCoordinate=i.newCoordinate,e.reason||i.reason){let t,n;e.reason=Array.from(new Set((null!=(t=e.reason)?t:[]).concat(null!=(n=i.reason)?n:[])))}}else x(i)&&x(e)&&i.blockId===e.blockId&&i.element===e.element&&i.name===e.name?e.newValue=i.newValue:V(i)&&V(e)?(e.viewTop=i.viewTop,e.viewLeft=i.viewLeft,e.scale=i.scale,e.oldScale=i.oldScale):M(i)&&L(e)||t.push(i);else t.push(i);return t.filter((e=>!e.isNull()))},te=function(){for(let e,t=0;e=Ia[t];t++)e.recordUndo=!1},$l.disable$$module$build$src$core$events$utils=function(){Ta++},$l.enable$$module$build$src$core$events$utils=function(){Ta--},ie=function(){return 0===Ta},$l.getGroup$$module$build$src$core$events$utils=function(){return Ca},$l.setGroup$$module$build$src$core$events$utils=function(e){ka.setGroupInternal(e)},ne=function(e){Ca="boolean"==typeof e?e?w():"":e},oe=function(e){const t=[];e=e.getDescendants(!1);for(let i,n=0;i=e[n];n++)t[n]=i.id;return t},se=function(e,t){const i=re(e.type);if(!i)throw Error("Unknown event type.");return i.fromJson(e,t)},re=function(e){const t=r(Bl.EVENT,e);if(!t)throw Error(`Event type ${e} not found in registry.`);return t},le=function(e){if((S(e)||I(e))&&e.workspaceId){var t=Ie(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=t.getBlockById(e.blockId)){const i=_a;try{_a=!1;const i=e.getParent();if(i&&!i.hasDisabledReason(wa)){const t=e.getDescendants(!1);for(let e,i=0;e=t[i];i++)e.setDisabledReason(!1,wa)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging())do{e.setDisabledReason(!0,wa),e=e.getNextBlock()}while(e)}finally{_a=i}}}},ae=function(e,t,i){e=document.createElementNS(Sa,`${e}`);for(const i in t)e.setAttribute(i,`${t[i]}`);return i&&i.appendChild(e),e},ce=function(e,t){return!(t=t.split(" ")).every((t=>e.classList.contains(t)))&&(e.classList.add(...t),!0)},he=function(e,t){e.classList.remove(...t.split(" "))},ue=function(e,t){return!(t=t.split(" ")).every((t=>!e.classList.contains(t)))&&(e.classList.remove(...t),!0)},de=function(e,t){return e.classList.contains(t)},pe=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},ge=function(e,t){const i=t.nextSibling;if(!(t=t.parentNode))throw Error("Reference node has no parent.");i?t.insertBefore(e,i):t.appendChild(e)},me=function(e,t){e.style.transform=t,e.style["-webkit-transform"]=t},be=function(){Oa++,$a||($a=Object.create(null))},fe=function(){--Oa||($a=null)},Ee=function(e){const t=e.textContent+"\n"+e.className.baseVal;var i;return $a&&(i=$a[t])||(i=window.getComputedStyle(e),i=ve(e,i.fontSize,i.fontWeight,i.fontFamily),$a&&($a[t]=i)),i},ye=function(e,t,i,n){return ve(e,t+"pt",i,n)},ve=function(e,t,i,n){const o=e.textContent;var s;return e=o+"\n"+e.className.baseVal,$a&&(s=$a[e])||(Da||((s=document.createElement("canvas")).className="blocklyComputeCanvas",document.body.appendChild(s),Da=s.getContext("2d")),o&&Da?(Da.font=i+" "+t+" "+n,s=Da.measureText(o).width):s=0,$a&&($a[e]=s)),s},Ce=function(e,t,i,n){const o=document.createElement("span");o.style.font=i+" "+t+" "+n,o.textContent=e,(e=document.createElement("div")).style.width="1px",e.style.height="0",(t=document.createElement("div")).style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.appendChild(o),t.appendChild(e),document.body.appendChild(t),i={height:0,baseline:0};try{t.style.alignItems="baseline",i.baseline=e.offsetTop-o.offsetTop,t.style.alignItems="flex-end",i.height=e.offsetTop-o.offsetTop}finally{document.body.removeChild(t)}return i},$l.getFocusManager$$module$build$src$core$focus_manager=function(){return Pa.getFocusManager()},_e=function(e){return e&&"getFocusableElement"in e&&"getFocusableTree"in e&&"onNodeFocus"in e&&"onNodeBlur"in e&&"canBeFocused"in e},Te=function(e){return"string"==typeof e.id&&void 0!==e.workspace&&void 0!==e.select&&void 0!==e.unselect&&_e(e)},we=function(e,t){for(const i in t)null!==t[i]&&Array.isArray(t[i])?e[i]=we(e[i]||[],t[i]):e[i]=null!==t[i]&&"object"==typeof t[i]?we(e[i]||Object.create(null),t[i]):t[i];return e},Ie=function(e){return Ga[e]||null},ke=function(){const e=[];for(const t in Ga)e.push(Ga[t]);return e},xe=function(e){Ga[e.id]=e},Ne=function(e){delete Ga[e.id]},Se=function(){return Wa},Ae=function(e){Wa=e},Re=function(){const e=$l.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode();return e&&Te(e)?e:null},$e=function(e){$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)},Oe=function(e){const t=Re();let i,n,o,s;const r=new(re(ia.SELECTED))(null!=(i=null==t?void 0:t.id)?i:null,null!=(n=null==e?void 0:e.id)?n:null,null!=(s=null!=(o=null==e?void 0:e.workspace.id)?o:null==t?void 0:t.workspace.id)?s:"");J(r)},De=function(){return Ha},Me=function(e){Ha=e},Le=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;const t=e.getParentSvg(),i=e.getCachedParentSvgSize();var n=t.parentElement;if(n instanceof HTMLElement){var o=n.offsetWidth;n=n.offsetHeight,i.width!==o&&(t.setAttribute("width",o+"px"),e.setCachedParentSvgSize(o,null)),i.height!==n&&(t.setAttribute("height",n+"px"),e.setCachedParentSvgSize(null,n)),e.resize()}},Be=function(e,t){const i=Object.create(null),n=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=n.indexOf(e),n.splice(e,n.length-e));for(let e,t=0;e=n[t];t++)i[e.type]?i[e.type]++:i[e.type]=1;return i},Pe=function(e){return function(){this.jsonInit(e)}},Fe=function(e){ja.defineBlocksWithJsonArrayInternal(e)},Ve=function(e){$l.defineBlocks$$module$build$src$core$common($l.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},$l.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(e){const t={};for(let i=0;i<e.length;i++){const n=e[i];if(!n){console.warn(`Block definition #${i} in JSON array is ${n}. Skipping`);continue}const o=n.type;o?t[o]={init:Pe(n)}:console.warn(`Block definition #${i} in JSON array is missing a type attribute. Skipping.`)}return t},$l.defineBlocks$$module$build$src$core$common=function(e){for(const t of Object.keys(e)){const i=e[t];t in Yl&&console.warn(`Block definition "${t}" overwrites previous definition.`),Yl[t]=i}},Ue=function(e){const t=Se();t&&!(y(e)||t.rendered&&!t.isVisible())&&Ua.registry.onKeyDown(t,e)},We=function(e,t){return-1!==(t=e.indexOf(t))&&(e.splice(t,1),!0)},He=function(e){if(oc)throw Error("CSS already injected");sc+="\n"+e},Ge=function(e,t){oc||(oc=!0,e&&(e=t.replace(/[\\/]$/,""),t=sc.replace(/<<<PATH>>>/g,e),sc="",(e=document.createElement("style")).id="blockly-common-style",t=document.createTextNode(t),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild)))},ze=function(e){return uc.getSizeInternal(e)},je=function(e){if("none"!==Ke(e,"display"))return Xe(e);const t=e.style,i=t.display,n=t.visibility,o=t.position;t.visibility="hidden",t.position="absolute",t.display="inline";const s=e.offsetWidth;return e=e.offsetHeight,t.display=i,t.position=o,t.visibility=n,new hc(s,e)},Xe=function(e){return new hc(e.offsetWidth,e.offsetHeight)},Ke=function(e,t){return(e=window.getComputedStyle(e))[t]||e.getPropertyValue(t)},Ye=function(e){const t=new lc(0,0);e=e.getBoundingClientRect();var i=document.documentElement;return i=new lc(window.pageXOffset||i.scrollLeft,window.pageYOffset||i.scrollTop),t.x=e.left+i.x,t.y=e.top+i.y,t},Je=function(){const e=document.body,t=document.documentElement;return new lc(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)},qe=function(e){const t=parseFloat(Ke(e,"borderLeftWidth")),i=parseFloat(Ke(e,"borderRightWidth")),n=parseFloat(Ke(e,"borderTopWidth"));return e=parseFloat(Ke(e,"borderBottomWidth")),new cc(n,e,t,i)},Qe=function(e,t,i){e=Ze(e,t,i),t.scrollLeft=e.x,t.scrollTop=e.y},Ze=function(e,t,i){var n=Ye(e),o=Ye(t),s=qe(t);const r=n.x-o.x-s.left;return n=n.y-o.y-s.top,o=Xe(e),e=t.clientWidth-o.width,o=t.clientHeight-o.height,s=t.scrollLeft,t=t.scrollTop,i?(s+=r-e/2,t+=n-o/2):(s+=Math.min(r,Math.max(r-e,0)),t+=Math.min(n,Math.max(n-o,0))),new lc(s,t)},et=function(e){const t=new lc(0,0);var i=e.x&&e.getAttribute("x");const n=e.y&&e.getAttribute("y");return i&&(t.x=parseInt(i)),n&&(t.y=parseInt(n)),(i=(i=e.getAttribute("transform"))&&i.match(pc))&&(t.x+=Number(i[1]),i[3]&&(t.y+=Number(i[3]))),(e=e.getAttribute("style"))&&e.includes("translate")&&(e=e.match(gc))&&(t.x+=Number(e[1]),e[3]&&(t.y+=Number(e[3]))),t},tt=function(e){let t=0,i=0;for(;e;){const n=et(e);if(t+=n.x,i+=n.y,(" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv "))break;e=e.parentNode}return new lc(t,i)},it=function(){const e=Je();return new cc(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},nt=function(){const e=document.documentElement,t=window;return new lc(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)},ot=function(e,t){var i=t.x;t=t.y;const n=e.getInjectionDiv().getBoundingClientRect();return i=new lc(i-n.left,t-n.top),t=e.getOriginOffsetInPixels(),lc.difference(i,t).scale(1/e.scale)},st=function(e,t){var i=t.scale(e.scale);t=i.x,i=i.y;const n=e.getInjectionDiv().getBoundingClientRect();return e=e.getOriginOffsetInPixels(),new lc(t+n.left+e.x,i+n.top+e.y)},rt=function(e){({document:yc=yc,DOMParser:vc=vc,XMLSerializer:Cc=Cc}=e),fc=new vc,Ec=new Cc},$l.createElement$$module$build$src$core$utils$xml=function(e){return yc.createElementNS(_c,e)},$l.createTextNode$$module$build$src$core$utils$xml=function(e){return yc.createTextNode(e)},$l.textToDom$$module$build$src$core$utils$xml=function(e){let t=fc.parseFromString(e,"text/xml");if(t&&t.documentElement&&!t.getElementsByTagName("parsererror").length)return t.documentElement;if((t=fc.parseFromString(e,"text/html"))&&t.body.firstChild&&"xml"===t.body.firstChild.nodeName.toLowerCase())return t.body.firstChild;throw Error(`DOMParser was unable to parse: ${e}`)},lt=function(e){return at(Ec.serializeToString(e))},at=function(e){return e.replace(Tc,(e=>`&#${e.charCodeAt(0)};`))},ct=function(e){return e?((e instanceof Element||"string"==typeof e)&&(e=Et(e),e=mt(e)),ht(e),e):null},ht=function(e){const t=e.kind;if(e=e.contents,t&&t!==xc&&t!==kc)throw Error("Invalid toolbox kind "+t+". Please supply either "+xc+" or "+kc);if(!e)throw Error("Toolbox must have a contents attribute.")},ut=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:bt(e):[]},dt=function(e){return Rc.hasCategoriesInternal(e)},pt=function(e){if(!e)return!1;const t=e.kind;return t?t===kc:!!e.contents.filter((e=>"CATEGORY"===e.kind.toUpperCase())).length},gt=function(e){return!(!e||!e.contents||!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length)},mt=function(e){const t={contents:bt(e)};return e instanceof Node&&ft(e,t),t},bt=function(e){const t=[];let i=e.childNodes;i||(i=e);for(let n,o=0;n=i[o];o++){if(!n.tagName)continue;e={};const i=n.tagName.toUpperCase();e.kind=i,"BLOCK"===i?e.blockxml=n:n.childNodes&&0<n.childNodes.length&&(e.contents=bt(n)),ft(n,e),t.push(e)}return t},ft=function(e,t){for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i];n.nodeName.includes("css-")?(t.cssconfig=t.cssconfig||{},t.cssconfig[n.nodeName.replace("css-","")]=n.value):t[n.nodeName]=n.value}},Et=function(e){let t=null;if(e)if("string"==typeof e){if(t=$l.textToDom$$module$build$src$core$utils$xml(e),"xml"!==t.nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(t=e);return t},yt=function(e,t,i,n,o,s){const r=s.scrollbar&&s.scrollbar.canScrollVertically();return e.horizontal===Sc.LEFT?(i=o.absoluteMetrics.left+i,r&&s.RTL&&(i+=bc.scrollbarThickness)):(i=o.absoluteMetrics.left+o.viewMetrics.width-t.width-i,r&&!s.RTL&&(i-=bc.scrollbarThickness)),e.vertical===Nc.TOP?e=o.absoluteMetrics.top+n:(e=o.absoluteMetrics.top+o.viewMetrics.height-t.height-n,s.scrollbar&&s.scrollbar.canScrollHorizontally()&&(e-=bc.scrollbarThickness)),new cc(e,e+t.height,i,i+t.width)},vt=function(e,t){return{horizontal:t.toolboxMetrics.position===Ic.LEFT||e.horizontalLayout&&!e.RTL?Sc.RIGHT:Sc.LEFT,vertical:t.toolboxMetrics.position===Ic.BOTTOM?Nc.TOP:Nc.BOTTOM}},Ct=function(e,t,i,n){const o=e.left,s=e.right-e.left,r=e.bottom-e.top;for(let l=0;l<n.length;l++){const a=n[l];e.intersects(a)&&(e=i===Ac.UP?a.top-r-t:a.bottom+t,e=new cc(e,e+r,o,o+s),l=-1)}return e},_t=function(t,i){e(Bl.SERIALIZER,t,i)},Tt=function(e){n(Bl.SERIALIZER,e)},wt=function(e,{addCoordinates:t=!1,saveIds:i=!0}={}){const n=e.workspace,o=Object.create(null);return o.height=e.getSize().height,o.width=e.getSize().width,i&&(o.id=e.id),t&&(t=e.getRelativeToSurfaceXY(),o.x=n.RTL?n.getWidth()-t.x:t.x,o.y=t.y),e.getText()&&(o.text=e.getText()),e.isCollapsed()&&(o.collapsed=!0),e.isOwnEditable()||(o.editable=!1),e.isOwnMovable()||(o.movable=!1),e.isOwnDeletable()||(o.deletable=!1),o},It=function(e,t,{recordUndo:i=!1}={}){const n=Y();if($l.setRecordUndo$$module$build$src$core$events$utils(i),i=t.newComment(e.id),void 0!==e.text&&i.setText(e.text),void 0!==e.x||void 0!==e.y){const n=i.getRelativeToSurfaceXY();let s,r=null!=(s=e.x)?s:n.x;var o;r=t.RTL?t.getWidth()-r:r,t=null!=(o=e.y)?o:n.y,i.moveTo(new lc(r,t))}if(void 0!==e.width||e.height){let t,n;o=i.getSize(),i.setSize(new hc(null!=(t=e.width)?t:o.width,null!=(n=e.height)?n:o.height))}return void 0!==e.collapsed&&i.setCollapsed(e.collapsed),void 0!==e.editable&&i.setEditable(e.editable),void 0!==e.movable&&i.setMovable(e.movable),void 0!==e.deletable&&i.setDeletable(e.deletable),$l.setRecordUndo$$module$build$src$core$events$utils(n),i},kt=function(t,i){e(Bl.PASTER,t,i)},xt=function(e){n(Bl.PASTER,e)},Nt=function(e){const t=e.workspace,i=e.getRelativeToSurfaceXY(),n=new lc(0,0),o=t.getTopComments(!1).filter((t=>t.id!==e.id)).map((e=>e.getRelativeToSurfaceXY()));for(;St(lc.sum(i,n),o);)n.translate(t.RTL?-30:30,30);e.moveTo(lc.sum(i,n))},St=function(e,t){return t.some((t=>1>=Math.abs(t.x-e.x)&&1>=Math.abs(t.y-e.y)))},At=function(e,t){e.setAttribute(Xc,t)},Rt=function(e,t,i){Array.isArray(i)&&(i=i.join(" ")),e.setAttribute(jc+t,`${i}`)},$t=function(e){return void 0!==e.saveState&&void 0!==e.loadState},Ot=function(e){return Bt(e),Lt()?(Pt(),Promise.resolve()):(lh||(lh=new Promise((e=>{ah=e,ch=window.requestAnimationFrame((()=>{Pt(),e()}))}))),lh)},Dt=function(){return lh||Promise.resolve()},Mt=function(e){e||window.cancelAnimationFrame(ch),Pt(e),!e&&ah&&ah()},Lt=function(){return oa},Bt=function(e){sh.add(e),rh.set(e,$l.getGroup$$module$build$src$core$events$utils());const t=e.getParent();t?Bt(t):oh.add(e)},Pt=function(e){const t=e?new Set([e]):new Set([...oh].map((e=>e.workspace))),i=[...oh].filter(Vt).filter((e=>t.has(e.workspace)));for(var n of i)Ut(n);for(const e of t)e.resizeContents();for(var o of i)n=o.getRelativeToSurfaceXY(),o.updateComponentLocations(n);for(const e of i)o=$l.getGroup$$module$build$src$core$events$utils(),(n=rh.get(e))&&$l.setGroup$$module$build$src$core$events$utils(n),e.bumpNeighbours(),$l.setGroup$$module$build$src$core$events$utils(o);for(const e of i)Ft(e);e||(lh=null)},Ft=function(e){oh.delete(e),sh.delete(e),rh.delete(e);for(const t of e.getChildren(!1))Ft(t)},Vt=function(e){return!e.isDisposed()&&!e.getParent()},Ut=function(e){if(sh.has(e)&&e.initialized){for(const t of e.getChildren(!1))Ut(t);e.renderEfficiently()}},Wt=function(e,t){bh(e,t)},Ht=function(e=mh){bh=e},Gt=function(e,t){Eh(e,t)},zt=function(e=fh){Eh=e},jt=function(e,t,i){vh(e,t,i)},Xt=function(e=yh){vh=e},Kt=function(e,t){_h(e,t)},Yt=function(e=Ch){_h=e},Jt=function(e){return void 0!==e.getProcedureDef},qt=function(e){return void 0!==e.getProcedureCall&&void 0!==e.renameProcedure},Qt=function(e){return void 0!==e.getVariableModel},Zt=function(e,t,i,n){e=e+" was deprecated in "+t+" and will be deleted in "+i+".",n&&(e+="\nUse "+n+" instead."),Ih.has(e)||(Ih.add(e),console.warn(e))},$l.allUsedVarModels$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let i=0;i<e.length;i++){const n=e[i].getVarModels();if(n)for(let e=0;e<n.length;e++){const i=n[e];i.getId()&&t.add(i)}}return Array.from(t.values())},$l.allDeveloperVariables$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let n,o=0;n=e[o];o++){var i=n.getDeveloperVariables;if(i){i=i();for(let e=0;e<i.length;e++)t.add(i[e])}}return Array.from(t.values())},ei=function(e){return ti(e,!1)},ti=function(e,t=!0){return Yl.variables_set||Yl.variables_get||console.warn("There are no variable blocks, but there is a variable category."),t?(Zt("The XML return value of Blockly.Variables.flyoutCategory()","v12","v13","the same method, but handle a return type of FlyoutItemInfo[] (JSON) instead."),oi(e)):(e.registerButtonCallback("CREATE_VARIABLE",(function(e){ci(e.getTargetWorkspace())})),[{kind:"button",text:"%{BKY_NEW_VARIABLE}",callbackkey:"CREATE_VARIABLE"},...ni(e,e.getVariableMap().getVariablesOfType(""),!0)])},ii=function(e){return{VAR:{name:e.getName(),type:e.getType()}}},ni=function(e,t,i,n="variables_get",o="variables_set"){i&&(i=Yl.math_change),e=[];const s=t.slice(-1)[0];return s&&(Yl[o]&&e.push({kind:"block",type:o,gap:i?8:24,fields:ii(s)}),i&&e.push({kind:"block",type:"math_change",gap:Yl[n]?20:8,fields:ii(s),inputs:{DELTA:{shadow:{type:"math_number",fields:{NUM:1}}}}})),Yl[n]&&e.push(...t.sort(yi).map((e=>({kind:"block",type:n,gap:8,fields:ii(e)})))),e},oi=function(e){let t=[];const i=document.createElement("button");return i.setAttribute("text","%{BKY_NEW_VARIABLE}"),i.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){ci(e.getTargetWorkspace())})),t.push(i),e=si(e),t.concat(e)},si=function(e){const t=[];if(0<(e=e.getVariableMap().getVariablesOfType("")).length){var i=e[e.length-1];if(Yl.variables_set){var n=$l.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","variables_set"),n.setAttribute("gap",Yl.math_change?"8":"24"),n.appendChild(bi(i)),t.push(n)}if(Yl.math_change&&((n=$l.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","math_change"),n.setAttribute("gap",Yl.variables_get?"20":"8"),n.appendChild(bi(i)),i=$l.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),n.appendChild(i),t.push(n)),Yl.variables_get){e.sort(yi);for(let n,o=0;n=e[o];o++)(i=$l.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get"),i.setAttribute("gap","8"),i.appendChild(bi(n)),t.push(i)}}return t},ri=function(e){return Sh.generateUniqueNameInternal(e)},li=function(e){return ai(Nh.charAt(0),e.getVariableMap().getAllVariables().map((e=>e.getName())))},ai=function(e,t){if(!t.length)return e;const i=Nh;let n="",o=i.indexOf(e);for(;;){let s=!1;for(let i=0;i<t.length;i++)if(t[i].toLowerCase()===e){s=!0;break}if(!s)break;o++,o===i.length&&(o=0,n=`${Number(n)+1}`),e=i.charAt(o)+n}return e},ci=function(e,t,i){const n=i||"";!function i(o){hi($l.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,o,(function(o){if(o){var s=di(o,e);if(s){if(s.getType()===n)var r=$l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",s.getName());else r=(r=$l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE).replace("%1",s.getName()).replace("%2",s.getType());Wt(r,(function(){i(o)}))}else e.getVariableMap().createVariable(o,n),t&&t(o)}else t&&t(null)}))}("")},$l.renameVariable$$module$build$src$core$variables=function(e,t,i){!function n(o){const s=$l.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",t.getName());hi(s,o,(function(o){if(o){var s=ui(o,t.getType(),e),r=pi(t.getName(),o,e);if(s||r){var l="";s?l=$l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",s.getName()).replace("%2",s.getType()):r&&(l=$l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",o).replace("%2",r)),Wt(l,(function(){n(o)}))}else e.getVariableMap().renameVariable(t,o),i&&i(o)}else i&&i(null)}))}("")},hi=function(e,t,i){jt(e,t,(function(e){e&&((e=e.replace(/[\s\xa0]+/g," ").trim())===$l.Msg$$module$build$src$core$msg.RENAME_VARIABLE||e===$l.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(e=null),i(e)}))},ui=function(e,t,i){i=i.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let n,o=0;n=i[o];o++)if(n.getName().toLowerCase()===e&&n.getType()!==t)return n;return null},di=function(e,t){t=t.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let i,n=0;i=t[n];n++)if(i.getName().toLowerCase()===e)return i;return null},pi=function(e,t,i){return i.getProcedureMap().getProcedures().length?gi(e,t,i):mi(e,t,i)},gi=function(e,t,i){e=e.toLowerCase(),t=t.toLowerCase(),i=i.getProcedureMap().getProcedures();for(const o of i){var n=o.getParameters().filter(Qt).map((e=>e.getVariableModel().getName()));if(n&&(i=n.some((t=>t.toLowerCase()===e)),n=n.some((e=>e.toLowerCase()===t)),i&&n))return o.getName()}return null},mi=function(e,t,i){e=e.toLowerCase(),t=t.toLowerCase(),i=i.getAllBlocks(!1);for(const o of i){if(!Jt(o))continue;var n=(i=o.getProcedureDef())[1];const s=n.some((t=>t.toLowerCase()===e));if(n=n.some((e=>e.toLowerCase()===t)),s&&n)return i[0]}return null},bi=function(e){const t=$l.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name","VAR"),t.setAttribute("id",e.getId()),t.setAttribute("variabletype",e.getType()),e=$l.createTextNode$$module$build$src$core$utils$xml(e.getName()),t.appendChild(e),t},$l.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,t,i,n){let o=$l.getVariable$$module$build$src$core$variables(e,t,i,n);return o||(o=fi(e,t,i,n)),o},$l.getVariable$$module$build$src$core$variables=function(e,t,i,n){const o=e.getPotentialVariableMap();let s=null;if(t&&(s=e.getVariableById(t),!s&&o&&(s=o.getVariableById(t)),s))return s;if(i){if(void 0===n)throw Error("Tried to look up a variable by name without a type");s=e.getVariable(i,n),!s&&o&&(s=o.getVariable(i,n))}return s},fi=function(e,t,i,n){const o=e.getVariableMap(),s=e.getPotentialVariableMap();return i||(i=ri(e.isFlyout?e.targetWorkspace:e)),s?s.createVariable(i,n,null!=t?t:void 0):o.createVariable(i,n,t)},Ei=function(e,t){e=e.getAllVariables();const i=[];if(t.length!==e.length)for(let n=0;n<e.length;n++){const o=e[n];t.includes(o)||i.push(o)}return i},yi=function(e,t){return e.getName().localeCompare(t.getName(),void 0,{sensitivity:"base"})},vi=function(e,t){const i=[];e=e.getAllBlocks(!1);for(let n=0;n<e.length;n++){const o=e[n].getVarModels();if(o)for(let s=0;s<o.length;s++)o[s].getId()===t&&i.push(e[n])}return i},$l.deleteVariable$$module$build$src$core$variables=function(e,t,i){var n=t.getName();const o=vi(e,t.getId());for(let e=o.length-1;0<=e;e--){const t=o[e];if("procedures_defnoreturn"===t.type||"procedures_defreturn"===t.type)return i=String(t.getFieldValue("NAME")),n=$l.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",n).replace("%2",i),void Wt(n);t===i&&o.splice(e,1)}i&&o.length||1<o.length?(n=$l.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(o.length+(i&&!i.workspace.isFlyout?1:0))).replace("%2",n),Gt(n,(i=>{i&&t&&e.getVariableMap().deleteVariable(t)}))):e.getVariableMap().deleteVariable(t)},Ci=function(e,{addCoordinates:t=!1,addInputBlocks:i=!0,addNextBlocks:n=!0,doFullSerialization:o=!0,saveIds:s=!0}={}){if(e.isInsertionMarker())return null;const r={type:e.type,id:s?e.id:void 0};return t&&Ti(e,r),_i(e,r),wi(e,r,o),Ii(e,r,o),ki(e,r,o),i&&xi(e,r,o,s),n&&Ni(e,r,o,s),r},_i=function(e,t){e.isCollapsed()&&(t.collapsed=!0),e.isEnabled()||(t.disabledReasons=Array.from(e.getDisabledReasons())),e.isOwnDeletable()||(t.deletable=!1),e.isOwnMovable()||(t.movable=!1),e.isOwnEditable()||(t.editable=!1),void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&(t.inline=e.inputsInline),e.data&&(t.data=e.data)},Ti=function(e,t){const i=e.workspace;e=e.getRelativeToSurfaceXY(),t.x=Math.round(i.RTL?i.getWidth()-e.x:e.x),t.y=Math.round(e.y)},wi=function(e,t,i){e.saveExtraState?null!==(e=e.saveExtraState(i))&&(t.extraState=e):e.mutationToDom&&null!==(e=e.mutationToDom())&&(t.extraState=Vo(e).replace(' xmlns="https://developers.google.com/blockly/xml"',""))},Ii=function(e,t,i){const n=Object.create(null);for(const t of e.getIcons())$t(t)&&(e=t.saveState(i))&&(n[t.getType().toString()]=e);Object.keys(n).length&&(t.icons=n)},ki=function(e,t,i){const n=Object.create(null);for(const t of e.getFields())t.isSerializable()&&(n[t.name]=t.saveState(i));Object.keys(n).length&&(t.fields=n)},xi=function(e,t,i,n){const o=Object.create(null);for(let t=0;t<e.inputList.length;t++){const s=e.inputList[t];if(!s.connection)continue;const r=Si(s.connection,i,n);r&&(o[s.name]=r)}Object.keys(o).length&&(t.inputs=o)},Ni=function(e,t,i,n){e.nextConnection&&(e=Si(e.nextConnection,i,n))&&(t.next=e)},Si=function(e,t,i){const n=e.getShadowState(!0);if(e=e.targetBlock(),!n&&!e)return null;const o=Object.create(null);return n&&(o.shadow=n),e&&!e.isShadow()&&(o.block=Ci(e,{doFullSerialization:t,saveIds:i})),o},Ai=function(e,t,{recordUndo:i=!1}={}){return e=Ri(e,t,{recordUndo:i}),t.rendered&&Mt(),e},Ri=function(e,t,{parentConnection:i,isShadow:n=!1,recordUndo:o=!1}={}){const s=Y();$l.setRecordUndo$$module$build$src$core$events$utils(o),(o=$l.getGroup$$module$build$src$core$events$utils())||$l.setGroup$$module$build$src$core$events$utils(!0),$l.disable$$module$build$src$core$events$utils();const r=t.getAllVariables();let l;try{l=$i(e,t,{parentConnection:i,isShadow:n})}finally{$l.enable$$module$build$src$core$events$utils()}if(Oi(t,r),ie()&&J(new(re(ia.BLOCK_CREATE))(l)),$l.setGroup$$module$build$src$core$events$utils(o),$l.setRecordUndo$$module$build$src$core$events$utils(s),t.rendered){const e=l;setTimeout((()=>{e.disposed||e.setConnectionTracking(!0)}),1)}return l},$i=function(e,t,{parentConnection:i,isShadow:n=!1}={}){if(!e.type)throw new $h(e);const o=t.newBlock(e.type,e.id);return o.setShadow(n),Di(o,e),Mi(o,e),Li(o,e),Bi(i,o,e),Pi(o,e),Fi(o,e),Vi(o,e),Ui(o,e),Hi(o,t.rendered),o},Oi=function(e,t){if(ie())for(e=Ei(e,t),t=0;t<e.length;t++){const i=e[t];J(new(re(ia.VAR_CREATE))(i))}},Di=function(e,t){let i=void 0===t.x?0:t.x;t=void 0===t.y?0:t.y;const n=e.workspace;i=n.RTL?n.getWidth()-i:i,e.moveBy(i,t)},Mi=function(e,t){if(t.collapsed&&e.setCollapsed(!0),!1===t.deletable&&e.setDeletable(!1),!1===t.movable&&e.setMovable(!1),!1===t.editable&&e.setEditable(!1),!1===t.enabled&&e.setDisabledReason(!0,eh),Array.isArray(t.disabledReasons))for(const i of t.disabledReasons)e.setDisabledReason(!0,i);void 0!==t.inline&&e.setInputsInline(t.inline),void 0!==t.data&&(e.data=t.data)},Li=function(e,t){t.extraState&&(e.loadExtraState?e.loadExtraState(t.extraState):e.domToMutation&&e.domToMutation($l.textToDom$$module$build$src$core$utils$xml(t.extraState)))},Bi=function(e,t,i){if(e){if(e.getSourceBlock().isShadow()&&!t.isShadow())throw new Mh(i);if(e.type===$l.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var n=t.outputConnection;if(!n)throw new Oh("output",t,i)}else if(!(n=t.previousConnection))throw new Oh("previous",t,i);if(!e.connect(n)){const o=t.workspace.connectionChecker;throw new Dh(o.getErrorMessage(o.canConnectWithReason(n,e,!1),n,e),e.type===$l.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",t,i)}}},Pi=function(e,t){if(t.icons){var i=Object.keys(t.icons);for(const o of i){i=t.icons[o];var n=e.getIcon(o);if(!n){if(!(n=r(Bl.ICON,o,!1)))throw new Lh(o,e,t);n=new n(e),e.addIcon(n)}$t(n)&&n.loadState(i)}}},Fi=function(e,t){if(t.fields){var i=Object.keys(t.fields);for(let n=0;n<i.length;n++){const o=i[n],s=t.fields[o],r=e.getField(o);r?r.loadState(s):console.warn(`Ignoring non-existant field ${o} in block ${e.type}`)}}},Vi=function(e,t){if(t.inputs){var i=Object.keys(t.inputs);for(let n=0;n<i.length;n++){const o=i[n],s=e.getInput(o);if(!s||!s.connection)throw new Oh(o,e,t);Wi(s.connection,t.inputs[o])}}},Ui=function(e,t){if(t.next){if(!e.nextConnection)throw new Oh("next",e,t);Wi(e.nextConnection,t.next)}},Wi=function(e,t){t.shadow&&e.setShadowState(t.shadow),t.block&&$i(t.block,e.getSourceBlock().workspace,{parentConnection:e})},Hi=function(e,t){if(t){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(const t of e.getIcons())t.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},Gi=function(e){return void 0!==e.bubbleIsVisible&&void 0!==e.setBubbleVisible},zi=function(e){return e*Math.PI/180},ji=function(e){return 180*e/Math.PI},Xi=function(e,t,i){if(i<e){const t=i;i=e,e=t}return Math.max(e,Math.min(t,i))},Ki=function(){document.querySelector(".blocklyDropDownDiv")||((Gh=document.createElement("div")).className="blocklyDropDownDiv",Gh.tabIndex=-1,(De()||document.body).appendChild(Gh),(zh=document.createElement("div")).className="blocklyDropDownContent",Gh.appendChild(zh),ru=b(zh,"keydown",null,Ue),(jh=document.createElement("div")).className="blocklyDropDownArrow",Gh.appendChild(jh),Gh.style.opacity="0",Gh.style.transition="transform "+qh+"s, opacity "+qh+"s")},Yi=function(e){iu=e},Ji=function(){return nu},qi=function(){return zh},Qi=function(){ru&&(E(ru),ru=null),Gh.remove(),Ki()},Zi=function(e,t){Gh.style.backgroundColor=e,Gh.style.borderColor=t},en=function(e,t,i,n,o=!0){return sn(nn(t),e,o,i,n)},tn=function(e,t,i,n=!0){return ou=!0,sn(on(e),e,n,t,i)},nn=function(e){var t=e.getSvgRoot();const i=e.workspace.scale,n=e.height*i;return e=e.width*i,t=Ye(t),new cc(t.y,t.y+n,t.x,t.x+e)},on=function(e){return e=e.getScaledBBox(),new cc(e.top,e.bottom,e.left,e.right)},sn=function(e,t,i,n,o){const s=e.left+(e.right-e.left)/2,r=e.bottom;e=e.top,o&&(e+=o);let l=(o=t.getSourceBlock()).workspace;for(;l.options.parentWorkspace;)l=l.options.parentWorkspace;return Yi(l.getParentSvg().parentNode),rn(t,o.RTL,s,r,s,e,i,n)},rn=function(e,t,i,n,o,s,r,l){return nu=e,Zh=l||null,Gh.style.direction=t?"rtl":"ltr",e=Se(),eu=e.getRenderer().getClassName(),tu=e.getTheme().getClassName(),ce(Gh,eu),ce(Gh,tu),i=mn(i,n,o,s),r&&(su=$l.getFocusManager$$module$build$src$core$focus_manager().takeEphemeralFocus(Gh)),i},ln=function(e,t,i,n){return{initialX:(e=hn(e,i.left,i.right,n.width)).divX,initialY:t,finalX:e.divX,finalY:t+Jh,arrowX:e.arrowX,arrowY:-(Xh/2+Kh),arrowAtTop:!0,arrowVisible:!0}},an=function(e,t,i,n){return{initialX:(e=hn(e,i.left,i.right,n.width)).divX,initialY:t-n.height,finalX:e.divX,finalY:t-n.height-Jh,arrowX:e.arrowX,arrowY:n.height-2*Kh-Xh/2,arrowAtTop:!1,arrowVisible:!0}},cn=function(e,t,i){return{initialX:(e=hn(e,t.left,t.right,i.width)).divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},hn=function(e,t,i,n){return t=Xi(t,e-n/2,i-n),{arrowX:e=Xi(i=Yh,e=e-Xh/2-t,n-i-Xh),divX:t}},un=function(){return!!nu},dn=function(e,t){return nu===e&&(t?gn():pn(),!0)},pn=function(){Gh.style.transform="translate(0, 0)",Gh.style.opacity="0",Qh=setTimeout((function(){gn()}),1e3*qh),Zh&&(Zh(),Zh=null)},gn=function(){un()&&(Qh&&clearTimeout(Qh),Zh&&(Zh(),Zh=null),Qi(),nu=null,Se().markFocused(),su&&(su(),su=null))},mn=function(e,t,i,n){(e=lu.getPositionMetrics(e,t,i,n)).arrowVisible?(t=e.arrowX,i=e.arrowY,n=e.arrowAtTop?45:225,jh.style.display="",jh.style.transform=`translate(${t}px, ${i}px) rotate(${n}deg)`,jh.setAttribute("class","blocklyDropDownArrow")):jh.style.display="none",t=Math.floor(e.initialX),i=Math.floor(e.initialY),n=Math.floor(e.finalX);const o=Math.floor(e.finalY);return Gh.style.left=t+"px",Gh.style.top=i+"px",Gh.style.display="block",Gh.style.opacity="1",Gh.style.transform="translate("+(n-t)+"px,"+(o-i)+"px)",!!e.arrowAtTop},bn=function(){if(nu){var e=nu.getSourceBlock();const t=(e=ou?on(nu):nn(e)).left+(e.right-e.left)/2;mn(t,e.bottom,t,e.top)}else pn()},fn=function(e){return e.length?e.reduce((function(e,t){return e.length<t.length?e:t})).length:0},En=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i,n=0;for(t=t||fn(e),i=0;i<t;i++){for(var o=e[0][i],s=1;s<e.length;s++)if(o!==e[s][i])return n;" "===o&&(n=i+1)}for(o=1;o<e.length;o++)if((s=e[o][i])&&" "!==s)return n;return t},yn=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i,n=0;for(t=t||fn(e),i=0;i<t;i++){for(var o=e[0].substr(-i-1,1),s=1;s<e.length;s++)if(o!==e[s].substr(-i-1,1))return n;" "===o&&(n=i+1)}for(o=1;o<e.length;o++)if((s=e[o].charAt(e[o].length-i-1))&&" "!==s)return n;return t},$l.wrap$$module$build$src$core$utils$string=function(e,t){e=e.split("\n");for(let i=0;i<e.length;i++)e[i]=vn(e[i],t);return e.join("\n")},vn=function(e,t){if(e.length<=t)return e;const i=e.trim().split(/\s+/);for(var n=0;n<i.length;n++)i[n].length>t&&(t=i[n].length);var o=-1/0;let s,r=1;do{n=o,s=e,e=[],o=i.length/r;let l=1;for(let t=0;t<i.length-1;t++)l<(t+1.5)/o?(l++,e[t]=!0):e[t]=!1;e=_n(i,e,t),o=Cn(i,e,t),e=Tn(i,e),r++}while(o>n);return s},Cn=function(e,t,i){const n=[0],o=[];for(var s=0;s<e.length;s++)n[n.length-1]+=e[s].length,!0===t[s]?(n.push(0),o.push(e[s].charAt(e[s].length-1))):!1===t[s]&&n[n.length-1]++;for(e=Math.max(...n),t=0,s=0;s<n.length;s++)t-=2*Math.pow(Math.abs(i-n[s]),1.5),t-=Math.pow(e-n[s],1.5),".?!".includes(o[s])?t+=i/3:",;)]}".includes(o[s])&&(t+=i/4);return 1<n.length&&n[n.length-1]<=n[n.length-2]&&(t+=.5),t},_n=function(e,t,i){let n,o=Cn(e,t,i);for(let s=0;s<t.length-1;s++){if(t[s]===t[s+1])continue;const r=[].concat(t);r[s]=!r[s],r[s+1]=!r[s+1];const l=Cn(e,r,i);l>o&&(o=l,n=r)}return n?_n(e,n,i):t},Tn=function(e,t){const i=[];for(let n=0;n<e.length;n++)i.push(e[n]),void 0!==t[n]&&i.push(t[n]?"\n":" ");return i.join("")},$l.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},wn=function(e){hu=e},In=function(){return hu},kn=function(){return uu},xn=function(){return Iu},Nn=function(e){if(e=Sn(e)){for(e=e.tooltip;"function"==typeof e;)e=e();if("string"!=typeof e)throw Error("Tooltip function must return a string.");return e}return""},Sn=function(e){for(;e&&e.tooltip;){if("string"==typeof e.tooltip||"function"==typeof e.tooltip)return e;e=e.tooltip}return null},An=function(){document.querySelector(".blocklyTooltipDiv")||((Iu=document.createElement("div")).className="blocklyTooltipDiv",(De()||document.body).appendChild(Iu))},Rn=function(e){e.mouseOverWrapper_=f(e,"pointerover",null,On),e.mouseOutWrapper_=f(e,"pointerout",null,Dn),e.addEventListener("pointermove",Mn,!1)},$n=function(e){e&&(E(e.mouseOverWrapper_),E(e.mouseOutWrapper_),e.removeEventListener("pointermove",Mn))},On=function(e){du||(e=Sn(e.currentTarget),Eu!==e&&(Bn(),yu=null,Eu=e),clearTimeout(gu))},Dn=function(e){du||(gu=setTimeout((function(){yu=Eu=null,Bn()}),1),clearTimeout(mu),mu=0)},Mn=function(e){if(Eu&&Eu.tooltip&&!du)if(uu){const t=bu-e.pageX;e=fu-e.pageY,Math.sqrt(t*t+e*e)>_u&&Bn()}else yu!==Eu&&(clearTimeout(mu),bu=e.pageX,fu=e.pageY,mu=setTimeout(Hn,Tu))},Ln=function(){yu=Eu=null,Bn()},Bn=function(){uu&&(uu=!1,Iu&&(Iu.style.display="none")),mu&&(clearTimeout(mu),mu=0)},Pn=function(){Bn(),du=!0},Fn=function(){du=!1},Vn=function(){Iu&&Eu&&("function"==typeof hu?hu(Iu,Eu):Un())},Un=function(){var e=Nn(Eu);e=(e=$l.wrap$$module$build$src$core$utils$string(e,pu)).split("\n");for(let t=0;t<e.length;t++){const i=document.createElement("div");i.appendChild(document.createTextNode(e[t])),Iu.appendChild(i)}},Wn=function(e){const t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;let n=bu;n=e?n-(vu+Iu.offsetWidth):n+vu;let o=fu+Cu;return o+Iu.offsetHeight>i+window.scrollY&&(o-=Iu.offsetHeight+2*Cu),e?n=Math.max(wu-window.scrollX,n):n+Iu.offsetWidth>t+window.scrollX-2*wu&&(n=t-Iu.offsetWidth-2*wu),{x:n,y:o}},Hn=function(){if(!du&&(yu=Eu,Iu)){Iu.textContent="",Vn();var e=Eu.RTL;Iu.style.direction=e?"rtl":"ltr",Iu.style.display="block",uu=!0;var{x:t,y:i}=Wn(e);Iu.style.left=t+"px",Iu.style.top=i+"px"}},Gn=function(){return xu},zn=function(e){xu=e},jn=function(){return Nu},Xn=function(e){Nu=e},Kn=function(e){e=`${e}`.toLowerCase().trim();var t=Su[e];if(t)return t;if(t="#"===(t="0x"===e.substring(0,2)?"#"+e.substring(2):e)[0]?t:"#"+t,/^#[0-9a-f]{6}$/.test(t))return t;if(/^#[0-9a-f]{3}$/.test(t))return["#",t[1],t[1],t[2],t[2],t[3],t[3]].join("");var i=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return i&&(e=Number(i[1]),t=Number(i[2]),i=Number(i[3]),0<=e&&256>e&&0<=t&&256>t&&0<=i&&256>i)?Yn(e,t,i):null},Yn=function(e,t,i){return t=e<<16|t<<8|i,16>e?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)},Jn=function(e){return(e=Kn(e))?[(e=parseInt(e.substr(1),16))>>16,e>>8&255,255&e]:[0,0,0]},qn=function(e,t,i){let n=0,o=0,s=0;if(0===t)s=o=n=i;else{const r=Math.floor(e/60),l=e/60-r;e=i*(1-t);const a=i*(1-t*l);switch(t=i*(1-t*(1-l)),r){case 1:n=a,o=i,s=e;break;case 2:n=e,o=i,s=t;break;case 3:n=e,o=a,s=i;break;case 4:n=t,o=e,s=i;break;case 5:n=i,o=e,s=a;break;case 6:case 0:n=i,o=t,s=e}}return Yn(Math.floor(n),Math.floor(o),Math.floor(s))},Qn=function(e,t,i){return(e=Kn(e))&&(t=Kn(t))?(e=Jn(e),t=Jn(t),Yn(Math.round(t[0]+i*(e[0]-t[0])),Math.round(t[1]+i*(e[1]-t[1])),Math.round(t[2]+i*(e[2]-t[2])))):null},Zn=function(e){return qn(e,xu,255*Nu)},eo=function(e,t,i){const n=[];var o=e.split("");o.push("");var s=0;e=[];let r=null;for(let c=0;c<o.length;c++){var l=o[c];if(0===s)if("%"===l)(s=e.join(""))&&n.push(s),e.length=0,s=1;else if(i&&"\n"===l){const t=e.join("");t&&n.push(t),e.length=0,n.push(l)}else e.push(l);else if(1===s)"%"===l?(e.push(l),s=0):t&&"0"<=l&&"9">=l?(s=2,r=l,(l=e.join(""))&&n.push(l),e.length=0):"{"===l?s=3:(e.push("%",l),s=0);else if(2===s)if("0"<=l&&"9">=l)r+=l;else{var a=void 0;n.push(parseInt(null!=(a=r)?a:"",10)),c--,s=0}else 3===s&&(""===l?(e.splice(0,0,"%{"),c--,s=0):"}"!==l?e.push(l):(s=e.join(""),/[A-Z]\w*/i.test(s)&&(l=(l=s.toUpperCase()).startsWith("BKY_")?l.substring(4):null)&&l in $l.Msg$$module$build$src$core$msg?"string"==typeof(s=$l.Msg$$module$build$src$core$msg[l])?Array.prototype.push.apply(n,eo(s,t,i)):t?n.push(`${s}`):n.push(s):n.push("%{"+s+"}"),s=e.length=0))}for((t=e.join(""))&&n.push(t),a=[],e.length=0,o=0;o<n.length;o++)"string"!=typeof n[o]||i&&"\n"===n[o]?((t=e.join(""))&&a.push(t),e.length=0,a.push(n[o])):e.push(n[o]);return(t=e.join(""))&&a.push(t),e.length=0,a},to=function(e){return eo(e,!0,!0)},io=function(e){return"string"!=typeof e?e:(e=eo(e,!1,!1)).length?String(e[0]):""},no=function(e){let t=!0;const i=$l.Msg$$module$build$src$core$msg,n=e.match(/%{BKY_[A-Z]\w*}/gi);if(n)for(let o=0;o<n.length;o++)void 0===i[n[o].toUpperCase().slice(6,-1)]&&(console.warn("No message string for "+n[o]+" in "+e),t=!1);return t},oo=function(e){const t="string"==typeof e?io(e):e;var i=Number(t);if(!isNaN(i)&&0<=i&&360>=i)return{hue:i,hex:qn(i,Gn(),255*jn())};if(i=Kn(t))return{hue:null,hex:i};throw i='Invalid colour: "'+t+'"',e!==t&&(i+=' (from "'+e+'")'),Error(i)},so=function(){return Mu},ro=function(e){if(Mu=e,null===e){let e;null==(e=document.querySelector("."+Fu))||e.remove()}},lo=function(){const e=De()||document.body,t=document.querySelector("div."+Fu);t?Mu=t:((Mu=document.createElement("div")).className=Fu,Mu.tabIndex=-1),b(Mu,"keydown",null,Ue),e.appendChild(Mu)},ao=function(e,t,i,n,o=!0){if(co(),Lu=e,Pu=i,i=Mu){if(i.style.direction=t?"rtl":"ltr",i.style.display="block",!n&&e instanceof $u){let t;n=null==(t=e.getSourceBlock())?void 0:t.workspace}var s,r;Bu=null!=(s=n)?s:null,e=null!=(r=n)?r:Se(),Vu=e.getRenderer().getClassName(),Uu=e.getTheme().getClassName(),Vu&&ce(i,Vu),Uu&&ce(i,Uu),o&&(Wu=$l.getFocusManager$$module$build$src$core$focus_manager().takeEphemeralFocus(i))}},co=function(){if(ho()){Lu=null;var e=Mu;e&&(e.style.display="none",e.style.left="",e.style.top="",Pu&&(Pu(),Pu=null),e.textContent="",Vu&&(ue(e,Vu),Vu=""),Uu&&(ue(e,Uu),Uu=""),Se().markFocused(),Wu&&(Wu(),Wu=null))}},ho=function(){return!!Lu},uo=function(e){Lu===e&&co()},po=function(e){let t=null===Bu,i=e;for(;!t&&i;){if(i===e){t=!0;break}i=e.options.parentWorkspace}t&&co()},go=function(e,t,i){Mu.style.left=e+"px",Mu.style.top=t+"px",Mu.style.height=i+"px"},mo=function(e,t,i,n){const o=fo(e,t,i);e=bo(e,t,i,n),0>o?go(e,0,i.height+o):go(e,o,i.height)},bo=function(e,t,i,n){return n?Math.min(Math.max(t.right-i.width,e.left),e.right-i.width):Math.max(Math.min(t.left,e.right-i.width),e.left)},fo=function(e,t,i){return t.bottom+i.height>=e.bottom?t.top-i.height:t.bottom},Eo=function(e){return!(null==e||!e.repositionForWindowResize)},yo=function(){Eo(Lu)&&Lu.repositionForWindowResize()||co()},vo=function(){return Gu},Co=function(e){Gu=e},_o=function(e,t,i,n,o){if(ao(zu,i,No,n),t.length){o||(e instanceof PointerEvent?o=new lc(e.clientX,e.clientY):(console.warn("Context menu opened with keyboard but no location given"),o=new lc(0,0)));var s=To(t,i,e,o);ju=s,wo(s,i,o),setTimeout((function(){s.focus()}),1),Gu=null}else xo()},To=function(e,t,i,n){const o=new Jc;o.setRole(Gc.MENU);for(let s=0;s<e.length;s++){const r=e[s];if(r.separator){o.addChild(new qc);continue}const l=new Yc(r.text);l.setRightToLeft(t),l.setRole(Gc.MENUITEM),o.addChild(l),l.setEnabled(r.enabled),r.enabled&&l.onAction((function(e,t){xo(),requestAnimationFrame((()=>{setTimeout((()=>{r.callback(r.scope,i,t,n)}),0)}))}),{})}return o},wo=function(e,t,i){const n=it();i=new cc(i.y+n.top,i.y+n.top,i.x+n.left,i.x+n.left),Io(e);const o=e.getSize();t&&(i.left+=o.width,i.right+=o.width,n.left+=o.width,n.right+=o.width),mo(n,i,o,t),e.focus()},Io=function(e){var t=so();if(!t)throw Error("Attempting to create a context menu when widget div is null");t=e.render(t),ce(t,"blocklyContextMenu"),b(t,"contextmenu",null,ko),e.focus()},ko=function(e){e.preventDefault(),e.stopPropagation()},xo=function(){uo(zu),Gu=null},No=function(){ju&&(ju.dispose(),ju=null)},$l.callbackFactory$$module$build$src$core$contextmenu=function(e,t){return()=>{let i;$l.disable$$module$build$src$core$events$utils();try{i=t instanceof Element?zo(t,e.workspace):Ri(t,e.workspace);const n=e.getRelativeToSurfaceXY();n.x=e.RTL?n.x-$l.config$$module$build$src$core$config.snapRadius:n.x+$l.config$$module$build$src$core$config.snapRadius,n.y+=2*$l.config$$module$build$src$core$config.snapRadius,i.moveBy(n.x,n.y)}finally{$l.enable$$module$build$src$core$events$utils()}return ie()&&!i.isShadow()&&J(new(re(ia.BLOCK_CREATE))(i)),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(i),i}},So=function(e,t){return(t=C(t,e.getParentSvg(),e.getInverseScreenCTM())).x/=e.scale,t.y/=e.scale,t},Ao=function(e,t,i){t=So(e,t),td.set(e,lc.difference(i,t))},Ro=function(e,t){if(t=So(e,t),!(e=td.get(e)))throw Error("Drag not initialized");return lc.sum(e,t)},$o=function(e,t=!1){const i=$l.createElement$$module$build$src$core$utils$xml("xml");var n=Do($l.allUsedVarModels$$module$build$src$core$variables(e));n.hasChildNodes()&&i.appendChild(n);for(const n of e.getTopComments())i.appendChild(Oo(n,t));for(e=e.getTopBlocks(!0),n=0;n<e.length;n++)i.appendChild(Mo(e[n],t));return i},Oo=function(e,t=!1){const i=$l.createElement$$module$build$src$core$utils$xml("comment");t||i.setAttribute("id",e.id),t=e.workspace;const n=e.getRelativeToSurfaceXY();return n.x=t.RTL?t.getWidth()-n.x:n.x,i.setAttribute("x",`${n.x}`),i.setAttribute("y",`${n.y}`),i.setAttribute("w",`${e.getSize().width}`),i.setAttribute("h",`${e.getSize().height}`),e.getText()&&(i.textContent=e.getText()),e.isCollapsed()&&i.setAttribute("collapsed","true"),e.isOwnEditable()||i.setAttribute("editable","false"),e.isOwnMovable()||i.setAttribute("movable","false"),e.isOwnDeletable()||i.setAttribute("deletable","false"),i},Do=function(e){const t=$l.createElement$$module$build$src$core$utils$xml("variables");for(let i=0;i<e.length;i++){const n=e[i],o=$l.createElement$$module$build$src$core$utils$xml("variable");o.appendChild($l.createTextNode$$module$build$src$core$utils$xml(n.getName())),n.getType()&&o.setAttribute("type",n.getType()),o.id=n.getId(),t.appendChild(o)}return t},Mo=function(e,t){if(e.isInsertionMarker()&&!(e=e.getChildren(!1)[0]))return new DocumentFragment;let i=0;if(e.workspace.RTL&&(i=e.workspace.getWidth()),t=Po(e,t),os(t)){const n=e.getRelativeToSurfaceXY();t.setAttribute("x",String(Math.round(e.workspace.RTL?i-n.x:n.x))),t.setAttribute("y",String(Math.round(n.y)))}return t},Lo=function(e){if(e.isSerializable()){const t=$l.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name",e.name||""),e.toXml(t)}return null},Bo=function(e,t){for(const i of e.getFields())(e=Lo(i))&&t.appendChild(e)},Po=function(e,t){if(e.isInsertionMarker())return(t=e.getChildren(!1)[0])?Po(t):new DocumentFragment;const i=$l.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");if(i.setAttribute("type",e.type),t||(i.id=e.id),e.mutationToDom){var n=e.mutationToDom();n&&(n.hasChildNodes()||n.hasAttributes())&&i.appendChild(n)}if(Bo(e,i),n=e.getCommentText()){var o=e.getIcon(Vh.COMMENT),s=o.getBubbleSize(),r=o.bubbleIsVisible();o=o.getBubbleLocation();var l=$l.createElement$$module$build$src$core$utils$xml("comment");l.appendChild($l.createTextNode$$module$build$src$core$utils$xml(n)),l.setAttribute("pinned",`${r}`),l.setAttribute("h",`${s.height}`),l.setAttribute("w",`${s.width}`),o&&(l.setAttribute("x",`${e.workspace.RTL?e.workspace.getWidth()-(o.x+s.width):o.x}`),l.setAttribute("y",`${o.y}`)),i.appendChild(l)}for(e.data&&((n=$l.createElement$$module$build$src$core$utils$xml("data")).appendChild($l.createTextNode$$module$build$src$core$utils$xml(e.data)),i.appendChild(n)),n=0;n<e.inputList.length;n++){var a=void 0;r=!0,(s=e.inputList[n]).type!==$l.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&s.type!==$l.inputTypes$$module$build$src$core$inputs$input_types.END_ROW&&(o=s.connection.targetBlock(),s.type===$l.inputTypes$$module$build$src$core$inputs$input_types.VALUE?a=$l.createElement$$module$build$src$core$utils$xml("value"):s.type===$l.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(a=$l.createElement$$module$build$src$core$utils$xml("statement")),!(l=s.connection.getShadowDom())||o&&o.isShadow()||a.appendChild(Fo(l,t)),o&&(o=Po(o,t)).nodeType===Na.ELEMENT_NODE&&(a.appendChild(o),r=!1),a.setAttribute("name",s.name),r||i.appendChild(a))}let c;return void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&i.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&i.setAttribute("collapsed","true"),e.isEnabled()||i.setAttribute("disabled-reasons",Array.from(e.getDisabledReasons()).map(encodeURIComponent).join(",")),e.isOwnDeletable()||i.setAttribute("deletable","false"),e.isOwnMovable()||i.setAttribute("movable","false"),e.isOwnEditable()||i.setAttribute("editable","false"),(a=e.getNextBlock())&&(n=Po(a,t)).nodeType===Na.ELEMENT_NODE&&(c=$l.createElement$$module$build$src$core$utils$xml("next"),c.appendChild(n),i.appendChild(c)),!(e=e.nextConnection&&e.nextConnection.getShadowDom())||a&&a.isShadow()||c.appendChild(Fo(e,t)),i},Fo=function(e,t){let i,n=e=e.cloneNode(!0);for(;n;)if(t&&"shadow"===n.nodeName&&n.removeAttribute("id"),n.firstChild)n=n.firstChild;else{for(;n&&!n.nextSibling;){let e;i=n,n=n.parentNode,i.nodeType===Na.TEXT_NODE&&""===i.data.trim()&&(null==(e=n)?void 0:e.firstChild)!==i&&pe(i)}n&&(i=n,n=n.nextSibling,i.nodeType===Na.TEXT_NODE&&""===i.data.trim()&&pe(i))}return e},Vo=function(e){return lt(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},Uo=function(e){e=Vo(e).split("<");let t="";for(let i=1;i<e.length;i++){const n=e[i];"/"===n[0]&&(t=t.substring(2)),e[i]=t+"<"+n,"/"!==n[0]&&"/>"!==n.slice(-2)&&(t+="  ")}return(e=(e=e.join("\n")).replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>")).replace(/^\n/,"")},Wo=function(e,t){return t.setResizesEnabled(!1),t.clear(),e=$l.domToWorkspace$$module$build$src$core$xml(e,t),t.setResizesEnabled(!0),e},$l.domToWorkspace$$module$build$src$core$xml=function(e,t){let i=0;t.RTL&&(i=t.getWidth());const n=[];be();const o=$l.getGroup$$module$build$src$core$events$utils();o||$l.setGroup$$module$build$src$core$events$utils(!0),t.setResizesEnabled&&t.setResizesEnabled(!1);let s=!0;try{for(let o,r=0;o=e.childNodes[r];r++){const e=o.nodeName.toLowerCase(),r=o;if("block"===e||"shadow"===e&&!Y()){const e=zo(r,t);let o;n.push(e.id);const l=parseInt(null!=(o=r.getAttribute("x"))?o:"10",10);let a;const c=parseInt(null!=(a=r.getAttribute("y"))?a:"10",10);isNaN(l)||isNaN(c)||e.moveBy(t.RTL?i-l:l,c,["create"]),s=!1}else{if("shadow"===e)throw TypeError("Shadow block cannot be a top-level block.");if("comment"===e)Ho(r,t);else if("variables"===e){if(!s)throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");jo(r,t),s=!1}}}}finally{$l.setGroup$$module$build$src$core$events$utils(o),t.setResizesEnabled&&t.setResizesEnabled(!0),t.rendered&&Mt(),fe()}return J(new(re(ia.FINISHED_LOADING))(t)),n},Ho=function(e,t){var i;const n=null!=(i=e.getAttribute("id"))?i:void 0;var o,s;let r;var l;let a;return(i=t.rendered?new sd(t,n):new od(t,n)).setText(null!=(o=e.textContent)?o:""),o=parseInt(null!=(s=e.getAttribute("x"))?s:"",10),s=parseInt(null!=(r=e.getAttribute("y"))?r:"",10),isNaN(o)||isNaN(s)||(o=t.RTL?t.getWidth()-o:o,i.moveTo(new lc(o,s))),t=parseInt(null!=(l=e.getAttribute("w"))?l:"",10),l=parseInt(null!=(a=e.getAttribute("h"))?a:"",10),isNaN(t)||isNaN(l)||i.setSize(new hc(t,l)),"true"===e.getAttribute("collapsed")&&i.setCollapsed(!0),"false"===e.getAttribute("editable")&&i.setEditable(!1),"false"===e.getAttribute("movable")&&i.setMovable(!1),"false"===e.getAttribute("deletable")&&i.setDeletable(!1),i},Go=function(e,t){if(!t.getBlocksBoundingBox)return $l.domToWorkspace$$module$build$src$core$xml(e,t);var i=t.getBlocksBoundingBox();if(e=$l.domToWorkspace$$module$build$src$core$xml(e,t),i&&i.top!==i.bottom){var n=i.bottom;i=t.RTL?i.right:i.left;var o=1/0;let s=-1/0,r=1/0;for(let i=0;i<e.length;i++){const n=t.getBlockById(e[i]).getRelativeToSurfaceXY();n.y<r&&(r=n.y),n.x<o&&(o=n.x),n.x>s&&(s=n.x)}for(n=n-r+10,i=t.RTL?i-s:i-o,o=0;o<e.length;o++)t.getBlockById(e[o]).moveBy(i,n,["create"])}return e},$l.domToBlock$$module$build$src$core$xml=function(e,t){return e=zo(e,t),t.rendered&&Mt(),e},zo=function(e,t){$l.disable$$module$build$src$core$events$utils();var i=t.getAllVariables();let n;try{if(n=ts(e,t),t.rendered){const e=n,i=n.getDescendants(!1);e.setConnectionTracking(!1);for(let e=i.length-1;0<=e;e--)i[e].initSvg();for(let e=i.length-1;0<=e;e--)i[e].queueRender();setTimeout((function(){e.disposed||e.setConnectionTracking(!0)}),1),t.resizeContents()}else{const e=n.getDescendants(!1);for(let t=e.length-1;0<=t;t--)e[t].initModel()}}finally{$l.enable$$module$build$src$core$events$utils()}if(ie()){for(e=Ei(t,i),t=0;t<e.length;t++)i=e[t],J(new(re(ia.VAR_CREATE))(i));J(new(re(ia.BLOCK_CREATE))(n))}return n},jo=function(e,t){for(let n=0;n<e.children.length;n++){var i=e.children[n];const o=i.getAttribute("type"),s=i.getAttribute("id");if(!(i=i.textContent))break;let r;t.getVariableMap().createVariable(i,null!=(r=o)?r:void 0,s)}},Xo=function(e){const t={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let i=0;i<e.children.length;i++){const n=e.children[i];if(n.nodeType!==Na.TEXT_NODE)switch(n.nodeName.toLowerCase()){case"mutation":t.mutation.push(n);break;case"comment":t.comment.push(n);break;case"data":t.data.push(n);break;case"title":case"field":t.field.push(n);break;case"value":case"statement":t.input.push(n);break;case"next":t.next.push(n);break;default:console.warn("Ignoring unknown tag: "+n.nodeName)}}return t},Ko=function(e,t){let i=!1;for(let n=0;n<e.length;n++){const o=e[n];t.domToMutation&&(t.domToMutation(o),t.initSvg&&(i=!0))}return i},Yo=function(e,t){for(let i=0;i<e.length;i++){const n=e[i],o=n.textContent,s="true"===n.getAttribute("pinned");let r;const l=parseInt(null!=(r=n.getAttribute("w"))?r:"50",10);let a;const c=parseInt(null!=(a=n.getAttribute("h"))?a:"50",10);let h,u,d=parseInt(null!=(h=n.getAttribute("x"))?h:"",10);const p=parseInt(null!=(u=n.getAttribute("y"))?u:"",10);t.setCommentText(o);const g=t.getIcon(Vh.COMMENT);isNaN(l)||isNaN(c)||g.setBubbleSize(new hc(l,c)),g.setBubbleVisible(s),setTimeout((()=>{isNaN(d)||isNaN(p)||(d=t.workspace.RTL?t.workspace.getWidth()-(d+l):d,g.setBubbleLocation(new lc(d,p))),g.setBubbleVisible(s)}),1)}},Jo=function(e,t){for(let i=0;i<e.length;i++)t.data=e[i].textContent},qo=function(e,t){for(let i=0;i<e.length;i++){const n=e[i],o=n.getAttribute("name");o?is(t,o,n):console.warn(`Ignoring unnamed field in block ${t.type}`)}},Qo=function(e){let t=null,i=null;for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];os(o)&&("block"===o.nodeName.toLowerCase()?t=o:"shadow"===o.nodeName.toLowerCase()&&(i=o))}return{childBlockElement:t,childShadowElement:i}},Zo=function(e,t,i,n){for(let s=0;s<e.length;s++){var o=e[s];const r=o.getAttribute("name"),l=r?i.getInput(r):null;if(!l){console.warn("Ignoring non-existent input "+r+" in block "+n);break}if((o=Qo(o)).childBlockElement){if(!l.connection)throw TypeError("Input connection does not exist.");ts(o.childBlockElement,t,l.connection,!1)}if(o.childShadowElement){let e;null==(e=l.connection)||e.setShadowDom(o.childShadowElement)}}},es=function(e,t,i){for(let n=0;n<e.length;n++){const o=Qo(e[n]);if(o.childBlockElement){if(!i.nextConnection)throw TypeError("Next statement does not exist.");if(i.nextConnection.isConnected())throw TypeError("Next statement is already connected.");ts(o.childBlockElement,t,i.nextConnection,!0)}o.childShadowElement&&i.nextConnection&&i.nextConnection.setShadowDom(o.childShadowElement)}},ts=function(e,t,i,n){var o;const s=e.getAttribute("type");if(!s)throw TypeError("Block type unspecified: "+e.outerHTML);var r=null!=(o=e.getAttribute("id"))?o:void 0;o=t.newBlock(s,r),r=Xo(e);const l=Ko(r.mutation,o);if(Yo(r.comment,o),Jo(r.data,o),i)if(n){if(!o.previousConnection)throw TypeError("Next block does not have previous statement.");i.connect(o.previousConnection)}else if(o.outputConnection)i.connect(o.outputConnection);else{if(!o.previousConnection)throw TypeError("Child block does not have output or previous statement.");i.connect(o.previousConnection)}if(qo(r.field,o),Zo(r.input,t,o,s),es(r.next,t,o),l&&o.initSvg(),(t=e.getAttribute("inline"))&&o.setInputsInline("true"===t),(t=e.getAttribute("disabled"))&&o.setDisabledReason("true"===t||"disabled"===t,eh),null!==(t=e.getAttribute("disabled-reasons")))for(var a of t.split(","))o.setDisabledReason(!0,decodeURIComponent(a));if((a=e.getAttribute("deletable"))&&o.setDeletable("true"===a),(a=e.getAttribute("movable"))&&o.setMovable("true"===a),(a=e.getAttribute("editable"))&&o.setEditable("true"===a),(a=e.getAttribute("collapsed"))&&o.setCollapsed("true"===a),"shadow"===e.nodeName.toLowerCase()){for(e=o.getChildren(!1),a=0;a<e.length;a++)if(!e[a].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");o.setShadow(!0)}return o},is=function(e,t,i){const n=e.getField(t);n?n.fromXml(i):console.warn("Ignoring non-existent field "+t+" in block "+e.type)},ns=function(e){for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if("next"===i.nodeName.toLowerCase()){e.removeChild(i);break}}},os=function(e){return e.nodeType===Na.ELEMENT_NODE},ss=function(t,i){e(Bl.FIELD,t,i)},rs=function(e){n(Bl.FIELD,e)},$l.fromJson$$module$build$src$core$field_registry=function(e){return md.fromJsonInternal(e)},ls=function(e){const t=l(Bl.FIELD,e.type);return t?t.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},as=function(e){return e&&"object"==typeof e&&"src"in e&&"string"==typeof e.src&&"alt"in e&&"string"==typeof e.alt&&"width"in e&&"number"==typeof e.width&&"height"in e&&"number"==typeof e.height},$l.register$$module$build$src$core$extensions=function(e,t){if("string"!=typeof e||""===e.trim())throw Error('Error: Invalid extension name "'+e+'"');if(kd[e])throw Error('Error: Extension "'+e+'" is already registered.');if("function"!=typeof t)throw Error('Error: Extension "'+e+'" must be a function');kd[e]=t},$l.registerMixin$$module$build$src$core$extensions=function(e,t){if(!t||"object"!=typeof t)throw Error('Error: Mixin "'+e+'" must be a object');$l.register$$module$build$src$core$extensions(e,(function(){this.mixin(t)}))},$l.registerMutator$$module$build$src$core$extensions=function(e,t,i,n){const o='Error when registering mutator "'+e+'": ';fs(o,t);const s=ms(t,o);if(i&&"function"!=typeof i)throw Error(o+'Extension "'+e+'" is not a function');$l.register$$module$build$src$core$extensions(e,(function(){s&&this.setMutator(new $l.MutatorIcon$$module$build$src$core$icons$mutator_icon(n||[],this)),this.mixin(t),i&&i.apply(this)}))},cs=function(e){hs(e)?delete kd[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},hs=function(e){return!!kd[e]},us=function(e,t,i){const n=kd[e];if("function"!=typeof n)throw Error('Error: Extension "'+e+'" not found.');let o;if(i?ds(e,t):o=Es(t),n.apply(t),i)fs('Error after applying mutator "'+e+'": ',t);else if(!ys(o,t))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},ds=function(e,t){if(Es(t).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+t.id)},ps=function(e,t){return bs(e.mutationToDom,e.domToMutation,t+" mutationToDom/domToMutation")},gs=function(e,t){return bs(e.saveExtraState,e.loadExtraState,t+" saveExtraState/loadExtraState")},ms=function(e,t){return bs(e.compose,e.decompose,t+" compose/decompose")},bs=function(e,t,i){if(e&&t){if("function"!=typeof e||"function"!=typeof t)throw Error(i+" must be a function");return!0}if(!e&&!t)return!1;throw Error(i+"Must have both or neither functions")},fs=function(e,t){const i=ps(t,e),n=gs(t,e);if(!i&&!n)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");ms(t,e)},Es=function(e){const t=[];return void 0!==e.domToMutation&&t.push(e.domToMutation),void 0!==e.mutationToDom&&t.push(e.mutationToDom),void 0!==e.saveExtraState&&t.push(e.saveExtraState),void 0!==e.loadExtraState&&t.push(e.loadExtraState),void 0!==e.compose&&t.push(e.compose),void 0!==e.decompose&&t.push(e.decompose),t},ys=function(e,t){if((t=Es(t)).length!==e.length)return!1;for(let i=0;i<t.length;i++)if(e[i]!==t[i])return!1;return!0},vs=function(e){if("object"!=typeof document)throw Error("runAfterPageLoad() requires browser document.");if("complete"===document.readyState)e();else{const t=setInterval((function(){"complete"===document.readyState&&(clearInterval(t),e())}),10)}},$l.buildTooltipForDropdown$$module$build$src$core$extensions=function(e,t){const i=[];return function(){i.includes(this.type)||(Cs(this,e,t),i.push(this.type)),this.setTooltip(function(){const i=String(this.getFieldValue(e));return io(t[i])}.bind(this))}},Cs=function(e,t,i){var n=e.getField(t);if(n instanceof fd&&!n.isOptionListDynamic()){n=n.getOptions();for(const o of n)o!==fd.SEPARATOR&&([,n]=o,void 0===i[n]&&console.warn(`No tooltip mapping for value ${n} of field ${t} of block type ${e.type}.`))}},$l.buildTooltipWithFieldText$$module$build$src$core$extensions=function(e,t){return function(){this.setTooltip(function(){const i=this.getField(t);return io(e).replace("%1",i?i.getText():"")}.bind(this))}},_s=function(){const e=this.tooltip;this.setTooltip(function(){const t=this.getParent();return t&&t.getInputsInline()&&t.tooltip||e}.bind(this))},Ts=function(e,t){return" "+e+","+t+" "},ws=function(e,t){return" "+e+t.join("")},Is=function(e,t){return" M "+e+","+t+" "},ks=function(e,t){return" m "+e+","+t+" "},xs=function(e,t){return" l "+e+","+t+" "},Ns=function(e){return" l"+e.join("")},Ss=function(e,t){return" "+e+" "+t+" "},As=function(e,t,i,n){return e+" "+i+" "+i+" "+t+n},Rs=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");e.targetConnection=t,t.targetConnection=e},$s=function(e,t){let i=null;const n=null==(t=t.outputConnection)?void 0:t.getConnectionChecker();for(let o,s=0;o=e.inputList[s];s++){const e=o.connection;let s;if(e&&null!=(s=n)&&s.canConnect(t,e,!1)){if(i)return null;i=e}}return i},Os=function(e,t){let i;for(;i=$s(e,t);)if(!(e=i.targetBlock())||e.isShadow())return i;return null},Ds=function(e){return void 0!==e.getType&&void 0!==e.initView&&void 0!==e.dispose&&void 0!==e.getWeight&&void 0!==e.getSize&&void 0!==e.applyColour&&void 0!==e.hideForInsertionMarker&&void 0!==e.updateEditable&&void 0!==e.updateCollapsed&&void 0!==e.isShownWhenCollapsed&&void 0!==e.setOffsetInBlock&&void 0!==e.onLocationChange&&void 0!==e.onClick&&_e(e)},Ms=function(e){return Ds(e)&&Gi(e)&&$t(e)&&void 0!==e.setText&&void 0!==e.getText&&void 0!==e.setBubbleSize&&void 0!==e.getBubbleSize&&void 0!==e.setBubbleLocation&&void 0!==e.getBubbleLocation&&e.getType()===Vh.COMMENT},Ls=function(e){if(!(100<e.getDescendants(!1).length)){var t=e.workspace,i=e.getSvgRoot();t.getAudioManager().play("delete");var n,o=e.getRelativeToSurfaceXY(),s=i.cloneNode(!0);s.setAttribute("transform","translate("+o.x+","+o.y+")"),null==(n=t.getLayerManager())||n.appendToAnimationLayer({getSvgRoot:()=>s}),Bs(s,{x:o.x,y:o.y,width:e.width,height:e.height},t.RTL,new Date)}},Bs=function(e,t,i,n){const o=((new Date).getTime()-n.getTime())/150;1<o?pe(e):(e.setAttribute("transform","translate("+(t.x+(i?-1:1)*t.width/2*o)+","+(t.y+t.height/2*o)+") scale("+(1-o)+")"),setTimeout(Bs,10,e,t,i,n))},Ps=function(e){var t=e.workspace;const i=t.scale;if(t.getAudioManager().play("click"),!(1>i)){var n=t.getSvgXY(e.getSvgRoot());e.outputConnection?(n.x+=(e.RTL?3:-3)*i,n.y+=13*i):e.previousConnection&&(n.x+=(e.RTL?-23:23)*i,n.y+=3*i);var o=ae(ac.CIRCLE,{cx:n.x,cy:n.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());e=ae(ac.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*i},o),t=ae(ac.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},o),e.beginElement(),t.beginElement(),setTimeout((()=>{pe(o)}),150)}},Fs=function(e){if(Us(),e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var t=e.getHeightWidth().height;t=Math.atan(10/t)/Math.PI*180,e.RTL||(t*=-1),Kd=e,Vs(e,t,new Date,0)}},Vs=function(e,t,i,n){const o=[.66,1,.66,0,-.66,-1,-.66,0];let s="";i.getTime()+200>(new Date).getTime()&&(s=`skewX(${Math.round(o[n%o.length]*t)})`,Xd=setTimeout(Vs,15,e,t,i,n+1)),e.getSvgRoot().setAttribute("transform",`${e.getTranslation()} ${s}`)},Us=function(){Kd&&(Xd&&(clearTimeout(Xd),Xd=null),Kd.getSvgRoot().setAttribute("transform",Kd.getTranslation()),Kd=null)},Ws=function(e,t){const i=e.workspace,n=$l.config$$module$build$src$core$config.snapRadius,o=lc.difference(t,e.getRelativeToSurfaceXY()),s=new lc(0,0),r=i.getAllBlocks(!1).filter((t=>t.id!=e.id)).map((e=>e.getRelativeToSurfaceXY()));for(;Hs(lc.sum(t,s),r)||Gs(e,lc.sum(o,s),n);)i.RTL?s.translate(-n,2*n):s.translate(n,2*n);e.moveTo(lc.sum(t,s))},Hs=function(e,t){return t.some((t=>1>=Math.abs(t.x-e.x)&&1>=Math.abs(t.y-e.y)))},Gs=function(e,t,i){return e.getConnections_(!1).some((e=>!!e.closest(i,t).connection))},zs=function(e,t,i){const n=i.getBoundingRectangle(),o=n.right-n.left,s=Xi(t.top,n.top,t.top+t.height-(n.bottom-n.top))-n.top;let r=t.left;return t=t.left+t.width-o,e.RTL?r=Math.min(t,r):t=Math.max(r,t),!(!(e=Xi(r,n.left,t)-n.left)&&!s||(i.moveBy(e,s,["inbounds"]),0))},js=function(e){return t=>{var i,n=e.getMetricsManager();if(n.hasFixedEdges()&&!e.isDragging())if(ma.includes(null!=(i=t.type)?i:"")){i=n.getScrollMetrics(!0);const o=Xs(e,t);o&&(n=$l.getGroup$$module$build$src$core$events$utils()||!1,$l.setGroup$$module$build$src$core$events$utils(t.group),zs(e,i,o)&&!t.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),$l.setGroup$$module$build$src$core$events$utils(n))}else V(t)&&t.scale&&t.oldScale&&t.scale>t.oldScale&&Ks(e)}},Xs=function(e,t){let i=null;switch(t.type){case ia.BLOCK_CREATE:case ia.BLOCK_MOVE:(i=e.getBlockById(t.blockId))&&(i=i.getRootBlock());break;case ia.COMMENT_CREATE:case ia.COMMENT_MOVE:case ia.COMMENT_RESIZE:i=e.getCommentById(t.commentId)}return i},Ks=function(e){var t=e.getMetricsManager();if(t.hasFixedEdges()&&!e.isDragging()){t=t.getScrollMetrics(!0);var i=e.getTopBoundedElements();for(let n,o=0;n=i[o];o++)zs(e,t,n)}},Ys=function(e){return void 0!==e.isDeletable&&void 0!==e.dispose&&void 0!==e.setDeleteStyle},Js=function(e){const t=e.getIcons();for(const i of e.inputList){if(!i.isVisible())continue;let e;if(t.push(...i.fieldRow),null!=(e=i.connection)&&e.targetBlock())t.push(i.connection.targetBlock());else{let e;(null==(e=i.connection)?void 0:e.type)===hd.INPUT_VALUE&&t.push(i.connection)}}return t},qs=function(e,t){const i=e.workspace.getTopBlocks(!0);let n=null;if(0<=(e=i.indexOf(e.getRootBlock())+t)&&e<i.length?n=i[e]:0>e?n=i[i.length-1]:e>=i.length&&(n=i[0]),0>t&&n){let e,t;return null!=(t=null==(e=n.lastConnectionInStack(!1))?void 0:e.getSourceBlock())?t:n}return n},Qs=function(e,t){var i=e instanceof ip?e.outputConnection.targetBlock():e.getSourceBlock();return i instanceof ip?-1===(e=(i=Js(i)).indexOf(e))?null:0<=(t=e+t)&&t<i.length?i[t]:null:null},Zs=function(e){return void 0!==e.getRelativeToSurfaceXY&&void 0!==e.isMovable&&void 0!==e.startDrag&&void 0!==e.drag&&void 0!==e.endDrag&&void 0!==e.revertDrag},er=function(e){return void 0!==e.autoHide},tr=function(t,i){e(Bl.ICON,t.toString(),i)},ir=function(e){n(Bl.ICON,e)},nr=function(e){return void 0!==e.getProcedureModel&&void 0!==e.doProcedureUpdate&&void 0!==e.isProcedureDef},or=function(e){return void 0!==e.startPublishing&&void 0!==e.stopPublishing},sr=function(e){const t=e.getProcedureMap().getProcedures().filter((e=>!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!1]));e.getBlocksByType("procedures_defnoreturn",!1).forEach((e=>{!nr(e)&&Jt(e)&&t.push(e.getProcedureDef())}));const i=e.getProcedureMap().getProcedures().filter((e=>!!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!0]));return e.getBlocksByType("procedures_defreturn",!1).forEach((e=>{!nr(e)&&Jt(e)&&i.push(e.getProcedureDef())})),t.sort(rr),i.sort(rr),[t,i]},rr=function(e,t){return e[0].localeCompare(t[0],void 0,{sensitivity:"base"})},$l.findLegalName$$module$build$src$core$procedures=function(e,t){if(t.isInFlyout)return e;for(e=e||$l.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!lr(e,t.workspace,t);){const t=e.match(/^(.*?)(\d+)$/);e=t?t[1]+(parseInt(t[2])+1):e+"2"}return e},lr=function(e,t,i){return!ar(e,t,i)},ar=function(e,t,i){for(const n of t.getAllBlocks(!1))if(n!==i&&Jt(n)&&$l.Names$$module$build$src$core$names.equals(n.getProcedureDef()[0],e))return!0;i=i&&nr(i)?null==i?void 0:i.getProcedureModel():void 0;for(const n of t.getProcedureMap().getProcedures())if(n!==i&&$l.Names$$module$build$src$core$names.equals(n.getName(),e))return!0;return!1},$l.rename$$module$build$src$core$procedures=function(e){var t=this.getSourceBlock();if(!t)throw new Ou;e=e.trim();const i=$l.findLegalName$$module$build$src$core$procedures(e,t);nr(t)&&!t.isInsertionMarker()&&t.getProcedureModel().setName(i);const n=this.getValue();if(n!==e&&n!==i)for(e=t.workspace.getAllBlocks(!1),t=0;t<e.length;t++){const o=e[t];o.renameProcedure&&o.renameProcedure(n,i)}return i},cr=function(e){function t(e,t){for(let o=0;o<e.length;o++){var n=e[o][0];const s=e[o][1],r=$l.createElement$$module$build$src$core$utils$xml("block");r.setAttribute("type",t),r.setAttribute("gap","16");const l=$l.createElement$$module$build$src$core$utils$xml("mutation");for(l.setAttribute("name",n),r.appendChild(l),n=0;n<s.length;n++){const e=$l.createElement$$module$build$src$core$utils$xml("arg");e.setAttribute("name",s[n]),l.appendChild(e)}i.push(r)}}const i=[];if(Yl.procedures_defnoreturn){var n=$l.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","procedures_defnoreturn"),n.setAttribute("gap","16");var o=$l.createElement$$module$build$src$core$utils$xml("field");o.setAttribute("name","NAME"),o.appendChild($l.createTextNode$$module$build$src$core$utils$xml($l.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),n.appendChild(o),i.push(n)}return Yl.procedures_defreturn&&((n=$l.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_defreturn"),n.setAttribute("gap","16"),(o=$l.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),o.appendChild($l.createTextNode$$module$build$src$core$utils$xml($l.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),n.appendChild(o),i.push(n)),Yl.procedures_ifreturn&&((n=$l.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_ifreturn"),n.setAttribute("gap","16"),i.push(n)),i.length&&i[i.length-1].setAttribute("gap","24"),t((e=sr(e))[0],"procedures_callnoreturn"),t(e[1],"procedures_callreturn"),i},hr=function(e){return ur(e,!1)},ur=function(e,t=!0){function i(e,t){for(const[i,o]of e)n.push({kind:"block",type:t,gap:16,extraState:{name:i,params:o}})}if(t)return Zt("The XML return value of Blockly.Procedures.flyoutCategory()","v12","v13","the same method, but handle a return type of FlyoutItemInfo[] (JSON) instead."),cr(e);const n=[];return Yl.procedures_defnoreturn&&n.push({kind:"block",type:"procedures_defnoreturn",gap:16,fields:{NAME:$l.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE}}),Yl.procedures_defreturn&&n.push({kind:"block",type:"procedures_defreturn",gap:16,fields:{NAME:$l.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE}}),Yl.procedures_ifreturn&&n.push({kind:"block",type:"procedures_ifreturn",gap:16}),n.length&&(n[n.length-1].gap=24),i((e=sr(e))[0],"procedures_callnoreturn"),i(e[1],"procedures_callreturn"),n},dr=function(e){var t=[],i=e.getBlocksByType("procedures_mutatorarg",!1);for(let e,n=0;e=i[n];n++)t.push(e.getFieldValue("NAME"));i=$l.createElement$$module$build$src$core$utils$xml("xml");const n=$l.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","procedures_mutatorarg");const o=$l.createElement$$module$build$src$core$utils$xml("field");o.setAttribute("name","NAME"),t=ai($l.DEFAULT_ARG$$module$build$src$core$procedures,t),t=$l.createTextNode$$module$build$src$core$utils$xml(t),o.appendChild(t),n.appendChild(o),i.appendChild(n),e.updateToolbox(i)},pr=function(e){if(L(e)&&"mutator"===e.bubbleType&&e.isOpen&&e.blockId){var t=(e=Ie(e.workspaceId).getBlockById(e.blockId)).type;"procedures_defnoreturn"!==t&&"procedures_defreturn"!==t||(e=e.getIcon($l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),dr(e),e.addChangeListener(gr))}},gr=function(e){(I(e)||k(e)||x(e)||N(e))&&(e=Ie(e.workspaceId),dr(e))},mr=function(e,t){return t.getAllBlocks(!1).filter((t=>br(t,e)||qt(t)&&$l.Names$$module$build$src$core$names.equals(t.getProcedureCall(),e)))},br=function(e,t){return nr(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&$l.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),t)},$l.mutateCallers$$module$build$src$core$procedures=function(e){const t=Y();var i=e.getProcedureDef()[0];const n=e.mutationToDom(!0);e=mr(i,e.workspace);for(let s,r=0;s=e[r];r++){i=(i=s.mutationToDom())&&lt(i),s.domToMutation&&s.domToMutation(n);var o=s.mutationToDom();i!==(o=o&&lt(o))&&($l.setRecordUndo$$module$build$src$core$events$utils(!1),J(new(re(ia.BLOCK_CHANGE))(s,"mutation",null,i,o)),$l.setRecordUndo$$module$build$src$core$events$utils(t))}},$l.getDefinition$$module$build$src$core$procedures=function(e,t){for(const i of t.getAllBlocks(!1))if(nr(i)&&i.isProcedureDef()&&$l.Names$$module$build$src$core$names.equals(i.getProcedureModel().getName(),e)||Jt(i)&&$l.Names$$module$build$src$core$names.equals(i.getProcedureDef()[0],e))return i;return null},fr=function(e){return e.isDynamic},Er=function(e){return void 0!==e.pathDown&&void 0!==e.pathUp},yr=function(e){return void 0!==e.pathLeft&&void 0!==e.pathRight},vr=function(t,i){e(Bl.RENDERER,t,i)},Cr=function(e){n(Bl.RENDERER,e)},_r=function(e,t,i){return(e=new(r(Bl.RENDERER,e))(e)).init(t,i),e},Tr=function(e){ci(e.getTargetWorkspace(),void 0,"String")},wr=function(e){ci(e.getTargetWorkspace(),void 0,"Number")},Ir=function(e){ci(e.getTargetWorkspace(),void 0,"Colour")},kr=function(e){return xr(e,!1)},xr=function(e,t=!0){return Yl.variables_set_dynamic||Yl.variables_get_dynamic||console.warn("There are no dynamic variable blocks, but there is a dynamic variable category."),t?(Zt("The XML return value of Blockly.VariablesDynamic.flyoutCategory()","v12","v13","the same method, but handle a return type of FlyoutItemInfo[] (JSON) instead."),Nr(e)):(e.registerButtonCallback("CREATE_VARIABLE_STRING",Tr),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",wr),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",Ir),[{kind:"button",text:$l.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE,callbackkey:"CREATE_VARIABLE_STRING"},{kind:"button",text:$l.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE,callbackkey:"CREATE_VARIABLE_NUMBER"},{kind:"button",text:$l.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE,callbackkey:"CREATE_VARIABLE_COLOUR"},...ni(e,e.getVariableMap().getAllVariables(),!1,"variables_get_dynamic","variables_set_dynamic")])},Nr=function(e){let t=[],i=document.createElement("button");return i.setAttribute("text",$l.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),t.push(i),i=document.createElement("button"),i.setAttribute("text",$l.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),t.push(i),i=document.createElement("button"),i.setAttribute("text",$l.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),t.push(i),e.registerButtonCallback("CREATE_VARIABLE_STRING",Tr),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",wr),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",Ir),e=Sr(e),t.concat(e)},Sr=function(e){const t=[];if(0<(e=e.getVariableMap().getAllVariables()).length){if(Yl.variables_set_dynamic){var i=e[e.length-1];const n=$l.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","variables_set_dynamic"),n.setAttribute("gap","24"),n.appendChild(bi(i)),t.push(n)}if(Yl.variables_get_dynamic){e.sort(yi);for(let n,o=0;n=e[o];o++)(i=$l.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get_dynamic"),i.setAttribute("gap","8"),i.appendChild(bi(n)),t.push(i)}}return t},Ar=function(e){e.resizeContents()},Rr=function(e){const t=e.toCopyData();let i;return jg=t,Xg=null!=(i=e.workspace)?i:null,t},$r=function(e,t,i){return e&&t?Or(e,t,i):jg&&Xg?Or(jg,Xg):null},Or=function(e,t,i){let n,o,s;return t=t.isMutator?t:null!=(n=t.getRootWorkspace())?n:t,null!=(s=null==(o=l(Bl.PASTER,e.paster,!1))?void 0:o.paste(e,t,i))?s:null},Dr=function(e){const t=e.toCopyData();return t?$r(t,e.workspace):null},Mr=function(e){return void 0!==e.toCopyData},Lr=function(){Ua.registry.register({name:Ag.ESCAPE,preconditionFn:e=>!e.isReadOnly(),callback:e=>(e.hideChaff(),!0),keyCodes:[Nd.ESC]})},Br=function(){Ua.registry.register({name:Ag.DELETE,preconditionFn:(e,t)=>(t=t.focusedNode,!e.isReadOnly()&&null!=t&&Ys(t)&&t.isDeletable()&&!Sp.inProgress()&&!$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()),callback:(e,t,i,n)=>(t.preventDefault(),(e=n.focusedNode)instanceof ip?e.checkAndDelete():Ys(e)&&e.isDeletable()&&($l.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),$l.setGroup$$module$build$src$core$events$utils(!1)),!0),keyCodes:[Nd.DELETE,Nd.BACKSPACE]})},Pr=function(e){return e instanceof ip&&Mr(e)&&Ys(e)&&e.isOwnDeletable()&&Zs(e)&&e.isOwnMovable()},Fr=function(e){return e instanceof ip&&Mr(e)&&Ys(e)&&e.isDeletable()&&Zs(e)&&e.isMovable()},Vr=function(){const e=Ua.registry.createSerializedKey(Nd.C,[Nd.CTRL]),t=Ua.registry.createSerializedKey(Nd.C,[Nd.META]);Ua.registry.register({name:Ag.COPY,preconditionFn:(e,t)=>(t=t.focusedNode)instanceof ip&&(e=e.isFlyout?e.targetWorkspace:e,!!t&&!!e&&!e.isReadOnly()&&!e.isDragging()&&!$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()&&Pr(t)),callback:(e,t,i,n)=>(t.preventDefault(),!!((t=n.focusedNode)&&Pr(t)&&(e=(e=t.workspace instanceof Cg?t.workspace:e).isFlyout?e.targetWorkspace:e)&&(t.workspace.isFlyout||e.hideChaff(),Jg=t.toCopyData(),qg=e,Qg=Zs(t)&&t.workspace==e?t.getRelativeToSurfaceXY():null,Jg))),keyCodes:[e,t]})},Ur=function(){const e=Ua.registry.createSerializedKey(Nd.X,[Nd.CTRL]),t=Ua.registry.createSerializedKey(Nd.X,[Nd.META]);Ua.registry.register({name:Ag.CUT,preconditionFn:(e,t)=>!!(t=t.focusedNode)&&!e.isReadOnly()&&!e.isDragging()&&!$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()&&Fr(t),callback:(e,t,i,n)=>(t=n.focusedNode)instanceof ip?(Jg=t.toCopyData(),qg=e,Qg=t.getRelativeToSurfaceXY(),t.checkAndDelete(),!0):!!(Ys(t)&&t.isDeletable()&&Mr(t))&&(Jg=t.toCopyData(),qg=e,Qg=Zs(t)?t.getRelativeToSurfaceXY():null,t.dispose(),!0),keyCodes:[e,t]})},Wr=function(){const e=Ua.registry.createSerializedKey(Nd.V,[Nd.CTRL]),t=Ua.registry.createSerializedKey(Nd.V,[Nd.META]);Ua.registry.register({name:Ag.PASTE,preconditionFn:e=>(e=e.isFlyout?e.targetWorkspace:e,!(!Jg||!e||e.isReadOnly()||e.isDragging()||$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken())),callback(e,t){if(!Jg||!qg)return!1;if(t instanceof PointerEvent)return e=ot(qg,new lc(t.clientX,t.clientY)),!!$r(Jg,qg,e);if(!Qg)return!!$r(Jg,qg);const{left:i,top:n,width:o,height:s}=qg.getMetricsManager().getViewMetrics(!0);return new cc(n,n+s,i,i+o).contains(Qg.x,Qg.y)?!!$r(Jg,qg):(e=new lc(i+o/2,n+s/2),!!$r(Jg,qg,e))},keyCodes:[e,t]})},Hr=function(){const e=Ua.registry.createSerializedKey(Nd.Z,[Nd.CTRL]),t=Ua.registry.createSerializedKey(Nd.Z,[Nd.META]);Ua.registry.register({name:Ag.UNDO,preconditionFn:e=>!e.isReadOnly()&&!Sp.inProgress()&&!$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken(),callback:(e,t)=>(e.hideChaff(),e.undo(!1),t.preventDefault(),!0),keyCodes:[e,t]})},Gr=function(){const e=Ua.registry.createSerializedKey(Nd.Z,[Nd.SHIFT,Nd.CTRL]),t=Ua.registry.createSerializedKey(Nd.Z,[Nd.SHIFT,Nd.META]),i=Ua.registry.createSerializedKey(Nd.Y,[Nd.CTRL]);Ua.registry.register({name:Ag.REDO,preconditionFn:e=>!Sp.inProgress()&&!e.isReadOnly()&&!$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken(),callback:(e,t)=>(e.hideChaff(),e.undo(!0),t.preventDefault(),!0),keyCodes:[e,t,i]})},zr=function(){Lr(),Br(),Vr(),Ur(),Wr(),Hr(),Gr()},jr=function(e){const t=e.saveState();return e.getParameters().length?(t.parameters=e.getParameters().map((e=>e.saveState())),t):t},Xr=function(e,t,i,n){if(e=e.loadState(i,n),!i.parameters)return e;for(const[o,s]of i.parameters.entries())e.insertParameter(t.loadState(s,n),o);return e},Kr=function(e){const t=Object.create(null),i=a(Bl.SERIALIZER,!0);for(const n in i){let o;const s=null==(o=i[n])?void 0:o.save(e);s&&(t[n]=s)}return t},Yr=function(e,t,{recordUndo:i=!1}={}){var n=a(Bl.SERIALIZER,!0);if(n){n=Object.entries(n).sort(((e,t)=>t[1].priority-e[1].priority));var o=Y();$l.setRecordUndo$$module$build$src$core$events$utils(i),(i=$l.getGroup$$module$build$src$core$events$utils())||$l.setGroup$$module$build$src$core$events$utils(!0),be(),t instanceof Cg&&t.setResizesEnabled(!1);for(const[,e]of n.reverse()){let i;null==(i=e)||i.clear(t)}for(const[i,o]of n.reverse())if(e[i]){let n;null==(n=o)||n.load(e[i],t)}t instanceof Cg&&t.setResizesEnabled(!0),fe(),J(new(re(ia.FINISHED_LOADING))(t)),$l.setGroup$$module$build$src$core$events$utils(i),$l.setRecordUndo$$module$build$src$core$events$utils(o)}},Jr=function(e,t){let i=null;var n;if(i="string"==typeof e?document.getElementById(e)||document.querySelector(e):e,!document.contains(i)&&document!==(null==(n=i)?void 0:n.ownerDocument))throw Error("Error: container is not in current document");e=new Cd(t||{}),n=document.createElement("div"),ce(n,"injectionDiv"),null!=t&&t.rtl&&ce(n,"blocklyRTL"),i.appendChild(n),t=qr(n,e);const o=Qr(n,t,e);return Zr(o),Ae(o),Le(o),n.addEventListener("focusin",(function(){Ae(o)})),b(n,"keydown",null,Ue),o},qr=function(e,t){e.setAttribute("dir","LTR"),Ge(t.hasCss,t.pathToMedia);const i=ae(ac.SVG,{xmlns:Sa,"xmlns:html":Aa,"xmlns:xlink":Ra,version:"1.1",class:"blocklySvg"},e),n=ae(ac.DEFS,{},i),o=String(Math.random()).substring(2);return t.gridPattern=Ap.createDom(o,t.gridOptions,n,e),i},Qr=function(e,t,i){i.parentWorkspace=null;const n=(i=new Cg(i)).options;i.scale=n.zoomOptions.startScale,t.appendChild(i.createDom("blocklyMainBackground",e));var o=i.getRenderer().getClassName();return o&&ce(e,o),(o=i.getTheme().getClassName())&&ce(e,o),!n.hasCategories&&n.languageTree&&(e=i.addFlyout(ac.SVG),ge(e,t)),n.hasTrashcan&&i.addTrashcan(),n.zoomOptions&&n.zoomOptions.controls&&i.addZoomControls(),i.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),i.translate(0,0),i.addChangeListener(js(i)),Le(i),lo(),Ki(),An(),i},Zr=function(e){const t=e.options;var i=e.getParentSvg();if(b(i.parentNode,"contextmenu",null,(function(e){y(e)||e.preventDefault()})),i=b(window,"resize",null,(function(){Bn(),e.hideComponents(!0),bn(),yo(),Le(e),Ks(e)})),e.setResizeHandlerWrapper(i),el(),t.languageTree){i=e.getToolbox();const n=e.getFlyout(!0);i?i.init():n&&(n.init(e),n.show(t.languageTree),"function"==typeof n.scrollToStart&&n.scrollToStart())}t.hasTrashcan&&e.trashcan.init(),t.zoomOptions&&t.zoomOptions.controls&&e.zoomControls_.init(),t.moveOptions&&t.moveOptions.scrollbars?(e.scrollbar=new Cp(e,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.horizontal,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),t.hasSounds&&tl(t.pathToMedia,e)},el=function(){vm||(b(document,"scroll",null,(function(){const e=ke();for(let t,i=0;t=e[i];i++)t instanceof Cg&&t.updateInverseScreenCTM()})),f(document,"touchend",null,u),f(document,"touchcancel",null,u)),vm=!0},tl=function(e,t){function i(){for(;o.length;){const e=o.pop();e&&E(e)}n.preload()}const n=t.getAudioManager();n.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),n.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),n.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");const o=[];o.push(b(document,"pointermove",null,i,!0)),o.push(b(document,"touchstart",null,i,!0))},il=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.UNDO,preconditionFn:e=>0<e.workspace.getUndoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!1)},scopeType:Ku.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},nl=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.REDO,preconditionFn:e=>0<e.workspace.getRedoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!0)},scopeType:Ku.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},ol=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.CLEAN_UP,preconditionFn:e=>e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden",callback(e){e.workspace.cleanUp()},scopeType:Ku.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},sl=function(e,t){function i(t){o--,t.setCollapsed(e),0===o&&$l.setGroup$$module$build$src$core$events$utils(!1)}let n=0,o=0;$l.setGroup$$module$build$src$core$events$utils(!0);for(let e=0;e<t.length;e++){let s=t[e];for(;s;)o++,setTimeout(i.bind(null,s),n),s=s.getNextBlock(),n+=10}},rl=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.COLLAPSE_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let i=e[t];for(;i;){if(!i.isCollapsed())return"enabled";i=i.getNextBlock()}}return"disabled"}return"hidden"},callback(e){sl(!0,e.workspace.getTopBlocks(!0))},scopeType:Ku.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},ll=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.EXPAND_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let i=e[t];for(;i;){if(i.isCollapsed())return"enabled";i=i.getNextBlock()}}return"disabled"}return"hidden"},callback(e){sl(!1,e.workspace.getTopBlocks(!0))},scopeType:Ku.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},al=function(e,t){if(e.isDeletable())Array.prototype.push.apply(t,e.getDescendants(!1));else{e=e.getChildren(!1);for(let i=0;i<e.length;i++)al(e[i],t)}},cl=function(e){const t=[];e=e.getTopBlocks(!0);for(let i=0;i<e.length;i++)al(e[i],t);return t},hl=function(e,t){t?$l.setGroup$$module$build$src$core$events$utils(t):($l.setGroup$$module$build$src$core$events$utils(!0),t=$l.getGroup$$module$build$src$core$events$utils());const i=e.shift();i&&(i.isDeadOrDying()?hl(e,t):(i.dispose(!1,!0),setTimeout(hl,10,e,t))),$l.setGroup$$module$build$src$core$events$utils(!1)},ul=function(){Ku.registry.register({displayText:e=>e.workspace?1===(e=cl(e.workspace).length)?$l.Msg$$module$build$src$core$msg.DELETE_BLOCK:$l.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`):"",preconditionFn:e=>e.workspace&&0<cl(e.workspace).length?"enabled":"disabled",callback(e){if(e.workspace){e.workspace.cancelCurrentGesture();var t=cl(e.workspace);2>t.length?hl(t):Gt($l.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(t.length)),(function(e){e&&hl(t)}))}},scopeType:Ku.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},dl=function(){il(),nl(),ol(),rl(),ll(),ul()},pl=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden",callback(e){if(e.block){var t=e.block.toCopyData();t&&$r(t,e.block.workspace)}},scopeType:Ku.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},gl=function(){Ku.registry.register({displayText:e=>e.block.hasIcon(Mp.TYPE)?$l.Msg$$module$build$src$core$msg.REMOVE_COMMENT:$l.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>!(e=e.block).isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden",callback(e){(e=e.block).hasIcon(Mp.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:Ku.ScopeType.BLOCK,id:"blockComment",weight:2})},ml=function(){Ku.registry.register({displayText:e=>e.block.getInputsInline()?$l.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:$l.Msg$$module$build$src$core$msg.INLINE_INPUTS,preconditionFn(e){if(!(e=e.block).isInFlyout&&e.isMovable()&&!e.isCollapsed())for(let t=1;t<e.inputList.length;t++)if(!(e.inputList[t-1]instanceof dm||e.inputList[t]instanceof dm))return"enabled";return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:Ku.ScopeType.BLOCK,id:"blockInline",weight:3})},bl=function(){Ku.registry.register({displayText:e=>e.block.isCollapsed()?$l.Msg$$module$build$src$core$msg.EXPAND_BLOCK:$l.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden",callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:Ku.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},fl=function(){Ku.registry.register({displayText:e=>e.block.hasDisabledReason(eh)?$l.Msg$$module$build$src$core$msg.ENABLE_BLOCK:$l.Msg$$module$build$src$core$msg.DISABLE_BLOCK,preconditionFn(e){if(!(e=e.block).isInFlyout&&e.workspace.options.disable&&e.isEditable()){var t=e.getDisabledReasons();return t=t.size>(t.has(eh)?1:0),e.getInheritedDisabled()||t?"disabled":"enabled"}return"hidden"},callback(e){e=e.block;const t=$l.getGroup$$module$build$src$core$events$utils();t||$l.setGroup$$module$build$src$core$events$utils(!0),e.setDisabledReason(!e.hasDisabledReason(eh),eh),$l.setGroup$$module$build$src$core$events$utils(t)},scopeType:Ku.ScopeType.BLOCK,id:"blockDisable",weight:5})},El=function(){Ku.registry.register({displayText(e){var t=e.block;return e=t.getDescendants(!1).length,(t=t.getNextBlock())&&(e-=t.getDescendants(!1).length),1===e?$l.Msg$$module$build$src$core$msg.DELETE_BLOCK:$l.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)},preconditionFn:e=>!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden",callback(e){e.block&&e.block.checkAndDelete()},scopeType:Ku.ScopeType.BLOCK,id:"blockDelete",weight:6})},yl=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.HELP,preconditionFn:e=>("function"==typeof(e=e.block).helpUrl?e.helpUrl():e.helpUrl)?"enabled":"hidden",callback(e){e.block.showHelp()},scopeType:Ku.ScopeType.BLOCK,id:"blockHelp",weight:7})},vl=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.REMOVE_COMMENT,preconditionFn(e){let t;return null!=(t=e.comment)&&t.isDeletable()?"enabled":"hidden"},callback(e){let t;$l.setGroup$$module$build$src$core$events$utils(!0),null==(t=e.comment)||t.dispose(),$l.setGroup$$module$build$src$core$events$utils(!1)},scopeType:Ku.ScopeType.COMMENT,id:"commentDelete",weight:6})},Cl=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,preconditionFn(e){let t;return null!=(t=e.comment)&&t.isMovable()?"enabled":"hidden"},callback(e){if(e.comment){var t=e.comment.toCopyData();t&&$r(t,e.comment.workspace)}},scopeType:Ku.ScopeType.COMMENT,id:"commentDuplicate",weight:1})},_l=function(){Ku.registry.register({displayText:()=>$l.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>{let t;return null!=(t=e.workspace)&&t.isMutator?"hidden":"enabled"},callback:(e,t,i,n)=>{(e=e.workspace)&&($l.setGroup$$module$build$src$core$events$utils(!0),(t=new sd(e)).setPlaceholderText($l.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT),t.moveTo(Tl(new lc(n.x,n.y),e)),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(t),$l.setGroup$$module$build$src$core$events$utils(!1))},scopeType:Ku.ScopeType.WORKSPACE,id:"commentCreate",weight:8})},Tl=function(e,t){var i=t.getInjectionDiv().getBoundingClientRect();return e=new lc(e.x-i.left,e.y-i.top),i=t.getOriginOffsetInPixels(),(e=lc.difference(e,i)).scale(1/t.scale),e},wl=function(){pl(),gl(),ml(),bl(),fl(),El(),yl()},Il=function(){Cl(),vl(),_l()},kl=function(){dl(),wl()},xl=function(e){return void 0!==e.paste},Nl=function(e){return void 0!==e.getSvgRoot},Sl=function(e){return e.isSelectable()},Al=function(e){Se().hideChaff(e)},(Rl=Rl||{}).scope={},Rl.ASSUME_ES5=!1,Rl.ASSUME_NO_NATIVE_MAP=!1,Rl.ASSUME_NO_NATIVE_SET=!1,Rl.SIMPLE_FROUND_POLYFILL=!1,Rl.ISOLATE_POLYFILLS=!1,Rl.FORCE_POLYFILL_PROMISE=!1,Rl.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,Rl.defineProperty=Rl.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype||(e[t]=i.value),e},Rl.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof i.g&&i.g];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")},Rl.global=Rl.getGlobal(this),Rl.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),Rl.TRUST_ES6_POLYFILLS=!Rl.ISOLATE_POLYFILLS||Rl.IS_SYMBOL_NATIVE,Rl.polyfills={},Rl.propertyToPolyfillSymbol={},Rl.POLYFILL_PREFIX="$jscp$",Rl.polyfill=function(e,t,i,n){t&&(Rl.ISOLATE_POLYFILLS?Rl.polyfillIsolated(e,t,i,n):Rl.polyfillUnisolated(e,t,i,n))},Rl.polyfillUnisolated=function(e,t,i,n){for(i=Rl.global,e=e.split("."),n=0;n<e.length-1;n++){var o=e[n];if(!(o in i))return;i=i[o]}(t=t(n=i[e=e[e.length-1]]))!=n&&null!=t&&Rl.defineProperty(i,e,{configurable:!0,writable:!0,value:t})},Rl.polyfillIsolated=function(e,t,i,n){var o=e.split(".");e=1===o.length,n=o[0],n=!e&&n in Rl.polyfills?Rl.polyfills:Rl.global;for(var s=0;s<o.length-1;s++){var r=o[s];if(!(r in n))return;n=n[r]}o=o[o.length-1],null!=(t=t(i=Rl.IS_SYMBOL_NATIVE&&"es6"===i?n[o]:null))&&(e?Rl.defineProperty(Rl.polyfills,o,{configurable:!0,writable:!0,value:t}):t!==i&&(void 0===Rl.propertyToPolyfillSymbol[o]&&(i=1e9*Math.random()>>>0,Rl.propertyToPolyfillSymbol[o]=Rl.IS_SYMBOL_NATIVE?Rl.global.Symbol(o):Rl.POLYFILL_PREFIX+i+"$"+o),Rl.defineProperty(n,Rl.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:t})))},Rl.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},Rl.setPrototypeOf=Rl.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:Rl.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,Rl.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},Rl.arrayIterator=function(e){return{next:Rl.arrayIteratorImpl(e)}},Rl.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if(t)return t.call(e);if("number"==typeof e.length)return Rl.arrayIterator(e);throw Error(String(e)+" is not an iterable or ArrayLike")},Rl.generator={},Rl.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},Rl.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},Rl.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},Rl.generator.Context.prototype.stop_=function(){this.isRunning_=!1},Rl.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},Rl.generator.Context.prototype.next_=function(e){this.yieldResult=e},Rl.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},Rl.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},Rl.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},Rl.generator.Context.prototype.yield=function(e,t){return this.nextAddress=t,{value:e}},Rl.generator.Context.prototype.yieldAll=function(e,t){var i=(e=Rl.makeIterator(e)).next();if(Rl.generator.ensureIteratorResultIsObject_(i),!i.done)return this.yieldAllIterator_=e,this.yield(i.value,t);this.yieldResult=i.value,this.nextAddress=t},Rl.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},Rl.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},Rl.generator.Context.prototype.setCatchFinallyBlocks=function(e,t){this.catchAddress_=e,null!=t&&(this.finallyAddress_=t)},Rl.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},Rl.generator.Context.prototype.leaveTryBlock=function(e,t){this.nextAddress=e,this.catchAddress_=t||0},Rl.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},Rl.generator.Context.prototype.enterFinallyBlock=function(e,t,i){i?this.finallyContexts_[i]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=t||0},Rl.generator.Context.prototype.leaveFinallyBlock=function(e,t){if(t=this.finallyContexts_.splice(t||0)[0],t=this.abruptCompletion_=this.abruptCompletion_||t){if(t.isException)return this.jumpToErrorHandler_();null!=t.jumpTo&&this.finallyAddress_<t.jumpTo?(this.nextAddress=t.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},Rl.generator.Context.prototype.forIn=function(e){return new Rl.generator.Context.PropertyIterator(e)},Rl.generator.Context.PropertyIterator=function(e){for(var t in this.object_=e,this.properties_=[],e)this.properties_.push(t);this.properties_.reverse()},Rl.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},Rl.generator.Engine_=function(e){this.context_=new Rl.generator.Context,this.program_=e},Rl.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},Rl.generator.Engine_.prototype.return_=function(e){this.context_.start_();var t=this.context_.yieldAllIterator_;return t?this.yieldAllStep_("return"in t?t.return:function(e){return{value:e,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},Rl.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},Rl.generator.Engine_.prototype.yieldAllStep_=function(e,t,i){try{var n=e.call(this.context_.yieldAllIterator_,t);if(Rl.generator.ensureIteratorResultIsObject_(n),!n.done)return this.context_.stop_(),n;var o=n.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}return this.context_.yieldAllIterator_=null,i.call(this.context_,o),this.nextStep_()},Rl.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},Rl.generator.Generator_=function(e){this.next=function(t){return e.next_(t)},this.throw=function(t){return e.throw_(t)},this.return=function(t){return e.return_(t)},this[Symbol.iterator]=function(){return this}},Rl.generator.createGenerator=function(e,t){return t=new Rl.generator.Generator_(new Rl.generator.Engine_(t)),Rl.setPrototypeOf&&e.prototype&&Rl.setPrototypeOf(t,e.prototype),t},Rl.asyncExecutePromiseGenerator=function(e){function t(t){return e.next(t)}function i(t){return e.throw(t)}return new Promise((function(n,o){!function e(s){s.done?n(s.value):Promise.resolve(s.value).then(t,i).then(e,o)}(e.next())}))},Rl.asyncExecutePromiseGeneratorFunction=function(e){return Rl.asyncExecutePromiseGenerator(e())},Rl.asyncExecutePromiseGeneratorProgram=function(e){return Rl.asyncExecutePromiseGenerator(new Rl.generator.Generator_(new Rl.generator.Engine_(e)))},Rl.polyfill("globalThis",(function(e){return e||Rl.global}),"es_2020","es3"),Rl.polyfill("Array.prototype.includes",(function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var n=i.length;for(0>(t=t||0)&&(t=Math.max(t+n,0));t<n;t++){var o=i[t];if(o===e||Object.is(o,e))return!0}return!1}}),"es7","es3"),Rl.initSymbol=function(){},Rl.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},Rl.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var i=0,n=!1,o={next:function(){if(!n&&i<e.length){var o=i++;return{value:t(o,e[o]),done:!1}}return n=!0,{done:!0,value:void 0}}};return o[Symbol.iterator]=function(){return o},o},Rl.polyfill("Array.prototype.values",(function(e){return e||function(){return Rl.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3"),Rl.polyfill("Array.prototype.flatMap",(function(e){return e||function(e,t){var i=[];return Array.prototype.forEach.call(this,(function(n,o){n=e.call(t,n,o,this),Array.isArray(n)?i.push.apply(i,n):i.push(n)})),i}}),"es9","es5"),Rl.polyfill("Array.prototype.flat",(function(e){return e||function(e){e=void 0===e?1:e;var t=[];return Array.prototype.forEach.call(this,(function(i){Array.isArray(i)&&0<e?(i=Array.prototype.flat.call(i,e-1),t.push.apply(t,i)):t.push(i)})),t}}),"es9","es5"),Rl.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Rl.polyfill("Object.entries",(function(e){return e||function(e){var t,i=[];for(t in e)Rl.owns(e,t)&&i.push([t,e[t]]);return i}}),"es8","es3"),Rl.polyfill("Object.values",(function(e){return e||function(e){var t,i=[];for(t in e)Rl.owns(e,t)&&i.push(e[t]);return i}}),"es8","es3");var Ol=Object.create(null),Dl={typeMap:Ol},Ml=Object.create(null),Ll="default",Bl=class{constructor(e){this.name=e}toString(){return this.name}};Bl.CONNECTION_CHECKER=new Bl("connectionChecker"),Bl.CONNECTION_PREVIEWER=new Bl("connectionPreviewer"),Bl.CURSOR=new Bl("cursor"),Bl.EVENT=new Bl("event"),Bl.FIELD=new Bl("field"),Bl.INPUT=new Bl("input"),Bl.RENDERER=new Bl("renderer"),Bl.TOOLBOX=new Bl("toolbox"),Bl.THEME=new Bl("theme"),Bl.TOOLBOX_ITEM=new Bl("toolboxItem"),Bl.FLYOUTS_VERTICAL_TOOLBOX=new Bl("flyoutsVerticalToolbox"),Bl.FLYOUTS_HORIZONTAL_TOOLBOX=new Bl("flyoutsHorizontalToolbox"),Bl.FLYOUT_INFLATER=new Bl("flyoutInflater"),Bl.METRICS_MANAGER=new Bl("metricsManager"),Bl.BLOCK_DRAGGER=new Bl("blockDragger"),Bl.SERIALIZER=new Bl("serializer"),Bl.ICON=new Bl("icon"),Bl.PASTER=new Bl("paster"),Bl.VARIABLE_MODEL=new Bl("variableModel"),Bl.VARIABLE_MAP=new Bl("variableMap");var Pl={DEFAULT:Ll,TEST_ONLY:Dl};Pl.Type=Bl,Pl.getAllItems=a,Pl.getClass=r,Pl.getClassFromOptions=c,Pl.getObject=l,Pl.hasItem=s,Pl.register=e,Pl.unregister=n;var Fl,Vl,Ul,Wl,Hl,Gl,zl,jl,Xl,Kl,Yl=Object.create(null),Jl=750,ql="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),Ql=null,Zl={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},ea=0,ta={TOUCH_ENABLED:ql,TOUCH_MAP:Zl};ta.checkTouchIdentifier=m,ta.clearTouchIdentifier=d,ta.getTouchIdentifierFromEvent=g,ta.longStart=h,ta.longStop=u,ta.shouldHandleEvent=p,function(e){function t(e){return i.includes(e.toUpperCase())}const i=(Fl=e).toUpperCase();Vl=t("JavaFX"),Ul=t("WebKit"),Wl=t("Gecko")&&!Ul,Hl=t("Android"),e=globalThis.navigator&&globalThis.navigator.maxTouchPoints,Gl=t("iPad")||t("Macintosh")&&0<e,zl=t("iPhone")&&!Gl,jl=t("Macintosh"),Xl=Gl||Hl&&!t("Mobile")||t("Silk"),Kl=!Xl&&(zl||Hl)}(globalThis.navigator&&globalThis.navigator.userAgent||"");var ia,na,oa=Vl,sa=Wl,ra=Hl,la=Gl,aa=zl,ca=jl,ha=Kl,ua={ANDROID:ra,GECKO:sa,IPAD:la,IPHONE:aa,JavaFx:oa,MAC:ca,MOBILE:ha,raw:Fl},da=40,pa=125,ga={};ga.bind=f,ga.conditionalBind=b,ga.getScrollDeltaPixels=_,ga.isRightButton=v,ga.isTargetInput=y,ga.mouseToSvg=C,ga.unbind=E,(na=ia||(ia={})).BLOCK_CREATE="create",na.BLOCK_DELETE="delete",na.BLOCK_CHANGE="change",na.BLOCK_FIELD_INTERMEDIATE_CHANGE="block_field_intermediate_change",na.BLOCK_MOVE="move",na.VAR_CREATE="var_create",na.VAR_DELETE="var_delete",na.VAR_RENAME="var_rename",na.VAR_TYPE_CHANGE="var_type_change",na.UI="ui",na.BLOCK_DRAG="drag",na.SELECTED="selected",na.CLICK="click",na.MARKER_MOVE="marker_move",na.BUBBLE_OPEN="bubble_open",na.TRASHCAN_OPEN="trashcan_open",na.TOOLBOX_ITEM_SELECT="toolbox_item_select",na.THEME_CHANGE="theme_change",na.VIEWPORT_CHANGE="viewport_change",na.COMMENT_CREATE="comment_create",na.COMMENT_DELETE="comment_delete",na.COMMENT_CHANGE="comment_change",na.COMMENT_MOVE="comment_move",na.COMMENT_RESIZE="comment_resize",na.COMMENT_DRAG="comment_drag",na.COMMENT_COLLAPSE="comment_collapse",na.FINISHED_LOADING="finished_loading";var ma=[ia.BLOCK_CREATE,ia.BLOCK_MOVE,ia.COMMENT_CREATE,ia.COMMENT_MOVE];({BUMP_EVENTS:ma}).EventType=ia;var ba="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",fa={genUid:()=>{const e=[];for(let t=0;20>t;t++)e[t]=ba.charAt(88*Math.random());return e.join("")}},Ea=0,ya={TEST_ONLY:fa};ya.genUid=w,ya.getNextUniqueId=T;var va={};va.isBlockChange=x,va.isBlockCreate=I,va.isBlockDelete=k,va.isBlockDrag=O,va.isBlockFieldIntermediateChange=N,va.isBlockMove=S,va.isBubbleOpen=L,va.isClick=M,va.isCommentChange=H,va.isCommentCollapse=X,va.isCommentCreate=U,va.isCommentDelete=W,va.isCommentDrag=j,va.isCommentMove=G,va.isCommentResize=z,va.isFinishedLoading=K,va.isSelected=D,va.isThemeChange=F,va.isToolboxItemSelect=P,va.isTrashcanOpen=B,va.isVarCreate=A,va.isVarDelete=R,va.isVarRename=$,va.isViewportChange=V;var Ca="",_a=!0,Ta=0,wa="ORPHANED_BLOCK",Ia=[],ka={FIRE_QUEUE:Ia,enqueueEvent:Z,fireNow:Q,fireInternal:q,setGroupInternal:ne},xa={TEST_ONLY:ka};xa.clearPendingUndo=te,xa.disable=$l.disable$$module$build$src$core$events$utils,xa.disableOrphans=le,xa.enable=$l.enable$$module$build$src$core$events$utils,xa.filter=ee,xa.fire=J,xa.fromJson=se,xa.get=re,xa.getDescendantIds=oe,xa.getGroup=$l.getGroup$$module$build$src$core$events$utils,xa.getRecordUndo=Y,xa.isEnabled=ie,xa.setGroup=$l.setGroup$$module$build$src$core$events$utils,xa.setRecordUndo=$l.setRecordUndo$$module$build$src$core$events$utils;var Na,Sa="http://www.w3.org/2000/svg",Aa="http://www.w3.org/1999/xhtml",Ra="http://www.w3.org/1999/xlink";!function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE"}(Na||(Na={}));var $a=null,Oa=0,Da=null,Ma={HTML_NS:Aa};Ma.NodeType=Na,Ma.SVG_NS=Sa,Ma.XLINK_NS=Ra,Ma.addClass=ce,Ma.createSvgElement=ae,Ma.getFastTextWidth=ye,Ma.getFastTextWidthWithSizeString=ve,Ma.getTextWidth=Ee,Ma.hasClass=de,Ma.insertAfter=ge,Ma.measureFontMetrics=Ce,Ma.removeClass=ue,Ma.removeClasses=he,Ma.removeNode=pe,Ma.setCssTransform=me,Ma.startTextWidthCache=be,Ma.stopTextWidthCache=fe;var La=class{static findFocusedNode(e){var t=e.getRootFocusableNode();if(!t.canBeFocused())return null;var i=t.getFocusableElement();return de(i,La.ACTIVE_CLASS_NAME)||de(i,La.PASSIVE_CSS_CLASS_NAME)||((t=i.querySelector(this.ACTIVE_FOCUS_NODE_CSS_SELECTOR))instanceof HTMLElement||t instanceof SVGElement)&&(t=La.findFocusableNodeFor(t,e))?t:((i=i.querySelector(this.PASSIVE_FOCUS_NODE_CSS_SELECTOR))instanceof HTMLElement||i instanceof SVGElement)&&(e=La.findFocusableNodeFor(i,e))?e:null}static findFocusableNodeFor(e,t){if(-1!==t.getNestedTrees().map((t=>La.findFocusableNodeFor(e,t))).findIndex((e=>!!e)))return null;var i,n=t.getRootFocusableNode();return n.canBeFocused()&&e===n.getFocusableElement()||(n=null!=(i=t.lookUpFocusableNode(e.id))?i:null)?n:(i=e.parentElement,!n&&i?La.findFocusableNodeFor(i,t):null)}};La.ACTIVE_CLASS_NAME="blocklyActiveFocus",La.PASSIVE_CSS_CLASS_NAME="blocklyPassiveFocus",La.ACTIVE_FOCUS_NODE_CSS_SELECTOR=`.${La.ACTIVE_CLASS_NAME}`,La.PASSIVE_FOCUS_NODE_CSS_SELECTOR=`.${La.PASSIVE_CSS_CLASS_NAME}`;var Ba=class{constructor(e,t){this.tree=e,this.rootShouldBeAutoTabbable=t}},Pa=class{constructor(e){this.previouslyFocusedNode=this.focusedNode=null,this.registeredTrees=[],this.isUpdatingFocusedNode=this.recentlyLostAllFocus=this.lockFocusStateChanges=this.currentlyHoldsEphemeralFocus=!1;const t=e=>{if(!this.isUpdatingFocusedNode){this.recentlyLostAllFocus=!e;var t=null;if(e instanceof HTMLElement||e instanceof SVGElement)for(var i of this.registeredTrees)if(t=La.findFocusableNodeFor(e,i.tree))break;if(t&&t.canBeFocused()){let n;e=t.getFocusableTree(),i=null==(n=this.focusedNode)?void 0:n.getFocusableTree(),t===e.getRootFocusableNode()&&e!==i?this.focusTree(e):this.focusNode(t)}else this.defocusCurrentFocusedNode()}};e("focusin",(e=>{e instanceof FocusEvent&&t(document.activeElement)})),e("focusout",(e=>{e instanceof FocusEvent&&t(e.relatedTarget)}))}registerTree(e,t=!1){if(this.ensureManagerIsUnlocked(),this.isRegistered(e))throw Error(`Attempted to re-register already registered tree: ${e}.`);this.registeredTrees.push(new Ba(e,t)),t&&(e.getRootFocusableNode().getFocusableElement().tabIndex=0)}isRegistered(e){return!!this.lookUpRegistration(e)}lookUpRegistration(e){let t;return null!=(t=this.registeredTrees.find((t=>t.tree===e)))?t:null}unregisterTree(e){if(this.ensureManagerIsUnlocked(),!this.isRegistered(e))throw Error(`Attempted to unregister not registered tree: ${e}.`);var t=this.registeredTrees.findIndex((t=>t.tree===e));const i=this.registeredTrees[t];this.registeredTrees.splice(t,1),t=La.findFocusedNode(e);const n=e.getRootFocusableNode();t&&this.removeHighlight(t),this.focusedNode!==t&&this.focusedNode!==n||this.updateFocusedNode(null),this.removeHighlight(n),i.rootShouldBeAutoTabbable&&e.getRootFocusableNode().getFocusableElement().removeAttribute("tabindex")}getFocusedTree(){let e,t;return null!=(t=null==(e=this.focusedNode)?void 0:e.getFocusableTree())?t:null}getFocusedNode(){return this.focusedNode}focusTree(e){if(this.ensureManagerIsUnlocked(),!this.isRegistered(e))throw Error(`Attempted to focus unregistered tree: ${e}.`);const t=La.findFocusedNode(e),i=e.getRestoredFocusableNode(t);let n;e=e.getRootFocusableNode(),this.focusNode(null!=(n=null!=i?i:t)?n:e)}focusNode(e){this.ensureManagerIsUnlocked();const t=!this.currentlyHoldsEphemeralFocus;t&&(this.isUpdatingFocusedNode=!0);var i,n=(null==(i=this.focusedNode)?void 0:i.getFocusableElement())!==document.activeElement;if(this.focusedNode!==e||n)if(e.canBeFocused()){if(n=e.getFocusableTree(),!this.isRegistered(n))throw Error(`Attempted to focus unregistered node: ${e}.`);var o=La.findFocusableNodeFor(e.getFocusableElement(),n);i=La.findFocusedNode(n);var s,r=e;o!==e&&(r=n.getRestoredFocusableNode(i),e=n.getRootFocusableNode(),r=null!=(s=null!=r?r:i)?s:e),s=null==(e=this.focusedNode)?void 0:e.getFocusableTree(),e&&this.passivelyFocusNode(e,n),n=n.getRootFocusableNode(),i&&this.removeHighlight(i),n!==r&&this.removeHighlight(n),this.currentlyHoldsEphemeralFocus||this.activelyFocusNode(r,null!=s?s:null),this.updateFocusedNode(r)}else console.warn("Trying to focus a node that can't be focused.");t&&(this.isUpdatingFocusedNode=!1)}takeEphemeralFocus(e){if(this.ensureManagerIsUnlocked(),this.currentlyHoldsEphemeralFocus)throw Error(`Attempted to take ephemeral focus when it's already held, with new element: ${e}.`);this.currentlyHoldsEphemeralFocus=!0,this.focusedNode&&this.passivelyFocusNode(this.focusedNode,null),e.focus();let t=!1;return()=>{if(t)throw Error(`Attempted to finish ephemeral focus twice for element: ${e}.`);if(t=!0,this.currentlyHoldsEphemeralFocus=!1,this.focusedNode){this.activelyFocusNode(this.focusedNode,null);const e=this.focusedNode;setTimeout((()=>{!this.focusedNode&&this.previouslyFocusedNode===e&&this.recentlyLostAllFocus&&this.focusNode(e)}),0)}}}ephemeralFocusTaken(){return this.currentlyHoldsEphemeralFocus}ensureManagerIsUnlocked(){if(this.lockFocusStateChanges)throw Error("FocusManager state changes cannot happen in a tree/node focus/blur callback.")}updateFocusedNode(e){this.previouslyFocusedNode=this.focusedNode,this.focusedNode=e}defocusCurrentFocusedNode(){this.focusedNode&&!this.currentlyHoldsEphemeralFocus&&(this.passivelyFocusNode(this.focusedNode,null),this.updateFocusedNode(null))}activelyFocusNode(e,t){this.lockFocusStateChanges=!0;const i=e.getFocusableTree(),n=e.getFocusableElement();let o;const s=null==(o=this.lookUpRegistration(i))?void 0:o.rootShouldBeAutoTabbable;i!==t&&(i.onTreeFocus(e,t),s&&(i.getRootFocusableNode().getFocusableElement().tabIndex=-1)),e.onNodeFocus(),this.lockFocusStateChanges=!1,s&&e===i.getRootFocusableNode()||n.hasAttribute("tabindex")||(n.tabIndex=-1),this.setNodeToVisualActiveFocus(e),n.focus()}passivelyFocusNode(e,t){this.lockFocusStateChanges=!0;const i=e.getFocusableTree();if(i!==t){let e;i.onTreeBlur(t),null!=(e=this.lookUpRegistration(i))&&e.rootShouldBeAutoTabbable&&(i.getRootFocusableNode().getFocusableElement().tabIndex=0)}e.onNodeBlur(),this.lockFocusStateChanges=!1,i!==t&&this.setNodeToVisualPassiveFocus(e)}setNodeToVisualActiveFocus(e){e=e.getFocusableElement(),ce(e,Pa.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),ue(e,Pa.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME)}setNodeToVisualPassiveFocus(e){e=e.getFocusableElement(),ue(e,Pa.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),ce(e,Pa.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME)}removeHighlight(e){e=e.getFocusableElement(),ue(e,Pa.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),ue(e,Pa.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME)}static getFocusManager(){return Pa.focusManager||(Pa.focusManager=new Pa(document.addEventListener)),Pa.focusManager}};Pa.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME="blocklyActiveFocus",Pa.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME="blocklyPassiveFocus",Pa.focusManager=null;var Fa={};Fa.FocusManager=Pa,Fa.getFocusManager=$l.getFocusManager$$module$build$src$core$focus_manager;var Va={};Va.deepMerge=we;var Ua=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,t){if(this.shortcuts.get(e.name)&&!t)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),null!=(t=e.keyCodes)&&t.length)for(const i of t)this.addKeyMapping(i,e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,t,i){e=`${e}`;const n=this.keyMap.get(e);if(n&&!i)throw Error(`Shortcut named "${t}" collides with shortcuts "${n}"`);n&&i?n.unshift(t):this.keyMap.set(e,[t])}removeKeyMapping(e,t,i){const n=this.keyMap.get(e);if(!n)return i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1;const o=n.indexOf(t);return-1<o?(n.splice(o,1),0===n.length&&this.keyMap.delete(e),!0):(i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1)}removeAllKeyMappings(e){for(const t of this.keyMap.keys())this.removeKeyMapping(t,e,!0)}setKeyMap(e){this.keyMap.clear();for(const t in e)this.keyMap.set(t,e[t])}getKeyMap(){const e=Object.create(null);for(const[t,i]of this.keyMap)e[t]=i;return e}getRegistry(){const e=Object.create(null);for(const[t,i]of this.shortcuts)e[t]=i;return we(Object.create(null),e)}onKeyDown(e,t){var i=this.serializeKeyEvent(t);if(!(i=this.getShortcutNamesByKeyCode(i)))return!1;for(const n of i){let o,s,r,l;if((i=this.shortcuts.get(n))&&(!i.preconditionFn||i.preconditionFn(e,{focusedNode:null!=(o=$l.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode())?o:void 0}))&&null!=(r=(s=i).callback)&&r.call(s,e,t,i,{focusedNode:null!=(l=$l.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode())?l:void 0}))return!0}return!1}getShortcutNamesByKeyCode(e){let t;return(null==(t=this.keyMap.get(e))?void 0:t.slice())||[]}getKeyCodesByShortcutName(e){const t=[];for(const[i,n]of this.keyMap)-1<n.indexOf(e)&&t.push(i);return t}serializeKeyEvent(e){let t="";for(const i in Ua.modifierKeys)e.getModifierState(i)&&(""!==t&&(t+="+"),t+=i);return""!==t&&e.keyCode?t+="+"+e.keyCode:e.keyCode&&(t=String(e.keyCode)),t}checkModifiers(e){for(const t of e)if(!(t in Ua.modifierKeys))throw Error(t+" is not a valid modifier key.")}createSerializedKey(e,t){let i="";if(t){this.checkModifiers(t);for(const e in Ua.modifierKeys)t.includes(Ua.modifierKeys[e])&&(""!==i&&(i+="+"),i+=e)}return""!==i&&e?i+="+"+e:e&&(i=`${e}`),i}};Ua.registry=new Ua,function(e){(e=e.modifierKeys||(e.modifierKeys={}))[e.Shift=16]="Shift",e[e.Control=17]="Control",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta"}(Ua||(Ua={}));var Wa,Ha,Ga=Object.create(null),za=[],ja={defineBlocksWithJsonArrayInternal:Ve},Xa={TEST_ONLY:ja};Xa.createBlockDefinitionsFromJsonArray=$l.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,Xa.defineBlocks=$l.defineBlocks$$module$build$src$core$common,Xa.defineBlocksWithJsonArray=Fe,Xa.draggingConnections=za,Xa.fireSelectedEvent=Oe,Xa.getAllWorkspaces=ke,Xa.getBlockTypeCounts=Be,Xa.getMainWorkspace=Se,Xa.getParentContainer=De,Xa.getSelected=Re,Xa.getWorkspaceById=Ie,Xa.globalShortcutHandler=Ue,Xa.registerWorkspace=xe,Xa.setMainWorkspace=Ae,Xa.setParentContainer=Me,Xa.setSelected=$e,Xa.svgResize=Le,Xa.unregisterWorkpace=Ne;var Ka,Ya=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=$l.getGroup$$module$build$src$core$events$utils(),this.recordUndo=Y()}toJson(){return{type:this.type,group:this.group}}static fromJson(e,t,i){return i.isBlank=!1,i.group=e.group||"",i.workspaceId=t.id,i}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(this.workspaceId&&(e=Ie(this.workspaceId)),!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e}},Ja=class extends Ya{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=void 0===e,this.workspaceId=e||""}},qa=class extends Ja{constructor(e,t,i){null===(t=e?e.workspace.id:t)&&(t=void 0),super(t),this.type=ia.CLICK,this.blockId=e?e.id:void 0,this.targetType=i}toJson(){const e=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return e.targetType=this.targetType,e.blockId=this.blockId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new qa)).targetType=e.targetType,t.blockId=e.blockId,t}};(function(e){e.BLOCK="block",e.WORKSPACE="workspace",e.ZOOM_CONTROLS="zoom_controls"})(Ka||(Ka={})),e(Bl.EVENT,ia.CLICK,qa);var Qa={};Qa.Click=qa,Qa.ClickTarget=Ka;var Za={};Za.removeElem=We;var ec=class{constructor(e){this.name=e}toString(){return this.name}};ec.POSITIONABLE=new ec("positionable"),ec.DRAG_TARGET=new ec("drag_target"),ec.DELETE_AREA=new ec("delete_area"),ec.AUTOHIDEABLE=new ec("autohideable");var tc=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,t){const i=e.component.id;var n;if(!t&&this.componentData.has(i))throw Error('Plugin "'+i+'" with capabilities "'+(null==(n=this.componentData.get(i))?void 0:n.capabilities)+'" already added.');for(this.componentData.set(i,e),t=[],n=0;n<e.capabilities.length;n++){const o=String(e.capabilities[n]).toLowerCase();if(t.push(o),this.capabilityToComponentIds.has(o)){let e;null==(e=this.capabilityToComponentIds.get(o))||e.push(i)}else this.capabilityToComponentIds.set(o,[i])}this.componentData.get(i).capabilities=t}removeComponent(e){const t=this.componentData.get(e);if(t){for(let i=0;i<t.capabilities.length;i++){const n=String(t.capabilities[i]).toLowerCase();We(this.capabilityToComponentIds.get(n),e)}this.componentData.delete(e)}}addCapability(e,t){if(!this.getComponent(e))throw Error('Cannot add capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');var i,n;this.hasCapability(e,t)?console.warn('Plugin "'+e+'already has capability "'+t+'"'):(t=`${t}`.toLowerCase(),null==(i=this.componentData.get(e))||i.capabilities.push(t),null==(n=this.capabilityToComponentIds.get(t))||n.push(e))}removeCapability(e,t){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,t)?(t=`${t}`.toLowerCase(),We(this.componentData.get(e).capabilities,t),We(this.capabilityToComponentIds.get(t),e)):console.warn('Plugin "'+e+"doesn't have capability \""+t+'" to remove')}hasCapability(e,t){return t=`${t}`.toLowerCase(),this.componentData.has(e)&&this.componentData.get(e).capabilities.includes(t)}getComponent(e){let t;return null==(t=this.componentData.get(e))?void 0:t.component}getComponents(e,t){if(e=`${e}`.toLowerCase(),!(e=this.capabilityToComponentIds.get(e)))return[];const i=[];if(t){const t=[];e.forEach((e=>{t.push(this.componentData.get(e))})),t.sort((function(e,t){return e.weight-t.weight})),t.forEach((function(e){i.push(e.component)}))}else e.forEach((e=>{i.push(this.componentData.get(e).component)}));return i}};tc.Capability=ec,function(e){(e=e.ComponentWeight||(e.ComponentWeight={}))[e.TOOLBOX_WEIGHT=0]="TOOLBOX_WEIGHT",e[e.FLYOUT_WEIGHT=1]="FLYOUT_WEIGHT",e[e.TRASHCAN_WEIGHT=2]="TRASHCAN_WEIGHT",e[e.ZOOM_CONTROLS_WEIGHT=3]="ZOOM_CONTROLS_WEIGHT"}(tc||(tc={}));var ic=tc.ComponentWeight,nc={};nc.ComponentManager=tc,nc.ComponentWeight=ic;var oc=!1,sc='\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyEmboss {\n  filter: var(--blocklyEmbossFilter);\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv:focus {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyHighlighted>.blocklyPath {\n  filter: var(--blocklyEmbossFilter);\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n  /* Drag surface disables events to not block the toolbox, so we have to\n   * reenable them here for the cursor values to work. */\n  pointer-events: auto;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabledPattern>.blocklyPath {\n  fill: var(--blocklyDisabledPattern);\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyNonEditableField>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don\'t allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n  pointer-events: none;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu:focus {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;\n  outline: none;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyMenuSeparator {\n  background-color: #ccc;\n  height: 1px;\n  border: 0;\n  margin-left: 4px;\n  margin-right: 4px;\n}\n\n.blocklyBlockDragSurface, .blocklyAnimationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n\n.blocklyField {\n  cursor: default;\n}\n\n.blocklyInputField {\n  cursor: text;\n}\n\n.blocklyDragging .blocklyField,\n.blocklyDragging .blocklyIconGroup {\n  cursor: grabbing;\n}\n\n.blocklyActiveFocus:is(\n  .blocklyFlyout,\n  .blocklyWorkspace,\n  .blocklyField,\n  .blocklyPath,\n  .blocklyHighlightedConnectionPath,\n  .blocklyComment,\n  .blocklyBubble,\n  .blocklyIconGroup,\n  .blocklyTextarea\n) {\n  outline: none;\n}\n',rc={};rc.inject=Ge,rc.register=He;var lc=class{constructor(e,t){this.x=e,this.y=t}clone(){return new lc(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,t){return this.x+=e,this.y+=t,this}static equals(e,t){return e===t||!(!e||!t)&&e.x===t.x&&e.y===t.y}static distance(e,t){const i=e.x-t.x;return e=e.y-t.y,Math.sqrt(i*i+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,t){return new lc(e.x-t.x,e.y-t.y)}static sum(e,t){return new lc(e.x+t.x,e.y+t.y)}},ac=class{constructor(e){this.tagName=e}toString(){return this.tagName}};ac.ANIMATE=new ac("animate"),ac.CIRCLE=new ac("circle"),ac.CLIPPATH=new ac("clipPath"),ac.DEFS=new ac("defs"),ac.FECOMPOSITE=new ac("feComposite"),ac.FECOMPONENTTRANSFER=new ac("feComponentTransfer"),ac.FEFLOOD=new ac("feFlood"),ac.FEFUNCA=new ac("feFuncA"),ac.FEGAUSSIANBLUR=new ac("feGaussianBlur"),ac.FEPOINTLIGHT=new ac("fePointLight"),ac.FESPECULARLIGHTING=new ac("feSpecularLighting"),ac.FILTER=new ac("filter"),ac.FOREIGNOBJECT=new ac("foreignObject"),ac.G=new ac("g"),ac.IMAGE=new ac("image"),ac.LINE=new ac("line"),ac.PATH=new ac("path"),ac.PATTERN=new ac("pattern"),ac.POLYGON=new ac("polygon"),ac.RECT=new ac("rect"),ac.SVG=new ac("svg"),ac.TEXT=new ac("text"),ac.TSPAN=new ac("tspan");var cc=class{constructor(e,t,i,n){this.top=e,this.bottom=t,this.left=i,this.right=n}clone(){return new cc(this.top,this.bottom,this.left,this.right)}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}intersects(e){return this.left<=e.right&&this.right>=e.left&&this.bottom>=e.top&&this.top<=e.bottom}static equals(e,t){return e===t||!(!e||!t)&&e.top===t.top&&e.bottom===t.bottom&&e.left===t.left&&e.right===t.right}static createFromPoint(e,t,i){const n=e.x;return e=e.y,new cc(e,e+i,n,n+t)}},hc=class{constructor(e,t){this.width=e,this.height=t}static equals(e,t){return e===t||!(!e||!t)&&e.width===t.width&&e.height===t.height}static max(e,t){return new hc(Math.max(e.width,t.width),Math.max(e.height,t.height))}static min(e,t){return new hc(Math.min(e.width,t.width),Math.min(e.height,t.height))}},uc={getSizeInternal:je},dc={TEST_ONLY:uc};dc.getBorderBox=qe,dc.getComputedStyle=Ke,dc.getContainerOffsetToScrollInto=Ze,dc.getPageOffset=Ye,dc.getSize=ze,dc.getViewportPageOffset=Je,dc.scrollIntoContainerView=Qe;var pc=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,gc=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,mc={TEST_ONLY:{XY_REGEX:pc,XY_STYLE_REGEX:gc}};mc.getDocumentScroll=nt,mc.getInjectionDivXY=tt,mc.getRelativeXY=et,mc.getViewportBBox=it,mc.screenToWsCoordinates=ot,mc.wsToScreenCoordinates=st;var bc=class{constructor(e,t,i,n,o){this.workspace=e,this.horizontal=t,this.oldHostMetrics=null,this.ratio=1,this.origin=new lc(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new lc(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=i||!1,this.margin=void 0!==o?o:bc.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),n&&(e+=" "+n),this.outerSvg=ae(ac.SVG,{class:e}),n=ae(ac.G,{},this.outerSvg),this.svgBackground=ae(ac.RECT,{class:"blocklyScrollbarBackground"},n),e=Math.floor((bc.scrollbarThickness-5)/2),this.svgHandle=ae(ac.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},n),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),ge(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),t?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=b(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=b(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const e=bc.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),E(this.onMouseDownBarWrapper_),E(this.onMouseDownHandleWrapper_),pe(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,t){this.position.x=e,this.position.y=t,me(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){(e||(e=this.workspace.getMetrics()))&&(this.oldHostMetrics&&bc.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics()))}requiresViewResize(e){return!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var t=e.viewWidth-2*this.margin;this.pair&&(t-=bc.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),t=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(t+=bc.scrollbarThickness),this.setPosition(t,e.absoluteTop+e.viewHeight-bc.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewWidth/e.scrollWidth;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollWidth-e.viewWidth;var i=this.scrollbarLength-this.handleLength;e=(e.viewLeft-e.scrollLeft)/t*i,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=i/t}}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let t=e.viewHeight-2*this.margin;this.pair&&(t-=bc.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-bc.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewHeight/e.scrollHeight;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollHeight-e.viewHeight;var i=this.scrollbarLength-this.handleLength;e=(e.viewTop-e.scrollTop)/t*i,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=i/t}}isVisible(){return this.isHandleVisible}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){const t=e!==this.isVisible();this.isHandleVisible=e,t&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){if(this.workspace.markFocused(),d(),this.cleanUp(),v(e))e.stopPropagation();else{var t=C(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());t=this.horizontal?t.x:t.y;var i=tt(this.svgHandle);i=this.horizontal?i.x:i.y;var n=this.handlePosition,o=.95*this.handleLength;t<=i?n-=o:t>=i+this.handleLength&&(n+=o),this.setHandlePosition(this.constrainHandlePosition(n)),this.updateMetrics(),e.stopPropagation(),e.preventDefault()}}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),v(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=b(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=b(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){d(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(E(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(E(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(e)&&(e=0),e}updateMetrics(){const e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,t){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),(t||void 0===t)&&this.updateMetrics()}setOrigin(e,t){this.origin=new lc(e,t)}static metricsAreEquivalent(e,t){return e.viewWidth===t.viewWidth&&e.viewHeight===t.viewHeight&&e.viewLeft===t.viewLeft&&e.viewTop===t.viewTop&&e.absoluteTop===t.absoluteTop&&e.absoluteLeft===t.absoluteLeft&&e.scrollWidth===t.scrollWidth&&e.scrollHeight===t.scrollHeight&&e.scrollLeft===t.scrollLeft&&e.scrollTop===t.scrollTop}};bc.scrollbarThickness=ql?25:15,bc.DEFAULT_SCROLLBAR_MARGIN=.5;var fc={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},Ec={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:yc,DOMParser:vc,XMLSerializer:Cc}=globalThis;vc&&(fc=new vc),Cc&&(Ec=new Cc);var _c="https://developers.google.com/blockly/xml",Tc=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,wc={NAME_SPACE:_c};wc.createElement=$l.createElement$$module$build$src$core$utils$xml,wc.createTextNode=$l.createTextNode$$module$build$src$core$utils$xml,wc.domToText=lt,wc.injectDependencies=rt,wc.textToDom=$l.textToDom$$module$build$src$core$utils$xml;var Ic,kc="categoryToolbox",xc="flyoutToolbox";!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(Ic||(Ic={}));var Nc,Sc,Ac,Rc={hasCategoriesInternal:pt},$c={};$c.Position=Ic,$c.TEST_ONLY=Rc,$c.convertFlyoutDefToJsonArray=ut,$c.convertToolboxDefToJson=ct,$c.hasCategories=dt,$c.isCategoryCollapsible=gt,$c.parseToolboxTree=Et,function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(Nc||(Nc={})),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(Sc||(Sc={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Ac||(Ac={}));var Oc={};Oc.bumpDirection=Ac,Oc.bumpPositionRect=Ct,Oc.getCornerOppositeToolbox=vt,Oc.getStartPositionRect=yt,Oc.horizontalPosition=Sc,Oc.verticalPosition=Nc;var Dc=96,Mc=124,Lc="sprites.png",Bc=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=ae(ac.G,{});const e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:tc.ComponentWeight.ZOOM_CONTROLS_WEIGHT,capabilities:[tc.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&pe(this.svgGroup);for(const e of this.boundEvents)E(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new cc(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,t){if(this.initialized){var i,n=vt(this.workspace,e),o=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(o+=this.LARGE_SPACING+this.HEIGHT),e=yt(n,new hc(this.WIDTH,o),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),n=n.vertical,t=Ct(e,this.MARGIN_VERTICAL,n===Nc.TOP?Ac.DOWN:Ac.UP,t),n===Nc.TOP){var s,r=this.SMALL_SPACING+this.HEIGHT;null==(s=this.zoomInGroup)||s.setAttribute("transform","translate(0, "+r+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(r+this.LARGE_SPACING+this.HEIGHT)+")")}else{let e;s=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0,null==(e=this.zoomInGroup)||e.setAttribute("transform","translate(0, "+s+")"),s=s+this.SMALL_SPACING+this.HEIGHT,null==(r=this.zoomOutGroup)||r.setAttribute("transform","translate(0, "+s+")")}this.top=t.top,this.left=t.left,null==(i=this.svgGroup)||i.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(e){this.zoomOutGroup=ae(ac.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const t=ae(ac.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);ae(ac.RECT,{width:32,height:32},t),ae(ac.IMAGE,{width:Dc,height:Mc,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(Ra,"xlink:href",this.workspace.options.pathToMedia+Lc),this.boundEvents.push(b(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=ae(ac.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const t=ae(ac.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);ae(ac.RECT,{width:32,height:32},t),ae(ac.IMAGE,{width:Dc,height:Mc,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(Ra,"xlink:href",this.workspace.options.pathToMedia+Lc),this.boundEvents.push(b(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,t){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),d(),t.stopPropagation(),t.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=ae(ac.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const t=ae(ac.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);ae(ac.RECT,{width:32,height:32},t),ae(ac.IMAGE,{width:Dc,height:Mc,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(Ra,"xlink:href",this.workspace.options.pathToMedia+Lc),this.boundEvents.push(b(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();const t=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(t),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),d(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){const e=new(re(ia.CLICK))(null,this.workspace.id,"zoom_controls");J(e)}};He("\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n");var Pc={BLOCKS:50,PROCEDURES:75,VARIABLES:100,WORKSPACE_COMMENTS:25},Fc={};Fc.register=_t,Fc.unregister=Tt;var Vc=class{constructor(){this.priority=25}save(e){const t=[];for(const i of e.getTopComments())(e=wt(i,{addCoordinates:!0,saveIds:!0}))&&t.push(e);return t.length?t:null}load(e,t){for(const i of e)It(i,t,{recordUndo:Y()})}clear(e){for(const t of e.getTopComments())t.dispose()}};_t("workspaceComments",new Vc);var Uc={};Uc.WorkspaceCommentSerializer=Vc,Uc.append=It,Uc.save=wt;var Wc={};Wc.register=kt,Wc.unregister=xt;var Hc=class{paste(e,t,i){let n;e=e.commentState,i&&(e.x=i.x,e.y=i.y),$l.disable$$module$build$src$core$events$utils();try{n=It(e,t),Nt(n)}finally{$l.enable$$module$build$src$core$events$utils()}return n?(ie()&&J(new(re(ia.COMMENT_CREATE))(n)),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(n),n):null}};Hc.TYPE="workspace-comment",kt(Hc.TYPE,new Hc),$l.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:28,connectingSnapRadius:28,currentConnectionPreference:8,bumpDelay:250},$l.config$$module$build$src$core$config;var Gc,zc,jc="aria-",Xc="role";(function(e){e.GRID="grid",e.GRIDCELL="gridcell",e.GROUP="group",e.LISTBOX="listbox",e.MENU="menu",e.MENUITEM="menuitem",e.MENUITEMCHECKBOX="menuitemcheckbox",e.OPTION="option",e.PRESENTATION="presentation",e.ROW="row",e.TREE="tree",e.TREEITEM="treeitem",e.SEPARATOR="separator",e.STATUS="status"})(Gc||(Gc={})),function(e){e.ACTIVEDESCENDANT="activedescendant",e.COLCOUNT="colcount",e.DISABLED="disabled",e.EXPANDED="expanded",e.INVALID="invalid",e.LABEL="label",e.LABELLEDBY="labelledby",e.LEVEL="level",e.ORIENTATION="orientation",e.POSINSET="posinset",e.ROWCOUNT="rowcount",e.SELECTED="selected",e.SETSIZE="setsize",e.VALUEMAX="valuemax",e.VALUEMIN="valuemin",e.LIVE="live",e.HIDDEN="hidden"}(zc||(zc={}));var Kc={};Kc.Role=Gc,Kc.State=zc,Kc.setRole=At,Kc.setState=Rt;var Yc=class{constructor(e,t){this.content=e,this.opt_value=t,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const e=document.createElement("div");e.id=T(),this.element=e,e.className="blocklyMenuItem "+(this.enabled?"":"blocklyMenuItemDisabled ")+(this.checked?"blocklyMenuItemSelected ":"")+(this.highlight?"blocklyMenuItemHighlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl ":"");const t=document.createElement("div");if(t.className="blocklyMenuItemContent",this.checkable){var i=document.createElement("div");i.className="blocklyMenuItemCheckbox ",t.appendChild(i)}return i=this.content,"string"==typeof this.content&&(i=document.createTextNode(this.content)),t.appendChild(i),e.appendChild(t),this.roleName&&At(e,this.roleName),Rt(e,zc.SELECTED,this.checkable&&this.checked||!1),Rt(e,zc.DISABLED,!this.enabled),e}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let e;return null!=(e=this.opt_value)?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;const t=this.getElement();t&&this.isEnabled()&&(e?ce(t,"blocklyMenuItemHighlight"):ue(t,"blocklyMenuItemHighlight"))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(e){this.isEnabled()&&this.actionHandler&&this.actionHandler(this,e)}onAction(e,t){this.actionHandler=e.bind(t)}},Jc=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.pointerLeaveHandler=this.pointerEnterHandler=this.clickHandler=this.pointerMoveHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){const t=document.createElement("div");t.className="blocklyMenu",t.tabIndex=0,this.roleName&&At(t,this.roleName),this.element=t;for(let e,i=0;e=this.menuItems[i];i++)t.appendChild(e.createDom());return this.pointerMoveHandler=b(t,"pointermove",this,this.handlePointerMove,!0),this.clickHandler=b(t,"pointerup",this,this.handleClick,!0),this.pointerEnterHandler=b(t,"pointerenter",this,this.handlePointerEnter,!0),this.pointerLeaveHandler=b(t,"pointerleave",this,this.handlePointerLeave,!0),this.onKeyDownHandler=b(t,"keydown",this,this.handleKeyEvent),e.appendChild(t),t}getElement(){return this.element}focus(){const e=this.getElement();e&&e.focus({preventScroll:!0})}blur(){const e=this.getElement();e&&e.blur()}setRole(e){this.roleName=e}dispose(){this.pointerMoveHandler&&(E(this.pointerMoveHandler),this.pointerMoveHandler=null),this.clickHandler&&(E(this.clickHandler),this.clickHandler=null),this.pointerEnterHandler&&(E(this.pointerEnterHandler),this.pointerEnterHandler=null),this.pointerLeaveHandler&&(E(this.pointerLeaveHandler),this.pointerLeaveHandler=null),this.onKeyDownHandler&&(E(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e,t=0;e=this.menuItems[t];t++)e.dispose();this.element=null}getMenuItem(e){const t=this.getElement();for(;e&&e!==t;){if(e.classList.contains("blocklyMenuItem")){const t=this.getMenuItems();for(let i,n=0;i=t[n];n++)if(i.getElement()===e)return i}e=e.parentElement}return null}setHighlighted(e){var t=this.highlightedItem;if(t&&(t.setHighlighted(!1),this.highlightedItem=null),e){e.setHighlighted(!0),this.highlightedItem=e,t=this.getElement();const i=e.getElement();t&&i&&(Qe(i,t),Rt(t,zc.ACTIVEDESCENDANT,e.getId()))}}highlightNext(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>e?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,t){let i;e+=t;const n=this.getMenuItems();for(;i=n[e];){if(i.isEnabled()){this.setHighlighted(i);break}e+=t}}handlePointerMove(e){0!==Math.max(Math.abs(e.movementX),Math.abs(e.movementY))&&(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){var t=this.openingCoords;if(this.openingCoords=null,t&&"number"==typeof e.clientX){const i=new lc(e.clientX,e.clientY);if(1>lc.distance(t,i))return}(t=this.getMenuItem(e.target))&&t.performAction(e)}handlePointerEnter(e){this.focus()}handlePointerLeave(e){this.getElement()&&this.setHighlighted(null)}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=this.highlightedItem;switch(e.key){case"Enter":case" ":t&&t.performAction(e);break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){const e=this.getElement(),t=ze(e);return t.height=e.scrollHeight,t}getMenuItems(){return this.menuItems.filter((e=>e instanceof Yc))}},qc=class{constructor(){this.element=null}createDom(){return this.element=document.createElement("hr"),this.element.className="blocklyMenuSeparator",At(this.element,Gc.SEPARATOR),this.element}dispose(){let e;null==(e=this.element)||e.remove(),this.element=null}},Qc="_TEMP_COLLAPSED_INPUT",Zc="_TEMP_COLLAPSED_FIELD",eh="MANUALLY_DISABLED",th={COLLAPSED_FIELD_NAME:Zc,COLLAPSED_INPUT_NAME:Qc,MANUALLY_DISABLED:eh};(function(e){e[e.VALUE=1]="VALUE",e[e.STATEMENT=3]="STATEMENT",e[e.DUMMY=5]="DUMMY",e[e.CUSTOM=6]="CUSTOM",e[e.END_ROW=7]="END_ROW"})($l.inputTypes$$module$build$src$core$inputs$input_types||($l.inputTypes$$module$build$src$core$inputs$input_types={})),$l.inputTypes$$module$build$src$core$inputs$input_types;var ih,nh,oh=new Set,sh=new WeakSet,rh=new WeakMap,lh=null,ah=null,ch=0,hh={};hh.finishQueuedRenders=Dt,hh.queueRender=Ot,hh.triggerQueuedRenders=Mt,$l.Msg$$module$build$src$core$msg=Object.create(null),ih=function(e){Object.keys(e).forEach((function(t){$l.Msg$$module$build$src$core$msg[t]=e[t]}))},nh={Msg:$l.Msg$$module$build$src$core$msg,setLocale:ih};var uh="blocklyToast",dh="blocklyToastMessage",ph="blocklyToastCloseButton",gh=class{static show(e,t){if(t.oncePerSession&&t.id){if(this.shownIds.has(t.id))return;this.shownIds.add(t.id)}this.hide(e);const i=this.createDom(e,t);requestAnimationFrame((()=>{i.style.bottom="2rem"}))}static createDom(e,t){const{message:i,duration:n=5,assertiveness:o=gh.Assertiveness.POLITE}=t,s=document.createElement("div");e.getInjectionDiv().appendChild(s),s.dataset.toastId=t.id,s.className=uh,At(s,Gc.STATUS),Rt(s,zc.LIVE,o),(t=s.appendChild(document.createElement("div"))).className=dh,t.innerText=i,(t=s.appendChild(document.createElement("button"))).className=ph,Rt(t,zc.LABEL,$l.Msg$$module$build$src$core$msg.CLOSE);var r=ae(ac.SVG,{width:24,height:24,viewBox:"0 0 24 24",fill:"none"},t);let l;return Rt(r,zc.HIDDEN,!0),ae(ac.RECT,{x:19.7782,y:2.80762,width:2,height:24,transform:"rotate(45, 19.7782, 2.80762)",fill:"black"},r),ae(ac.RECT,{x:2.80762,y:4.22183,width:2,height:24,transform:"rotate(-45, 2.80762, 4.22183)",fill:"black"},r),t.addEventListener("click",(()=>{s.remove(),e.markFocused()})),t=()=>{l=setTimeout((()=>s.remove()),1e3*n)},r=()=>clearTimeout(l),s.addEventListener("focusin",r),s.addEventListener("focusout",t),s.addEventListener("mouseenter",r),s.addEventListener("mousemove",r),s.addEventListener("mouseleave",t),t(),s}static hide(e,t){(e=e.getInjectionDiv().querySelector(`.${uh}`))instanceof HTMLElement&&(!t||t===e.dataset.toastId)&&e.remove()}};gh.shownIds=new Set,function(e){(e=e.Assertiveness||(e.Assertiveness={})).ASSERTIVE="assertive",e.POLITE="polite"}(gh||(gh={})),He(`\n.${uh} {\n  font-size: 1.2rem;\n  position: absolute;\n  bottom: -10rem;\n  right: 2rem;\n  padding: 1rem;\n  color: black;\n  background-color: white;\n  border: 2px solid black;\n  border-radius: 0.4rem;\n  z-index: 999;\n  display: flex;\n  align-items: center;\n  gap: 0.8rem;\n  line-height: 1.5;\n  transition: bottom 0.3s ease-out;\n}\n\n.${uh} .${dh} {\n  maxWidth: 18rem;\n}\n\n.${uh} .${ph} {\n  margin: 0;\n  padding: 0.2rem;\n  background-color: transparent;\n  color: black;\n  border: none;\n  cursor: pointer;\n}\n`);var mh=function(e,t){window.alert(e),t&&t()},bh=mh,fh=function(e,t){t(window.confirm(e))},Eh=fh,yh=function(e,t,i){i(window.prompt(e,t))},vh=yh,Ch=gh.show.bind(gh),_h=Ch,Th={};Th.alert=Wt,Th.confirm=Gt,Th.prompt=jt,Th.setAlert=Ht,Th.setConfirm=zt,Th.setPrompt=Xt,Th.setToast=Yt,Th.toast=Kt;var wh={};wh.isLegacyProcedureCallBlock=qt,wh.isLegacyProcedureDefBlock=Jt;var Ih=new Set,kh={};kh.warn=Zt;var xh="VARIABLE",Nh="ijkmnopqrstuvwxyzabcdefgh",Sh={generateUniqueNameInternal:li},Ah={CATEGORY_NAME:xh,TEST_ONLY:Sh,VAR_LETTER_OPTIONS:Nh};Ah.allDeveloperVariables=$l.allDeveloperVariables$$module$build$src$core$variables,Ah.allUsedVarModels=$l.allUsedVarModels$$module$build$src$core$variables,Ah.compareByName=yi,Ah.createVariableButtonHandler=ci,Ah.deleteVariable=$l.deleteVariable$$module$build$src$core$variables,Ah.flyoutCategory=ti,Ah.flyoutCategoryBlocks=si,Ah.generateUniqueName=ri,Ah.generateUniqueNameFromOptions=ai,Ah.generateVariableFieldDom=bi,Ah.getAddedVariables=Ei,Ah.getOrCreateVariablePackage=$l.getOrCreateVariablePackage$$module$build$src$core$variables,Ah.getVariable=$l.getVariable$$module$build$src$core$variables,Ah.getVariableUsesById=vi,Ah.internalFlyoutCategory=ei,Ah.jsonFlyoutCategoryBlocks=ni,Ah.nameUsedWithAnyType=di,Ah.nameUsedWithConflictingParam=pi,Ah.promptName=hi,Ah.renameVariable=$l.renameVariable$$module$build$src$core$variables;var Rh=class extends Error{},$h=class extends Rh{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},Oh=class extends Rh{constructor(e,t,i){super(`The block ${t.toDevString()} is missing a(n) ${e}\nconnection`),this.block=t,this.state=i}},Dh=class extends Rh{constructor(e,t,i,n){super(`The block ${i.toDevString()} could not connect its\n${t} to its parent, because: ${e}`),this.childBlock=i,this.childState=n}},Mh=class extends Rh{constructor(e){super("Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren"),this.state=e}},Lh=class extends Rh{constructor(e,t,i){super(`Cannot add an icon of type '${e}' to the block ${t.toDevString()}, because there is no icon registered with type '${e}'. Make sure that all of your icons have been registered.`),this.block=t,this.state=i}},Bh={};Bh.BadConnectionCheck=Dh,Bh.DeserializationError=Rh,Bh.MissingBlockType=$h,Bh.MissingConnection=Oh,Bh.RealChildOfShadow=Mh,Bh.UnregisteredIcon=Lh;var Ph=class{constructor(){this.priority=50}save(e){const t=[];for(const i of e.getTopBlocks(!1))(e=Ci(i,{addCoordinates:!0,doFullSerialization:!1}))&&t.push(e);return t.length?{languageVersion:0,blocks:t}:null}load(e,t){e=e.blocks;for(const i of e)Ai(i,t,{recordUndo:Y()})}clear(e){for(const t of e.getTopBlocks(!1))t.dispose(!1)}};_t("blocks",new Ph);var Fh={};Fh.BlockSerializer=Ph,Fh.append=Ai,Fh.appendInternal=Ri,Fh.save=Ci;var Vh=class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}};Vh.MUTATOR=new Vh("mutator"),Vh.WARNING=new Vh("warning"),Vh.COMMENT=new Vh("comment");var Uh=class extends Ya{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.blockId=this.blockId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Uh)).blockId=e.blockId,t}},Wh=class extends Uh{constructor(e,t,i,n,o){super(e),this.type=ia.BLOCK_CHANGE,e&&(this.element=t,this.name=i||void 0,this.oldValue=n,this.newValue=o)}toJson(){const e=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,this.disabledReason&&(e.disabledReason=this.disabledReason),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Wh)).element=e.element,t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,void 0!==e.disabledReason&&(t.disabledReason=e.disabledReason),t}setDisabledReason(e){if("disabled"!==this.element)throw Error('Cannot set the disabled reason for a BlockChange event if the element is not "disabled".');this.disabledReason=e}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");const i=t.getIcon(Vh.MUTATOR);switch(i&&Gi(i)&&i.bubbleIsVisible()&&i.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":var n;t.setDisabledReason(!!e,null!=(n=this.disabledReason)?n:eh);break;case"inline":t.setInputsInline(!!e);break;case"mutation":n=Wh.getExtraBlockState_(t),t.loadExtraState?t.loadExtraState(JSON.parse(e||"{}")):t.domToMutation&&t.domToMutation($l.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),J(new Wh(t,"mutation",null,n,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?Vo(e):""}};e(Bl.EVENT,ia.BLOCK_CHANGE,Wh);var Hh={};Hh.clamp=Xi,Hh.toDegrees=ji,Hh.toRadians=zi;var Gh,zh,jh,Xh=16,Kh=1,Yh=12,Jh=16,qh=.25,Qh=null,Zh=null,eu="",tu="",iu=null,nu=null,ou=null,su=null,ru=null,lu={getBoundsInfo:function(){const e=Ye(iu),t=ze(iu);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}},getPositionMetrics:function(e,t,i,n){const o=lu.getBoundsInfo(),s=ze(Gh);return t+s.height<o.bottom?ln(e,t,o,s):n-s.height>o.top?an(i,n,o,s):t+s.height<document.documentElement.clientHeight?ln(e,t,o,s):n-s.height>document.documentElement.clientTop?an(i,n,o,s):cn(e,o,s)}},au={ANIMATION_TIME:qh,ARROW_HORIZONTAL_PADDING:Yh,ARROW_SIZE:Xh,BORDER_SIZE:Kh,PADDING_Y:Jh,TEST_ONLY:lu};au.clearContent=Qi,au.createDom=Ki,au.getContentDiv=qi,au.getOwner=Ji,au.getPositionX=hn,au.hide=pn,au.hideIfOwner=dn,au.hideWithoutAnimation=gn,au.isVisible=un,au.repositionForWindowResize=bn,au.setBoundsElement=Yi,au.setColour=Zi,au.show=rn,au.showPositionedByBlock=en,au.showPositionedByField=tn;var cu={};cu.commonWordPrefix=En,cu.commonWordSuffix=yn,cu.isNumber=$l.isNumber$$module$build$src$core$utils$string,cu.shortestStringLength=fn,cu.wrap=$l.wrap$$module$build$src$core$utils$string;var hu=void 0,uu=!1,du=!1,pu=50,gu=0,mu=0,bu=0,fu=0,Eu=null,yu=null,vu=0,Cu=10,_u=10,Tu=750,wu=5,Iu=null,ku={HOVER_MS:Tu,LIMIT:pu,MARGINS:wu,OFFSET_X:vu,OFFSET_Y:Cu,RADIUS_OK:_u};ku.bindMouseEvents=Rn,ku.block=Pn,ku.createDom=An,ku.dispose=Ln,ku.getCustomTooltip=In,ku.getDiv=xn,ku.getTooltipOfObject=Nn,ku.hide=Bn,ku.isVisible=kn,ku.setCustomTooltip=wn,ku.unbindMouseEvents=$n,ku.unblock=Fn;var xu=.45,Nu=.65,Su={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},Au={};Au.blend=Qn,Au.getHsvSaturation=Gn,Au.getHsvValue=jn,Au.hexToRgb=Jn,Au.hsvToHex=qn,Au.hueToHex=Zn,Au.names=Su,Au.parse=Kn,Au.rgbToHex=Yn,Au.setHsvSaturation=zn,Au.setHsvValue=Xn;var Ru={};Ru.checkMessageReferences=no,Ru.parseBlockColour=oo,Ru.replaceMessageReferences=io,Ru.tokenizeInterpolation=to;var $u=class{get size_(){return this.size}set size_(e){this.size=e}constructor(e,t,i){this.DEFAULT_VALUE=null,this.name=void 0,this.tooltip=this.validator_=null,this.size=new hc(0,0),this.constants_=this.mouseDownWrapper=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.id_=null,this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new hc(0,0),e!==$u.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){e.tooltip&&this.setTooltip(io(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=e,this.id_=`${e.id}_field_${T()}`}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){if(!this.fieldGroup_){var e=this.id_;if(!e)throw Error("Expected ID to be defined prior to init.");this.fieldGroup_=ae(ac.G,{id:e}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip),this.bindEvents_(),this.initModel(),this.applyColour()}}initView(){this.createBorderRect_(),this.createTextElement_(),this.fieldGroup_&&ce(this.fieldGroup_,"blocklyField")}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=ae(ac.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=ae(ac.TEXT,{class:"blocklyText blocklyFieldText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");Rn(e),this.mouseDownWrapper=b(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return null!==(e=this.saveLegacyState($u))?e:this.getValue()}loadState(e){this.loadLegacyState($u,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?((e=$l.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name",this.name||""),lt(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,t){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml&&(this.fromXml($l.textToDom$$module$build$src$core$utils$xml(t)),!0)}dispose(){let e;dn(this),uo(this),null!=(e=this.getSourceBlock())&&e.isDeadOrDying()||pe(this.fieldGroup_),this.disposed=!0}updateEditable(){const e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?(ce(e,"blocklyEditableField"),ue(e,"blocklyNonEditableField")):(ce(e,"blocklyNonEditableField"),ue(e,"blocklyEditableField")))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==$u.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){if(this.visible_!==e){this.visible_=e;var t=this.fieldGroup_;t&&(t.style.display=e?"block":"none")}}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){const t=this.getConstants();let i=2*(e=void 0!==e?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING),n=t.FIELD_TEXT_HEIGHT,o=0;this.textElement_&&(o=Ee(this.textElement_),i+=o),this.isFullBlockField()||(n=Math.max(n,t.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=n,this.size_.width=i,this.positionTextElement_(e,o),this.positionBorderRect_()}positionTextElement_(e,t){if(this.textElement_){var i,n=this.getConstants(),o=this.size_.height/2;this.textElement_.setAttribute("x",String(null!=(i=this.getSourceBlock())&&i.RTL?this.size_.width-t-e:e)),this.textElement_.setAttribute("y",String(n.FIELD_TEXT_BASELINE_CENTER?o:o-n.FIELD_TEXT_HEIGHT/2+n.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_&&(this.render_(),this.isDirty_=!1),this.size_):new hc(0,0)}getScaledBBox(){let e;var t=this.getSourceBlock();if(!t)throw new Ou;if(this.isFullBlockField()){var i=this.sourceBlock_.getHeightWidth();const n=t.workspace.scale;e=this.getAbsoluteXY_(),t=(i.width+1)*n,i=(i.height+1)*n,sa?(e.x+=1.5*n,e.y+=1.5*n):(e.x-=.5*n,e.y-=.5*n)}else i=this.borderRect_.getBoundingClientRect(),e=Ye(this.borderRect_),t=i.width,i=i.height;return new cc(e.y,e.y+i,e.x,e.x+t)}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+"…"),e=e.replace(/\s/g,$u.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+="‏"),e}getText(){const e=this.getText_();return String(null!==e?e:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.queueRender()}setValue(e,t=!0){if(null!==e){var i=$l.getGroup$$module$build$src$core$events$utils();i||$l.setGroup$$module$build$src$core$events$utils(!0);try{const i=this.doClassValidation_(e),a=this.processValidation(e,i,t);if(!(a instanceof Error)){var n,o=null==(n=this.getValidator())?void 0:n.call(this,a),s=this.processValidation(a,o,t);if(!(s instanceof Error)){var r=this.sourceBlock_;if(!r||!r.disposed){var l=this.getValue();l===s?this.doValueUpdate_(s):(this.doValueUpdate_(s),t&&r&&ie()&&J(new(re(ia.BLOCK_CHANGE))(r,"field",this.name||null,l,s)),this.isDirty_&&this.forceRerender())}}}}finally{$l.setGroup$$module$build$src$core$events$utils(i)}}}processValidation(e,t,i){return null===t?(this.doValueInvalid_(e,i),this.isDirty_&&this.forceRerender(),Error()):void 0===t?e:t}getValue(){return this.value_}doClassValidation_(e){return null==e?null:e}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e,t){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||""===e||(e=this.sourceBlock_);const t=this.getClickTarget_();t?t.tooltip=e:this.tooltip=e}getTooltip(){const e=this.getClickTarget_();return Nn(e||{tooltip:this.tooltip})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return Ye(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let e=null;const t=this.getSourceBlock();if(!t)throw new Ou;const i=t.inputList;for(let n=0;n<t.inputList.length;n++){const t=i[n],o=t.fieldRow;for(let i=0;i<o.length;i++)if(o[i]===this){e=t;break}}return e}getFlipRtl(){return!1}onShortcut(e){return!1}getFocusableElement(){if(!this.fieldGroup_)throw Error("This field currently has no representative DOM element.");return this.fieldGroup_}getFocusableTree(){const e=this.getSourceBlock();if(!e)throw new Ou;return e.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}static fromJson(e){throw Error("Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.")}};$u.NBSP=" ",$u.SKIP_SETUP=Symbol("SKIP_SETUP");var Ou=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},Du={};Du.Field=$u,Du.UnattachedFieldError=Ou;var Mu,Lu=null,Bu=null,Pu=null,Fu="blocklyWidgetDiv",Vu="",Uu="",Wu=null,Hu={};Hu.createDom=lo,Hu.getDiv=so,Hu.hide=co,Hu.hideIfOwner=uo,Hu.hideIfOwnerIsInWorkspace=po,Hu.isVisible=ho,Hu.positionWithAnchor=mo,Hu.repositionForWindowResize=yo,Hu.show=ao,Hu.testOnly_setDiv=ro;var Gu=null,zu={},ju=null,Xu={};Xu.callbackFactory=$l.callbackFactory$$module$build$src$core$contextmenu,Xu.dispose=No,Xu.getCurrentBlock=vo,Xu.hide=xo,Xu.setCurrentBlock=Co,Xu.show=_o;var Ku=class{constructor(){this.registeredItems=new Map,this.reset()}reset(){this.registeredItems.clear()}register(e){if(this.registeredItems.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registeredItems.set(e.id,e)}unregister(e){if(!this.registeredItems.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registeredItems.delete(e)}getItem(e){let t;return null!=(t=this.registeredItems.get(e))?t:null}getContextMenuOptions(e,t){const i=[];for(const n of this.registeredItems.values()){if(n.scopeType){if(n.scopeType===Yu.BLOCK&&!e.block)continue;if(n.scopeType===Yu.COMMENT&&!e.comment)continue;if(n.scopeType===Yu.WORKSPACE&&!e.workspace)continue}let o;if(o={scope:e,weight:n.weight},n.separator)o=Object.assign({},o,{separator:!0});else{const i=n.preconditionFn(e,t);if("hidden"===i)continue;const s="function"==typeof n.displayText?n.displayText(e):n.displayText;o=Object.assign({},o,{text:s,callback:n.callback,enabled:"enabled"===i})}i.push(o)}return i.sort((function(e,t){return e.weight-t.weight})),i}};!function(e){var t=e.ScopeType||(e.ScopeType={});t.BLOCK="block",t.WORKSPACE="workspace",t.COMMENT="comment",e.registry=new e}(Ku||(Ku={}));var Yu=Ku.ScopeType,Ju={};Ju.ContextMenuRegistry=Ku,Ju.ScopeType=Yu;var qu=50,Qu=100,Zu={BLOCK:qu,BUBBLE:Qu},ed=class{constructor(e){this.comment=e,this.startLoc=null,this.workspace=e.workspace}isMovable(){return this.comment.isOwnMovable()&&!this.comment.isDeadOrDying()&&!this.workspace.isReadOnly()}startDrag(){let e;this.fireDragStartEvent(),this.startLoc=this.comment.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1),null==(e=this.workspace.getLayerManager())||e.moveToDragLayer(this.comment),this.comment.setDragging(!0)}drag(e){this.comment.moveDuringDrag(e)}endDrag(){let e;this.fireDragEndEvent(),this.fireMoveEvent(),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.comment,qu),this.comment.setDragging(!1),this.comment.snapToGrid(),this.workspace.setResizesEnabled(!0)}fireDragStartEvent(){const e=new(re(ia.COMMENT_DRAG))(this.comment,!0);J(e)}fireDragEndEvent(){const e=new(re(ia.COMMENT_DRAG))(this.comment,!1);J(e)}fireMoveEvent(){if(!this.comment.isDeadOrDying()){var e=new(re(ia.COMMENT_MOVE))(this.comment);e.setReason(["drag"]),e.oldCoordinate_=this.startLoc,e.recordNew(),J(e)}}revertDrag(){this.startLoc&&this.comment.moveDuringDrag(this.startLoc)}},td=new WeakMap,id={};id.move=Ro,id.start=Ao;var nd=class{constructor(e){let t;this.workspace=e,this.collapsed=!1,this.editable=!0,this.location=new lc(0,0),this.text="",this.textChangeListeners=[],this.sizeChangeListeners=[],this.disposeListeners=[],this.collapseChangeListeners=[],this.resizePointerMoveListener=this.resizePointerUpListener=null,this.disposed=this.disposing=!1,this.svgRoot=ae(ac.G,{class:"blocklyComment blocklyEditable blocklyDraggable"}),this.highlightRect=this.createHighlightRect(this.svgRoot),({topBarGroup:this.topBarGroup,topBarBackground:this.topBarBackground,deleteIcon:this.deleteIcon,foldoutIcon:this.foldoutIcon,textPreview:this.textPreview,textPreviewNode:this.textPreviewNode}=this.createTopBar(this.svgRoot,e)),({foreignObject:this.foreignObject,textArea:this.textArea}=this.createTextArea(this.svgRoot)),this.resizeHandle=this.createResizeHandle(this.svgRoot,e),null==(t=e.getLayerManager())||t.append(this,qu),this.size=nd.defaultCommentSize,this.setSizeWithoutFiringEvents(this.size),this.moveTo(new lc(0,0))}createHighlightRect(e){return ae(ac.RECT,{class:"blocklyCommentHighlight"},e)}createTopBar(e,t){e=ae(ac.G,{class:"blocklyCommentTopbar"},e);const i=ae(ac.RECT,{class:"blocklyCommentTopbarBackground"},e),n=ae(ac.IMAGE,{class:"blocklyDeleteIcon",href:`${t.options.pathToMedia}delete-icon.svg`},e);t=ae(ac.IMAGE,{class:"blocklyFoldoutIcon",href:`${t.options.pathToMedia}foldout-icon.svg`},e);const o=ae(ac.TEXT,{class:"blocklyCommentPreview blocklyCommentText blocklyText"},e),s=document.createTextNode("");return o.appendChild(s),b(t,"pointerdown",this,this.onFoldoutDown),b(n,"pointerdown",this,this.onDeleteDown),{topBarGroup:e,topBarBackground:i,deleteIcon:n,foldoutIcon:t,textPreview:o,textPreviewNode:s}}createTextArea(e){e=ae(ac.FOREIGNOBJECT,{class:"blocklyCommentForeignObject"},e);const t=document.createElementNS(Aa,"body");t.setAttribute("xmlns",Aa),t.className="blocklyMinimalBody";const i=document.createElementNS(Aa,"textarea");return ce(i,"blocklyCommentText"),ce(i,"blocklyTextarea"),ce(i,"blocklyText"),t.appendChild(i),e.appendChild(t),b(i,"change",this,this.onTextChange),{foreignObject:e,textArea:i}}createResizeHandle(e,t){return e=ae(ac.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e),b(e,"pointerdown",this,this.onResizePointerDown),e}getSvgRoot(){return this.svgRoot}getSize(){return this.collapsed?this.topBarBackground.getBBox():this.size}setSizeWithoutFiringEvents(e){const t=this.topBarBackground.getBBox(),i=this.deleteIcon.getBBox(),n=this.foldoutIcon.getBBox(),o=this.textPreview.getBBox(),s=this.resizeHandle.getBBox();this.size=e=hc.max(e,this.calcMinSize(t,n,i)),this.svgRoot.setAttribute("height",`${e.height}`),this.svgRoot.setAttribute("width",`${e.width}`),this.updateHighlightRect(e),this.updateTopBarSize(e),this.updateTextAreaSize(e,t),this.updateDeleteIconPosition(e,t,i),this.updateFoldoutIconPosition(t,n),this.updateTextPreviewSize(e,t,o,i,s),this.updateResizeHandlePosition(e,s)}setSize(e){const t=this.preResizeSize||this.size;this.setSizeWithoutFiringEvents(e),this.onSizeChange(t,this.size)}calcMinSize(e,t,i){var n;this.updateTextPreview(null!=(n=this.textArea.value)?n:""),n=Ee(this.textPreview);const o=this.calcFoldoutMargin(e,t),s=this.calcDeleteMargin(e,i);let r=n;return this.foldoutIcon.checkVisibility()?r+=t.width+2*o:n&&(r+=4),this.deleteIcon.checkVisibility()?r+=i.width+2*s:n&&(r+=4),new hc(r,e.height+20)}calcDeleteMargin(e,t){return(e.height-t.height)/2}calcFoldoutMargin(e,t){return(e.height-t.height)/2}updateHighlightRect(e){this.highlightRect.setAttribute("height",`${e.height}`),this.highlightRect.setAttribute("width",`${e.width}`),this.workspace.RTL&&this.highlightRect.setAttribute("x",""+-e.width)}updateTopBarSize(e){this.topBarBackground.setAttribute("width",`${e.width}`)}updateTextAreaSize(e,t){this.foreignObject.setAttribute("height",""+(e.height-t.height)),this.foreignObject.setAttribute("width",`${e.width}`),this.foreignObject.setAttribute("y",`${t.height}`),this.workspace.RTL&&this.foreignObject.setAttribute("x",""+-e.width)}updateDeleteIconPosition(e,t,i){t=this.calcDeleteMargin(t,i),this.deleteIcon.setAttribute("y",`${t}`),this.deleteIcon.setAttribute("x",""+(e.width-i.width-t))}updateFoldoutIconPosition(e,t){e=this.calcFoldoutMargin(e,t),this.foldoutIcon.setAttribute("y",`${e}`),this.foldoutIcon.setAttribute("x",`${e}`)}updateTextPreviewSize(e,t,i,n,o){const s=(t.height-i.height)/2,r=this.calcDeleteMargin(t,n);t=this.calcFoldoutMargin(t,o),e=e.width-o.width-2*t-n.width-2*r,this.textPreview.setAttribute("x",`${o.width+2*t*(this.workspace.RTL?-1:1)}`),this.textPreview.setAttribute("y",`${s+i.height/2}`),this.textPreview.setAttribute("width",`${e}`)}updateResizeHandlePosition(e,t){this.resizeHandle.setAttribute("y",""+(e.height-t.height)),this.resizeHandle.setAttribute("x",""+(e.width-t.width))}onSizeChange(e,t){for(let i=this.sizeChangeListeners.length-1;0<=i;i--)this.sizeChangeListeners[i](e,t)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}removeSizeChangeListener(e){this.sizeChangeListeners.splice(this.sizeChangeListeners.indexOf(e),1)}onResizePointerDown(e){this.isEditable()&&(this.bringToFront(),v(e)||(this.preResizeSize=this.getSize(),Ao(this.workspace,e,new lc(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=b(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=b(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation())}onResizePointerUp(e){d(),this.resizePointerUpListener&&(E(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(E(this.resizePointerMoveListener),this.resizePointerMoveListener=null),this.setSize(this.size),this.preResizeSize=void 0}onResizePointerMove(e){e=Ro(this.workspace,e),this.setSizeWithoutFiringEvents(new hc(this.workspace.RTL?-e.x:e.x,e.y))}isCollapsed(){return this.collapsed}setCollapsed(e){(this.collapsed=e)?ce(this.svgRoot,"blocklyCollapsed"):ue(this.svgRoot,"blocklyCollapsed"),this.setSizeWithoutFiringEvents(this.size),this.onCollapse()}onCollapse(){for(let e=this.collapseChangeListeners.length-1;0<=e;e--)this.collapseChangeListeners[e](this.collapsed)}addOnCollapseListener(e){this.collapseChangeListeners.push(e)}removeOnCollapseListener(e){this.collapseChangeListeners.splice(this.collapseChangeListeners.indexOf(e),1)}onFoldoutDown(e){d(),this.bringToFront(),v(e)||(this.setCollapsed(!this.collapsed),this.workspace.hideChaff()),e.stopPropagation()}isEditable(){return this.editable}setEditable(e){(this.editable=e)?(ce(this.svgRoot,"blocklyEditable"),ue(this.svgRoot,"blocklyReadonly"),this.textArea.removeAttribute("readonly")):(ue(this.svgRoot,"blocklyEditable"),ce(this.svgRoot,"blocklyReadonly"),this.textArea.setAttribute("readonly","true"))}getRelativeToSurfaceXY(){return this.location}moveTo(e){this.location=e,this.svgRoot.setAttribute("transform",`translate(${e.x}, ${e.y})`)}getText(){return this.text}setText(e){this.textArea.value=e,this.onTextChange()}setPlaceholderText(e){this.textArea.placeholder=e}addTextChangeListener(e){this.textChangeListeners.push(e)}removeTextChangeListener(e){this.textChangeListeners.splice(this.textChangeListeners.indexOf(e),1)}onTextChange(){const e=this.text;this.text=this.textArea.value,this.updateTextPreview(this.text),this.setSize(this.size);for(let t=this.textChangeListeners.length-1;0<=t;t--)this.textChangeListeners[t](e,this.text)}updateTextPreview(e){this.textPreviewNode.textContent=this.truncateText(e)}truncateText(e){return 12<=e.length?`${e.substring(0,9)}...`:e}bringToFront(){const e=this.svgRoot.parentNode,t=e.childNodes;t[t.length-1]!==this.svgRoot&&e.appendChild(this.svgRoot)}onDeleteDown(e){d(),v(e)||this.dispose(),e.stopPropagation()}dispose(){this.disposing=!0,pe(this.svgRoot);for(let e=this.disposeListeners.length-1;0<=e;e--)this.disposeListeners[e]();this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}addDisposeListener(e){this.disposeListeners.push(e)}removeDisposeListener(e){this.disposeListeners.splice(this.disposeListeners.indexOf(e),1)}};nd.defaultCommentSize=new hc(120,100),He("\n.injectionDiv {\n  --commentFillColour: #FFFCC7;\n  --commentBorderColour: #F2E49B;\n}\n\n.blocklyComment .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 1px solid var(--commentBorderColour);\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n\n.blocklyReadonly.blocklyComment .blocklyTextarea {\n  cursor: inherit;\n}\n\n.blocklyDeleteIcon {\n  width: 20px;\n  height: 20px;\n  display: none;\n  cursor: pointer;\n}\n\n.blocklyFoldoutIcon {\n  width: 20px;\n  height: 20px;\n  transform-origin: 12px 12px;\n  cursor: pointer;\n}\n.blocklyResizeHandle {\n  width: 12px;\n  height: 12px;\n  cursor: se-resize;\n}\n.blocklyReadonly.blocklyComment .blocklyResizeHandle {\n  cursor: inherit;\n}\n\n.blocklyCommentTopbarBackground {\n  fill: var(--commentBorderColour);\n  height: 24px;\n}\n\n.blocklyComment .blocklyCommentPreview.blocklyText {\n  fill: #000;\n  dominant-baseline: middle;\n  visibility: hidden;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentPreview {\n  visibility: visible;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,\n.blocklyCollapsed.blocklyComment .blocklyResizeHandle {\n  display: none;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {\n  transform: rotate(-90deg);\n}\n\n.blocklyRTL .blocklyCommentTopbar {\n  transform: scale(-1, 1);\n}\n\n.blocklyRTL .blocklyCommentForeignObject {\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyCommentPreview {\n  /* Revert the scale and control RTL using direction instead. */\n  transform: scale(-1, 1);\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyResizeHandle {\n  transform: scale(-1, 1);\n  cursor: sw-resize;\n}\n\n.blocklyCommentHighlight {\n  fill: none;\n}\n\n.blocklySelected .blocklyCommentHighlight {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {\n  stroke: none;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n");var od=class{constructor(e,t){this.workspace=e,this.text="",this.collapsed=!1,this.deletable=this.movable=this.editable=!0,this.location=new lc(0,0),this.disposing=this.disposed=!1,this.id=t&&!e.getCommentById(t)?t:w(),this.size=nd.defaultCommentSize,e.addTopComment(this),this.fireCreateEvent()}fireCreateEvent(){ie()&&J(new(re(ia.COMMENT_CREATE))(this))}fireDeleteEvent(){ie()&&J(new(re(ia.COMMENT_DELETE))(this))}fireChangeEvent(e,t){ie()&&J(new(re(ia.COMMENT_CHANGE))(this,e,t))}fireCollapseEvent(e){ie()&&J(new(re(ia.COMMENT_COLLAPSE))(this,e))}setText(e){const t=this.text;this.text=e,this.fireChangeEvent(t,e)}getText(){return this.text}setSize(e){const t=new(re(ia.COMMENT_RESIZE))(this);this.size=e,t.recordCurrentSizeAsNewSize(),J(t)}getSize(){return this.size}setCollapsed(e){this.collapsed=e,this.fireCollapseEvent(e)}isCollapsed(){return this.collapsed}setEditable(e){this.editable=e}isEditable(){return this.isOwnEditable()&&!this.workspace.isReadOnly()}isOwnEditable(){return this.editable}setMovable(e){this.movable=e}isMovable(){return this.isOwnMovable()&&!this.workspace.isReadOnly()}isOwnMovable(){return this.movable}setDeletable(e){this.deletable=e}isDeletable(){return this.isOwnDeletable()&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnDeletable(){return this.deletable}moveTo(e,t){const i=new(re(ia.COMMENT_MOVE))(this);t&&i.setReason(t),this.location=e,i.recordNew(),J(i)}getRelativeToSurfaceXY(){return this.location}dispose(){this.disposing=!0,this.fireDeleteEvent(),this.workspace.removeTopComment(this),this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}},sd=class extends od{constructor(e,t){super(e,t),this.dragStrategy=new ed(this),this.workspace=e,this.view=new nd(e),this.view.setSize(this.getSize()),this.view.setEditable(this.isEditable()),this.view.getSvgRoot().setAttribute("data-id",this.id),this.view.getSvgRoot().setAttribute("id",this.id),this.addModelUpdateBindings(),b(this.view.getSvgRoot(),"pointerdown",this,this.startGesture),b(this.view.getSvgRoot(),"wheel",this,(e=>{e.stopPropagation()}))}addModelUpdateBindings(){this.view.addTextChangeListener(((e,t)=>{super.setText(t)})),this.view.addSizeChangeListener(((e,t)=>{super.setSize(t)})),this.view.addOnCollapseListener((()=>{super.setCollapsed(this.view.isCollapsed())})),this.view.addDisposeListener((()=>{this.isDeadOrDying()||this.dispose()}))}setText(e){this.view.setText(e)}setPlaceholderText(e){this.view.setPlaceholderText(e)}setSize(e){this.view.setSize(e)}setCollapsed(e){this.view.setCollapsed(e)}setEditable(e){super.setEditable(e),this.view.setEditable(this.isEditable())}getSvgRoot(){return this.view.getSvgRoot()}getSize(){return super.getSize()}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY();var t,i;const n=null!=(i=null==(t=this.view)?void 0:t.getSize())?i:this.getSize();return this.workspace.RTL?(t=e.x-n.width,i=e.x):(t=e.x,i=e.x+n.width),new cc(e.y,e.y+n.height,t,i)}moveBy(e,t,i){const n=this.getRelativeToSurfaceXY();e=new lc(n.x+e,n.y+t),this.moveTo(e,i)}moveTo(e,t){super.moveTo(e,t),this.view.moveTo(e)}moveDuringDrag(e){this.location=e,this.view.moveTo(e)}setDragging(e){e?ce(this.getSvgRoot(),"blocklyDragging"):ue(this.getSvgRoot(),"blocklyDragging")}dispose(){this.disposing=!0;const e=$l.getFocusManager$$module$build$src$core$focus_manager();e.getFocusedNode()===this&&setTimeout((()=>e.focusTree(this.workspace)),0),this.view.isDeadOrDying()||this.view.dispose(),super.dispose()}startGesture(e){const t=this.workspace.getGesture(e);t&&(y(e)?e.stopPropagation():t.handleCommentStart(e,this),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this))}setDeleteStyle(e){e?ce(this.getSvgRoot(),"blocklyDraggingDelete"):ue(this.getSvgRoot(),"blocklyDraggingDelete")}isMovable(){return this.dragStrategy.isMovable()}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){ce(this.getSvgRoot(),"blocklySelected"),Oe(this)}unselect(){ue(this.getSvgRoot(),"blocklySelected"),Oe(null)}toCopyData(){return{paster:Hc.TYPE,commentState:wt(this,{addCoordinates:!0})}}showContextMenu(e){const t=Ku.registry.getContextMenuOptions({comment:this,focusedNode:this},e);let i;i=e instanceof PointerEvent?new lc(e.clientX,e.clientY):st(this.workspace,this.getRelativeToSurfaceXY()).translate(10,10),_o(e,t,this.workspace.RTL,this.workspace,i)}snapToGrid(){if(!this.isDeadOrDying()){var e=this.workspace.getGrid();if(null!=e&&e.shouldSnap()){var t=this.getRelativeToSurfaceXY();(e=e.alignXY(t))!==t&&this.moveTo(e,["snap"])}}}getFocusableElement(){return this.getSvgRoot()}getFocusableTree(){return this.workspace}onNodeFocus(){let e;this.select(),null==(e=this.workspace.getLayerManager())||e.append(this,qu)}onNodeBlur(){this.unselect()}canBeFocused(){return!0}},rd={};rd.appendDomToWorkspace=Go,rd.blockToDom=Po,rd.blockToDomWithXY=Mo,rd.clearWorkspaceAndLoadFromXml=Wo,rd.deleteNext=ns,rd.domToBlock=$l.domToBlock$$module$build$src$core$xml,rd.domToBlockInternal=zo,rd.domToPrettyText=Uo,rd.domToText=Vo,rd.domToVariables=jo,rd.domToWorkspace=$l.domToWorkspace$$module$build$src$core$xml,rd.loadWorkspaceComment=Ho,rd.saveWorkspaceComment=Oo,rd.variablesToDom=Do,rd.workspaceToDom=$o;var ld=class extends Uh{constructor(e){super(e),this.type=ia.BLOCK_CREATE,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Mo(e),this.ids=oe(e),this.json=Ci(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Vo(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new ld)).xml=$l.textToDom$$module$build$src$core$utils$xml(e.xml),t.ids=e.ids,t.json=e.json,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!ad(t,this.ids))if(e)Ai(this.json,t);else for(e=0;e<this.ids.length;e++){const i=this.ids[e],n=t.getBlockById(i);n?n.dispose(!1):i===this.blockId&&console.warn("Can't uncreate non-existent block: "+i)}}},ad=function(e,t){return t.map((t=>e.getBlockById(t))).filter((e=>e&&e.isShadow())).length===t.length};e(Bl.EVENT,ia.BLOCK_CREATE,ld);var cd=class extends Ja{constructor(e,t){super(t),this.type=ia.THEME_CHANGE,this.themeName=e}toJson(){const e=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return e.themeName=this.themeName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new cd)).themeName=e.themeName,t}};e(Bl.EVENT,ia.THEME_CHANGE,cd);var hd,ud=class extends Ja{constructor(e,t,i,n,o){super(n),this.type=ia.VIEWPORT_CHANGE,this.viewTop=e,this.viewLeft=t,this.scale=i,this.oldScale=o}toJson(){const e=super.toJson();if(void 0===this.viewTop)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.viewLeft)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.scale)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.oldScale)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new ud)).viewTop=e.viewTop,t.viewLeft=e.viewLeft,t.scale=e.scale,t.oldScale=e.oldScale,t}};e(Bl.EVENT,ia.VIEWPORT_CHANGE,ud),function(e){e[e.INPUT_VALUE=1]="INPUT_VALUE",e[e.OUTPUT_VALUE=2]="OUTPUT_VALUE",e[e.NEXT_STATEMENT=3]="NEXT_STATEMENT",e[e.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"}(hd||(hd={}));var dd=class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,t){t=this.calculateIndexForYPos(t),this.connections.splice(t,0,e)}findIndexOfConnection(e,t){if(!this.connections.length)return-1;const i=this.calculateIndexForYPos(t);if(i>=this.connections.length)return-1;t=e.y;let n=i;for(;0<=n&&this.connections[n].y===t;){if(this.connections[n]===e)return n;n--}for(n=i;n<this.connections.length&&this.connections[n].y===t;){if(this.connections[n]===e)return n;n++}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let t=0,i=this.connections.length;for(;t<i;){const n=Math.floor((t+i)/2);if(this.connections[n].y<e)t=n+1;else{if(!(this.connections[n].y>e)){t=n;break}i=n}}return t}removeConnection(e,t){if(-1===(e=this.findIndexOfConnection(e,t)))throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,t){function i(e){const i=o-n[e].x,r=s-n[e].y;return Math.sqrt(i*i+r*r)<=t&&a.push(n[e]),r<t}const n=this.connections,o=e.x,s=e.y;e=0;let r=n.length-2,l=r;for(;e<l;)n[l].y<s?e=l:r=l,l=Math.floor((e+r)/2);const a=[];if(r=e=l,n.length){for(;0<=e&&i(e);)e--;do{r++}while(r<n.length&&i(r))}return a}isInYRange(e,t,i){return Math.abs(this.connections[e].y-t)<=i}searchForClosest(e,t,i){if(!this.connections.length)return{connection:null,radius:t};const n=e.y,o=e.x;e.x=o+i.x,e.y=n+i.y;var s=this.calculateIndexForYPos(e.y);i=null;let r,l=t,a=s-1;for(;0<=a&&this.isInYRange(a,e.y,t);)r=this.connections[a],this.connectionChecker.canConnect(e,r,!0,l)&&(i=r,l=r.distanceFrom(e)),a--;for(;s<this.connections.length&&this.isInYRange(s,e.y,t);)r=this.connections[s],this.connectionChecker.canConnect(e,r,!0,l)&&(i=r,l=r.distanceFrom(e)),s++;return e.x=o,e.y=n,{connection:i,radius:l}}static init(e){const t=[];return t[hd.INPUT_VALUE]=new dd(e),t[hd.OUTPUT_VALUE]=new dd(e),t[hd.NEXT_STATEMENT]=new dd(e),t[hd.PREVIOUS_STATEMENT]=new dd(e),t}},pd=class extends Ja{constructor(e,t,i){super(i),this.type=ia.SELECTED,this.oldElementId=null!=e?e:void 0,this.newElementId=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new pd)).oldElementId=e.oldElementId,t.newElementId=e.newElementId,t}};e(Bl.EVENT,ia.SELECTED,pd);var gd=class extends Uh{constructor(e){if(super(e),this.type=ia.BLOCK_DELETE,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Mo(e),this.ids=oe(e),this.wasShadow=e.isShadow(),this.oldJson=Ci(e,{addCoordinates:!0})}}toJson(){const e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(void 0===this.wasShadow)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.oldXml=Vo(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new gd)).oldXml=$l.textToDom$$module$build$src$core$utils$xml(e.oldXml),t.ids=e.ids,t.wasShadow=e.wasShadow||"shadow"===t.oldXml.tagName.toLowerCase(),t.oldJson=e.oldJson,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){const i=this.ids[e],n=t.getBlockById(i);n?n.dispose(!1):i===this.blockId&&console.warn("Can't delete non-existent block: "+i)}else Ai(this.oldJson,t)}};e(Bl.EVENT,ia.BLOCK_DELETE,gd);var md={fromJsonInternal:ls},bd={TEST_ONLY:md};bd.fromJson=$l.fromJson$$module$build$src$core$field_registry,bd.register=ss,bd.unregister=rs;var fd=class extends $u{constructor(e,t,i){super($u.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==$u.SKIP_SETUP&&(this.setOptions(e),i&&this.configure_(i),t&&this.setValidator(t))}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(fd,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=ae(ac.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&ce(this.borderRect_,"blocklyDropdownRect"),this.fieldGroup_&&(ce(this.fieldGroup_,"blocklyField"),ce(this.fieldGroup_,"blocklyDropdownField"))}shouldAddBorderRect_(){let e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!(null!=(e=this.getSourceBlock())&&e.isShadow())}createTextArrow_(){let e,t;this.arrow=ae(ac.TSPAN,{},this.textElement_),this.arrow.appendChild(document.createTextNode(null!=(e=this.getSourceBlock())&&e.RTL?fd.ARROW_CHAR+" ":" "+fd.ARROW_CHAR)),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.arrow.setAttribute("dominant-baseline","central"),null!=(t=this.getSourceBlock())&&t.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=ae(ac.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(Ra,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var t=this.getSourceBlock();if(!t)throw new Ou;this.dropdownCreate(),this.menu_&&(this.menu_.openingCoords=e&&"number"==typeof e.clientX?new lc(e.clientX,e.clientY):null,Qi(),e=this.menu_.render(qi()),ce(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(t=t.getColour(),e=this.sourceBlock_.getColourTertiary(),Zi(t,e)),tn(this,this.dropdownDispose_.bind(this)),qi().style.height=`${this.menu_.getSize().height}px`,this.menu_.focus(),this.selectedMenuItem&&this.menu_.setHighlighted(this.selectedMenuItem),this.applyColour())}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new Ou;const t=new Jc;t.setRole(Gc.LISTBOX),this.menu_=t;const i=this.getOptions(!1);this.selectedMenuItem=null;for(let o=0;o<i.length;o++){var n=i[o];if(n===fd.SEPARATOR){t.addChild(new qc);continue}const[s,r]=n;as(s)?((n=new Image(s.width,s.height)).src=s.src,n.alt=s.alt):n=s,(n=new Yc(n,r)).setRole(Gc.OPTION),n.setRightToLeft(e.RTL),n.setCheckable(!0),t.addChild(n),n.setChecked(r===this.value_),r===this.value_&&(this.selectedMenuItem=n),n.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){dn(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue())}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||(this.generatedOptions=this.menuGenerator_(),this.validateOptions(this.generatedOptions)),this.generatedOptions)}setOptions(e){Array.isArray(e)?(this.validateOptions(e),e=this.trimOptions(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],this.setValue(this.selectedOption[1])}doClassValidation_(e){return this.getOptions(!0).some((t=>t[1]===e))?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)}doValueUpdate_(e){super.doValueUpdate_(e),e=this.getOptions(!0);for(let t,i=0;t=e[i];i++)t[1]===this.value_&&(this.selectedOption=t)}applyColour(){const e=this.sourceBlock_;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.getColourTertiary()),this.menu_?this.borderRect_.setAttribute("fill",e.getColourTertiary()):this.borderRect_.setAttribute("fill","transparent")),e&&this.arrow&&(e.isShadow()?this.arrow.style.fill=e.getColourSecondary():this.arrow.style.fill=e.getColour())}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const e=this.selectedOption&&this.selectedOption[0];as(e)?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){const t=this.getSourceBlock();if(!t)throw new Ou;this.imageElement.style.display="",this.imageElement.setAttributeNS(Ra,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));const i=Number(e.height);e=Number(e.width);var n=!!this.borderRect_;const o=Math.max(n?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,i+fd.IMAGE_Y_PADDING);let s;n=n?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,s=this.svgArrow?this.positionSVGArrow(e+n,o/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):Ee(this.arrow),this.size_.width=e+s+2*n,this.size_.height=o;let r=0;t.RTL?this.imageElement.setAttribute("x",`${n+s}`):(r=e+s,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${n}`)),this.imageElement.setAttribute("y",String(o/2-i/2)),this.positionTextElement_(r+n,e+s)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement();ce(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start");var t=!!this.borderRect_;e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const i=Ee(this.getTextElement());t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let n=0;this.svgArrow&&(n=this.positionSVGArrow(i+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=i+n+2*t,this.size_.height=e,this.positionTextElement_(t,i)}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const i=this.getSourceBlock();if(!i)throw new Ou;const n=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,s=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(i.RTL?n:e+o)+","+t+")"),s+o}getText_(){if(!this.selectedOption)return null;const e=this.selectedOption[0];if(as(e))return e.alt;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement){let t,i;return null!=(i=null!=(t=e.title)?t:e.ariaLabel)?i:e.innerText}return"string"==typeof e?e:(console.warn("Can't get text for existing dropdown option. If you're using HTMLElement dropdown options in node, ensure you're using jsdom-global or similar."),null)}static fromJson(e){if(!e.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(e.options,void 0,e)}trimOptions(e){let t=!1;const i=e.map((e=>{if(e===fd.SEPARATOR)return e;const[i,n]=e;return"string"==typeof i?[io(i),n]:(t=!0,[as(i)?Object.assign({},i,{alt:io(i.alt)}):Object.assign({},i),n])}));if(t||2>e.length)return{options:i};var n=i.map((([e])=>e)),o=fn(n);e=En(n,o);const s=yn(n,o);return!e&&!s||o<=e+s?{options:i}:(o=e?n[0].substring(0,e-1):void 0,n=s?n[0].substr(1-s):void 0,{options:this.applyTrim(i,e,s),prefix:o,suffix:n})}applyTrim(e,t,i){return e.map((([e,n])=>[e.substring(t,e.length-i),n]))}validateOptions(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)||n===fd.SEPARATOR?"string"!=typeof n[1]?(t=!0,console.error(`Invalid option[${i}]: Each FieldDropdown option id must be a string. \n          Found ${n[1]} in: ${n}`)):!n[0]||"string"==typeof n[0]||as(n[0])||"undefined"!=typeof HTMLElement&&n[0]instanceof HTMLElement||(t=!0,console.error(`Invalid option[${i}]: Each FieldDropdown option must have a string \n          label, image description, or HTML element. Found ${n[0]} in: ${n}`)):(t=!0,console.error(`Invalid option[${i}]: Each FieldDropdown option must be an array or\n          the string literal 'separator'. Found: ${n}`))}if(t)throw TypeError("Found invalid FieldDropdown options.")}};fd.SEPARATOR="separator",fd.ARROW_CHAR="▾",fd.IMAGE_Y_OFFSET=5,fd.IMAGE_Y_PADDING=2*fd.IMAGE_Y_OFFSET,ss("field_dropdown",fd);var Ed,yd=class{constructor(t,i,n,o){this.name=t,this.startHats=!1,this.blockStyles=i||Object.create(null),this.categoryStyles=n||Object.create(null),this.componentStyles=o||Object.create(null),this.fontStyle=Object.create(null),e(Bl.THEME,t,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,t){this.blockStyles[e]=t}setCategoryStyle(e,t){this.categoryStyles[e]=t}getComponentStyle(e){if(!(e=this.componentStyles[e]))return null;if("string"==typeof e){const t=this.getComponentStyle(e);if(t)return t}return`${e}`}setComponentStyle(e,t){this.componentStyles[e]=t}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,t){e=e.toLowerCase();const i=new yd(e);let n=t.base;if(n){if("string"==typeof n){let e;n=null!=(e=l(Bl.THEME,n))?e:void 0}n instanceof yd&&(we(i,n),i.name=e)}return we(i.blockStyles,t.blockStyles),we(i.categoryStyles,t.categoryStyles),we(i.componentStyles,t.componentStyles),we(i.fontStyle,t.fontStyle),null!==t.startHats&&(i.startHats=t.startHats),i}},vd=new yd("classic",{colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},{colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}}),Cd=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let t=null,i=!1;var n=!1,o=!1,s=!1,r=!1,l=!1;const a=!!e.readOnly;var c;a||(t=ct(null!=(c=e.toolbox)?c:null),i=dt(t),n=void 0===(n=e.trashcan)?i:n,o=void 0===(o=e.collapse)?i:o,s=void 0===(s=e.comments)?i:s,r=void 0===(r=e.disable)?i:r,l=void 0===(l=e.sounds)||l),c=e.maxTrashcanContents,n?void 0===c&&(c=32):c=0;const h=!!e.rtl;let u=e.horizontalLayout;void 0===u&&(u=!1);var d="end"!==e.toolboxPosition;d=u?d?Ic.TOP:Ic.BOTTOM:d===h?Ic.RIGHT:Ic.LEFT;let p=e.css;void 0===p&&(p=!0);let g="https://blockly-demo.appspot.com/static/media/";e.media&&(g=e.media.endsWith("/")?e.media:e.media+"/");const m=e.oneBasedIndex,b=e.renderer||"geras",f=e.plugins||{};let E,y,v,C=e.modalInputs;void 0===C&&(C=!0),this.RTL=h,this.oneBasedIndex=void 0===m||m,this.collapse=o,this.comments=s,this.disable=r,this.readOnly=a,this.maxBlocks=e.maxBlocks||1/0,this.maxInstances=null!=(E=e.maxInstances)?E:null,this.modalInputs=C,this.pathToMedia=g,this.hasCategories=i,this.moveOptions=Cd.parseMoveOptions(e,i),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=n,this.maxTrashcanContents=c,this.hasSounds=l,this.hasCss=p,this.horizontalLayout=u,this.languageTree=t,this.gridOptions=Cd.parseGridOptions(e),this.zoomOptions=Cd.parseZoomOptions(e),this.toolboxPosition=d,this.theme=Cd.parseThemeOptions(e),this.renderer=b,this.rendererOverrides=null!=(y=e.rendererOverrides)?y:null,this.parentWorkspace=null!=(v=e.parentWorkspace)?v:null,this.plugins=f}static parseMoveOptions(e,t){const i=e.move||{},n={};return void 0===i.scrollbars&&void 0===e.scrollbars?n.scrollbars=t:"object"==typeof i.scrollbars?(n.scrollbars={horizontal:!!i.scrollbars.horizontal,vertical:!!i.scrollbars.vertical},n.scrollbars.horizontal&&n.scrollbars.vertical?n.scrollbars=!0:n.scrollbars.horizontal||n.scrollbars.vertical||(n.scrollbars=!1)):n.scrollbars=!!i.scrollbars||!!e.scrollbars,n.wheel=n.scrollbars&&void 0!==i.wheel?!!i.wheel:"object"==typeof n.scrollbars,n.drag=!(!n.scrollbars||void 0!==i.drag&&!i.drag),n}static parseZoomOptions(e){e=e.zoom||{};const t={};return t.controls=void 0!==e.controls&&!!e.controls,t.wheel=void 0!==e.wheel&&!!e.wheel,t.startScale=void 0===e.startScale?1:Number(e.startScale),t.maxScale=void 0===e.maxScale?3:Number(e.maxScale),t.minScale=void 0===e.minScale?.3:Number(e.minScale),t.scaleSpeed=void 0===e.scaleSpeed?1.2:Number(e.scaleSpeed),t.pinch=void 0===e.pinch?t.wheel||t.controls:!!e.pinch,t}static parseGridOptions(e){e=e.grid||{};const t={};return t.spacing=Number(e.spacing)||0,t.colour=e.colour||"#888",t.length=void 0===e.length?1:Number(e.length),t.snap=0<t.spacing&&!!e.snap,t}static parseThemeOptions(e){return"string"==typeof(e=e.theme||vd)?l(Bl.THEME,e):e instanceof yd?e:yd.defineTheme(e.name||"builtin"+T(),e)}},_d=class{constructor(e,t){this.bubble=e,this.workspace=t,this.startLoc=null}isMovable(){return!0}startDrag(){let e;this.startLoc=this.bubble.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1),null==(e=this.workspace.getLayerManager())||e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}drag(e){this.bubble.moveDuringDrag(e)}endDrag(){let e;this.workspace.setResizesEnabled(!0),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.bubble,Qu),this.bubble.setDragging(!1)}revertDrag(){this.startLoc&&this.bubble.moveDuringDrag(this.startLoc)}},Td=class{constructor(e,t,i,n){this.workspace=e,this.anchor=t,this.ownerRect=i,this.size=new hc(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.dragStrategy=new _d(this,this.workspace),this.id=T(),this.svgRoot=ae(ac.G,{class:"blocklyBubble"},e.getBubbleCanvas()),e=ae(ac.G,{class:"blocklyEmboss"},this.svgRoot),this.tail=ae(ac.PATH,{class:"blocklyBubbleTail"},e),this.background=ae(ac.RECT,{class:"blocklyDraggable",x:0,y:0,rx:Ed.BORDER_WIDTH,ry:Ed.BORDER_WIDTH},e),this.contentContainer=ae(ac.G,{},this.svgRoot),this.focusableElement=null!=n?n:this.svgRoot,this.focusableElement.setAttribute("id",this.id),b(this.background,"pointerdown",this,this.onMouseDown)}dispose(){pe(this.svgRoot),this.disposed=!0}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,t=!1){e.width=Math.max(e.width,Ed.MIN_SIZE),e.height=Math.max(e.height,Ed.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){let t;null==(t=this.workspace.getGesture(e))||t.handleBubbleStart(e,this),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this)}positionRelativeToAnchor(){let e=this.anchor.x;e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft,this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new cc(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft(t),n=this.getOptimalRelativeTop(t);const o={x:i,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},s={x:-this.size.width-30,y:n};n={x:e.getWidth(),y:n};var r={x:i,y:e.getHeight()};i=e.getWidth()<e.getHeight()?n:r,e=e.getWidth()<e.getHeight()?r:n,n=this.getOverlap(o,t),r=this.getOverlap(s,t);const l=this.getOverlap(i,t);t=this.getOverlap(e,t),n===(t=Math.max(n,r,l,t))?(this.relativeLeft=o.x,this.relativeTop=o.y):r===t?(this.relativeLeft=s.x,this.relativeTop=s.y):l===t?(this.relativeLeft=i.x,this.relativeTop=i.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var i=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(i+this.size.width,t.left+t.width)-Math.max(i,t.left))*(Math.min(e+this.size.height,t.top+t.height)-Math.max(e,t.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;if(this.size.width>e.width)return t;if(e=this.getWorkspaceViewRect(e),this.workspace.RTL){var i=this.anchor.x-t;i-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):i>e.right&&(t=-(e.right-this.anchor.x))}else{const n=(i=t+this.anchor.x)+this.size.width;i<e.left?t=e.left-this.anchor.x:n>e.right&&(t=e.right-this.anchor.x-this.size.width)}return t}getOptimalRelativeTop(e){let t=-this.size.height/4;if(this.size.height>e.height)return t;const i=this.anchor.y+t,n=i+this.size.height;return i<(e=this.getWorkspaceViewRect(e)).top?t=e.top-this.anchor.y:n>e.bottom&&(t=e.bottom-this.anchor.y-this.size.height),t}getWorkspaceViewRect(e){const t=e.top;let i=e.top+e.height,n=e.left;return e=e.left+e.width,i-=this.getScrollbarThickness(),this.workspace.RTL?n-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new cc(t,i,n,e)}getScrollbarThickness(){return bc.scrollbarThickness/this.workspace.scale}renderTail(){const e=[];var t=this.size.width/2,i=this.size.height/2,n=-this.relativeLeft,o=-this.relativeTop;if(t===n&&i===o)e.push("M "+t+","+i);else{o-=i,n-=t,this.workspace.RTL&&(n*=-1);var s=Math.sqrt(o*o+n*n),r=Math.acos(n/s);0>o&&(r=2*Math.PI-r);var l=r+Math.PI/2;l>2*Math.PI&&(l-=2*Math.PI);var a=Math.sin(l);const c=Math.cos(l);let h=(this.size.width+this.size.height)/Ed.TAIL_THICKNESS;h=Math.min(h,this.size.width,this.size.height)/4,n=t+(l=1-Ed.ANCHOR_RADIUS/s)*n,o=i+l*o,l=t+h*c;const u=i+h*a;t-=h*c,i-=h*a,(a=r+(a=zi(this.workspace.RTL?-Ed.TAIL_ANGLE:Ed.TAIL_ANGLE)))>2*Math.PI&&(a-=2*Math.PI),r=Math.sin(a)*s/Ed.TAIL_BEND,s=Math.cos(a)*s/Ed.TAIL_BEND,e.push("M"+l+","+u),e.push("C"+(l+s)+","+(u+r)+" "+n+","+o+" "+n+","+o),e.push("C"+n+","+o+" "+(t+s)+","+(i+r)+" "+t+","+i)}let c;e.push("z"),null==(c=this.tail)||c.setAttribute("d",e.join(" "))}bringToFront(){let e;const t=null==(e=this.svgRoot)?void 0:e.parentNode;return!(!this.svgRoot||(null==t?void 0:t.lastChild)===this.svgRoot||(null==t||t.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new lc(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){Oe(this)}unselect(){Oe(null)}getFocusableElement(){return this.focusableElement}getFocusableTree(){return this.workspace}onNodeFocus(){this.select(),this.bringToFront()}onNodeBlur(){this.unselect()}canBeFocused(){return!0}};Ed=Td,Td.BORDER_WIDTH=6,Td.DOUBLE_BORDER=2*Ed.BORDER_WIDTH,Td.MIN_SIZE=Ed.DOUBLE_BORDER,Td.TAIL_THICKNESS=1,Td.TAIL_ANGLE=20,Td.TAIL_BEND=4,Td.ANCHOR_RADIUS=8;var wd=class extends Td{constructor(e,t,i,n){let o,s;super(t,i,n),this.workspace=t,this.anchor=i,this.ownerRect=n,this.autoLayout=!0,t=new Cd(e),this.validateWorkspaceOptions(t),this.svgDialog=ae(ac.SVG,{x:Td.BORDER_WIDTH,y:Td.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new Cd(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),t.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(ac.G),this.miniWorkspace.getCanvas()),null==(e=this.miniWorkspace.getFlyout())||e.init(this.miniWorkspace),null==e||e.show(t.languageTree)),ce(this.svgRoot,"blocklyMiniWorkspaceBubble"),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this)),null==(o=this.miniWorkspace.getFlyout())||null==(s=o.getWorkspace())||s.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const e of this.miniWorkspace.getTopBlocks(!1)){const t=e.getRelativeToSurfaceXY();if(20>t.y&&e.moveBy(0,20-t.y),e.RTL){let i=-20;const n=this.miniWorkspace.getFlyout();n&&(i-=n.getWidth()),t.x>i&&e.moveBy(i-t.x,0)}else 20>t.x&&e.moveBy(20-t.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var e=this.getSize(),t=this.calculateWorkspaceSize();Math.abs(e.width-t.width)<wd.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-t.height)<wd.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${t.width}px`),this.svgDialog.setAttribute("height",`${t.height}px`),this.miniWorkspace.setCachedParentSvgSize(t.width,t.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${t.width}, 0)`),this.setSize(new hc(t.width+Td.DOUBLE_BORDER,t.height+Td.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let t=e.width+wd.MARGIN;e=e.height+wd.MARGIN;const i=this.miniWorkspace.getFlyout();if(i){const n=i.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,n.height+20),t+=i.getWidth()}return new hc(t,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());let t;if(e=null==(t=this.miniWorkspace.getFlyout())?void 0:t.getWorkspace())for(const t of e.getAllBlocks(!1))t.setStyle(t.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,t){super.moveTo(e,t),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};wd.MINIMUM_VIEW_CHANGE=10,wd.MARGIN=3*Td.DOUBLE_BORDER;var Id=class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new lc(0,0),this.workspaceLocation=new lc(0,0),this.svgRoot=null,this.tooltip=e,this.id=T()}getType(){throw Error("Icons must implement getType")}initView(e){if(!this.svgRoot){var t=this.sourceBlock;this.svgRoot=ae(ac.G,{class:"blocklyIconGroup",id:this.id}),t.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),b(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,Rn(this.svgRoot)}}dispose(){$n(this.svgRoot),pe(this.svgRoot)}getWeight(){return-1}getSize(){return new hc(0,0)}setTooltip(e){this.tooltip=null!=e?e:this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",Gi(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){let e;null==(e=this.svgRoot)||e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=lc.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}getFocusableElement(){const e=this.svgRoot;if(!e)throw Error("Attempting to focus uninitialized icon.");return e}getFocusableTree(){return this.sourceBlock.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}getSourceBlock(){return this.sourceBlock}};$l.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends Id{constructor(e,t){super(t),this.flyoutBlockTypes=e,this.sourceBlock=t,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return $l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),ae(ac.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),ae(ac.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),ae(ac.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),ce(this.svgRoot,"blocklyMutatorIcon"))}dispose(){let e;super.dispose(),null==(e=this.miniWorkspaceBubble)||e.dispose()}getWeight(){return $l.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new hc(17,17)}applyColour(){let e,t;super.applyColour(),null==(e=this.miniWorkspaceBubble)||e.setColour(this.sourceBlock.getColour()),null==(t=this.miniWorkspaceBubble)||t.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.miniWorkspaceBubble)||t.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(e){const t=this;return Rl.asyncExecutePromiseGeneratorFunction((function*(){if(t.bubbleIsVisible()!==e){if(yield Dt(),e){let e;t.miniWorkspaceBubble=new wd(t.getMiniWorkspaceConfig(),t.sourceBlock.workspace,t.getAnchorLocation(),t.getBubbleOwnerRect()),t.applyColour(),t.createRootBlock(),t.addSaveConnectionsListener(),null==(e=t.miniWorkspaceBubble)||e.addWorkspaceChangeListener(t.createMiniWorkspaceChangeListener())}else{let e;null==(e=t.miniWorkspaceBubble)||e.dispose(),t.miniWorkspaceBubble=null,t.saveConnectionsListener&&t.sourceBlock.workspace.removeChangeListener(t.saveConnectionsListener),t.saveConnectionsListener=null}J(new(re(ia.BUBBLE_OPEN))(t.sourceBlock,e,"mutator"))}}))}getBubble(){return this.miniWorkspaceBubble}getMiniWorkspaceConfig(){let e;const t={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:null!=(e=this.sourceBlock.workspace.options.rendererOverrides)?e:void 0};return this.flyoutBlockTypes.length&&(t.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map((e=>({kind:"block",type:e})))}),t}getAnchorLocation(){return lc.sum(this.workspaceLocation,new lc(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new cc(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");for(var e of(this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace()),this.rootBlock.getDescendants(!1)))e.queueRender();let t,i,n,o;this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1),e=null!=(o=null==(t=this.miniWorkspaceBubble)||null==(i=t.getWorkspace())||null==(n=i.getFlyout())?void 0:n.getWidth())?o:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+16):16,16)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{$l.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout((()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()}),0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||I(e)||x(e)&&"disabled"===e.element}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=$l.getGroup$$module$build$src$core$events$utils();e||$l.setGroup$$module$build$src$core$events$utils(!0);var t=Wh.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var i=Wh.getExtraBlockState_(this.sourceBlock);t!==i&&J(new(re(ia.BLOCK_CHANGE))(this.sourceBlock,"mutation",null,t,i)),$l.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){let e;return null==(e=this.miniWorkspaceBubble)?void 0:e.getWorkspace()}},$l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=Vh.MUTATOR,$l.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,$l.MutatorIcon$$module$build$src$core$icons$mutator_icon;var kd=Object.create(null),xd={allExtensions:kd};$l.register$$module$build$src$core$extensions("parent_tooltip_when_inline",_s);var Nd,Sd={TEST_ONLY:xd};Sd.apply=us,Sd.buildTooltipForDropdown=$l.buildTooltipForDropdown$$module$build$src$core$extensions,Sd.buildTooltipWithFieldText=$l.buildTooltipWithFieldText$$module$build$src$core$extensions,Sd.isRegistered=hs,Sd.register=$l.register$$module$build$src$core$extensions,Sd.registerMixin=$l.registerMixin$$module$build$src$core$extensions,Sd.registerMutator=$l.registerMutator$$module$build$src$core$extensions,Sd.runAfterPageLoad=vs,Sd.unregister=cs,function(e){e[e.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",e[e.MAC_ENTER=3]="MAC_ENTER",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.NUM_CENTER=12]="NUM_CENTER",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.FF_SEMICOLON=59]="FF_SEMICOLON",e[e.FF_EQUALS=61]="FF_EQUALS",e[e.FF_DASH=173]="FF_DASH",e[e.FF_HASH=163]="FF_HASH",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.AT_SIGN=64]="AT_SIGN",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META=91]="META",e[e.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUM_ZERO=96]="NUM_ZERO",e[e.NUM_ONE=97]="NUM_ONE",e[e.NUM_TWO=98]="NUM_TWO",e[e.NUM_THREE=99]="NUM_THREE",e[e.NUM_FOUR=100]="NUM_FOUR",e[e.NUM_FIVE=101]="NUM_FIVE",e[e.NUM_SIX=102]="NUM_SIX",e[e.NUM_SEVEN=103]="NUM_SEVEN",e[e.NUM_EIGHT=104]="NUM_EIGHT",e[e.NUM_NINE=105]="NUM_NINE",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_PERIOD=110]="NUM_PERIOD",e[e.NUM_DIVISION=111]="NUM_DIVISION",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUMLOCK=144]="NUMLOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",e[e.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",e[e.SEMICOLON=186]="SEMICOLON",e[e.DASH=189]="DASH",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.APOSTROPHE=192]="APOSTROPHE",e[e.TILDE=192]="TILDE",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e[e.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",e[e.BACKSLASH=220]="BACKSLASH",e[e.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",e[e.WIN_KEY=224]="WIN_KEY",e[e.MAC_FF_META=224]="MAC_FF_META",e[e.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",e[e.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",e[e.WIN_IME=229]="WIN_IME",e[e.VK_NONAME=252]="VK_NONAME",e[e.PHANTOM=255]="PHANTOM"}(Nd||(Nd={}));var Ad={};Ad.arc=As,Ad.curve=ws,Ad.line=Ns,Ad.lineOnAxis=Ss,Ad.lineTo=xs,Ad.moveBy=ks,Ad.moveTo=Is,Ad.point=Ts;var Rd={};Rd.Coordinate=lc,Rd.KeyCodes=Nd,Rd.Rect=cc,Rd.Size=hc,Rd.Svg=ac,Rd.aria=Kc,Rd.array=Za,Rd.browserEvents=ga,Rd.colour=Au,Rd.deprecation=kh,Rd.dom=Ma,Rd.extensions=Sd,Rd.idGenerator=ya,Rd.math=Hh,Rd.object=Va,Rd.parsing=Ru,Rd.string=cu,Rd.style=dc,Rd.svgMath=mc,Rd.svgPaths=Ad,Rd.toolbox=$c,Rd.userAgent=ua,Rd.xml=wc;var $d=class{constructor(e,t){this.type=t,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=e,this.id=`${e.id}_connection_${T()}`}connect_(e){const t=hd.INPUT_VALUE,i=this.getSourceBlock();var n=e.getSourceBlock();let o,s;if(e.isConnected()&&e.disconnectInternal(!1),this.isConnected()){const e=this.stashShadowState(),t=this.targetBlock();t.isShadow()?t.dispose(!1):(this.disconnectInternal(),o=t),this.applyShadowState(e)}ie()&&(s=new(re(ia.BLOCK_MOVE))(n),s.setReason(["connect"])),Rs(this,e),n.setParent(i),s&&(s.recordNew(),J(s)),o&&(e=this.type===t?o.outputConnection:o.previousConnection)&&((n=$d.getConnectionForOrphanedConnection(n,e))?e.connect(n):e.onFailedConnect(this))}dispose(){if(this.isConnected()){this.isSuperior()&&this.setShadowStateInternal();const e=this.targetBlock();e&&!e.isDeadOrDying()&&e.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===hd.INPUT_VALUE||this.type===hd.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){if(this.targetConnection===e)return!0;if(this.getConnectionChecker().canConnect(this,e,!1)){const t=$l.getGroup$$module$build$src$core$events$utils();t||$l.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),$l.setGroup$$module$build$src$core$events$utils(t)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){const{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(!t||!i)throw Error("Source connection not connected.");const n=$l.getGroup$$module$build$src$core$events$utils();let o;n||$l.setGroup$$module$build$src$core$events$utils(!0),ie()&&(o=new(re(ia.BLOCK_MOVE))(i.getSourceBlock()),o.setReason(["disconnect"]));const s=this.targetConnection;s&&(s.targetConnection=null),this.targetConnection=null,e&&i.getSourceBlock().setParent(null),o&&(o.recordNew(),J(o)),i.getSourceBlock().isShadow()||t.respawnShadow_(),$l.setGroup$$module$build$src$core$events$utils(n)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,t){return!(this.getSourceBlock().isDeadOrDying()||(t=null==(i=e.getInput(t))?void 0:i.connection,(i=this.targetBlock())&&i!==e||!t||t.targetConnection===this||(t.isConnected()&&t.disconnect(),t.connect(this),0)));var i}targetBlock(){if(this.isConnected()){let e,t;return null!=(t=null==(e=this.targetConnection)?void 0:e.getSourceBlock())?t:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?Po(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?Ci(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let e=null;const t=this.sourceBlock_.inputList;for(let i=0;i<t.length;i++)if(t[i].connection===this){e=t[i];break}return e}toString(){const e=this.sourceBlock_;if(!e)return"Orphan Connection";if(e.outputConnection===this)var t="Output Connection of ";else if(e.previousConnection===this)t="Previous Connection of ";else if(e.nextConnection===this)t="Next Connection of ";else{t=null;for(let i,n=0;i=e.inputList[n];n++)if(i.connection===this){t=i;break}if(!t)return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection";t='Input "'+t.name+'" connection on '}return t+e.toDevString()}stashShadowState(){const e=this.getShadowDom(!0),t=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:t}}applyShadowState({shadowDom:e,shadowState:t}){this.shadowDom=e,this.shadowState=t}setShadowStateInternal({shadowDom:e=null,shadowState:t=null}={}){this.shadowDom=e,this.shadowState=t,this.getSourceBlock().isDeadOrDying()||((e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())))}createShadowBlock(e){var t=this.getSourceBlock();const i=this.getShadowState(),n=this.getShadowDom();if(t.isDeadOrDying()||!i&&!n)return null;if(i)return Ri(i,t.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(n){if(t=zo(n,t.workspace),e)if(this.type===hd.INPUT_VALUE){if(!t.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(t.outputConnection))throw Error("Could not connect shadow block to connection")}else{if(this.type!==hd.NEXT_STATEMENT)throw Error("Cannot connect a shadow block to a previous/output connection");if(!t.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(t.previousConnection))throw Error("Could not connect shadow block to connection")}return t}return null}serializeShadow(e){e&&(this.shadowDom=Po(e),this.shadowState=Ci(e))}static getConnectionForOrphanedConnection(e,t){if(t.type===hd.OUTPUT_VALUE)return Os(e,t.getSourceBlock());e=e.lastConnectionInStack(!0);const i=t.getConnectionChecker();return e&&i.canConnect(t,e,!1)?e:null}};$d.CAN_CONNECT=0,$d.REASON_SELF_CONNECTION=1,$d.REASON_WRONG_TYPE=2,$d.REASON_TARGET_NULL=3,$d.REASON_CHECKS_FAILED=4,$d.REASON_DIFFERENT_WORKSPACES=5,$d.REASON_SHADOW_PARENT=6,$d.REASON_DRAG_CHECKS_FAILED=7,$d.REASON_PREVIOUS_AND_OUTPUT=8;var Od=class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=e}},Dd={};Dd.DuplicateIconType=Od,function(e){e[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"}($l.Align$$module$build$src$core$inputs$align||($l.Align$$module$build$src$core$inputs$align={})),$l.Align$$module$build$src$core$inputs$align;var Md=class extends $u{constructor(e,t,i){super($u.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==$u.SKIP_SETUP&&(i?this.configure_(i):this.class=t||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&ce(this.getTextElement(),this.class),this.fieldGroup_&&ce(this.fieldGroup_,"blocklyLabelField")}doClassValidation_(e){return null==e?null:`${e}`}setClass(e){this.textElement_&&(this.class&&ue(this.textElement_,this.class),e&&ce(this.textElement_,e)),this.class=e}static fromJson(e){return new this(io(e.text),void 0,e)}};ss("field_label",Md),Md.prototype.DEFAULT_VALUE="";var Ld=[];Ld[hd.INPUT_VALUE]=hd.OUTPUT_VALUE,Ld[hd.OUTPUT_VALUE]=hd.INPUT_VALUE,Ld[hd.NEXT_STATEMENT]=hd.PREVIOUS_STATEMENT,Ld[hd.PREVIOUS_STATEMENT]=hd.NEXT_STATEMENT;var Bd="RENAME_VARIABLE_ID",Pd="DELETE_VARIABLE_ID",Fd=class extends $d{constructor(e,t){super(e,t),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[t],this.dbOpposite=e.workspace.connectionDBList[Ld[t]],this.offsetInBlock=new lc(0,0),this.trackedState=Fd.TrackedState.WILL_TRACK}dispose(){let e,t;super.dispose(),this.trackedState===Fd.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),null==(t=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)||t.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){const t=this.x-e.x;return e=this.y-e.y,Math.sqrt(t*t+e*e)}bumpAwayFrom(e,t=!1){if(!this.sourceBlock_.workspace.isDragging()){var i=$l.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random()),n=$l.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random()),o=e.sourceBlock_.getRootBlock(),s=this.sourceBlock_.getRootBlock();if(!o.isInFlyout&&!s.isInFlyout){var r=!0;if(s.isMovable())o.isMovable()&&t&&(n=-n);else{if(!o.isMovable())return;r=!1,i=-i,n=-n}t=r?e:this,e=r?this:e,(o=r?s:o).RTL&&(i=-i),o.moveBy(t.x+i-e.x,t.y+n-e.y,["bump"])}}}moveTo(e,t){let i=!1;return this.trackedState===Fd.TrackedState.WILL_TRACK?(this.db.addConnection(this,t),this.trackedState=Fd.TrackedState.TRACKED,i=!0):this.trackedState===Fd.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,t),i=!0),this.x=e,this.y=t,i}moveBy(e,t){return this.moveTo(this.x+e,this.y+t)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,t){this.offsetInBlock.x=e,this.offsetInBlock.y=t}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection;const t=this.targetBlock();e&&t&&(e=lc.difference(this.offsetInBlock,e.offsetInBlock),t.translate(e.x,e.y))}closest(e,t){return this.dbOpposite.searchForClosest(this,e,t)}highlight(){this.highlighted=!0;const e=this.findHighlightSvg();e&&(e.style.display="")}unhighlight(){this.highlighted=!1;const e=this.findHighlightSvg();e&&(e.style.display="none")}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===Fd.TrackedState.TRACKED||!e&&this.trackedState===Fd.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=Fd.TrackedState.TRACKED):(this.trackedState===Fd.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=Fd.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const e=this.targetBlock().getDescendants(!1);for(let t=0;t<e.length;t++){const i=e[t],n=i.getConnections_(!0);for(let e=0;e<n.length;e++)n[e].setTracking(!1);for(const e of i.getIcons())Gi(e)&&e.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let e=[];if(this.type!==hd.INPUT_VALUE&&this.type!==hd.NEXT_STATEMENT)return e;const t=this.targetBlock();if(t){let i;t.isCollapsed()?(i=[],t.outputConnection&&i.push(t.outputConnection),t.nextConnection&&i.push(t.nextConnection),t.previousConnection&&i.push(t.previousConnection)):i=t.getConnections_(!0);for(let t=0;t<i.length;t++)e.push(...i[t].startTrackingAll());e.length||(e=[t])}return e}onFailedConnect(e){const t=this.getSourceBlock();if(Y()){const i=$l.getGroup$$module$build$src$core$events$utils();setTimeout(function(){t.isDisposed()||t.getParent()||($l.setGroup$$module$build$src$core$events$utils(i),this.bumpAwayFrom(e),$l.setGroup$$module$build$src$core$events$utils(!1))}.bind(this),$l.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){const{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(t&&i){var n=$l.getGroup$$module$build$src$core$events$utils();n||$l.setGroup$$module$build$src$core$events$utils(!0);var o=t.getSourceBlock(),s=i.getSourceBlock();super.disconnectInternal(e),o.queueRender(),s.updateDisabled(),s.queueRender(),s.getSvgRoot().style.display="block",$l.setGroup$$module$build$src$core$events$utils(n)}}respawnShadow_(){super.respawnShadow_();const e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var t=this.getSourceBlock();e=e.getSourceBlock(),t.updateDisabled(),e.updateDisabled(),e.queueRender(),(t=t.getInputWithBlock(e))&&(t=t.isVisible(),e.getSvgRoot().style.display=t?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return super.setCheck(e),this.sourceBlock_.queueRender(),this}showContextMenu(e){const t=Ku.registry.getContextMenuOptions({focusedNode:this},e);if(t.length){var i=this.getSourceBlock(),n=i.workspace;if(e instanceof PointerEvent)var o=new lc(e.clientX,e.clientY);else o=new lc(this.x,this.y),o=st(n,o).translate(i.RTL?-5:5,5);_o(e,t,i.RTL,n,o)}}getFocusableElement(){const e=this.findHighlightSvg();if(e)return e;throw Error("No highlight SVG found corresponding to this connection.")}getFocusableTree(){return this.getSourceBlock().workspace}onNodeFocus(){this.highlight()}onNodeBlur(){this.unhighlight()}canBeFocused(){return!0}findHighlightSvg(){return document.getElementById(this.id)}};!function(e){(e=e.TrackedState||(e.TrackedState={}))[e.WILL_TRACK=-1]="WILL_TRACK",e[e.UNTRACKED=0]="UNTRACKED",e[e.TRACKED=1]="TRACKED"}(Fd||(Fd={}));var Vd=Fd.TrackedState,Ud={};Ud.RenderedConnection=Fd,Ud.TrackedState=Vd;var Wd=class{constructor(e,t){this.name=e,this.sourceBlock=t,this.fieldRow=[],this.align=$l.Align$$module$build$src$core$inputs$align.LEFT,this.visible=!0,this.type=$l.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,t){return this.insertFieldAt(this.fieldRow.length,e,t),this}insertFieldAt(e,t,i){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return t||""===t&&i?("string"==typeof t&&(t=$l.fromJson$$module$build$src$core$field_registry({type:"field_label",text:t})),t.setSourceBlock(this.sourceBlock),this.sourceBlock.initialized&&this.initField(t),t.name=i,t.setVisible(this.isVisible()),t.prefixField&&(e=this.insertFieldAt(e,t.prefixField)),this.fieldRow.splice(e,0,t),e++,t.suffixField&&(e=this.insertFieldAt(e,t.suffixField)),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),e):e}removeField(e,t){for(let t,i=0;t=this.fieldRow[i];i++)if(t.name===e)return t.dispose(),this.fieldRow.splice(i,1),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),!0;if(t)return!1;throw Error('Field "'+e+'" not found.')}isVisible(){return this.visible}setVisible(e){let t=[];if(this.visible===e)return t;this.visible=e;for(let t,i=0;t=this.fieldRow[i];i++)t.setVisible(e);if(this.connection&&this.connection instanceof Fd){e?t=this.connection.startTrackingAll():this.connection.stopTrackingAll();const i=this.connection.targetBlock();i&&(i.getSvgRoot().style.display=e?"block":"none")}return t}markDirty(){for(let e,t=0;e=this.fieldRow[t];t++)e.markDirty()}setCheck(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){for(const e of this.fieldRow)e.init()}initModel(){for(const e of this.fieldRow)e.initModel()}initField(e){this.sourceBlock.rendered?e.init():e.initModel()}dispose(){for(let e,t=0;e=this.fieldRow[t];t++)e.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}},Hd=class extends Wd{constructor(e,t){super(e,t),this.name=e,this.type=$l.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},Gd=class extends Wd{constructor(e,t){super(e,t),this.name=e,this.type=$l.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},zd=class extends Wd{constructor(e,t){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,t),this.name=e,this.type=$l.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(hd.NEXT_STATEMENT)}};$l.ValueInput$$module$build$src$core$inputs$value_input=class extends Wd{constructor(e,t){if(!e)throw Error("Value inputs must have a non-empty name");super(e,t),this.name=e,this.type=$l.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(hd.INPUT_VALUE)}},$l.ValueInput$$module$build$src$core$inputs$value_input;var jd=class{constructor(e,t,i){if(this.data=null,this.disposed=!1,this.hue=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabledReasons=new Set,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable=this.movable=this.deletable=!0,this.collapsed_=this.shadow=!1,this.outputShape_=null,this.rendered=this.isInsertionMarker_=this.initialized=this.disposing=!1,this.onchangeWrapper=this.helpUrl=null,this.statementInputCount=0,this.workspace=e,this.id=i&&!e.getBlockById(i)?i:w(),e.setBlockById(this.id,this),this.xy=new lc(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,t){if(this.type=t,!(i=Yl[t])||"object"!=typeof i)throw TypeError("Invalid block definition for type: "+t);Object.assign(this,i)}e.addTopBlock(this),e.addTypedBlock(this),new.target===jd&&this.doInit_()}doInit_(){const e=$l.getGroup$$module$build$src$core$events$utils();e||$l.setGroup$$module$build$src$core$events$utils(!0);const t=Y();try{"function"==typeof this.init&&($l.setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),$l.setRecordUndo$$module$build$src$core$events$utils(t)),ie()&&J(new(re(ia.BLOCK_CREATE))(this))}finally{$l.setGroup$$module$build$src$core$events$utils(e),$l.setRecordUndo$$module$build$src$core$events$utils(t)}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)}dispose(e=!1){this.disposing=!0,this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.unplug(e),ie()&&J(new(re(ia.BLOCK_DELETE))(this)),this.workspace.removeTopBlock(this),this.disposeInternal()}disposeInternal(){this.disposing=!0,this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),"function"==typeof this.destroy&&this.destroy(),this.childBlocks_.forEach((e=>e.disposeInternal())),this.inputList.forEach((e=>e.dispose())),this.inputList.length=0,this.getConnections_(!0).forEach((e=>e.dispose())),this.disposed=!0}isDeadOrDying(){return this.disposing||this.disposed}initModel(){if(!this.initialized){for(const e of this.inputList)e.initModel();this.initialized=!0}}unplug(e){this.outputConnection&&this.unplugFromRow(e),this.previousConnection&&this.unplugFromStack(e)}unplugFromRow(e){let t,i=null;null!=(t=this.outputConnection)&&t.isConnected()&&(i=this.outputConnection.targetConnection,this.outputConnection.disconnect()),i&&e&&(e=this.getOnlyValueConnection())&&e.isConnected()&&!e.targetBlock().isShadow()&&(null==(e=e.targetConnection)||e.disconnect(),this.workspace.connectionChecker.canConnect(e,i,!1)?i.connect(e):null==e||e.onFailedConnect(i))}getOnlyValueConnection(){let e=null;for(let t=0;t<this.inputList.length;t++){const i=this.inputList[t].connection;if(i&&i.type===hd.INPUT_VALUE&&i.targetConnection){if(e)return null;e=i}}return e}unplugFromStack(e){let t=null;var i;if(null!=(i=this.previousConnection)&&i.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect()),i=this.getNextBlock(),e&&i&&!i.isShadow()){let i,n;null==(e=null!=(n=null==(i=this.nextConnection)?void 0:i.targetConnection)?n:null)||e.disconnect(),t&&this.workspace.connectionChecker.canConnect(t,e,!1)&&t.connect(e)}}getConnections_(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(let t,i=0;t=this.inputList[i];i++)t.connection&&e.push(t.connection);return e}lastConnectionInStack(e){let t=this.nextConnection;for(;t;){const i=t.targetBlock();if(!i||e&&i.isShadow())return t;t=i.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(e){for(let t,i=0;t=this.inputList[i];i++)if(t.connection&&t.connection.targetBlock()===e)return t;return null}getSurroundParent(){let e,t=this;do{if(e=t,t=t.getParent(),!t)return null}while(t.getNextBlock()===e);return t}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,t=this;do{e=t,t=e.parentBlock_}while(t);return e}getTopStackBlock(){let e,t=this;do{e=t.getPreviousBlock()}while(e&&e.getNextBlock()===t&&(t=e));return t}getChildren(e){if(!e)return this.childBlocks_;e=[];for(let i,n=0;i=this.inputList[n];n++)if(i.connection){var t=i.connection.targetBlock();t&&e.push(t)}return(t=this.getNextBlock())&&e.push(t),e}setParent(e){if(e!==this.parentBlock_){var t=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),i=!!t;if(i&&e&&t!==e)throw Error("Block connected to superior one that is not new parent.");if(!i&&e)throw Error("Block not connected to new parent.");if(i&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?We(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(e){const t=[this],i=this.getChildren(e);for(let n,o=0;n=i[o];o++)t.push(...n.getDescendants(e));return t}isDeletable(){return this.deletable&&!this.shadow&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnDeletable(){return this.deletable}setDeletable(e){this.deletable=e}isMovable(){return this.movable&&!this.shadow&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnMovable(){return this.movable}setMovable(e){this.movable=e}isDuplicatable(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable(Be(this,!0))}isShadow(){return this.shadow}setShadow(e){this.shadow=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnEditable(){return this.editable}setEditable(e){this.editable=e;for(const e of this.getFields())e.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(e,t){const i=this.getConnections_(!0);if(e=e.getConnections_(!0),i.length!==e.length)throw Error("Connection lists did not match in length.");for(let n=0;n<e.length;n++)if(e[n]===t)return i[n];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return Nn(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue}setColour(e){e=oo(e),this.hue=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&"function"!=typeof e)throw Error("onchange must be a function.");this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.onchange=e,this.onchangeWrapper=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper)}getField(e){if("string"!=typeof e)throw TypeError("Block.prototype.getField expects a string with the field name but received "+(void 0===e?"nothing":e+" of type "+typeof e)+" instead");for(const t of this.getFields())if(t.name===e)return t;return null}*getFields(){for(const e of this.inputList)for(const t of e.fieldRow)yield t}getVars(){const e=[];for(const t of this.getFields())t.referencesVariables()&&e.push(t.getValue());return e}getVarModels(){const e=[];for(const t of this.getFields())if(t.referencesVariables()){const i=this.workspace.getVariableById(t.getValue());i&&e.push(i)}return e}updateVarName(e){for(const t of this.getFields())t.referencesVariables()&&e.getId()===t.getValue()&&t.refreshVariableName()}renameVarById(e,t){for(const i of this.getFields())i.referencesVariables()&&e===i.getValue()&&i.setValue(t)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,t){const i=this.getField(t);if(!i)throw Error('Field "'+t+'" not found.');i.setValue(e)}setPreviousStatement(e,t){if(e)void 0===t&&(t=null),this.previousConnection||(this.previousConnection=this.makeConnection_(hd.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(t);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,t){if(e)void 0===t&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(hd.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,t){if(e)void 0===t&&(t=null),this.outputConnection||(this.outputConnection=this.makeConnection_(hd.OUTPUT_VALUE)),this.outputConnection.setCheck(t);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(J(new(re(ia.BLOCK_CHANGE))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(void 0!==this.inputsInline)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof Hd&&this.inputList[e]instanceof Hd)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof $l.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof Hd)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof Gd)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return 0===this.disabledReasons.size}setDisabledReason(e,t){e||this.workspace.options.disable||!this.hasDisabledReason(eh)||t==eh||this.setDisabledReason(!1,eh),this.disabledReasons.has(t)!==e&&(e?this.disabledReasons.add(t):this.disabledReasons.delete(t),(e=new(re(ia.BLOCK_CHANGE))(this,"disabled",null,!e,e)).setDisabledReason(t),J(e))}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(!e.isEnabled())return!0;e=e.getSurroundParent()}return!1}hasDisabledReason(e){return this.disabledReasons.has(e)}getDisabledReasons(){return this.disabledReasons}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(J(new(re(ia.BLOCK_CHANGE))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,t){t=this.toTokens(t);for(let e=2;e<t.length;e++)"("===t[e-2]&&")"===t[e]&&(t[e-2]=t[e-1],t.splice(e-1,2));let i="";return t=(t=t.reduce(((e,t)=>(e=e+("("===i||")"===t?"":" ")+t,i=t[t.length-1],e)),"")).trim()||"???",e&&t.length>e&&(t=t.substring(0,e-3)+"..."),t}toTokens(e="?"){const t=[];for(const n of this.inputList)if(n.name!=Qc){for(const e of n.fieldRow)t.push(e.getText());if(n.connection){const o=n.connection.targetBlock();if(o){var i=n.connection;let s=i.getCheck();!s&&i.targetConnection&&(s=i.targetConnection.getCheck()),(i=!!s&&(s.includes("Boolean")||s.includes("Number")))&&t.push("("),t.push(...o.toTokens(e)),i&&t.push(")")}else t.push(e)}}return t}appendValueInput(e){return this.appendInput(new $l.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new zd(e,this))}appendDummyInput(e=""){return this.appendInput(new Hd(e,this))}appendEndRowInput(e=""){return this.appendInput(new Gd(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,t){return(e=r(Bl.INPUT,e,!1))?this.appendInput(new e(t,this)):null}jsonInit(e){var t=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");for(var i=0;e["args"+i];){if(void 0===e["message"+i])throw Error(t+`args${i} must have a corresponding message (message${i}).`);i++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle(e,t):this.jsonInitColour(e,t),i=0;void 0!==e["message"+i];)this.interpolate(e["message"+i],e["args"+i]||[],e["implicitAlign"+i]||e["lastDummyAlign"+i],t),i++;if(void 0!==e.inputsInline&&($l.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),$l.enable$$module$build$src$core$events$utils()),void 0!==e.output&&this.setOutput(!0,e.output),void 0!==e.outputShape&&this.setOutputShape(e.outputShape),void 0!==e.previousStatement&&this.setPreviousStatement(!0,e.previousStatement),void 0!==e.nextStatement&&this.setNextStatement(!0,e.nextStatement),void 0!==e.tooltip&&(i=io(e.tooltip),this.setTooltip(i)),void 0!==e.enableContextMenu&&(this.contextMenu=!!e.enableContextMenu),void 0!==e.suppressPrefixSuffix&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),void 0!==e.helpUrl&&(i=io(e.helpUrl),this.setHelpUrl(i)),"string"==typeof e.extensions&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),void 0!==e.mutator&&us(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(t=0;t<e.length;t++)us(e[t],this,!1)}jsonInitColour(e,t){if("colour"in e)if(void 0===e.colour)console.warn(t+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch(i){console.warn(t+"Illegal colour value: ",e)}}}jsonInitStyle(e,t){e=e.style;try{this.setStyle(e)}catch(i){console.warn(t+"Style does not exist: ",e)}}mixin(e,t){if(void 0!==t&&"boolean"!=typeof t)throw Error("opt_disableCheck must be a boolean if provided");if(!t){t=[];for(const i in e)void 0!==this[i]&&t.push(i);if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}Object.assign(this,e)}interpolate(e,t,i,n){e=to(e),this.validateTokens(e,t.length),t=this.interpolateArguments(e,t,i),i=[];for(let o,s=0;o=t[s];s++)if(this.isInputKeyword(o.type)){if(e=this.inputFromJson(o,n)){for(let t,n=0;t=i[n];n++)e.appendField(t[0],t[1]);i.length=0}}else(e=this.fieldFromJson(o))&&i.push([e,o.name])}validateTokens(e,t){const i=[];let n=0;for(let o=0;o<e.length;o++){const s=e[o];if("number"==typeof s){if(1>s||s>t)throw Error('Block "'+this.type+'": Message index %'+s+" out of range.");if(i[s])throw Error('Block "'+this.type+'": Message index %'+s+" duplicated.");i[s]=!0,n++}}if(n!==t)throw Error('Block "'+this.type+'": Message does not reference all '+t+" arg(s).")}interpolateArguments(e,t,i){const n=[];for(let s=0;s<e.length;s++){var o=e[s];if("number"==typeof o&&(o=t[o-1]),"string"==typeof o)if("\n"===o)o={type:"input_end_row"},i&&(o.align=i);else if(!(o=this.stringToFieldJson(o)))continue;n.push(o)}return(e=n.length)&&!this.isInputKeyword(n[e-1].type)&&(e={type:"input_dummy"},i&&(e.align=i),n.push(e)),n}fieldFromJson(e){const t=$l.fromJson$$module$build$src$core$field_registry(e);return!t&&e.alt?"string"==typeof e.alt?(e=this.stringToFieldJson(e.alt))?this.fieldFromJson(e):null:this.fieldFromJson(e.alt):t}inputFromJson(e,t){var i={LEFT:$l.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:$l.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:$l.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:$l.Align$$module$build$src$core$inputs$align.CENTRE};let n;switch(e.type){case"input_value":n=this.appendValueInput(e.name);break;case"input_statement":n=this.appendStatementInput(e.name);break;case"input_dummy":n=this.appendDummyInput(e.name);break;case"input_end_row":n=this.appendEndRowInput(e.name);break;default:n=this.appendInputFromRegistry(e.type,e.name)}return n?(e.check&&n.setCheck(e.check),e.align&&(void 0===(i=i[e.align.toUpperCase()])?console.warn(t+"Illegal align value: ",e.align):n.setAlign(i)),n):null}isInputKeyword(e){return"input_value"===e||"input_statement"===e||"input_dummy"===e||"input_end_row"===e||s(Bl.INPUT,e)}stringToFieldJson(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(e,t){if(e!==t){var i=-1,n=t?-1:this.inputList.length;for(let o,s=0;o=this.inputList[s];s++)if(o.name===e){if(i=s,-1!==n)break}else if(t&&o.name===t&&(n=s,-1!==i))break;if(-1===i)throw Error('Named input "'+e+'" not found.');if(-1===n)throw Error('Reference input "'+t+'" not found.');this.moveNumberedInputBefore(i,n)}}moveNumberedInputBefore(e,t){if(e===t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");const i=this.inputList[e];this.inputList.splice(e,1),e<t&&t--,this.inputList.splice(t,0,i)}removeInput(e,t){for(let t,i=0;t=this.inputList[i];i++)if(t.name===e)return t instanceof zd&&this.statementInputCount--,t.dispose(),this.inputList.splice(i,1),!0;if(t)return!1;throw Error("Input not found: "+e)}getInput(e){for(let t,i=0;t=this.inputList[i];i++)if(t.name===e)return t;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){let e,t;return null!=(t=null==(e=this.getIcon(Vh.COMMENT))?void 0:e.getText())?t:null}setCommentText(e){var t;let i;const n=null!=(i=null==(t=this.getIcon(Vh.COMMENT))?void 0:t.getText())?i:null;if(n!==e){if(null!==e){if(!(t=this.getIcon(Vh.COMMENT))){if(!(t=r(Bl.ICON,Vh.COMMENT.toString(),!1)))throw Error("No comment icon class is registered, so a comment cannot be set");if(t=new t(this),!Ms(t))throw Error("The class registered as a comment icon does not conform to the ICommentIcon interface");t=this.addIcon(t)}$l.disable$$module$build$src$core$events$utils(),t.setText(e),$l.enable$$module$build$src$core$events$utils()}else this.removeIcon(Vh.COMMENT);J(new(re(ia.BLOCK_CHANGE))(this,"comment",null,n,e))}}setWarningText(e,t){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new Od(e);return this.icons.push(e),this.icons.sort(((e,t)=>e.getWeight()-t.getWeight())),e}removeIcon(e){if(!this.hasIcon(e))return!1;let t;return null==(t=this.getIcon(e))||t.dispose(),this.icons=this.icons.filter((t=>!t.getType().equals(e))),!0}hasIcon(e){return this.icons.some((t=>t.getType().equals(e)))}getIcon(e){return e instanceof Vh?this.icons.find((t=>t.getType().equals(e))):this.icons.find((t=>t.getType().toString()===e))}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");const n=new(re(ia.BLOCK_MOVE))(this);i&&n.setReason(i),this.xy.translate(e,t),n.recordNew(),J(n)}makeConnection_(e){return new $d(this,e)}allInputsFilled(e){if(void 0===e&&(e=!0),!e&&this.isShadow())return!1;for(let i,n=0;i=this.inputList[n];n++)if(i.connection){var t=i.connection.targetBlock();if(!t||!t.allInputsFilled(e))return!1}return!(t=this.getNextBlock())||t.allInputsFilled(e)}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}};jd.COLLAPSED_INPUT_NAME=Qc,jd.COLLAPSED_FIELD_NAME=Zc;var Xd=null,Kd=null,Yd={};Yd.connectionUiEffect=Ps,Yd.disconnectUiEffect=Fs,Yd.disconnectUiStop=Us,Yd.disposeUiEffect=Ls;var Jd=class{paste(e,t,i){if(!t.isCapacityAvailable(e.typeCounts))return null;let n;i&&(e.blockState.x=i.x,e.blockState.y=i.y),i=i||new lc(e.blockState.x||0,e.blockState.y||0),$l.disable$$module$build$src$core$events$utils();try{n=Ai(e.blockState,t),Ws(n,i)}finally{$l.enable$$module$build$src$core$events$utils()}if(!n)return n;ie()&&!n.isShadow()&&J(new(re(ia.BLOCK_CREATE))(n));const o=n;return Dt().then((()=>$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(o))),n}};Jd.TYPE="block",kt(Jd.TYPE,new Jd);var qd={};qd.BlockPaster=Jd,qd.moveBlockToNotConflict=Ws;var Qd={};Qd.bumpIntoBounds=zs,Qd.bumpIntoBoundsHandler=js,Qd.bumpTopObjectsIntoBounds=Ks;var Zd=class{constructor(e){this.block=e,this.connectionPreviewer=this.connectionCandidate=this.startLoc=this.startChildConn=this.startParentConn=null,this.dragging=!1,this.dragOffset=new lc(0,0),this.originalEventGroup="",this.workspace=e.workspace}isMovable(){if(this.block.isShadow()){let e,t;return null!=(t=null==(e=this.block.getParent())?void 0:e.isMovable())&&t}return this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.isReadOnly()&&!this.block.isInFlyout}startDrag(e){var t;this.block.isShadow()?this.startDraggingShadow(e):(this.dragging=!0,this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),this.connectionCandidate=null,this.connectionPreviewer=new(c(Bl.CONNECTION_PREVIEWER,this.workspace.options))(this.block),be(),this.workspace.setResizesEnabled(!1),Us(),e=this.shouldHealStack(e),this.shouldDisconnect(e)&&this.disconnectBlock(e),this.block.setDragging(!0),null==(t=this.workspace.getLayerManager())||t.moveToDragLayer(this.block))}shouldHealStack(e){return!!e&&(e.altKey||e.ctrlKey||e.metaKey)}startDraggingShadow(e){const t=this.block.getParent();if(!t)throw Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=lc.difference(t.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),t.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){let t,i,n;if(this.startParentConn=null!=(n=null==(t=this.block.outputConnection)?void 0:t.targetConnection)?n:null==(i=this.block.previousConnection)?void 0:i.targetConnection,e){let e;this.startChildConn=null==(e=this.block.nextConnection)?void 0:e.targetConnection}this.block.unplug(e),Fs(this.block)}fireDragStartEvent(){const e=new(re(ia.BLOCK_DRAG))(this.block,!0,this.block.getDescendants(!1));J(e)}fireDragEndEvent(){const e=new(re(ia.BLOCK_DRAG))(this.block,!1,this.block.getDescendants(!1));J(e)}fireMoveEvent(){if(!this.block.isDeadOrDying()){var e=new(re(ia.BLOCK_MOVE))(this.block);e.setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),J(e)}}drag(e){if(this.block.isShadow()){let t;null==(t=this.block.getParent())||t.drag(lc.sum(e,this.dragOffset))}else this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,lc.difference(e,this.startLoc))}updateConnectionPreview(e,t){var i=this.connectionCandidate;const n=this.getConnectionCandidate(e,t);if(n){this.connectionCandidate=t=i&&this.currCandidateIsBetter(i,t,n)?i:n;var o,{local:s,neighbour:r}=t;if(t=s.type===hd.OUTPUT_VALUE||s.type===hd.PREVIOUS_STATEMENT,i=r.isConnected()&&!(null!=(o=r.targetBlock())&&o.isInsertionMarker()),t&&i&&!this.orphanCanConnectAtEnd(e,r.targetBlock(),s.type)){let e;null==(e=this.connectionPreviewer)||e.previewReplacement(s,r,r.targetBlock())}else{var l;null==(l=this.connectionPreviewer)||l.previewConnection(s,r)}}else{let e;null==(e=this.connectionPreviewer)||e.hidePreview(),this.connectionCandidate=null}}orphanCanConnectAtEnd(e,t,i){return!!$d.getConnectionForOrphanedConnection(e,i===hd.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}currCandidateIsBetter(e,t,i){const{local:n,neighbour:o}=e;e=new lc(n.x,n.y);const s=new lc(o.x,o.y);return t=lc.distance(lc.sum(e,t),s),i.distance>t-$l.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,t){e=this.getLocalConnections(e);let i=this.getSearchRadius(),n=null;for(const o of e){const{connection:e,radius:s}=o.closest(i,t);e&&(n={local:o,neighbour:e,distance:s},i=s)}return n}getSearchRadius(){return this.connectionCandidate?$l.config$$module$build$src$core$config.connectingSnapRadius:$l.config$$module$build$src$core$config.snapRadius}getLocalConnections(e){const t=e.getConnections_(!1),i=e.lastConnectionInStack(!0);return i&&i!==e.nextConnection&&t.push(i),t}endDrag(e){if(this.block.isShadow()){let t;null==(t=this.block.getParent())||t.endDrag(e)}else{var t;if(this.originalEventGroup=$l.getGroup$$module$build$src$core$events$utils(),this.fireDragEndEvent(),this.fireMoveEvent(),fe(),Us(),null==(t=this.connectionPreviewer)||t.hidePreview(),!this.block.isDeadOrDying()&&this.dragging){let e;null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.block,qu),this.block.setDragging(!1)}this.connectionCandidate?(this.applyConnections(this.connectionCandidate),this.disposeStep()):this.block.queueRender().then((()=>this.disposeStep()))}}disposeStep(){const e=$l.getGroup$$module$build$src$core$events$utils();let t;$l.setGroup$$module$build$src$core$events$utils(this.originalEventGroup),this.block.snapToGrid(),null==(t=this.connectionPreviewer)||t.dispose(),this.workspace.setResizesEnabled(!0),$l.setGroup$$module$build$src$core$events$utils(e)}applyConnections(e){const{local:t,neighbour:i}=e;t.connect(i);const n=t.isSuperior()?i:t,o=this.block.getRootBlock();Dt().then((()=>{Ps(n.getSourceBlock()),setTimeout((()=>{o.bringToFront()}),0)}))}revertDrag(){if(this.block.isShadow()){let e;null==(e=this.block.getParent())||e.revertDrag()}else{var e,t;if(null==(e=this.connectionPreviewer)||e.hidePreview(),this.connectionCandidate=null,null==(t=this.startChildConn)||t.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case hd.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case hd.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else{let e;this.block.moveTo(this.startLoc,["drag"]),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.block,qu),zs(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block)}this.startParentConn=this.startChildConn=null,this.block.setDragging(!1),this.dragging=!1}}},ep=class extends Td{constructor(e,t,i,n){super(t,i,n),this.text=e,this.workspace=t,this.anchor=i,this.ownerRect=n,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize(),ce(this.svgRoot,"blocklyTextBubble")}getText(){return this.text}setText(e){this.text=e,pe(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,t){return t=this.createParagraph(t),e=this.createTextFragments(t,e),this.workspace.RTL&&this.rightAlignTextFragments(t.getBBox().width,e),t}createParagraph(e){return ae(ac.G,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",transform:`translate(0,${Td.BORDER_WIDTH})`,style:"direction: "+(this.workspace.RTL?"rtl":"ltr")},e)}createTextFragments(e,t){let i=1;return t.split("\n").map((t=>{const n=ae(ac.TEXT,{y:`${i}em`,x:Td.BORDER_WIDTH},e);return t=document.createTextNode(t),n.appendChild(t),i+=1,n}))}rightAlignTextFragments(e,t){for(const i of t)i.setAttribute("text-anchor","start"),i.setAttribute("x",`${e+Td.BORDER_WIDTH}`)}updateBubbleSize(){const e=this.paragraph.getBBox();this.setSize(new hc(e.width+2*Td.BORDER_WIDTH,e.height+2*Td.BORDER_WIDTH),!0)}},tp=class extends Id{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return tp.TYPE}initView(e){this.svgRoot||(super.initView(e),ae(ac.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),ae(ac.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),ae(ac.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),ce(this.svgRoot,"blocklyWarningIcon"))}dispose(){let e;super.dispose(),null==(e=this.textBubble)||e.dispose()}getWeight(){return tp.WEIGHT}getSize(){return new hc(17,17)}applyColour(){let e;super.applyColour(),null==(e=this.textBubble)||e.setColour(this.sourceBlock.getColour())}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.textBubble)||t.setAnchorLocation(this.getAnchorLocation())}addMessage(e,t){if(this.textMap.get(t)===e)return this;let i;return e?this.textMap.set(t,e):this.textMap.delete(t),null==(i=this.textBubble)||i.setText(this.getText()),this}getText(){return[...this.textMap.values()].join("\n")}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(e){const t=this;return Rl.asyncExecutePromiseGeneratorFunction((function*(){if(t.bubbleIsVisible()!==e){if(yield Dt(),e)t.textBubble=new ep(t.getText(),t.sourceBlock.workspace,t.getAnchorLocation(),t.getBubbleOwnerRect()),t.applyColour();else{let e;null==(e=t.textBubble)||e.dispose(),t.textBubble=null}J(new(re(ia.BUBBLE_OPEN))(t.sourceBlock,e,"warning"))}}))}getBubble(){return this.textBubble}getAnchorLocation(){return lc.sum(this.workspaceLocation,new lc(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new cc(e.y,e.y+e.height,e.x,e.x+e.width)}};tp.TYPE=Vh.WARNING,tp.WEIGHT=2;var ip=class extends jd{constructor(e,t,i){if(super(e,t,i),this.childlessWidth=this.width=this.height=0,this.warningTextDb=new Map,this.mutator=null,this.rendered=!0,this.visuallyDisabled=!1,this.translation="",this.dragging=!1,this.relativeCoords=new lc(0,0),this.dragStrategy=new Zd(this),!e.rendered)throw TypeError("Cannot create a rendered block in a headless workspace");this.workspace=e,this.svgGroup=ae(ac.G,{}),t&&ce(this.svgGroup,t),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup,this.style),(e=this.pathObject.svgPath).tooltip=this,Rn(e),this.svgGroup.setAttribute("data-id",this.id),e.id=T(),this.doInit_()}initSvg(){if(!this.initialized){for(var e of this.inputList)e.init();for(const e of this.getIcons())e.initView(this.createIconPointerDownListener(e)),e.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()||this.isInFlyout),(e=this.getSvgRoot())&&b(e,"pointerdown",this,this.onMouseDown),e.parentNode||this.workspace.getCanvas().appendChild(e),this.initialized=!0}}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){this.addSelect(),Oe(this)}unselect(){this.removeSelect(),Oe(null)}setParent(e){var t=this.parentBlock_;if(e!==t){be(),super.setParent(e),fe();var i=this.getSvgRoot();if(!this.workspace.isClearing&&i){var n=this.getRelativeToSurfaceXY();if(e)e.getSvgRoot().appendChild(i);else if(t){t=null==(e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?void 0:e.parentElement;const o=this.workspace.getCanvas();t===o?o.insertBefore(i,e):o.appendChild(i),this.translate(n.x,n.y)}this.applyColour()}}}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,i=0,n=this.getSvgRoot();if(n)do{const e=et(n);t+=e.x,i+=e.y,n=n.parentNode}while(n&&!e.hasLayer(n));return new lc(t,i)}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");const n=ie();let o=null;n&&(o=new(re(ia.BLOCK_MOVE))(this),i&&o.setReason(i)),e=new lc(e,t),t=this.getRelativeToSurfaceXY(),e=lc.sum(t,e),this.translate(e.x,e.y),this.updateComponentLocations(e),n&&o&&(o.recordNew(),J(o)),this.workspace.resizeContents()}translate(e,t){this.translation=`translate(${e}, ${t})`,this.relativeCoords=new lc(e,t),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,t){const i=this.getRelativeToSurfaceXY();this.moveBy(e.x-i.x,e.y-i.y,t)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){if(!this.isDeadOrDying()&&!this.getParent()&&!this.isInFlyout){var e=this.workspace.getGrid();if(null!=e&&e.shouldSnap()){var t=this.getRelativeToSurfaceXY();(e=e.alignXY(t))!==t&&this.moveTo(e,["snap"])}}}getBoundingRectangle(){return this.getBoundingRectangleWithDimensions(this.getHeightWidth())}getBoundingRectangleWithoutChildren(){return this.getBoundingRectangleWithDimensions({height:this.height,width:this.childlessWidth})}getBoundingRectangleWithDimensions(e){const t=this.getRelativeToSurfaceXY();let i,n;return this.RTL?(i=t.x-e.width,n=t.x):(i=t.x,n=t.x+e.width),new cc(t.y,t.y+e.height,i,n)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e,t=0;e=this.inputList[t];t++)e.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed())}childHasWarning(){const e=this.getChildren(!1);for(const t of e)if(t.getIcon(tp.TYPE)||t.childHasWarning())return!0;return!1}updateCollapsed(){var e=this.isCollapsed();const t=Qc,i=Zc;for(let i,n=0;i=this.inputList[n];n++)i.name!==t&&i.setVisible(!e);for(var n of this.getIcons())n.updateCollapsed();e?(ce(this.svgGroup,"blocklyCollapsed"),this.childHasWarning()&&this.setWarningText($l.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,ip.COLLAPSED_WARNING_ID),e=this.toString(30),(n=this.getField(i))?n.setValue(e):(this.getInput(t)||this.appendDummyInput(t)).appendField(new Md(e),i)):(this.updateDisabled(),this.removeInput(t),ue(this.svgGroup,"blocklyCollapsed"),this.setWarningText(null,ip.COLLAPSED_WARNING_ID))}onMouseDown(e){if(!this.workspace.isReadOnly()){var t=this.workspace.getGesture(e);t&&t.handleBlockStart(e,this)}}showHelp(){const e="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(e){return this.workspace.isReadOnly()||!this.contextMenu?null:(e=Ku.registry.getContextMenuOptions({block:this,focusedNode:this},e),this.customContextMenu&&this.customContextMenu(e),e)}calculateContextMenuLocation(e){if(e instanceof PointerEvent)return new lc(e.clientX,e.clientY);let t,i;e=st(this.workspace,this.getRelativeToSurfaceXY());const n=null==(t=this.inputList.filter((e=>e.isVisible())).flatMap((e=>e.fieldRow)).find((e=>e.isVisible())))||null==(i=t.getSvgRoot())?void 0:i.getBoundingClientRect();return new lc(this.RTL?e.x-5:e.x+5,(n&&n.height?n.y+n.height:e.y+this.height)+5)}showContextMenu(e){const t=this.generateContextMenu(e),i=this.calculateContextMenuLocation(e);t&&t.length&&(_o(e,t,this.RTL,this.workspace,i),Co(this))}updateComponentLocations(e){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(const t of this.getChildren(!1))t.updateComponentLocations(lc.sum(e,t.relativeCoords))}updateConnectionLocations(e){for(const t of this.getConnections_(!1))t.moveToOffset(e)}updateIconLocations(e){for(const t of this.getIcons())t.onLocationChange(e)}updateFieldLocations(e){for(const t of this.inputList)for(const i of t.fieldRow)i.onLocationChange(e)}addClass(e){ce(this.svgGroup,e)}removeClass(e){ue(this.svgGroup,e)}setDragging(e){(this.dragging=e)?(this.translation="",za.push(...this.getConnections_(!0)),this.addClass("blocklyDragging")):(za.length=0,this.removeClass("blocklyDragging"));for(let t=0;t<this.childBlocks_.length;t++)this.childBlocks_[t].setDragging(e)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(e){super.setEditable(e),e?ue(this.svgGroup,"blocklyNotEditable"):ce(this.svgGroup,"blocklyNotEditable"),e=this.getIcons();for(let t=0;t<e.length;t++)e[t].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup}dispose(e,t){this.disposing=!0,Ln(),xo();const i=$l.getFocusManager$$module$build$src$core$focus_manager();if(i.getFocusedNode()===this){const e=this.getParent();e?i.focusNode(e):setTimeout((()=>i.focusTree(this.workspace)),0)}t&&(this.unplug(e),Ls(this)),super.dispose(!!e),pe(this.svgGroup)}disposeInternal(){this.disposing=!0,super.disposeInternal(),$l.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode()===this&&this.workspace.cancelCurrentGesture(),[...this.warningTextDb.values()].forEach((e=>clearTimeout(e))),this.warningTextDb.clear(),this.getIcons().forEach((e=>e.dispose()))}checkAndDelete(){this.workspace.isFlyout||($l.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),$l.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:Jd.TYPE,blockState:Ci(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:Be(this,!0)}}applyColour(){var e,t;for(null==(t=(e=this.pathObject).applyColour)||t.call(e,this),e=this.getIcons(),t=0;t<e.length;t++)e[t].applyColour();for(const e of this.getFields())e.applyColour()}updateDisabled(){const e=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===e){let e;null==(e=this.getNextBlock())||e.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=e;for(const e of this.getChildren(!1))e.updateDisabled()}}setWarningText(e,t=""){if(t)this.warningTextDb.has(t)&&(clearTimeout(this.warningTextDb.get(t)),this.warningTextDb.delete(t));else{for(var i of this.warningTextDb.values())clearTimeout(i);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(t,setTimeout((()=>{this.isDeadOrDying()||(this.warningTextDb.delete(t),this.setWarningText(e,t))}),100));else if(this.isInFlyout&&(e=null),i=this.getIcon(tp.TYPE),e){let n=this.getSurroundParent(),o=null;for(;n;)n.isCollapsed()&&(o=n),n=n.getSurroundParent();o&&o.setWarningText($l.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,ip.COLLAPSED_WARNING_ID),i?i.addMessage(e,t):this.addIcon(new tp(this).addMessage(e,t))}else i&&(t?(i.addMessage("",t),i.getText()||this.removeIcon(tp.TYPE)):this.removeIcon(tp.TYPE))}setMutator(e){this.removeIcon($l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof $l.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),e}createIconPointerDownListener(e){return t=>{this.isDeadOrDying()||(t=this.workspace.getGesture(t))&&t.setStartIcon(e)}}removeIcon(e){const t=super.removeIcon(e);return e.equals($l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.queueRender(),t}setDisabledReason(e,t){const i=this.isEnabled();super.setDisabledReason(e,t),this.isEnabled()===i||this.getInheritedDisabled()||this.updateDisabled()}setDeletable(e){super.setDeletable(e),e?ue(this.svgGroup,"blocklyNotDeletable"):ce(this.svgGroup,"blocklyNotDeletable")}setHighlighted(e){this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){let t,i;super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),null==(i=(t=this.pathObject).setStyle)||i.call(t,e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){const t=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_&&ue(this.svgGroup,this.styleName_),!t)throw Error("Invalid style name: "+e);{let i,n;this.hat=t.hat,null==(n=(i=this.pathObject).setStyle)||n.call(i,t),this.colour_=t.colourPrimary,this.style=t,this.applyColour(),ce(this.svgGroup,e),this.styleName_=e}}getStyle(){return this.style}bringToFront(e=!1){const t=$l.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode();let i=this;if(!i.isDeadOrDying()){do{const t=i.getSvgRoot(),n=t.parentNode,o=n.childNodes;if(o[o.length-1]!==t&&n.appendChild(t),e)break;i=i.getParent()}while(i);t&&$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(t)}}setPreviousStatement(e,t){super.setPreviousStatement(e,t),this.queueRender()}setNextStatement(e,t){super.setNextStatement(e,t),this.queueRender()}setOutput(e,t){super.setOutput(e,t),this.queueRender()}setInputsInline(e){super.setInputsInline(e),this.queueRender()}removeInput(e,t){return e=super.removeInput(e,t),this.queueRender(),e}moveNumberedInputBefore(e,t){super.moveNumberedInputBefore(e,t),this.queueRender()}appendInput(e){return super.appendInput(e),this.queueRender(),e}setConnectionTracking(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var t=this.nextConnection.targetBlock();t&&t.setConnectionTracking(e)}if(!this.collapsed_)for(t=0;t<this.inputList.length;t++){var i=this.inputList[t].connection;i&&(i.setTracking(e),(i=i.targetBlock())&&i.setConnectionTracking(e))}}getConnections_(e){const t=[];if(this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection),e||!this.collapsed_)for(let e,i=0;e=this.inputList[i];i++)e.connection&&t.push(e.connection);return t}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,t){return super.getMatchingConnection(e,t)}makeConnection_(e){return new Fd(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){const e=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||e.isInFlyout))for(const t of this.getConnections_(!1)){if(t.isSuperior()){let e;null==(e=t.targetBlock())||e.bumpNeighbours()}for(const i of t.neighbours($l.config$$module$build$src$core$config.snapRadius))i.getSourceBlock().getRootBlock()!==e&&(t.isConnected()&&i.isConnected()||(t.isSuperior()?i.bumpAwayFrom(t,!1):t.bumpAwayFrom(i,!0)))}}scheduleSnapAndBump(){this.snapToGrid(),this.bumpNeighbours()}positionNearConnection(e,t,i){if(e.type===hd.NEXT_STATEMENT||e.type===hd.INPUT_VALUE){let n=t.x;t=t.y,n+=i.x-e.getOffsetInBlock().x,t+=i.y-e.getOffsetInBlock().y,this.moveBy(n,t)}}getChildren(e){return super.getChildren(e)}queueRender(){return Ot(this)}render(){this.queueRender(),Mt()}renderEfficiently(){be(),this.isCollapsed()&&this.updateCollapsed(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),fe()}tightenChildrenEfficiently(){for(const e of this.inputList){const t=e.connection;t&&t.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}getHeightWidth(){let e=this.height,t=this.width;var i=this.getNextBlock();if(i){i=i.getHeightWidth();const n=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=i.height-n,t=Math.max(t,i.width)}return{height:e,width:t}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,t){this.pathObject.updateShapeForInputHighlight(e,t)}getDragStrategy(){return this.dragStrategy}setDragStrategy(e){this.dragStrategy=e}isMovable(){return this.dragStrategy.isMovable()}startDrag(e){this.dragStrategy.startDrag(e)}drag(e,t){this.dragStrategy.drag(e,t)}endDrag(e){this.dragStrategy.endDrag(e)}revertDrag(){this.dragStrategy.revertDrag()}toFlyoutInfo(){const e=Object.assign({},{kind:"BLOCK"},Ci(this)),t=new Set(["id","height","width","pinned","enabled"]),i=function(e){for(const n in e)t.has(n)?delete e[n]:"object"==typeof e[n]&&i(e[n])};return i(e),[e]}jsonInit(e){super.jsonInit(e),e.classes&&this.addClass(Array.isArray(e.classes)?e.classes.join(" "):e.classes)}getFocusableElement(){return this.pathObject.svgPath}getFocusableTree(){return this.workspace}onNodeFocus(){this.select()}onNodeBlur(){this.unselect()}canBeFocused(){return!0}};ip.INLINE=-1,ip.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var np=class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}},op=class extends np{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e){return e instanceof ip?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e)):this.updateWouldDelete_(Ys(e)&&e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},sp=class{constructor(e,t){this.element=e,this.type=t}getElement(){return this.element}getType(){return this.type}},rp=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let t=0,i=0;return e&&(t=e.getWidth(),i=e.getHeight()),new hc(t,i)}getFlyoutMetrics(e){return{width:(e=this.getDimensionsPx_(this.workspace_.getFlyout(e))).width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,t=0;const i=this.getToolboxMetrics(),n=this.getFlyoutMetrics(),o=!!this.workspace_.getToolbox();var s;const r=!(null!=(s=this.workspace_.getFlyout())&&s.autoClose),l=(s=o?i.position:n.position)===Ic.TOP;return s===Ic.LEFT&&(o&&(e+=i.width),r&&(e+=n.width)),l&&(o&&(t+=i.height),r&&(t+=n.height)),{top:t,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;const t=this.getSvgMetrics(),i=this.getToolboxMetrics(),n=this.getFlyoutMetrics(),o=!!this.workspace_.getToolbox();var s;const r=!(null!=(s=this.workspace_.getFlyout())&&s.autoClose),l=(s=o?i.position:n.position)===Ic.LEFT||s===Ic.RIGHT;return s!==Ic.TOP&&s!==Ic.BOTTOM||(o&&(t.height-=i.height),r&&(t.height-=n.height)),l&&(o&&(t.width-=i.width),r&&(t.width-=n.width)),{height:t.height/e,width:t.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;const t=this.workspace_.getBlocksBoundingBox();return{height:(t.bottom-t.top)*e,width:(t.right-t.left)*e,top:t.top*e,left:t.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){if(!this.hasFixedEdges())return{};const t=this.workspace_.isMovableHorizontally(),i=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);const n={};return i||(n.top=e.top,n.bottom=e.top+e.height),t||(n.left=e.left,n.right=e.left+e.width),n}getPaddedContent_(e,t){const i=t.top+t.height,n=t.left+t.width,o=e.width,s=o/2,r=(e=e.height)/2;return{top:Math.min(t.top-r,i-e),bottom:Math.max(i+r,t.top+e),left:Math.min(t.left-s,n-o),right:Math.max(n+s,t.left+o)}}getScrollMetrics(e,t,i){e=e?this.workspace_.scale:1,t=t||this.getViewMetrics(!1);var n=i||this.getContentMetrics();i=this.getComputedFixedEdges_(t),t=this.getPaddedContent_(t,n),n=void 0!==i.top?i.top:t.top;const o=void 0!==i.left?i.left:t.left;return{top:n/e,left:o/e,width:((void 0!==i.right?i.right:t.right)-o)/e,height:((void 0!==i.bottom?i.bottom:t.bottom)-n)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const e=this.getToolboxMetrics(),t=this.getFlyoutMetrics(!0),i=this.getSvgMetrics(),n=this.getAbsoluteMetrics(),o=this.getViewMetrics(),s=this.getContentMetrics(),r=this.getScrollMetrics(!1,o,s);return{contentHeight:s.height,contentWidth:s.width,contentTop:s.top,contentLeft:s.left,scrollHeight:r.height,scrollWidth:r.width,scrollTop:r.top,scrollLeft:r.left,viewHeight:o.height,viewWidth:o.width,viewTop:o.top,viewLeft:o.left,absoluteTop:n.top,absoluteLeft:n.left,svgHeight:i.height,svgWidth:i.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:t.width,flyoutHeight:t.height}}};e(Bl.METRICS_MANAGER,Ll,rp);var lp=class extends rp{constructor(e,t){super(e),this.flyout_=t}getBoundingBox(){let e;try{e=this.workspace_.getCanvas().getBBox()}catch(t){e={height:0,y:0,width:0,x:0}}return e}getContentMetrics(e){const t=this.getBoundingBox();return e=e?1:this.workspace_.scale,{height:t.height*e,width:t.width*e,top:t.y*e,left:t.x*e}}getScrollMetrics(e,t,i){return t=i||this.getContentMetrics(),i=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(t.height+2*i)/e,width:(t.width+t.left+i)/e,top:0,left:0}}},ap=class{constructor(e,t,i,n){let o;this.workspace=e,this.targetWorkspace=t,this.isFlyoutLabel=n,this.height=this.width=0,this.cursorSvg=this.svgText=null,this.text=i.text,this.position=new lc(0,0),this.callbackKey=i.callbackKey||i.callbackkey,this.cssClass=i["web-class"]||null,this.info=i,e=this.isFlyoutLabel?"blocklyFlyoutLabel":"blocklyFlyoutButton",this.cssClass&&(e+=" "+this.cssClass),this.id=T(),this.svgGroup=ae(ac.G,{id:this.id,class:e},this.workspace.getCanvas()),this.isFlyoutLabel||(o=ae(ac.RECT,{class:"blocklyFlyoutButtonShadow",rx:ap.BORDER_RADIUS,ry:ap.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=ae(ac.RECT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:ap.BORDER_RADIUS,ry:ap.BORDER_RADIUS},this.svgGroup),t=ae(ac.TEXT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup),i=io(this.text),this.workspace.RTL&&(i+="‏"),t.textContent=i,this.isFlyoutLabel&&(this.svgText=t,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill")),n=Ke(t,"fontSize");const s=Ke(t,"fontWeight"),r=Ke(t,"fontFamily");if(this.width=ve(t,n,s,r),i=Ce(i,n,s,r),this.height=this.height||i.height,!this.isFlyoutLabel){let e,t;this.width+=2*ap.TEXT_MARGIN_X,this.height+=2*ap.TEXT_MARGIN_Y,null==(e=o)||e.setAttribute("width",String(this.width)),null==(t=o)||t.setAttribute("height",String(this.height))}e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),t.setAttribute("x",String(this.width/2)),t.setAttribute("y",String(this.height/2-i.height/2+i.baseline)),this.updateTransform(),this.onMouseDownWrapper=b(this.svgGroup,"pointerdown",this,this.onMouseDown),this.onMouseUpWrapper=b(this.svgGroup,"pointerup",this,this.onMouseUp)}createDom(){return this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,t){this.position.x=e,this.position.y=t,this.updateTransform()}moveBy(e,t,i){this.moveTo(this.position.x+e,this.position.y+t)}isLabel(){return this.isFlyoutLabel}getPosition(){return this.position}getBoundingRectangle(){return new cc(this.position.y,this.position.y+this.height,this.position.x,this.position.x+this.width)}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}getWorkspace(){return this.workspace}dispose(){E(this.onMouseDownWrapper),E(this.onMouseUpWrapper),this.svgGroup&&pe(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}setCursorSvg(e){e?this.svgGroup&&(this.svgGroup.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isFlyoutLabel&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isFlyoutLabel||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isFlyoutLabel||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}onMouseDown(e){const t=this.targetWorkspace.getGesture(e),i=this.targetWorkspace.getFlyout();t&&i&&t.handleFlyoutStart(e,i)}getSvgRoot(){return this.svgGroup}getFocusableElement(){return this.svgGroup}getFocusableTree(){return this.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}};ap.TEXT_MARGIN_X=5,ap.TEXT_MARGIN_Y=2,ap.BORDER_RADIUS=4,He("\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n");var cp=class{getFirstChild(e){return null}getParent(e){return e.getWorkspace()}getNextSibling(e){return null}getPreviousSibling(e){return null}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof ap}},hp=class{constructor(e,t){this.policy=e,this.flyout=t}getFirstChild(e){return null}getParent(e){return this.policy.getParent(e)}getNextSibling(e){const t=this.flyout.getContents();if(!t)return null;let i=t.findIndex((t=>t.getElement()===e));return-1===i?null:(i++,i>=t.length&&(i=0),t[i].getElement())}getPreviousSibling(e){const t=this.flyout.getContents();if(!t)return null;let i=t.findIndex((t=>t.getElement()===e));return-1===i?null:(i--,0>i&&(i=t.length-1),t[i].getElement())}isNavigable(e){return this.policy.isNavigable(e)}isApplicable(e){return this.policy.isApplicable(e)}},up=class{constructor(e,t){this.gap=e,this.axis=t,this.y=this.x=0}getBoundingRectangle(){switch(this.axis){case"x":return new cc(this.y,this.y,this.x,this.x+this.gap);case"y":return new cc(this.y,this.y+this.gap,this.x,this.x)}}moveBy(e,t,i){this.x+=e,this.y+=t}isNavigable(){return!1}getFocusableElement(){throw Error("Cannot be focused")}getFocusableTree(){throw Error("Cannot be focused")}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!1}},dp=class{getFirstChild(e){return null}getParent(e){return null}getNextSibling(e){return null}getPreviousSibling(e){return null}isNavigable(e){return!1}isApplicable(e){return e instanceof up}},pp=class{getFirstChild(e){return Js(e)[0]}getParent(e){var t;if(null!=(t=e.previousConnection)&&t.targetBlock()){if(t=e.getSurroundParent())return t}else{let t;if(null!=(t=e.outputConnection)&&t.targetBlock())return e.outputConnection.targetBlock()}return e.workspace}getNextSibling(e){let t,i;if(null!=(t=e.nextConnection)&&t.targetBlock()){let t;return null==(t=e.nextConnection)?void 0:t.targetBlock()}return null!=(i=e.outputConnection)&&i.targetBlock()?Qs(e,1):this.getParent(e)instanceof Cg?qs(e,1):null}getPreviousSibling(e){let t,i;if(null!=(t=e.previousConnection)&&t.targetBlock()){let t;return null==(t=e.previousConnection)?void 0:t.targetBlock()}return null!=(i=e.outputConnection)&&i.targetBlock()?Qs(e,-1):this.getParent(e)instanceof Cg?qs(e,-1):null}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof ip}},gp={};gp.BlockNavigationPolicy=pp,gp.navigateBlock=Qs,gp.navigateStacks=qs;var mp=class{getFirstChild(e){return e.getParentInput()?e.targetConnection:null}getParent(e){return e.getSourceBlock()}getNextSibling(e){if(e.getParentInput())return Qs(e,1);if(e.type===hd.NEXT_STATEMENT){const i=e.targetConnection;var t=e.getSourceBlock();if(!i&&t.getRootBlock().lastConnectionInStack(!1)===e){let i;return e=t.workspace.getTopBlocks(!0),(t=e.indexOf(t.getRootBlock())+1)>=e.length&&(t=0),t=e[t],null!=(i=this.getParentConnection(t))?i:t}return i}return e.getSourceBlock()}getPreviousSibling(e){if(e.getParentInput())return Qs(e,-1);if(e.type===hd.PREVIOUS_STATEMENT||e.type===hd.OUTPUT_VALUE){const i=e.targetConnection&&!e.targetConnection.getParentInput()?e.targetConnection:null;var t=e.getSourceBlock();if(!i&&this.getParentConnection(t.getRootBlock())===e){let i;return e=t.workspace.getTopBlocks(!0),0>(t=e.indexOf(t.getRootBlock())-1)&&(t=e.length-1),null!=(i=(t=e[t]).lastConnectionInStack(!1))?i:t}return i}return e.type===hd.NEXT_STATEMENT?e.getSourceBlock():null}getParentConnection(e){let t;return!e.outputConnection||null!=(t=e.previousConnection)&&t.isConnected()?e.previousConnection:e.outputConnection}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof Fd}},bp=class{getFirstChild(e){return null}getParent(e){return e.getSourceBlock()}getNextSibling(e){return Qs(e,1)}getPreviousSibling(e){return Qs(e,-1)}isNavigable(e){let t;return e.canBeFocused()&&e.isVisible()&&(e.isClickable()||e.isCurrentlyEditable())&&!(null!=(t=e.getSourceBlock())&&t.isSimpleReporter()&&e.isFullBlockField())&&e.getParentInput().isVisible()}isApplicable(e){return e instanceof $u}},fp=class{getFirstChild(e){return null}getParent(e){return e.getSourceBlock()}getNextSibling(e){return Qs(e,1)}getPreviousSibling(e){return Qs(e,-1)}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof Id}},Ep=class{getFirstChild(e){return(e=e.getTopBlocks(!0)).length?e[0]:null}getParent(e){return null}getNextSibling(e){return null}getPreviousSibling(e){return null}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof Cg}},yp=class{constructor(){this.rules=[new pp,new bp,new mp,new Ep,new fp]}addNavigationPolicy(e){this.rules.push(e)}get(e){return this.rules.find((t=>t.isApplicable(e)))}getFirstChild(e){let t;const i=null==(t=this.get(e))?void 0:t.getFirstChild(e);if(!i)return null;let n;return null!=(n=this.get(i))&&n.isNavigable(i)?i:this.getNextSibling(i)}getParent(e){let t;const i=null==(t=this.get(e))?void 0:t.getParent(e);if(!i)return null;let n;return null!=(n=this.get(i))&&n.isNavigable(i)?i:this.getParent(i)}getNextSibling(e){let t;const i=null==(t=this.get(e))?void 0:t.getNextSibling(e);if(!i)return null;let n;return null!=(n=this.get(i))&&n.isNavigable(i)?i:this.getNextSibling(i)}getPreviousSibling(e){let t;const i=null==(t=this.get(e))?void 0:t.getPreviousSibling(e);if(!i)return null;let n;return null!=(n=this.get(i))&&n.isNavigable(i)?i:this.getPreviousSibling(i)}},vp=class extends yp{constructor(e){super(),this.rules.push(new cp,new dp),this.rules=this.rules.map((t=>new hp(t,e)))}},Cp=class{constructor(e,t,i,n,o){this.workspace=e,this.oldHostMetrics=this.corner_=this.vScroll=this.hScroll=null,i=void 0===i||i;const s=(t=void 0===t||t)&&i;t&&(this.hScroll=new bc(e,!0,s,n,o)),i&&(this.vScroll=new bc(e,!1,s,n,o)),s&&(this.corner_=ae(ac.RECT,{height:bc.scrollbarThickness,width:bc.scrollbarThickness,class:"blocklyScrollbarBackground"}),ge(this.corner_,e.getBubbleCanvas()))}dispose(){pe(this.corner_),this.oldHostMetrics=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const e=this.workspace.getMetrics();if(e){var t=!1,i=!1;if(this.oldHostMetrics&&this.oldHostMetrics.viewWidth===e.viewWidth&&this.oldHostMetrics.viewHeight===e.viewHeight&&this.oldHostMetrics.absoluteTop===e.absoluteTop&&this.oldHostMetrics.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics&&this.oldHostMetrics.scrollWidth===e.scrollWidth&&this.oldHostMetrics.viewLeft===e.viewLeft&&this.oldHostMetrics.scrollLeft===e.scrollLeft||(t=!0),this.oldHostMetrics&&this.oldHostMetrics.scrollHeight===e.scrollHeight&&this.oldHostMetrics.viewTop===e.viewTop&&this.oldHostMetrics.scrollTop===e.scrollTop||(i=!0)):i=t=!0,t||i){try{$l.disable$$module$build$src$core$events$utils(),this.hScroll&&t&&this.hScroll.resize(e),this.vScroll&&i&&this.vScroll.resize(e)}finally{$l.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft){let e;null==(e=this.corner_)||e.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteTop!==e.absoluteTop){let e;null==(e=this.corner_)||e.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,t){this.hScroll&&this.hScroll.setOrigin(e,t),this.vScroll&&this.vScroll.setOrigin(e,t)}set(e,t,i){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(t,!1),(i||void 0===i)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},_p="sep",Tp=class{load(e,t){return e=new up(0,t.horizontalLayout?"x":"y"),new sp(e,_p)}gapForItem(e,t){let i;return null!=(i=parseInt(String(e.gap)))?i:t}disposeItem(e){}getType(){return _p}};e(Bl.FLYOUT_INFLATER,_p,Tp),{SEPARATOR_TYPE:_p}.SeparatorFlyoutInflater=Tp;var wp=class extends op{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.reflowWrapper=null,this.contents=[],this.autoClose=!0,this.visible=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,this.inflaters=new Map,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new Cg(e),this.workspace_.setMetricsManager(new lp(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.visible),this.workspace_.setNavigator(new vp(this)),this.id=w(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=ae(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=ae(ac.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new Cp(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(b(this.svgGroup_,"wheel",this,this.wheel_)),this.boundEvents.push(b(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:tc.ComponentWeight.FLYOUT_WEIGHT,capabilities:[tc.Capability.AUTOHIDEABLE,tc.Capability.DELETE_AREA,tc.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const e of this.boundEvents)E(e);this.boundEvents.length=0,this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&pe(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}getTargetWorkspace(){return this.targetWorkspace}isVisible(){return this.visible}setVisible(e){const t=e!==this.isVisible();this.visible=e,t&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay()}getContents(){return this.contents}setContents(e){this.contents=e}updateDisplay(){let e,t;e=!!this.containerVisible&&this.isVisible(),this.svgGroup_&&(this.svgGroup_.style.display=e?"block":"none"),null==(t=this.workspace_.scrollbar)||t.setContainerVisible(e)}positionAt_(e,t,i,n){let o,s;null==(o=this.svgGroup_)||o.setAttribute("width",`${e}`),null==(s=this.svgGroup_)||s.setAttribute("height",`${t}`),this.workspace_.setCachedParentSvgSize(e,t),this.svgGroup_&&me(this.svgGroup_,"translate("+i+"px,"+n+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(i,n),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))}hide(){this.isVisible()&&(this.setVisible(!1),this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null))}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),"string"==typeof e&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=ut(e),e=this.createFlyoutInfo(e),Mt(this.workspace_),this.setContents(e),this.layout_(e),this.horizontalLayout?this.height_=0:this.width_=0,this.reflow(),this.workspace_.setResizesEnabled(!0),this.reflowWrapper=e=>{e.type!==ia.BLOCK_CHANGE&&e.type!==ia.BLOCK_FIELD_INTERMEDIATE_CHANGE||this.reflow()},this.workspace_.addChangeListener(this.reflowWrapper)}createFlyoutInfo(e){const t=[],i=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const n of e)"custom"in n&&(e=this.getDynamicCategoryContents(n.custom),e=ut(e),t.push(...this.createFlyoutInfo(e))),e=n.kind.toLowerCase(),(e=this.getInflaterForType(e))&&(t.push(e.load(n,this)),(e=e.gapForItem(n,i))&&t.push(new sp(new up(e,this.horizontalLayout?"x":"y"),_p)));return this.normalizeSeparators(t)}normalizeSeparators(e){for(let t=e.length-1;0<t;t--){const i=e[t].getType().toLowerCase(),n=e[t-1].getType().toLowerCase();i===_p&&n===_p&&e.splice(t-1,1)}return e}getDynamicCategoryContents(e){if("function"!=typeof(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e)))throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}clearOldBlocks(){let e;this.getContents().forEach((e=>{let t;null==(t=this.getInflaterForType(e.getType()))||t.disposeItem(e)})),null==(e=this.workspace_.getPotentialVariableMap())||e.clear()}onMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()&&!this.getTargetWorkspace().isReadOnly()}createBlock(e){let t=null;$l.disable$$module$build$src$core$events$utils();var i=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{t=this.placeNewBlock(e)}finally{$l.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=Ei(this.targetWorkspace,i),ie()){for($l.setGroup$$module$build$src$core$events$utils(!0),i=0;i<e.length;i++){const t=e[i];J(new(re(ia.VAR_CREATE))(t))}J(new(re(ia.BLOCK_CREATE))(t))}return this.autoClose&&this.hide(),t}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return!!this.workspace_.scrollbar&&this.workspace_.scrollbar.isVisible()}placeNewBlock(e){var t=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered");const i=this.serializeBlock(e);return t.setResizesEnabled(!1),t=Ai(i,t),this.positionNewBlock(e,t),t}serializeBlock(e){return Ci(e)}positionNewBlock(e,t){const i=this.targetWorkspace;var n=i.getOriginOffsetInPixels(),o=this.workspace_.getOriginOffsetInPixels();(e=e.getRelativeToSurfaceXY()).scale(this.workspace_.scale),o=lc.sum(o,e),(n=lc.difference(o,n)).scale(1/i.scale),t.moveTo(new lc(n.x,n.y))}getInflaterForType(e){var t;return this.inflaters.has(e)?null!=(t=this.inflaters.get(e))?t:null:(t=r(Bl.FLYOUT_INFLATER,e))?(t=new t,this.inflaters.set(e,t),t):null}getFocusableElement(){throw Error("Flyouts are not directly focusable.")}getFocusableTree(){throw Error("Flyouts are not directly focusable.")}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!1}getRootFocusableNode(){throw Error("Flyouts are not directly focusable.")}getRestoredFocusableNode(e){throw Error("Flyouts are not directly focusable.")}getNestedTrees(){throw Error("Flyouts are not directly focusable.")}lookUpFocusableNode(e){throw Error("Flyouts are not directly focusable.")}onTreeFocus(e,t){}onTreeBlur(e){throw Error("Flyouts are not directly focusable.")}},Ip=class{constructor(){this.isActive=!1,this.activeClassName="blocklyKeyboardNavigation"}setIsActive(e=!0){this.isActive=e,this.updateActiveVisualization()}getIsActive(){return this.isActive}updateActiveVisualization(){this.isActive?document.body.classList.add(this.activeClassName):document.body.classList.remove(this.activeClassName)}},kp=new Ip,xp={};xp.KeyboardNavigationController=Ip,xp.keyboardNavigationController=kp;var Np=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled=this.workspace.isMovableVertically(),this.startScrollXY_=new lc(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){}endDrag(e){this.drag(e)}drag(e){if(e=lc.sum(this.startScrollXY_,e),this.horizontalScrollEnabled&&this.verticalScrollEnabled)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled)this.workspace.scroll(e.x,this.workspace.scrollY);else{if(!this.verticalScrollEnabled)throw new TypeError("Invalid state.");this.workspace.scroll(this.workspace.scrollX,e.y)}}},Sp=class{constructor(e,t){this.creatorWorkspace=t,this.mouseDownXY=new lc(0,0),this.startWorkspace_=this.targetBlock=this.startComment=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.workspaceDragger=this.dragger=null,this.dragging=!1,this.flyout=null,this.multiTouch=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new lc(0,0)}dispose(){d(),Fn(),this.creatorWorkspace.clearGesture();for(const e of this.boundEvents)E(e);this.boundEvents.length=0,this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){const t=new lc(e.clientX,e.clientY);this.updateDragDelta(t)&&(this.updateIsDragging(e),u()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=lc.difference(e,this.mouseDownXY),!this.hasExceededDragRadius&&(this.hasExceededDragRadius=lc.magnitude(this.currentDragDeltaXY)>(this.flyout?$l.config$$module$build$src$core$config.flyoutDragRadius:$l.config$$module$build$src$core$config.dragRadius))}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||null==(e=this.flyout)||!e.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error("Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined");return!(this.flyout.isScrollable()&&!this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)||(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),$l.getGroup$$module$build$src$core$events$utils()||$l.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.targetBlock),0))}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.dragging=!0,this.workspaceDragger=new Np(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(e){if(!this.startWorkspace_)throw Error("Cannot update dragging because the start workspace is undefined");if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.flyout&&this.updateIsDraggingFromFlyout();const t=Re();t&&Zs(t)&&t.isMovable()?(this.dragging=!0,this.dragger=this.createDragger(t,this.startWorkspace_),this.dragger.onDragStart(e),this.dragger.onDrag(e,this.currentDragDeltaXY)):this.updateIsDraggingWorkspace()}createDragger(e,t){return new(c(Bl.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(e,t)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,y(e)?this.cancel():(this.gestureHasStarted=!0,Us(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=Ji(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,Pn(),v(e)?this.handleRightClick(e):("pointerdown"===e.type.toLowerCase()&&"mouse"!==e.pointerType&&h(e,this),this.mouseDownXY=new lc(e.clientX,e.clientY),this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(b(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(b(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(b(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&u())}handleMove(e){this.isDragging()&&p(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),u())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!p(e))return;if(this.updateFromEvent(e),u(),this.isEnding_)return void console.log("Trying to end a gesture recursively.");this.isEnding_=!0,this.dragger?(kp.setIsActive(!1),this.dragger.onDragEnd(e,this.currentDragDeltaXY)):this.workspaceDragger?(kp.setIsActive(!1),this.workspaceDragger.endDrag(this.currentDragDeltaXY)):this.isBubbleClick()||this.isCommentClick()||(this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e))}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var t=g(e);this.cachedPoints.set(t,this.getTouchPoint(e));var i=Array.from(this.cachedPoints.keys());2===i.length&&(t=this.cachedPoints.get(i[0]),i=this.cachedPoints.get(i[1]),this.startDistance=lc.distance(t,i),this.multiTouch=!0,e.preventDefault())}handleTouchMove(e){const t=g(e);this.cachedPoints.set(t,this.getTouchPoint(e)),this.isPinchZoomEnabled&&2===this.cachedPoints.size?this.handlePinch(e):(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation())}handlePinch(e){var t=Array.from(this.cachedPoints.keys()),i=this.cachedPoints.get(t[0]);if(t=this.cachedPoints.get(t[1]),i=lc.distance(i,t)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(t=0<(t=i-this.previousScale)?5*t:6*t,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const n=this.startWorkspace_,o=C(e,n.getParentSvg(),n.getInverseScreenCTM());n.zoom(o.x,o.y,t)}this.previousScale=i,e.preventDefault()}handleTouchEnd(e){e=g(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new lc(e.pageX,e.pageY):null}isMultiTouch(){return this.multiTouch}cancel(){this.isEnding_||(u(),this.dragger?this.dragger.onDragEnd(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startComment?(this.startComment.workspace.hideChaff(),this.startComment.showContextMenu(e)):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.startWorkspace_),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),kp.setIsActive(!1),this.dispose()}handleWsStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(t),this.mostRecentEvent=e,this.startBlock||this.startBubble||this.startComment?this.startBlock&&$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.startBlock):$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(t),this.doStart(e)}fireWorkspaceClick(e){J(new(re(ia.CLICK))(null,e.id,"workspace"))}handleFlyoutStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(t),this.handleWsStart(e,t.getWorkspace())}handleBlockStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t),this.mostRecentEvent=e}handleBubbleStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t),this.mostRecentEvent=e}handleCommentStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleCommentStart, but the gesture had already been started.");this.setStartComment(t),this.mostRecentEvent=e}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.bringBlockToFront(),this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent)}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");if(this.flyout.isBlockCreatable(this.targetBlock)){$l.getGroup$$module$build$src$core$events$utils()||$l.setGroup$$module$build$src$core$events$utils(!0);var e=this.flyout.createBlock(this.targetBlock);e.snapToGrid(),e.bumpNeighbours(),$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)}}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");e=new(re(ia.CLICK))(this.startBlock,this.startWorkspace_.id,"block"),J(e)}this.bringBlockToFront(),$l.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){this.fireWorkspaceClick(this.startWorkspace_||this.creatorWorkspace)}bringBlockToFront(){this.targetBlock&&!this.flyout&&($l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.targetBlock),this.targetBlock.bringToFront())}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartComment(e){this.startComment||(this.startComment=e)}setStartBlock(e){this.startBlock||this.startBubble||(this.startBlock=e,e.isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):(this.targetBlock=e,$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(e))}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isCommentClick(){return!!this.startComment&&!this.hasExceededDragRadius}isBlockClick(){return!(!this.startBlock||this.hasExceededDragRadius||this.isFieldClick()||this.isIconClick())}isFieldClick(){return!!this.startField&&this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose))}isIconClick(){if(!this.startIcon)return!1;const e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&e}isWorkspaceClick(){return!(this.startBlock||this.startBubble||this.startField||this.hasExceededDragRadius)}getCurrentDragger(){let e,t;return null!=(t=null!=(e=this.workspaceDragger)?e:this.dragger)?t:null}isDragging(){return this.dragging}hasStarted(){return this.gestureHasStarted}static inProgress(){const e=ke();for(let t,i=0;t=e[i];i++)if(t.currentGesture_)return!0;return!1}},Ap=class{constructor(e,t){let i,n,o;this.pattern=e,this.scale=1,this.spacing=null!=(i=t.spacing)?i:0,this.length=null!=(n=t.length)?n:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling,this.snapToGrid=null!=(o=t.snap)&&o}setSpacing(e){this.spacing=e,this.update(this.scale)}getSpacing(){return this.spacing}setLength(e){this.length=e,this.update(this.scale)}getLength(){return this.length}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getPatternId(){return this.pattern.id}update(e){this.scale=e;var t=this.spacing*e;this.pattern.setAttribute("width",`${t}`),this.pattern.setAttribute("height",`${t}`);let i=(t=Math.floor(this.spacing/2)+.5)-this.length/2,n=t+this.length/2;t*=e,i*=e,n*=e,this.setLineAttributes(this.line1,e,i,n,t,t),this.setLineAttributes(this.line2,e,t,t,i,n)}setLineAttributes(e,t,i,n,o,s){e&&(e.setAttribute("stroke-width",`${t}`),e.setAttribute("x1",`${i}`),e.setAttribute("y1",`${o}`),e.setAttribute("x2",`${n}`),e.setAttribute("y2",`${s}`))}moveTo(e,t){this.pattern.setAttribute("x",`${e}`),this.pattern.setAttribute("y",`${t}`)}alignXY(e){var t=this.getSpacing();const i=t/2,n=Math.round(Math.round((e.x-i)/t)*t+i);return t=Math.round(Math.round((e.y-i)/t)*t+i),n===e.x&&t===e.y?e:new lc(n,t)}static createDom(e,t,i,n){let o,s;if(e=ae(ac.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},i),0<(null!=(o=t.length)?o:1)&&0<(null!=(s=t.spacing)?s:0)){let i;ae(ac.LINE,{stroke:t.colour},e),null!=(i=t.length)&&i&&ae(ac.LINE,{stroke:t.colour},e)}else ae(ac.LINE,{},e);return n&&n.style.setProperty("--blocklyGridPattern",`url(#${e.id})`),e}},Rp=class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e),this.animationLayer=this.createAnimationLayer(e)),e=this.createLayer(qu),ce(e,"blocklyBlockCanvas"),e=this.createLayer(Qu),ce(e,"blocklyBubbleCanvas")}createDragLayer(e){const t=ae(ac.SVG,{class:"blocklyBlockDragSurface",xmlns:Sa,"xmlns:html":Aa,"xmlns:xlink":Ra,version:"1.1"});return e.append(t),ae(ac.G,{},t)}createAnimationLayer(e){const t=ae(ac.SVG,{class:"blocklyAnimationLayer",xmlns:Sa,"xmlns:html":Aa,"xmlns:xlink":Ra,version:"1.1"});return e.append(t),ae(ac.G,{},t)}appendToAnimationLayer(e){let t;const i=null==(t=this.dragLayer)?void 0:t.getAttribute("transform");if(i){let e;null==(e=this.animationLayer)||e.setAttribute("transform",i)}let n;null==(n=this.animationLayer)||n.appendChild(e.getSvgRoot())}translateLayers(e,t){let i;e=`translate(${e.x}, ${e.y}) scale(${t})`,null==(i=this.dragLayer)||i.setAttribute("transform",e);for(const[,t]of this.layers)t.setAttribute("transform",e)}moveToDragLayer(e){let t;null==(t=this.dragLayer)||t.appendChild(e.getSvgRoot()),e.canBeFocused()&&$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)}moveOffDragLayer(e,t){this.append(e,t),e.canBeFocused()&&$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)}append(e,t){let i;if(this.layers.has(t)||this.createLayer(t),e=e.getSvgRoot(),(null==(i=this.layers.get(t))?void 0:i.lastChild)!==e){let i;null==(i=this.layers.get(t))||i.appendChild(e)}}createLayer(e){const t=this.workspace.getSvgGroup(),i=ae(ac.G,{});let n=!1;const o=[...this.layers].sort(((e,t)=>e[0]-t[0]));for(const[s,r]of o)if(e<s){t.insertBefore(i,r),n=!0;break}return n||t.appendChild(i),this.layers.set(e,i),i}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(qu)}getBubbleLayer(){return this.layers.get(Qu)}},$p=class{constructor(e){this.workspace=e,this.cursor=null,this.markers=new Map}registerMarker(e,t){this.markers.has(e)&&this.unregisterMarker(e),this.markers.set(e,t)}unregisterMarker(e){const t=this.markers.get(e);if(!t)throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.");t.dispose(),this.markers.delete(e)}getCursor(){return this.cursor}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor=e}dispose(){const e=Object.keys(this.markers);for(let t,i=0;t=e[i];i++)this.unregisterMarker(t);this.markers.clear(),this.cursor&&(this.cursor.dispose(),this.cursor=null)}};$p.LOCAL_MARKER="local_marker_1";var Op=class extends Td{constructor(e,t,i){super(e,t,i,Op.createTextArea()),this.workspace=e,this.anchor=t,this.ownerRect=i,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.locationChangeListeners=[],this.text="",this.DEFAULT_SIZE=new hc(160+Td.DOUBLE_BORDER,80+Td.DOUBLE_BORDER),this.MIN_SIZE=new hc(45+Td.DOUBLE_BORDER,20+Td.DOUBLE_BORDER),this.editable=!0,ce(this.svgRoot,"blocklyTextInputBubble"),this.textArea=this.getFocusableElement(),this.inputRoot=this.createEditor(this.contentContainer,this.textArea),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}setEditable(e){(this.editable=e)?this.textArea.removeAttribute("readonly"):this.textArea.setAttribute("readonly","")}isEditable(){return this.editable}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}addLocationChangeListener(e){this.locationChangeListeners.push(e)}static createTextArea(){const e=document.createElementNS(Aa,"textarea");return e.className="blocklyTextarea blocklyText",e}createEditor(e,t){e=ae(ac.FOREIGNOBJECT,{x:Td.BORDER_WIDTH,y:Td.BORDER_WIDTH},e);const i=document.createElementNS(Aa,"body");return i.setAttribute("xmlns",Aa),i.className="blocklyMinimalBody",t.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),i.appendChild(t),e.appendChild(i),this.bindTextAreaEvents(t),e}bindTextAreaEvents(e){b(e,"wheel",this,(e=>{e.stopPropagation()})),b(e,"change",this,this.onTextChange)}createResizeHandle(e,t){return e=ae(ac.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e),b(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);const i=e.width-Td.DOUBLE_BORDER,n=e.height-Td.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${i}`),this.inputRoot.setAttribute("height",`${n}`),this.resizeGroup.setAttribute("y",`${n}`),this.workspace.RTL?this.resizeGroup.setAttribute("x",""+-Td.DOUBLE_BORDER):this.resizeGroup.setAttribute("x",`${i}`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}moveDuringDrag(e){super.moveDuringDrag(e),this.onLocationChange()}setPositionRelativeToAnchor(e,t){super.setPositionRelativeToAnchor(e,t),this.onLocationChange()}positionByRect(e=new cc(0,0,0,0)){super.positionByRect(e),this.onLocationChange()}onResizePointerDown(e){this.bringToFront(),v(e)||(Ao(this.workspace,e,new lc(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=b(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=b(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){d(),this.resizePointerUpListener&&(E(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(E(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=Ro(this.workspace,e),this.setSize(new hc(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}onLocationChange(){for(const e of this.locationChangeListeners)e()}};He("\n.blocklyTextInputBubble .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 0;\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n");var Dp={};Dp.register=tr,Dp.unregister=ir;var Mp=class extends Id{constructor(e){super(e),this.sourceBlock=e,this.textInputBubble=null,this.text="",this.bubbleSize=new hc(160,80),this.bubbleVisiblity=!1}getType(){return Mp.TYPE}initView(e){this.svgRoot||(super.initView(e),ae(ac.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),ae(ac.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),ae(ac.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),ce(this.svgRoot,"blocklyCommentIcon"))}dispose(){let e;super.dispose(),null==(e=this.textInputBubble)||e.dispose()}getWeight(){return Mp.WEIGHT}getSize(){return new hc(17,17)}applyColour(){super.applyColour();const e=this.sourceBlock.getColour();let t;null==(t=this.textInputBubble)||t.setColour(e)}updateEditable(){const e=this,t=()=>super.updateEditable;return Rl.asyncExecutePromiseGeneratorFunction((function*(){t().call(e),e.bubbleIsVisible()&&(yield e.setBubbleVisible(!1),yield e.setBubbleVisible(!0))}))}onLocationChange(e){const t=this.workspaceLocation;let i;super.onLocationChange(e),this.bubbleLocation&&(e=lc.difference(this.workspaceLocation,t),this.bubbleLocation=lc.sum(this.bubbleLocation,e)),e=this.getAnchorLocation(),null==(i=this.textInputBubble)||i.setAnchorLocation(e)}setText(e){const t=this.text;let i;J(new(re(ia.BLOCK_CHANGE))(this.sourceBlock,"comment",null,t,e)),this.text=e,null==(i=this.textInputBubble)||i.setText(this.text)}getText(){return this.text}setBubbleSize(e){let t;this.bubbleSize=e,null==(t=this.textInputBubble)||t.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}setBubbleLocation(e){let t;this.bubbleLocation=e,null==(t=this.textInputBubble)||t.moveDuringDrag(e)}getBubbleLocation(){return this.bubbleLocation}saveState(){if(this.text){const e={text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width},t=this.getBubbleLocation();return t&&(e.x=this.sourceBlock.workspace.RTL?this.sourceBlock.workspace.getWidth()-(t.x+this.bubbleSize.width):t.x,e.y=t.y),e}return null}loadState(e){let t,i,n,o;this.text=null!=(t=e.text)?t:"",this.bubbleSize=new hc(null!=(i=e.width)?i:160,null!=(n=e.height)?n:80),this.bubbleVisiblity=null!=(o=e.pinned)&&o,this.setBubbleVisible(this.bubbleVisiblity);let s=e.x;const r=e.y;Dt().then((()=>{s&&r&&(s=this.sourceBlock.workspace.RTL?this.sourceBlock.workspace.getWidth()-(s+this.bubbleSize.width):s,this.setBubbleLocation(new lc(s,r)))}))}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var e=this.textInputBubble.getText();this.text!==e&&(J(new(re(ia.BLOCK_CHANGE))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}onBubbleLocationChange(){this.textInputBubble&&(this.bubbleLocation=this.textInputBubble.getRelativeToSurfaceXY())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){const t=this;return Rl.asyncExecutePromiseGeneratorFunction((function*(){t.bubbleVisiblity!==e&&(t.bubbleVisiblity=e,yield Dt(),!t.sourceBlock.rendered||t.sourceBlock.isInFlyout||t.sourceBlock.isInsertionMarker()||(e?(t.sourceBlock.isEditable()?t.showEditableBubble():t.showNonEditableBubble(),t.applyColour()):t.hideBubble(),J(new(re(ia.BUBBLE_OPEN))(t.sourceBlock,e,"comment"))))}))}getBubble(){return this.textInputBubble}showEditableBubble(){let e,t;this.createBubble(),null==(e=this.textInputBubble)||e.addTextChangeListener((()=>this.onTextChange())),null==(t=this.textInputBubble)||t.addSizeChangeListener((()=>this.onSizeChange()))}showNonEditableBubble(){let e;this.createBubble(),null==(e=this.textInputBubble)||e.setEditable(!1)}createBubble(){this.textInputBubble=new Op(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.bubbleLocation&&this.textInputBubble.moveDuringDrag(this.bubbleLocation),this.textInputBubble.addTextChangeListener((()=>this.onTextChange())),this.textInputBubble.addSizeChangeListener((()=>this.onSizeChange())),this.textInputBubble.addLocationChangeListener((()=>this.onBubbleLocationChange()))}hideBubble(){let e;null==(e=this.textInputBubble)||e.dispose(),this.textInputBubble=null}getAnchorLocation(){return lc.sum(this.workspaceLocation,new lc(8.5,8.5))}getBubbleOwnerRect(){return this.sourceBlock.getBoundingRectangleWithoutChildren()}};Mp.TYPE=Vh.COMMENT,Mp.WEIGHT=3,tr(Mp.TYPE,Mp);var Lp={};Lp.CommentIcon=Mp,Lp.Icon=Id,Lp.IconType=Vh,Lp.MutatorIcon=$l.MutatorIcon$$module$build$src$core$icons$mutator_icon,Lp.WarningIcon=tp,Lp.exceptions=Dd,Lp.registry=Dp,$l.Names$$module$build$src$core$names=class{constructor(e,t){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=t||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.getName():null:(console.warn("Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\nBlockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());"),null)}populateVariables(e){e=$l.allUsedVarModels$$module$build$src$core$variables(e);for(let t=0;t<e.length;t++)this.getName(e[t].getId(),$l.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,t){let i=e;t===$l.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))&&(i=e),e=i.toLowerCase();const n=t===$l.NameType$$module$build$src$core$names.VARIABLE||t===$l.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(t)||this.db.set(t,new Map);const o=this.db.get(t);return o.has(e)?n+o.get(e):(t=this.getDistinctName(i,t),o.set(e,t.substr(n.length)),t)}getUserNames(e){let t;return(e=null==(t=this.db.get(e))?void 0:t.keys())?Array.from(e):[]}getDistinctName(e,t){e=this.safeName(e);let i,n,o,s=null;for(;this.dbReverse.has(e+(null!=(i=s)?i:""))||this.reservedWords.has(e+(null!=(n=s)?n:""));)s=s?s+1:2;return e+=null!=(o=s)?o:"",this.dbReverse.add(e),(t===$l.NameType$$module$build$src$core$names.VARIABLE||t===$l.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".includes(e[0])&&(e="my_"+e)):e=$l.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,t){return e.toLowerCase()===t.toLowerCase()}},function(e){(e=e.NameType||(e.NameType={})).DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",e.VARIABLE="VARIABLE",e.PROCEDURE="PROCEDURE"}($l.Names$$module$build$src$core$names||($l.Names$$module$build$src$core$names={})),$l.NameType$$module$build$src$core$names=$l.Names$$module$build$src$core$names.NameType,$l.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=$l.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,{NameType:$l.NameType$$module$build$src$core$names}.Names=$l.Names$$module$build$src$core$names;var Bp,Pp,Fp=class extends Map{constructor(){super()}set(e,t){return this.get(e)===t||(super.set(e,t),or(t)&&t.startPublishing()),this}delete(e){const t=this.get(e);return(e=super.delete(e))?(or(t)&&t.stopPublishing(),e):e}clear(){if(this.size)for(const e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}};Bp="PROCEDURE",$l.DEFAULT_ARG$$module$build$src$core$procedures="x",(Pp={CATEGORY_NAME:Bp,DEFAULT_ARG:$l.DEFAULT_ARG$$module$build$src$core$procedures}).ObservableProcedureMap=Fp,Pp.allProcedures=sr,Pp.findLegalName=$l.findLegalName$$module$build$src$core$procedures,Pp.flyoutCategory=ur,Pp.getCallers=mr,Pp.getDefinition=$l.getDefinition$$module$build$src$core$procedures,Pp.internalFlyoutCategory=hr,Pp.isNameUsed=ar,Pp.isProcedureBlock=nr,Pp.mutateCallers=$l.mutateCallers$$module$build$src$core$procedures,Pp.mutatorOpenListener=pr,Pp.rename=$l.rename$$module$build$src$core$procedures;var Vp=new class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return 1<=(e.type&this.FIELD)}isHat(e){return 1<=(e.type&this.HAT)}isIcon(e){return 1<=(e.type&this.ICON)}isSpacer(e){return 1<=(e.type&this.SPACER)}isInRowSpacer(e){return 1<=(e.type&this.IN_ROW_SPACER)}isSpacerRow(e){return 1<=(e.type&this.BETWEEN_ROW_SPACER)}isInput(e){return 1<=(e.type&this.INPUT)}isExternalInput(e){return 1<=(e.type&this.EXTERNAL_VALUE_INPUT)}isInlineInput(e){return 1<=(e.type&this.INLINE_INPUT)}isStatementInput(e){return 1<=(e.type&this.STATEMENT_INPUT)}isPreviousConnection(e){return 1<=(e.type&this.PREVIOUS_CONNECTION)}isNextConnection(e){return 1<=(e.type&this.NEXT_CONNECTION)}isPreviousOrNextConnection(e){return this.isPreviousConnection(e)||this.isNextConnection(e)}isRoundCorner(e){return 1<=(e.type&this.LEFT_ROUND_CORNER)||1<=(e.type&this.RIGHT_ROUND_CORNER)}isLeftRoundedCorner(e){return this.isRoundCorner(e)&&1<=(e.type&this.LEFT_ROUND_CORNER)}isRightRoundedCorner(e){return this.isRoundCorner(e)&&1<=(e.type&this.RIGHT_ROUND_CORNER)}isLeftSquareCorner(e){return 1<=(e.type&this.LEFT_SQUARE_CORNER)}isRightSquareCorner(e){return 1<=(e.type&this.RIGHT_SQUARE_CORNER)}isCorner(e){return 1<=(e.type&this.CORNER)}isJaggedEdge(e){return 1<=(e.type&this.JAGGED_EDGE)}isRow(e){return 1<=(e.type&this.ROW)}isBetweenRowSpacer(e){return 1<=(e.type&this.BETWEEN_ROW_SPACER)}isTopRow(e){return 1<=(e.type&this.TOP_ROW)}isBottomRow(e){return 1<=(e.type&this.BOTTOM_ROW)}isTopOrBottomRow(e){return this.isTopRow(e)||this.isBottomRow(e)}isInputRow(e){return 1<=(e.type&this.INPUT_ROW)}},Up=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=Vp.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},Wp=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=Vp.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(Vp.isInput(t))return t}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){const t=this.elements[e];if(Vp.isInRowSpacer(t))return t}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(Vp.isInRowSpacer(t))return t}return null}},Hp=class extends Wp{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=Vp.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,i=0;for(let n=0;n<this.elements.length;n++){const o=this.elements[n];t+=o.width,Vp.isSpacer(o)||(Vp.isNextConnection(o)?i=Math.max(i,o.height):e=Math.max(e,o.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+i,this.descenderHeight=i,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},Gp=class extends Up{constructor(e,t){super(e),this.connectionModel=t,this.type|=Vp.CONNECTION,this.shape=this.constants_.shapeFor(t),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=t.isHighlighted()}},zp=class extends Gp{constructor(e,t){super(e,t.connection),this.input=t,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=Vp.INPUT,this.align=t.align,(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},jp=class extends zp{constructor(e,t){super(e,t),this.height=0,this.type|=Vp.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},Xp=class extends Up{constructor(e,t,i){super(e),this.field=t,this.parentInput=i,this.isEditable=t.EDITABLE,this.flipRtl=t.getFlipRtl(),this.type|=Vp.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},Kp=class extends Up{constructor(e){super(e),this.type|=Vp.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},Yp=class extends Up{constructor(e,t){super(e),this.icon=t,this.flipRtl=!1,this.type|=Vp.ICON,e=t.getSize(),this.height=e.height,this.width=e.width}},Jp=class extends Up{constructor(e,t){super(e),this.type=this.type|Vp.SPACER|Vp.IN_ROW_SPACER,this.width=t,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},qp=class extends zp{constructor(e,t){super(e,t),this.type|=Vp.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},Qp=class extends Wp{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=Vp.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let e=0;for(let t=0;t<this.elements.length;t++){const i=this.elements[t];this.width+=i.width,Vp.isInput(i)&&(Vp.isStatementInput(i)?e+=i.connectedBlockWidth:Vp.isExternalInput(i)&&0!==i.connectedBlockWidth&&(e+=i.connectedBlockWidth-i.connectionWidth)),Vp.isSpacer(i)||(this.height=Math.max(this.height,i.height))}this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},Zp=class extends Up{constructor(e){super(e),this.type|=Vp.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},eg=class extends Gp{constructor(e,t){super(e,t),this.type|=Vp.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},tg=class extends Gp{constructor(e,t){super(e,t),this.connectionOffsetX=0,this.type|=Vp.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},ig=class extends Gp{constructor(e,t){super(e,t),this.type|=Vp.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},ng=class extends Up{constructor(e,t){super(e),this.type=(t&&"left"!==t?Vp.RIGHT_ROUND_CORNER:Vp.LEFT_ROUND_CORNER)|Vp.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},og=class extends Wp{constructor(e,t,i){super(e),this.height=t,this.width=i,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|Vp.SPACER|Vp.BETWEEN_ROW_SPACER,this.elements=[new Jp(this.constants_,i)]}measure(){}},sg=class extends Up{constructor(e,t){super(e),this.type=(t&&"left"!==t?Vp.RIGHT_SQUARE_CORNER:Vp.LEFT_SQUARE_CORNER)|Vp.CORNER,this.width=this.height=this.constants_.NO_PADDING}},rg=class extends zp{constructor(e,t){super(e,t),this.type|=Vp.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},lg=class extends Wp{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=Vp.TOP_ROW}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,i=e.getPreviousBlock();return!!e.outputConnection||t||!!i&&i.getNextBlock()===e}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,i=0;for(let n=0;n<this.elements.length;n++){const o=this.elements[n];t+=o.width,Vp.isSpacer(o)||(Vp.isHat(o)?i=Math.max(i,o.ascenderHeight):e=Math.max(e,o.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+i,this.capline=this.ascenderHeight=i,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},ag=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=ks(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);const t=e.blockStyles;for(const e in t)this.blockStyles[e]=this.validatedBlockStyle_(t[e]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=void 0!==e.startHats?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=Ce("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){const t="auto_"+e;return this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e)),{style:this.blockStyles[t],name:t}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&e.startsWith("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){const t={};return e&&Object.assign(t,e),e=oo(t.colourPrimary||"#000"),t.colourPrimary=e.hex,t.colourSecondary=t.colourSecondary?oo(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary),t.colourTertiary=t.colourTertiary?oo(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary),t.hat=t.hat||"",t}generateSecondaryColour_(e){return Qn("#fff",e,.6)||e}generateTertiaryColour_(e){return Qn("#fff",e,.3)||e}dispose(){this.embossFilter&&pe(this.embossFilter),this.disabledPattern&&pe(this.disabledPattern),this.debugFilter&&pe(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH;return{height:e,width:t,path:Ns([Ts(t,e/4),Ts(2*-t,e/2),Ts(t,e/4)])}}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:.75*e,width:t,path:ws("c",[Ts(30,-e),Ts(70,-e),Ts(t,0)])}}makePuzzleTab(){function e(e){const n=-(e=e?-1:1);var o=i/2;const s=o+2.5,r=o+.5,l=Ts(-t,e*o);return o=Ts(t,e*o),ws("c",[Ts(0,e*s),Ts(-t,n*r),l])+ws("s",[Ts(t,2.5*n),o])}const t=this.TAB_WIDTH,i=this.TAB_HEIGHT,n=e(!0),o=e(!1);return{type:this.SHAPES.PUZZLE,width:t,height:i,pathDown:o,pathUp:n}}makeNotch(){function e(e){return Ns([Ts(e*n,i),Ts(3*e,0),Ts(e*n,-i)])}const t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,n=(t-3)/2,o=e(1),s=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:o,pathRight:s}}makeInsideCorners(){const e=this.CORNER_RADIUS;return{width:e,height:e,pathTop:As("a","0 0,0",e,Ts(-e,e)),pathBottom:As("a","0 0,0",e,Ts(e,e))}}makeOutsideCorners(){const e=this.CORNER_RADIUS,t=ks(0,e)+As("a","0 0,1",e,Ts(e,-e)),i=As("a","0 0,1",e,Ts(e,e)),n=As("a","0 0,1",e,Ts(-e,-e));return{topLeft:t,topRight:i,bottomRight:As("a","0 0,1",e,Ts(-e,e)),bottomLeft:n,rightHeight:e}}shapeFor(e){switch(e.type){case hd.INPUT_VALUE:case hd.OUTPUT_VALUE:return this.PUZZLE_TAB;case hd.PREVIOUS_STATEMENT:case hd.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,t,i,n){this.injectCSS_(t,i),this.defs=ae(ac.DEFS,{},e),e=ae(ac.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),ae(ac.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),t=ae(ac.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),ae(ac.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},t),ae(ac.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),ae(ac.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=ae(ac.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),ae(ac.RECT,{width:10,height:10,fill:"#aaa"},e),ae(ac.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter(),n&&(n.style.setProperty("--blocklyEmbossFilter",`url(#${this.embossFilterId})`),n.style.setProperty("--blocklyDisabledPattern",`url(#${this.disabledPatternId})`),n.style.setProperty("--blocklyDebugFilter",`url(#${this.debugFilterId})`))}createDebugFilter(){if(!this.debugFilter){const e=ae(ac.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),t=ae(ac.FECOMPONENTTRANSFER,{result:"outBlur"},e);ae(ac.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),ae(ac.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),ae(ac.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e}}injectCSS_(e,t){t=this.getCSS_(t),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);const i=t.join("\n");this.cssNode?this.cssNode.firstChild.textContent=i:((t=document.createElement("style")).id=e,e=document.createTextNode(i),t.appendChild(e),document.head.insertBefore(t,document.head.firstChild),this.cssNode=t)}getCSS_(e){return[`${e} .blocklyText, `,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableField>rect,`,`${e} .blocklyEditableField>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${e} .blocklyNonEditableField>text,`,`${e} .blocklyEditableField>text {`,"fill: #000;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${e} .blocklyEditableField:not(.blocklyEditing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${e} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${e} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${e} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${e} .blocklyReplaceable .blocklyPathLight,`,`${e} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},cg={};cg.ConstantProvider=ag,cg.isDynamicShape=fr,cg.isNotch=yr,cg.isPuzzleTab=Er;var hg=class{constructor(e,t){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=t,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=t.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren,this.block_.childlessWidth=this.info_.width}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const e=this.info_.topRow,t=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=ks(e.xPos,this.info_.startY);for(let e,i=0;e=t[i];i++)Vp.isLeftRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:Vp.isRightRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:Vp.isPreviousConnection(e)?this.outlinePath_+=e.shape.pathLeft:Vp.isHat(e)?this.outlinePath_+=this.constants_.START_HAT.path:Vp.isSpacer(e)&&(this.outlinePath_+=Ss("h",e.width));this.outlinePath_+=Ss("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+Ss("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){const t=e.getLastInput();this.positionExternalValueConnection_(e);const i=fr(t.shape)?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=Ss("H",t.xPos+t.width)+i+Ss("v",e.height-t.connectionHeight)}drawStatementInput_(e){var t=e.getLastInput();if(t){var i=t.xPos+t.notchOffset+t.shape.width;t=t.shape.pathRight+Ss("h",-(t.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var n=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=Ss("H",i)+t+Ss("v",n)+this.constants_.INSIDE_CORNERS.pathBottom+Ss("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}}drawRightSideRow_(e){this.outlinePath_+=Ss("V",e.yPos+e.height)}drawBottom_(){const e=this.info_.bottomRow,t=e.elements;this.positionNextConnection_();let i=0,n="";for(let o,s=t.length-1;o=t[s];s--)Vp.isNextConnection(o)?n+=o.shape.pathRight:Vp.isLeftSquareCorner(o)?n+=Ss("H",e.xPos):Vp.isLeftRoundedCorner(o)?n+=this.constants_.OUTSIDE_CORNERS.bottomLeft:Vp.isRightRoundedCorner(o)?(n+=this.constants_.OUTSIDE_CORNERS.bottomRight,i=this.constants_.OUTSIDE_CORNERS.rightHeight):Vp.isSpacer(o)&&(n+=Ss("h",-1*o.width));this.outlinePath_+=Ss("V",e.baseline-i),this.outlinePath_+=n}drawLeft_(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){const t=e.connectionOffsetY+e.height;e=fr(e.shape)?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=Ss("V",t)+e}this.outlinePath_+="z"}drawInternals_(){for(let e,t=0;e=this.info_.rows[t];t++)for(let t,i=0;t=e.elements[i];i++)Vp.isInlineInput(t)?this.drawInlineInput_(t):(Vp.isIcon(t)||Vp.isField(t))&&this.layoutField_(t)}layoutField_(e){const t=e.centerline-e.height/2;let i=e.xPos;var n="";this.info_.RTL&&(i=-(i+e.width),e.flipRtl&&(i+=e.width,n="scale(-1 1)")),Vp.isIcon(e)?((n=e.icon).setOffsetInBlock(new lc(i,t)),this.info_.isInsertionMarker&&n.hideForInsertionMarker()):((e=e.field.getSvgRoot()).setAttribute("transform","translate("+i+","+t+")"+n),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){const t=e.width,i=e.height,n=e.connectionOffsetY,o=e.connectionHeight+n;this.inlinePath_+=Is(e.xPos+e.connectionWidth,e.centerline-i/2)+Ss("v",n)+e.shape.pathDown+Ss("v",i-o)+Ss("h",t-e.connectionWidth)+Ss("v",-i)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let i=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(i*=-1),e.connectionModel.setOffsetInBlock(i,t+e.connectionOffsetY)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let i=e.xPos+e.statementEdge+t.notchOffset;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let i=e.xPos+e.width;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionPreviousConnection_(){const e=this.info_.topRow;if(e.connection){const t=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,0)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,i=t.xPos;t.connectionModel.setOffsetInBlock(this.info_.RTL?-i:i,e.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const e of this.info_.rows)for(const t of e.elements){if(!(t instanceof Gp))continue;const e=this.drawConnectionHighlightPath(t);e&&(e.style.display=t.highlighted?"":"none")}}drawConnectionHighlightPath(e){const t=e.connectionModel;e=t.type===hd.INPUT_VALUE||t.type===hd.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e);const i=t.getSourceBlock();let n,o;return null==(o=(n=i.pathObject).addConnectionHighlight)?void 0:o.call(n,t,e,t.getOffsetInBlock(),i.RTL)}getExpressionConnectionHighlightPath(e){let t="";return fr(e.shape)?t=e.shape.pathDown(e.height):Er(e.shape)&&(t=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,ks(0,-e)+Ss("v",e)+t+Ss("v",e)}getStatementConnectionHighlightPath(e){if(!yr(e.shape))throw Error("Statement connections should have notch shapes");const t=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return ks(-t,0)+Ss("h",t)+e.shape.pathLeft+Ss("h",t)}},ug=class{constructor(e,t){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=t.outputConnection?new tg(this.constants_,t.outputConnection):null,this.isInline=t.getInputsInline()&&!t.isCollapsed(),this.isCollapsed=t.isCollapsed(),this.isInsertionMarker=t.isInsertionMarker(),this.RTL=t.RTL,this.topRow=new lg(this.constants_),this.bottomRow=new Hp(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new Qp(this.constants_);this.inputRows.push(e);var t=this.block_.getIcons();for(let i,n=0;i=t[n];n++){const t=new Yp(this.constants_,i);this.isCollapsed&&!i.isShownWhenCollapsed()||e.elements.push(t)}t=void 0;for(let i,n=0;i=this.block_.inputList[n];n++)if(i.isVisible()){this.shouldStartNewRow_(i,t)&&(this.rows.push(e),e=new Qp(this.constants_),this.inputRows.push(e));for(let t,n=0;t=i.fieldRow[n];n++)e.elements.push(new Xp(this.constants_,t,i));this.addInput_(i,e),t=i}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new Zp(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection;const t=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let i=this.topRow.hasLeftSquareCorner(this.block_)?sg:ng;this.topRow.elements.push(new i(this.constants_)),t?(e=new Kp(this.constants_),this.topRow.elements.push(e)):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new ig(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof zd&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,i=this.topRow.hasRightSquareCorner(this.block_)?sg:ng,this.topRow.elements.push(new i(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof zd?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new sg(this.constants_)):this.bottomRow.elements.push(new ng(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new eg(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new sg(this.constants_,"right")):this.bottomRow.elements.push(new ng(this.constants_,"right"))}addInput_(e,t){this.isInline&&e instanceof $l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new qp(this.constants_,e)),t.hasInlineInput=!0):e instanceof zd?(t.elements.push(new rg(this.constants_,e)),t.hasStatement=!0):e instanceof $l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new jp(this.constants_,e)),t.hasExternalInput=!0):(e instanceof Hd||e instanceof Gd)&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),null===t.align&&(t.align=e.align)}shouldStartNewRow_(e,t){return!!t&&(t instanceof Gd||e instanceof zd||t instanceof zd||(e instanceof $l.ValueInput$$module$build$src$core$inputs$value_input||e instanceof Hd||t instanceof $l.ValueInput$$module$build$src$core$inputs$value_input)&&!this.isInline)}addElemSpacing_(){for(let e,t=0;e=this.rows[t];t++){const t=e.elements;if(e.elements=[],e.startsWithElemSpacer()&&e.elements.push(new Jp(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let i=0;i<t.length-1;i++){e.elements.push(t[i]);const n=this.getInRowSpacing_(t[i],t[i+1]);e.elements.push(new Jp(this.constants_,n))}e.elements.push(t[t.length-1]),e.endsWithElemSpacer()&&e.elements.push(new Jp(this.constants_,this.getInRowSpacing_(t[t.length-1],null)))}}}getInRowSpacing_(e,t){if(!e&&t&&Vp.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&Vp.isInput(e)&&!t){if(Vp.isExternalInput(e))return this.constants_.NO_PADDING;if(Vp.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Vp.isStatementInput(e))return this.constants_.NO_PADDING}return e&&Vp.isLeftSquareCorner(e)&&t&&(Vp.isPreviousConnection(t)||Vp.isNextConnection(t))?t.notchOffset:e&&Vp.isLeftRoundedCorner(e)&&t&&(Vp.isPreviousConnection(t)||Vp.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&Vp.isField(e)&&0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING}computeBounds_(){let e=0,t=0,i=0;for(let o,s=0;o=this.rows[s];s++){if(o.measure(),t=Math.max(t,o.width),o.hasStatement){var n=o.getLastInput();let t,i;n=o.width-(null!=(i=null==(t=n)?void 0:t.width)?i:0),e=Math.max(e,n)}i=Math.max(i,o.widthWithConnectedBlocks)}this.statementEdge=e,this.width=t;for(let e,t=0;e=this.rows[t];t++)e.hasStatement&&(e.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(t,i),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let t,i=0;t=this.rows[i];i++)if(t.hasStatement)this.alignStatementRow_(t);else{var e=t.width;0<(e=this.getDesiredRowWidth_(t)-e)&&this.addAlignmentPadding_(t,e),Vp.isTopOrBottomRow(t)&&(t.widthWithConnectedBlocks=t.width)}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,t){const i=e.getFirstSpacer(),n=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=t),e.align===$l.Align$$module$build$src$core$inputs$align.LEFT&&n)n.width+=t;else if(e.align===$l.Align$$module$build$src$core$inputs$align.CENTRE&&i&&n)i.width+=t/2,n.width+=t/2;else if(e.align===$l.Align$$module$build$src$core$inputs$align.RIGHT&&i)i.width+=t;else{if(!n)return;n.width+=t}e.width+=t}alignStatementRow_(e){const t=e.getLastInput();if(t){var i=e.width-t.width,n=this.statementEdge;0<(i=n-i)&&this.addAlignmentPadding_(e,i),i=e.width,n=this.getDesiredRowWidth_(e),t.width+=n-i,t.height=Math.max(t.height,e.height),e.width+=n-i,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)}}addRowSpacing_(){const e=this.rows;this.rows=[];for(let t=0;t<e.length;t++)this.rows.push(e[t]),t!==e.length-1&&this.rows.push(this.makeSpacerRow_(e[t],e[t+1]))}makeSpacerRow_(e,t){var i=this.getSpacerRowHeight_(e,t);const n=this.getSpacerRowWidth_(e,t);return i=new og(this.constants_,i,n),e.hasStatement&&(i.followsStatement=!0),t.hasStatement&&(i.precedesStatement=!0),i}getSpacerRowWidth_(e,t){return this.width-this.startX}getSpacerRowHeight_(e,t){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){return Vp.isSpacer(t)?e.yPos+t.height/2:Vp.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,Vp.isNextConnection(t)?e+t.height/2:e-t.height/2):Vp.isTopRow(e)?Vp.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2}recordElemPositions_(e){let t=e.xPos;for(let i,n=0;i=e.elements[n];n++)Vp.isSpacer(i)&&(i.height=e.height),i.xPos=t,i.centerline=this.getElemCenterline_(e,i),t+=i.width}finalize_(){let e=0,t=0;for(let i,n=0;i=this.rows[n];n++)i.yPos=t,i.xPos=this.startX,t+=i.height,e=Math.max(e,i.widthWithConnectedBlocks),this.recordElemPositions_(i);if(this.outputConnection&&this.block_.nextConnection){const t=this.block_.nextConnection.targetBlock();t&&(e=Math.max(e,t.getHeightWidth().width))}this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline,this.bottomRow.baseline=t-this.bottomRow.descenderHeight}getMeasureableForConnection(e){let t;if((null==(t=this.outputConnection)?void 0:t.connectionModel)===e)return this.outputConnection;for(const t of this.rows)for(const i of t.elements)if(i instanceof Gp&&i.connectionModel===e)return i;return null}},dg=class{constructor(e,t,i){this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=i,this.style=t,this.svgRoot=e,this.svgPath=ae(ac.PATH,{class:"blocklyPath"},this.svgRoot),this.setClass_("blocklyBlock",!0)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,t){e&&(t?ce(this.svgRoot,e):ue(this.svgRoot,e))}updateHighlighted(e){e?this.setClass_("blocklyHighlighted",!0):this.setClass_("blocklyHighlighted",!1)}updateShadow_(e){e?(this.setClass_("blocklyShadow",!0),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)):this.setClass_("blocklyShadow",!1)}updateDisabled_(e){this.setClass_("blocklyDisabled",e),this.setClass_("blocklyDisabledPattern",e)}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){}addConnectionHighlight(e,t,i,n){return i=`translate(${i.x}, ${i.y})`+(n?" scale(-1 1)":""),(n=this.connectionHighlights.get(e))?(n.setAttribute("d",t),n.setAttribute("transform",i),n):(t=ae(ac.PATH,{id:e.id,class:"blocklyHighlightedConnectionPath",style:"display: none;",d:t,transform:i},this.svgRoot),this.connectionHighlights.set(e,t),t)}removeConnectionHighlight(e){const t=this.connectionHighlights.get(e);t&&(pe(t),this.connectionHighlights.delete(e))}},pg=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,t){this.constants_=this.makeConstants_(),t&&(this.overrides=t,Object.assign(this.constants_,t)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,t,i){this.constants_.createDom(e,this.name+"-"+t.name,"."+this.getClassName()+"."+t.getClassName(),i)}refreshDom(e,t,i){const n=this.getConstants();n.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=n.randomIdentifier,this.constants_.setTheme(t),this.constants_.init(),this.createDom(e,t,i)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new ag}makeRenderInfo_(e){return new ug(this,e)}makeDrawer_(e,t){return new hg(e,t)}makePathObject(e,t){return new dg(e,t,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,t,i){return!!$d.getConnectionForOrphanedConnection(e,i===hd.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}render(e){const t=this.makeRenderInfo_(e);t.measure(),this.makeDrawer_(e,t).draw()}},gg={};gg.BottomRow=Hp,gg.Connection=Gp,gg.ConstantProvider=ag,gg.Drawer=hg,gg.ExternalValueInput=jp,gg.Field=Xp,gg.Hat=Kp,gg.Icon=Yp,gg.InRowSpacer=Jp,gg.InlineInput=qp,gg.InputConnection=zp,gg.InputRow=Qp,gg.JaggedEdge=Zp,gg.Measurable=Up,gg.NextConnection=eg,gg.OutputConnection=tg,gg.PathObject=dg,gg.PreviousConnection=ig,gg.RenderInfo=ug,gg.Renderer=pg,gg.RoundCorner=ng,gg.Row=Wp,gg.SpacerRow=og,gg.SquareCorner=sg,gg.StatementInput=rg,gg.TopRow=lg,gg.Types=Vp,gg.init=_r,gg.register=vr,gg.unregister=Cr;var mg=class{constructor(e,t){this.workspace=e,this.theme=t,this.subscribedWorkspaces=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var t=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&(t&&(t=t.getClassName())&&ue(e,t),(t=this.theme.getClassName())&&ce(e,t));for(let e,t=0;e=this.subscribedWorkspaces[t];t++)e.refreshTheme();for(const[i,n]of this.componentDB)for(const o of n){e=o.element,t=o.propertyName;const n=this.theme&&this.theme.getComponentStyle(i);e.style.setProperty(t,n||"")}for(const e of this.subscribedWorkspaces)e.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces.push(e)}unsubscribeWorkspace(e){if(!We(this.subscribedWorkspaces,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,t,i){this.componentDB.has(t)||this.componentDB.set(t,[]),this.componentDB.get(t).push({element:e,propertyName:i}),t=this.theme&&this.theme.getComponentStyle(t),e.style.setProperty(i,t||"")}unsubscribe(e){if(e)for(const[t,i]of this.componentDB){for(let t=i.length-1;0<=t;t--)i[t].element===e&&i.splice(t,1);i.length||this.componentDB.delete(t)}}dispose(){this.subscribedWorkspaces.length=0,this.componentDB.clear()}},bg="VARIABLE_DYNAMIC",fg={CATEGORY_NAME:bg};fg.flyoutCategory=xr,fg.flyoutCategoryBlocks=Sr,fg.internalFlyoutCategory=kr,fg.onCreateVariableButtonClick_Colour=Ir,fg.onCreateVariableButtonClick_Number=wr,fg.onCreateVariableButtonClick_String=Tr;var Eg=class{canConnect(e,t,i,n){return this.canConnectWithReason(e,t,i,n)===$d.CAN_CONNECT}canConnectWithReason(e,t,i,n){const o=this.doSafetyChecks(e,t);return o!==$d.CAN_CONNECT?o:this.doTypeChecks(e,t)?i&&!this.doDragChecks(e,t,n||0)?$d.REASON_DRAG_CHECKS_FAILED:$d.CAN_CONNECT:$d.REASON_CHECKS_FAILED}getErrorMessage(e,t,i){switch(e){case $d.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case $d.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case $d.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case $d.REASON_TARGET_NULL:return"Target connection is null.";case $d.REASON_CHECKS_FAILED:return"Connection checks failed. "+t+" expected "+t.getCheck()+", found "+i.getCheck();case $d.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case $d.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case $d.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,t){if(!e||!t)return $d.REASON_TARGET_NULL;let i,n,o;return e.isSuperior()?(i=e.getSourceBlock(),n=t.getSourceBlock(),o=t):(n=e.getSourceBlock(),i=t.getSourceBlock(),o=e,e=t),i===n?$d.REASON_SELF_CONNECTION:o.type!==Ld[e.type]?$d.REASON_WRONG_TYPE:i.workspace!==n.workspace?$d.REASON_DIFFERENT_WORKSPACES:i.isShadow()&&!n.isShadow()?$d.REASON_SHADOW_PARENT:o.type===hd.OUTPUT_VALUE&&n.previousConnection&&n.previousConnection.isConnected()||o.type===hd.PREVIOUS_STATEMENT&&n.outputConnection&&n.outputConnection.isConnected()?$d.REASON_PREVIOUS_AND_OUTPUT:$d.CAN_CONNECT}doTypeChecks(e,t){if(e=e.getCheck(),t=t.getCheck(),!e||!t)return!0;for(let i=0;i<e.length;i++)if(t.includes(e[i]))return!0;return!1}doDragChecks(e,t,i){if(e.distanceFrom(t)>i||t.getSourceBlock().isInsertionMarker())return!1;switch(t.type){case hd.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,t);case hd.OUTPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case hd.INPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;case hd.NEXT_STATEMENT:if(t.isConnected()&&!e.getSourceBlock().nextConnection&&!t.targetBlock().isShadow()&&t.targetBlock().nextConnection||t.targetBlock()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;default:return!1}return!za.includes(t)}canConnectToPrevious_(e,t){return!(e.targetConnection||za.includes(t)||t.targetConnection&&(!(e=t.targetBlock()).isInsertionMarker()||e.getPreviousBlock()))}};e(Bl.CONNECTION_CHECKER,Ll,Eg);var yg=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new Fp,this.readOnly=!1,this.potentialVariableMap=null,this.id=w(),xe(this),this.options=e||new Cd({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(c(Bl.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new(this.getVariableMapClass())(this),this.setIsReadOnly(this.options.readOnly)}dispose(){this.listeners.length=0,this.clear(),Ne(this)}sortObjects(e,t){const i=Math.sin(zi(yg.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getRelativeToSurfaceXY(),t=t.getRelativeToSurfaceXY(),e.y+i*e.x-(t.y+i*t.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!We(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){const t=[].concat(this.topBlocks);return e&&1<t.length&&t.sort(this.sortObjects.bind(this)),t}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){We(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,t=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),t&&e&&1<e.length&&e.sort(this.sortObjects.bind(this)),e.filter((e=>!e.isInsertionMarker()))):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!We(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){const t=[].concat(this.topComments);return e&&1<t.length&&t.sort(this.sortObjects.bind(this)),t}getAllBlocks(e=!1){if(e){var t=this.getTopBlocks(!0);e=[];for(let i=0;i<t.length;i++)e.push(...t[i].getDescendants(!0))}else for(e=this.getTopBlocks(!1),t=0;t<e.length;t++)e.push(...e[t].getChildren(!1));return e.filter((e=>!e.isInsertionMarker()))}clear(){this.isClearing=!0;try{const e=$l.getGroup$$module$build$src$core$events$utils();for(e||$l.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();$l.setGroup$$module$build$src$core$events$utils(e),this.isFlyout||this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,t){Zt("Blockly.Workspace.renameVariableById","v12","v13","Blockly.Workspace.getVariableMap().renameVariable"),(e=this.variableMap.getVariableById(e))&&this.variableMap.renameVariable(e,t)}createVariable(e,t,i){return Zt("Blockly.Workspace.createVariable","v12","v13","Blockly.Workspace.getVariableMap().createVariable"),this.variableMap.createVariable(e,null!=t?t:void 0,null!=i?i:void 0)}getVariableUsesById(e){return Zt("Blockly.Workspace.getVariableUsesById","v12","v13","Blockly.Workspace.getVariableMap().getVariableUsesById"),vi(this,e)}deleteVariableById(e){Zt("Blockly.Workspace.deleteVariableById","v12","v13","Blockly.Workspace.getVariableMap().deleteVariable");const t=this.variableMap.getVariableById(e);t?$l.deleteVariable$$module$build$src$core$variables(this,t):console.warn(`Can't delete non-existent variable: ${e}`)}getVariable(e,t){return Zt("Blockly.Workspace.getVariable","v12","v13","Blockly.Workspace.getVariableMap().getVariable"),this.variableMap.getVariable(e,t)}getVariableById(e){return Zt("Blockly.Workspace.getVariableById","v12","v13","Blockly.Workspace.getVariableMap().getVariableById"),this.variableMap.getVariableById(e)}getVariablesOfType(e){return Zt("Blockly.Workspace.getVariablesOfType","v12","v13","Blockly.Workspace.getVariableMap().getVariablesOfType"),this.variableMap.getVariablesOfType(null!=e?e:"")}getAllVariables(){return Zt("Blockly.Workspace.getAllVariables","v12","v13","Blockly.Workspace.getVariableMap().getAllVariables"),this.variableMap.getAllVariables()}getAllVariableNames(){return Zt("Blockly.Workspace.getAllVariableNames","v12","v13","Blockly.Workspace.getVariableMap().getAllVariables"),this.variableMap.getAllVariables().map((e=>e.getName()))}getWidth(){return 0}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(void 0!==this.options.maxInstances[e]?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let t=0;for(const i in e){if(e[i]>this.remainingCapacityOfType(i))return!1;t+=e[i]}return!(t>this.remainingCapacity())}hasBlockLimits(){return 1/0!==this.options.maxBlocks||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var t=e?this.redoStack_:this.undoStack_,i=e?this.undoStack_:this.redoStack_;const n=t.pop();if(n){for(var o=[n];t.length&&n.group&&n.group===t[t.length-1].group;){const e=t.pop();e&&o.push(e)}for(t=0;t<o.length;t++)i.push(o[t]);$l.setRecordUndo$$module$build$src$core$events$utils(!1);try{for(i=0;i<o.length;i++)o[i].run(e)}finally{$l.setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,te()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){We(this.listeners,e)}fireChangeListener(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let t=0;t<this.listeners.length;t++)(0,this.listeners[t])(e)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,t){this.blockDB.set(e,t)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){let t;return null!=(t=this.commentDB.get(e))?t:null}allInputsFilled(e){const t=this.getTopBlocks(!1);for(let i=0;i<t.length;i++)if(!t[i].allInputsFilled(e))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new(this.getVariableMapClass())(this,!0)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;const t=this.options.parentWorkspace;return this.isFlyout?t&&t.options&&(e=t.options.parentWorkspace):t&&(e=t),e}static getById(e){return Ie(e)}static getAll(){return ke()}getVariableMapClass(){const e=c(Bl.VARIABLE_MAP,this.options,!0);if(!e)throw Error("No variable map is registered.");return e}isReadOnly(){return this.readOnly}setIsReadOnly(e){this.readOnly=e,this.options.readOnly=e}};yg.SCAN_ANGLE=3;var vg=class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound=null,this.muted=!1}dispose(){this.sounds.clear()}load(e,t){if(e.length){try{var i=new globalThis.Audio}catch(e){return}for(let t=0;t<e.length;t++){const o=e[t],s=o.match(/\.(\w+)$/);if(s&&i.canPlayType("audio/"+s[1])){var n=new globalThis.Audio(o);break}}n&&this.sounds.set(t,n)}}preload(){for(const e of this.sounds.values()){e.volume=.01;const t=e.play();if(void 0!==t?t.then(e.pause).catch((function(){})):e.pause(),la||aa)break}}play(e,t){if(!this.muted){var i=this.sounds.get(e);i?(e=new Date,null!==this.lastSound&&e.getTime()-this.lastSound.getTime()<100||(this.lastSound=e,(i=la||ra?i:i.cloneNode()).volume=void 0===t?1:t,i.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,t)}}setMuted(e){this.muted=e}getMuted(){return this.muted}},Cg=class extends yg{constructor(e){let t;super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.visible=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardMoveInProgress=this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.navigator=new yp,this.metricsManager=new(c(Bl.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||Cg.setTopLevelWorkspaceMetrics,this.componentManager=new tc,this.connectionDBList=dd.init(this.connectionChecker),this.audioManager=new vg(e.parentWorkspace),this.grid=this.options.gridPattern?new Ap(this.options.gridPattern,e.gridOptions):null,this.markerManager=new $p(this),Ah&&ei&&this.registerToolboxCategoryCallback(xh,ei),fg&&kr&&this.registerToolboxCategoryCallback(bg,kr),Pp&&hr&&(this.registerToolboxCategoryCallback(Bp,hr),this.addChangeListener(pr)),this.addChangeListener(this.variableChangeCallback.bind(this)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new mg(this,this.options.theme||vd),this.themeManager_.subscribeWorkspace(this),this.renderer=_r(this.options.renderer||"geras",this.getTheme(),null!=(t=this.options.rendererOverrides)?t:void 0),this.cachedParentSvgSize=new hc(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}getMarker(e){return this.markerManager?this.markerManager.getMarker(e):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){e||(e=vd),this.themeManager_.setTheme(e)}refreshTheme(){if(this.svgGroup_){var e=null===this.options.parentWorkspace;this.renderer.refreshDom(this.svgGroup_,this.getTheme(),e?this.getInjectionDiv():void 0)}this.updateBlockStyles(this.getAllBlocks(!1).filter((e=>!!e.getStyleName()))),this.refreshToolboxSelection(),this.toolbox&&this.toolbox.refreshTheme(),this.isVisible()&&this.setVisible(!0),e=new(re(ia.THEME_CHANGE))(this.getTheme().name,this.id),J(e)}updateBlockStyles(e){for(let t,i=0;t=e[i];i++){const e=t.getStyleName();e&&t.setStyle(e)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.visible}getSvgXY(e){let t=0,i=0,n=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(n=this.scale);do{const o=et(e);e!==this.getCanvas()&&e!==this.getBubbleCanvas()||(n=1),t+=o.x*n,i+=o.y*n,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new lc(t,i)}getCachedParentSvgSize(){const e=this.cachedParentSvgSize;return new hc(e.width,e.height)}getOriginOffsetInPixels(){return tt(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if((" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,t){return this.injectionDiv||(this.injectionDiv=null!=t?t:null),this.svgGroup_=ae(ac.G,{class:"blocklyWorkspace",id:this.id}),t&&Rt(this.svgGroup_,zc.LABEL,$l.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),e&&(this.svgBackground_=ae(ac.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),"blocklyMainBackground"===e&&this.grid?this.svgBackground_.style.fill="var(--blocklyGridPattern)":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new Rp(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(b(this.svgGroup_,"pointerdown",this,this.onMouseDown,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),b(this.svgGroup_,"wheel",this,this.onMouseWheel)),this.options.hasCategories&&(this.toolbox=new(c(Bl.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=c(Bl.CURSOR,this.options))&&this.markerManager.setCursor(new e(this)),e=null===this.options.parentWorkspace,this.renderer.createDom(this.svgGroup_,this.getTheme(),e?this.getInjectionDiv():void 0),$l.getFocusManager$$module$build$src$core$focus_manager().registerTree(this,!!this.injectionDiv||this.isFlyout),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&pe(this.svgGroup_),this.toolbox&&(this.toolbox.dispose(),this.toolbox=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const e=this.getParentSvg();e&&e.parentNode&&pe(e.parentNode)}this.resizeHandlerWrapper&&(E(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null),$l.getFocusManager$$module$build$src$core$focus_manager().isRegistered(this)&&$l.getFocusManager$$module$build$src$core$focus_manager().unregisterTree(this)}addTrashcan(){this.trashcan=Cg.newTrashcan(this);const e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new Bc(this);const e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}copyOptionsForFlyout(){return new Cd({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,plugins:this.options.plugins,modalInputs:this.options.modalInputs,move:{scrollbars:!0}})}addFlyout(e){const t=this.copyOptionsForFlyout();return t.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(c(Bl.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(t):new(c(Bl.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(t),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox?this.toolbox.getFlyout():null}getToolbox(){return this.toolbox}updateScreenCalculations(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox?this.toolbox.position():this.flyout&&this.flyout.position();const e=this.componentManager.getComponents(tc.Capability.POSITIONABLE,!0),t=this.getMetricsManager().getUiMetrics(),i=[];for(let n,o=0;n=e[o];o++){n.position(t,i);const e=n.getBoundingRectangle();e&&i.push(e)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations()}updateScreenCalculationsIfScrolled(){const e=nt();lc.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,t){const i=this.getParentSvg();null!=e&&(this.cachedParentSvgSize.width=e,i.setAttribute("data-cached-width",`${e}`)),null!=t&&(this.cachedParentSvgSize.height=t,i.setAttribute("data-cached-height",`${t}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if("svg"===e.tagName){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(ie()){var e=this.scale,t=-this.scrollY,i=-this.scrollX;if(!(e===this.oldScale&&1>Math.abs(t-this.oldTop)&&1>Math.abs(i-this.oldLeft))){var n=new(re(ia.VIEWPORT_CHANGE))(t,i,e,this.id,this.oldScale);this.oldScale=e,this.oldTop=t,this.oldLeft=i,J(n)}}}translate(e,t){let i,n;null==(i=this.layerManager)||i.translateLayers(new lc(e,t),this.scale),null==(n=this.grid)||n.moveTo(e,t),this.maybeFireViewportChangeEvent()}getWidth(){const e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.visible=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox&&this.toolbox.setVisible(e),e||this.hideChaff(!0))}render(){const e=this.getAllBlocks(!1);for(let t=e.length-1;0<=t;t--)e[t].queueRender();this.getTopBlocks().flatMap((e=>e.getDescendants(!1))).filter((e=>e.isInsertionMarker())).forEach((e=>e.queueRender()))}highlightBlock(e,t){if(void 0===t){for(let e,t=0;e=this.highlightedBlocks[t];t++)e.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((t=void 0===t||t)?this.highlightedBlocks.includes(e)||this.highlightedBlocks.push(e):We(this.highlightedBlocks,e),e.setHighlighted(t))}variableChangeCallback(e){switch(e.type){case ia.VAR_CREATE:case ia.VAR_DELETE:case ia.VAR_RENAME:case ia.VAR_TYPE_CHANGE:this.refreshToolboxSelection()}}refreshToolboxSelection(){const e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox&&e.toolbox.getFlyout()&&e.toolbox.refreshSelection()}recordDragTargets(){const e=this.componentManager.getComponents(tc.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let t,i=0;t=e[i];i++){const e=t.getClientRect();e&&this.dragTargetAreas.push({component:t,clientRect:e})}}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}getDragTarget(e){for(let t,i=0;t=this.dragTargetAreas[i];i++)if(t.clientRect.contains(e.clientX,e.clientY))return t.component;return null}onMouseDown(e){const t=this.getGesture(e);t&&t.handleWsStart(e,this)}startDrag(e,t){Ao(this,e,t)}moveDrag(e){return Ro(this,e)}setKeyboardMoveInProgress(e){this.keyboardMoveInProgress=e}isDragging(){return this.keyboardMoveInProgress||null!==this.currentGesture_&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())}onMouseWheel(e){if(Sp.inProgress())e.preventDefault(),e.stopPropagation();else{var t=this.options.zoomOptions&&this.options.zoomOptions.wheel,i=this.options.moveOptions&&this.options.moveOptions.wheel;if(t||i){var n=_(e);if(ca)var o=e.metaKey;t&&(e.ctrlKey||o||!i)?(n=-n.y/50,t=C(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,n)):(t=this.scrollX-n.x,i=this.scrollY-n.y,e.shiftKey&&!n.x&&(t=this.scrollX-n.y,i=this.scrollY),this.scroll(t,i)),e.preventDefault()}}}getBlocksBoundingBox(){const e=this.getTopBoundedElements();if(!e.length)return new cc(0,0,0,0);const t=e[0].getBoundingRectangle();for(let n=1;n<e.length;n++){var i=e[n];i.isInsertionMarker&&i.isInsertionMarker()||((i=i.getBoundingRectangle()).top<t.top&&(t.top=i.top),i.bottom>t.bottom&&(t.bottom=i.bottom),i.left<t.left&&(t.left=i.left),i.right>t.right&&(t.right=i.right))}return t}cleanUp(){this.setResizesEnabled(!1),$l.setGroup$$module$build$src$core$events$utils(!0);var e=this.getTopBlocks(!0),t=e.filter((e=>e.isMovable()));const i=e.filter((e=>!e.isMovable())).map((e=>e.getBoundingRectangle()));e=function(e){for(const t of i)if(e.intersects(t))return t;return null};var n=0;const o=this.renderer.getConstants().MIN_BLOCK_HEIGHT;for(const i of t){for(t=i.getBoundingRectangle(),i.moveBy(-t.left,n-t.top,["cleanup"]),i.snapToGrid(),n=e(t=i.getBoundingRectangle());null!=n;)n=n.top+n.getHeight()+o,i.moveBy(0,n-t.top,["cleanup"]),i.snapToGrid(),n=e(t=i.getBoundingRectangle());n=i.getRelativeToSurfaceXY().y+i.getHeightWidth().height+o}$l.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){if(!this.isReadOnly()&&!this.isFlyout){var t=Ku.registry.getContextMenuOptions({workspace:this,focusedNode:this},e);this.configureContextMenu&&this.configureContextMenu(t,e);var i=e instanceof PointerEvent?new lc(e.clientX,e.clientY):st(this,new lc(5,5));_o(e,t,this.RTL,this,i)}}updateToolbox(e){if(e=ct(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(dt(e)){if(!this.toolbox)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(Ae(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,t,i){i=Math.pow(this.options.zoomOptions.scaleSpeed,i);const n=this.scale*i;if(this.scale!==n){n>this.options.zoomOptions.maxScale?i=this.options.zoomOptions.maxScale/this.scale:n<this.options.zoomOptions.minScale&&(i=this.options.zoomOptions.minScale/this.scale);var o=this.getCanvas().getCTM(),s=this.getParentSvg().createSVGPoint();s.x=e,s.y=t,e=(s=s.matrixTransform(o.inverse())).x,t=s.y,o=o.translate(e*(1-i),t*(1-i)).scale(i),this.scrollX=o.e,this.scrollY=o.f,this.setScale(n)}}zoomCenter(e){var t=this.getMetrics();let i;this.flyout?(i=t.svgWidth?t.svgWidth/2:0,t=t.svgHeight?t.svgHeight/2:0):(i=t.viewWidth/2+t.absoluteLeft,t=t.viewHeight/2+t.absoluteTop),this.zoom(i,t,e)}zoomToFit(){if(this.isMovable()){var e=this.getMetrics(),t=e.viewWidth;e=e.viewHeight;var i=this.getBlocksBoundingBox(),n=i.right-i.left+40;if(i=i.bottom-i.top+40,n){this.flyout&&(this.horizontalLayout?(e+=this.flyout.getHeight(),i+=this.flyout.getHeight()/this.scale):(t+=this.flyout.getWidth(),n+=this.flyout.getWidth()/this.scale)),t/=n,e/=i,$l.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(t,e)),this.scrollCenter()}finally{$l.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){ce(this.getCanvas(),"blocklyCanvasTransitioning"),ce(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){ue(this.getCanvas(),"blocklyCanvasTransitioning"),ue(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var e=this.getMetrics(),t=(e.scrollWidth-e.viewWidth)/2,i=(e.scrollHeight-e.viewHeight)/2;t=-t-e.scrollLeft,i=-i-e.scrollTop,this.scroll(t,i)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,t){if(this.isMovable()){var i=e?this.getBlockById(e):null;if(i){e=i.getRelativeToSurfaceXY(),i=t?{height:i.height,width:i.width}:i.getHeightWidth();var n=this.scale;t=(e.x+(this.RTL?-1:1)*i.width/2)*n,e=(e.y+i.height/2)*n,i=this.getMetrics(),this.scroll(-(t-i.viewWidth/2),-(e-i.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.scale}getAbsoluteScale(){const e=e=>{if(e.isFlyout){let t;const i=null==(t=e.targetWorkspace)?void 0:t.getFlyout();if(i instanceof wp)return i.getFlyoutScale()}return e.getScale()},t=(i,n)=>i.options.parentWorkspace&&i.options.parentWorkspace.getSvgGroup().contains(i.getSvgGroup())?t(i.options.parentWorkspace,n*e(i)):n*e(i);return t(this,1)}scroll(e,t){this.hideChaff(!0);const i=this.getMetrics();e=Math.min(e,-i.scrollLeft),t=Math.min(t,-i.scrollTop);const n=i.scrollTop+Math.max(0,i.scrollHeight-i.viewHeight);e=Math.max(e,-(i.scrollLeft+Math.max(0,i.scrollWidth-i.viewWidth))),t=Math.max(t,-n),this.scrollX=e,this.scrollY=t,this.scrollbar&&this.scrollbar.set(-(e+i.scrollLeft),-(t+i.scrollTop),!1),e+=i.absoluteLeft,t+=i.absoluteTop,this.translate(e,t)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){We(this.topBoundedElements,e)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(e){const t=!this.resizesEnabled&&e;this.resizesEnabled=e,t&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,t){if("function"!=typeof t)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,t)}getButtonCallback(e){let t;return null!=(t=this.flyoutButtonCallbacks.get(e))?t:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,t){if("function"!=typeof t)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,t)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){if(this.keyboardMoveInProgress)return e.preventDefault(),e.stopPropagation(),null;const t="pointerdown"===e.type;let i;return t&&null!=(i=this.currentGesture_)&&i.hasStarted()&&(console.warn("Tried to start the same gesture twice."),this.currentGesture_.cancel()),!this.currentGesture_&&t&&(this.currentGesture_=new Sp(e,this)),this.currentGesture_}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){Bn(),po(this),gn(),this.hideComponents(e)}hideComponents(e=!1){this.getComponentManager().getComponents(tc.Capability.AUTOHIDEABLE,!0).forEach((t=>t.autoHide(e)))}static setTopLevelWorkspaceMetrics(e){const t=this.getMetrics();"number"==typeof e.x&&(this.scrollX=-(t.scrollLeft+(t.scrollWidth-t.viewWidth)*e.x)),"number"==typeof e.y&&(this.scrollY=-(t.scrollTop+(t.scrollHeight-t.viewHeight)*e.y)),this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)}addClass(e){this.injectionDiv&&ce(this.injectionDiv,e)}removeClass(e){this.injectionDiv&&ue(this.injectionDiv,e)}setIsReadOnly(e){super.setIsReadOnly(e),e?this.addClass("blocklyReadOnly"):this.removeClass("blocklyReadOnly")}scrollBoundsIntoView(e,t=10){if(!Sp.inProgress()){var i=this.getScale(),n=this.getMetricsManager().getViewMetrics(!0);if(n=new cc(n.top,n.top+n.height,n.left,n.left+n.width),!(e.left>=n.left&&e.top>=n.top&&e.right<=n.right&&e.bottom<=n.bottom)){(e=e.clone()).top-=t,e.bottom+=t,e.left-=t,e.right+=t;var o=t=0;e.left<n.left?t=this.RTL?Math.min(n.left-e.left,n.right-e.right):n.left-e.left:e.right>n.right&&(t=this.RTL?n.right-e.right:Math.max(n.right-e.right,n.left-e.left)),e.top<n.top?o=n.top-e.top:e.bottom>n.bottom&&(o=Math.max(n.bottom-e.bottom,n.top-e.top)),this.scroll(this.scrollX+t*i,this.scrollY+o*i)}}}getFocusableElement(){return this.svgGroup_}getFocusableTree(){return this}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}getRootFocusableNode(){return this}getRestoredFocusableNode(e){if(e)return null;let t;return null!=(t=this.getTopBlocks(!0)[0])?t:null}getNestedTrees(){return[]}lookUpFocusableNode(e){var t;const i=null==(t=this.targetWorkspace)?void 0:t.getFlyout();if(this.isFlyout&&i)for(var n of i.getContents())if(t=n.getElement(),_e(t)&&t.canBeFocused()&&t.getFocusableElement().id===e)return t;if(n=e.indexOf("_field_"),t=e.indexOf("_connection_"),-1!==n){var o=e.substring(0,n);if(o=this.getBlockById(o))for(var s of o.getFields())if(s.canBeFocused()&&s.getFocusableElement().id===e)return s;return null}if(-1!==t){if(o=e.substring(0,t),o=this.getBlockById(o))for(const t of o.getConnections_(!0))if(t.id===e)return t;return null}if(s=this.getAllBlocks(!1).find((t=>t.getFocusableElement().id===e)))return s;for(const t of this.getTopComments())if(t instanceof sd&&t.canBeFocused()&&t.getFocusableElement().id===e)return t;for(o of s=this.getAllBlocks().map((e=>e.getIcons())).flat()){if(o.canBeFocused()&&o.getFocusableElement().id===e)return o;if(Gi(o)&&(s=o.getBubble())&&s.canBeFocused()&&s.getFocusableElement().id===e)return s}return null}onTreeFocus(e,t){}onTreeBlur(e){if(this.isFlyout&&this.targetWorkspace&&!$l.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()){var t=this.targetWorkspace.getFlyout(),i=this.targetWorkspace.getToolbox();i&&e===i||(i&&i.clearSelection(),t&&er(t)&&t.autoHide(!1))}}getNavigator(){return this.navigator}setNavigator(e){this.navigator=e}},_g={};_g.WorkspaceSvg=Cg,_g.resizeSvgContents=Ar;var Tg=class extends Ya{constructor(e){super(),this.isBlank=void 0===e,e&&(this.varId=e.getId(),this.workspaceId=e.getWorkspace().id)}toJson(){const e=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return e.varId=this.varId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Tg)).varId=e.varId,t}},wg=class extends Tg{constructor(e){super(e),this.type=ia.VAR_CREATE,e&&(this.varType=e.getType(),this.varName=e.getName())}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new wg)).varType=e.varType,t.varName=e.varName,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");t=t.getVariableMap(),e?t.createVariable(this.varName,this.varType,this.varId):(e=t.getVariableById(this.varId))&&t.deleteVariable(e)}};e(Bl.EVENT,ia.VAR_CREATE,wg);var Ig=class{constructor(e,t,i,n){this.workspace=e,this.name=t,this.type=i||"",this.id=n||w()}getId(){return this.id}getName(){return this.name}setName(e){return this.name=e,this}getType(){return this.type}setType(e){return this.type=e,this}getWorkspace(){return this.workspace}save(){const e={name:this.getName(),id:this.getId()},t=this.getType();return t&&(e.type=t),e}static load(e,t){e=new this(t,e.name,e.type,e.id),t.getVariableMap().addVariable(e),J(new(re(ia.VAR_CREATE))(e))}};e(Bl.VARIABLE_MODEL,Ll,Ig);var kg=class extends Tg{constructor(e){super(e),this.type=ia.VAR_DELETE,e&&(this.varType=e.getType(),this.varName=e.getName())}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new kg)).varType=e.varType,t.varName=e.varName,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");t=t.getVariableMap(),e?(e=t.getVariableById(this.varId))&&t.deleteVariable(e):t.createVariable(this.varName,this.varType,this.varId)}};e(Bl.EVENT,ia.VAR_DELETE,kg);var xg=class extends Tg{constructor(e,t){super(e),this.type=ia.VAR_RENAME,e&&(this.oldName=e.getName(),this.newName=void 0===t?"":t)}toJson(){const e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return e.oldName=this.oldName,e.newName=this.newName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new xg)).oldName=e.oldName,t.newName=e.newName,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");const i=(t=t.getVariableMap()).getVariableById(this.varId);e?i&&t.renameVariable(i,this.newName):i&&t.renameVariable(i,this.oldName)}};e(Bl.EVENT,ia.VAR_RENAME,xg);var Ng=class{constructor(e,t=!1){this.workspace=e,this.potentialMap=t,this.variableMap=new Map}clear(){for(const e of this.variableMap.values())for(const t of e.values())this.deleteVariable(t);if(0!==this.variableMap.size)throw Error("Non-empty variable map")}renameVariable(e,t){if(e.getName()===t)return e;var i=e.getType();i=this.getVariable(t,i);const n=this.workspace.getAllBlocks(!1);let o="";this.potentialMap||(o=$l.getGroup$$module$build$src$core$events$utils())||$l.setGroup$$module$build$src$core$events$utils(!0);try{i&&i.getId()!==e.getId()?this.renameVariableWithConflict(e,t,i,n):this.renameVariableAndUses(e,t,n)}finally{this.potentialMap||$l.setGroup$$module$build$src$core$events$utils(o)}return e}changeVariableType(e,t){var i;let n;return null==(i=this.variableMap.get(e.getType()))||i.delete(e.getId()),e.setType(t),(i=null!=(n=this.variableMap.get(t))?n:new Map).set(e.getId(),e),this.variableMap.has(t)||this.variableMap.set(t,i),e}renameVariableById(e,t){Zt("VariableMap.renameVariableById","v12","v13","VariableMap.renameVariable");const i=this.getVariableById(e);if(!i)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(i,t)}renameVariableAndUses(e,t,i){for(this.potentialMap||J(new(re(ia.VAR_RENAME))(e,t)),e.setName(t),t=0;t<i.length;t++)i[t].updateVarName(e)}renameVariableWithConflict(e,t,i,n){const o=e.getType();for(t!==i.getName()&&this.renameVariableAndUses(i,t,n),t=0;t<n.length;t++)n[t].renameVarById(e.getId(),i.getId());let s;this.potentialMap||J(new(re(ia.VAR_DELETE))(e)),null==(s=this.variableMap.get(o))||s.delete(e.getId())}createVariable(e,t,i){var n=this.getVariable(e,t);if(n){if(i&&n.getId()!==i)throw Error('Variable "'+e+'" is already in use and its id is "'+n.getId()+'" which conflicts with the passed in id, "'+i+'".');return n}if(i&&this.getVariableById(i))throw Error('Variable id, "'+i+'", is already in use.');if(n=i||w(),t=t||"",!(i=l(Bl.VARIABLE_MODEL,Ll,!0)))throw Error("No variable model is registered.");let o;return n=new i(this.workspace,e,t,n),(e=null!=(o=this.variableMap.get(t))?o:new Map).set(n.getId(),n),this.variableMap.has(t)||this.variableMap.set(t,e),this.potentialMap||J(new(re(ia.VAR_CREATE))(n)),n}addVariable(e){const t=e.getType();let i;this.variableMap.has(t)||this.variableMap.set(t,new Map),null==(i=this.variableMap.get(t))||i.set(e.getId(),e)}deleteVariable(e){const t=vi(this.workspace,e.getId());let i="";this.potentialMap||(i=$l.getGroup$$module$build$src$core$events$utils())||$l.setGroup$$module$build$src$core$events$utils(!0);try{for(let e=0;e<t.length;e++)t[e].dispose(!0);const i=this.variableMap.get(e.getType());i&&i.has(e.getId())&&(i.delete(e.getId()),this.potentialMap||J(new(re(ia.VAR_DELETE))(e)),0===i.size&&this.variableMap.delete(e.getType()))}finally{this.potentialMap||$l.setGroup$$module$build$src$core$events$utils(i)}}deleteVariableById(e){Zt("VariableMap.deleteVariableById","v12","v13","Blockly.Variables.deleteVariable"),(e=this.getVariableById(e))&&$l.deleteVariable$$module$build$src$core$variables(this.workspace,e)}getVariable(e,t){if(!(t=this.variableMap.get(t||"")))return null;let i;return null!=(i=[...t.values()].find((t=>$l.Names$$module$build$src$core$names.equals(t.getName(),e))))?i:null}getVariableById(e){for(const t of this.variableMap.values())if(t.has(e)){let i;return null!=(i=t.get(e))?i:null}return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?[...e.values()]:[]}getTypes(){return[...this.variableMap.keys()]}getAllVariables(){let e=[];for(const t of this.variableMap.values())e=e.concat(...t.values());return e}getAllVariableNames(){Zt("VariableMap.getAllVariableNames","v12","v13","Blockly.Variables.getAllVariables");const e=[];for(const t of this.variableMap.values())for(const i of t.values())e.push(i.getName());return e}getVariableUsesById(e){return Zt("VariableMap.getVariableUsesById","v12","v13","Blockly.Variables.getVariableUsesById"),vi(this.workspace,e)}};e(Bl.VARIABLE_MAP,Ll,Ng);var Sg=class extends Ja{constructor(e,t){super(t),this.type=ia.TRASHCAN_OPEN,this.isOpen=e}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Sg)).isOpen=e.isOpen,t}};e(Bl.EVENT,ia.TRASHCAN_OPEN,Sg);var Ag,Rg=class extends op{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(e=this.workspace.copyOptionsForFlyout(),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===Ic.TOP?Ic.BOTTOM:Ic.TOP,this.flyout=new(c(Bl.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===Ic.RIGHT?Ic.LEFT:Ic.RIGHT,this.flyout=new(c(Bl.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){let e;this.svgGroup=ae(ac.G,{class:"blocklyTrash"});const t=String(Math.random()).substring(2);e=ae(ac.CLIPPATH,{id:"blocklyTrashBodyClipPath"+t},this.svgGroup),ae(ac.RECT,{width:$g,height:Og,y:Dg},e);const i=ae(ac.IMAGE,{width:Dc,x:-Pg,height:Mc,y:-Fg,"clip-path":"url(#blocklyTrashBodyClipPath"+t+")"},this.svgGroup);return i.setAttributeNS(Ra,"xlink:href",this.workspace.options.pathToMedia+Lc),e=ae(ac.CLIPPATH,{id:"blocklyTrashLidClipPath"+t},this.svgGroup),ae(ac.RECT,{width:$g,height:Dg},e),this.svgLid=ae(ac.IMAGE,{width:Dc,x:-Pg,height:Mc,y:-Fg,"clip-path":"url(#blocklyTrashLidClipPath"+t+")"},this.svgGroup),this.svgLid.setAttributeNS(Ra,"xlink:href",this.workspace.options.pathToMedia+Lc),f(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),f(this.svgGroup,"pointerup",this,this.click),f(i,"pointerover",this,this.mouseOver),f(i,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){if(0<this.workspace.options.maxTrashcanContents){const e=this.flyout.createDom(ac.SVG);ce(e,"blocklyTrashcanFlyout"),ge(e,this.workspace.getParentSvg()),this.flyout.init(this.workspace)}this.workspace.getComponentManager().addComponent({component:this,weight:tc.ComponentWeight.TRASHCAN_WEIGHT,capabilities:[tc.Capability.AUTOHIDEABLE,tc.Capability.DELETE_AREA,tc.Capability.DRAG_TARGET,tc.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&pe(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var e=this.contents.map((function(e){return JSON.parse(e)})),t=this.workspace.getParentSvg().style;t.cursor="wait",setTimeout((()=>{let i,n;null==(i=this.flyout)||i.show(e),t.cursor="",null==(n=this.workspace.scrollbar)||n.setVisible(!1)}),10),this.fireUiEvent(!0)}}closeFlyout(){var e,t;this.contentsIsOpen()&&(null==(e=this.flyout)||e.hide(),null==(t=this.workspace.scrollbar)||t.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,t){if(this.initialized){var i,n,o=vt(this.workspace,e);e=yt(o,new hc($g,Og+Dg),Lg,Mg,e,this.workspace),t=Ct(e,Mg,o.vertical===Nc.TOP?Ac.DOWN:Ac.UP,t),this.top=t.top,this.left=t.left,null==(i=this.svgGroup)||i.setAttribute("transform","translate("+this.left+","+this.top+")"),null==(n=this.flyout)||n.position()}}getBoundingRectangle(){return new cc(this.top,this.top+Og+Dg,this.left,this.left+$g)}getClientRect(){if(!this.svgGroup)return null;var e=this.svgGroup.getBoundingClientRect();const t=e.top+Fg-Bg;return e=e.left+Pg-Bg,new cc(t,t+Dg+Og+2*Bg,e,e+$g+2*Bg)}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){const e=Wg;var t=1/(e+1);this.lidOpen+=this.isLidOpen?t:-t,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*zg),t=Hg+this.lidOpen*(Gg-Hg),this.svgGroup&&(this.svgGroup.style.opacity=`${t}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),Ug/e))}setLidAngle(e){const t=this.workspace.toolboxPosition===Ic.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let i;null==(i=this.svgLid)||i.setAttribute("transform","rotate("+(t?-e:e)+","+(t?4:$g-4)+","+(Dg-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*zg)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(re(ia.TRASHCAN_OPEN))(e,this.workspace.id),J(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(0>=this.workspace.options.maxTrashcanContents||!k(e)||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),!this.contents.includes(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(Vg)}}}cleanBlockJson(e){return function e(t){if(t){if(delete t.id,delete t.x,delete t.y,delete t.enabled,delete t.disabledReasons,t.icons&&t.icons.comment){var i=t.icons.comment;delete i.height,delete i.width,delete i.pinned}for(var n in i=t.inputs){var o=i[n];const t=o.block;o=o.shadow,t&&e(t),o&&e(o)}t.next&&(t=(n=t.next).block,n=n.shadow,t&&e(t),n&&e(n))}}(e=JSON.parse(JSON.stringify(e))),Object.assign({},{kind:"BLOCK"},e)}},$g=47,Og=44,Dg=16,Mg=20,Lg=20,Bg=10,Pg=0,Fg=32,Vg=.1,Ug=80,Wg=4,Hg=.4,Gg=.8,zg=45,jg=null,Xg=null,Kg={duplicateInternal:Dr,copyInternal:Rr},Yg={};Yg.BlockPaster=Jd,Yg.TEST_ONLY=Kg,Yg.paste=$r,Yg.registry=Wc,function(e){e.ESCAPE="escape",e.DELETE="delete",e.COPY="copy",e.CUT="cut",e.PASTE="paste",e.UNDO="undo",e.REDO="redo"}(Ag||(Ag={}));var Jg=null,qg=null,Qg=null;zr();var Zg={};Zg.names=Ag,Zg.registerCopy=Vr,Zg.registerCut=Ur,Zg.registerDefaultShortcuts=zr,Zg.registerDelete=Br,Zg.registerEscape=Lr,Zg.registerPaste=Wr,Zg.registerRedo=Gr,Zg.registerUndo=Hr;var em={ProcedureSerializer:class{constructor(e,t){this.procedureModelClass=e,this.parameterModelClass=t,this.priority=75}save(e){return(e=e.getProcedureMap().getProcedures().map((e=>jr(e)))).length?e:null}load(e,t){const i=t.getProcedureMap();for(const n of e)i.add(Xr(this.procedureModelClass,this.parameterModelClass,n,t))}clear(e){e.getProcedureMap().clear()}}};em.loadProcedure=Xr,em.saveProcedure=jr;var tm=class{constructor(){this.priority=100}save(e){return(e=e.getAllVariables().map((e=>e.save()))).length?e:null}load(e,t){const i=l(Bl.VARIABLE_MODEL,Ll);e.forEach((e=>{null==i||i.load(e,t)}))}clear(e){e.getVariableMap().clear()}};_t("variables",new tm);var im={};im.VariableSerializer=tm;var nm={};nm.load=Yr,nm.save=Kr;var om={blocks:Fh,exceptions:Bh,priorities:Pc,procedures:em,registry:Fc,variables:im,workspaceComments:Uc,workspaces:nm};"Blockly"in globalThis||(globalThis.Blockly={Msg:nh});var sm="label",rm=class{load(e,t){return(e=new ap(t.getWorkspace(),t.targetWorkspace,e,!0)).show(),new sp(e,sm)}gapForItem(e,t){return t}disposeItem(e){(e=e.getElement())instanceof ap&&e.dispose()}getType(){return sm}};e(Bl.FLYOUT_INFLATER,sm,rm);var lm=class extends ag{constructor(e){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,e&&(this.GRID_UNIT=e),this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const t=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=t&&!isNaN(t)?t:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&pe(this.selectedGlowFilter),this.replacementGlowFilter&&pe(this.replacementGlowFilter)}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:.75*e,width:t,path:ws("c",[Ts(25,-e),Ts(71,-e),Ts(t,0)])}}makeHexagonal(){function e(e,i,n){var o=e/2;return xs(-(n=n?-1:1)*(o=o>t?t:o),e=(i?-1:1)*e/2)+xs(n*o,e)}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeRounded(){function e(e,t,n){const o=e>i?e-i:0,s=n===t?"0":"1";return As("a","0 0,"+s,e=(e>i?i:e)/2,Ts((n?1:-1)*e,(t?-1:1)*e))+Ss("v",(t?-1:1)*o)+As("a","0 0,"+s,e,Ts((n?-1:1)*e,(t?-1:1)*e))}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,i=2*t;return{type:this.SHAPES.ROUND,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeSquared(){function e(e,i,n){e-=2*t;const o=n===i?"0":"1";return As("a","0 0,"+o,t,Ts((n?1:-1)*t,(i?-1:1)*t))+Ss("v",(i?-1:1)*e)+As("a","0 0,"+o,t,Ts((n?-1:1)*t,(i?-1:1)*t))}const t=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:e=>t,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case hd.INPUT_VALUE:case hd.OUTPUT_VALUE:if(null!==(e=e.getSourceBlock().getOutputShape()))switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return t&&t.includes("Boolean")?this.HEXAGONAL:(t&&t.includes("Number")||t&&t.includes("String"),this.ROUNDED);case hd.PREVIOUS_STATEMENT:case hd.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(e){return ws("c",[Ts(e*o/2,0),Ts(e*o*3/4,r/2),Ts(e*o,r)])+Ns([Ts(e*o,s)])+ws("c",[Ts(e*o/4,r/2),Ts(e*o/2,r),Ts(e*o,r)])+Ss("h",e*n)+ws("c",[Ts(e*o/2,0),Ts(e*o*3/4,-r/2),Ts(e*o,-r)])+Ns([Ts(e*o,-s)])+ws("c",[Ts(e*o/4,-r/2),Ts(e*o/2,-r),Ts(e*o,-r)])}const t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,n=t/3,o=n/3,s=i/2,r=s/2,l=e(1),a=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:l,pathRight:a}}makeInsideCorners(){const e=this.CORNER_RADIUS,t=As("a","0 0,0",e,Ts(-e,e)),i=As("a","0 0,1",e,Ts(-e,e));return{width:e,height:e,pathTop:t,pathBottom:As("a","0 0,0",e,Ts(e,e)),rightWidth:e,rightHeight:e,pathTopRight:i,pathBottomRight:As("a","0 0,1",e,Ts(e,e))}}generateSecondaryColour_(e){return Qn("#000",e,.15)||e}generateTertiaryColour_(e){return Qn("#000",e,.25)||e}createDom(e,t,i,n){super.createDom(e,t,i,n),e=ae(ac.DEFS,{},e),t=ae(ac.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),ae(ac.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},t),i=ae(ac.FECOMPONENTTRANSFER,{result:"outBlur"},t),ae(ac.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),ae(ac.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),ae(ac.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.selectedGlowFilterId=t.id,this.selectedGlowFilter=t,e=ae(ac.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),ae(ac.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),t=ae(ac.FECOMPONENTTRANSFER,{result:"outBlur"},e),ae(ac.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),ae(ac.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),ae(ac.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),ae(ac.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e,n&&(n.style.setProperty("--blocklySelectedGlowFilter",`url(#${this.selectedGlowFilterId})`),n.style.setProperty("--blocklyReplacementGlowFilter",`url(#${this.replacementGlowFilterId})`))}getCSS_(e){return[`${e} .blocklyText,`,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyTextInputBubble textarea {`,"font-weight: normal;","}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableField>rect:not(.blocklyDropdownRect),`,`${e} .blocklyEditableField>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${e} .blocklyNonEditableField>text,`,`${e} .blocklyEditableField>text,`,`${e} .blocklyNonEditableField>g>text,`,`${e} .blocklyEditableField>g>text {`,"fill: #575E75;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableField:not(.blocklyEditing):hover>rect,",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableField:not(.blocklyEditing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${e} .blocklyDropdownText {`,"fill: #fff !important;","}",`${e}.blocklyWidgetDiv .blocklyMenuItem,`,`${e}.blocklyDropDownDiv .blocklyMenuItem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e}.blocklyDropDownDiv .blocklyMenuItemContent {`,"color: #fff;","}",`${e} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${e} .blocklyDisabledPattern > .blocklyOutlinePath {`,"fill: var(--blocklyDisabledPattern)","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}",`${e} .blocklySelected>.blocklyPath.blocklyPathSelected {`,"fill: none;","filter: var(--blocklySelectedGlowFilter);","}",`${e} .blocklyReplaceable>.blocklyPath {`,"filter: var(--blocklyReplacementGlowFilter);","}"]}},am=class extends hg{constructor(e,t){super(e,t)}draw(){const e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(0>=e.height)){if(Vp.isSpacer(e)){const n=e.precedesStatement;var t=e.followsStatement;if(n||t){const o=this.constants_.INSIDE_CORNERS;var i=o.rightHeight;return i=e.height-(n?i:0),t=t?o.pathBottomRight:"",e=0<i?Ss("V",e.yPos+i):"",void(this.outlinePath_+=t+e+(n?o.pathTopRight:""))}}this.outlinePath_+=Ss("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=ks(e.xPos,this.info_.startY),this.outlinePath_+=Ss("h",e.width)}drawFlatBottom_(){const e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=Ss("V",e.baseline),this.outlinePath_+=Ss("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);const t=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=Is(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(t,e))}getInlineInputPath(e){const t=e.width-2*e.connectionWidth,i=e.height;return Ss("h",t)+e.shape.pathRightDown(i)+Ss("h",-t)+e.shape.pathUp(i)+"z"}drawStatementInput_(e){var t=e.getLastInput();const i=t.xPos+t.notchOffset+t.shape.width,n=this.constants_.INSIDE_CORNERS,o=t.shape.pathRight+Ss("h",-(t.notchOffset-n.width))+n.pathTop,s=e.height-2*n.height;t=n.pathBottom+Ss("h",t.notchOffset-n.width)+(t.connectedBottomNextConnection?"":t.shape.pathLeft),this.outlinePath_+=Ss("H",i)+o+Ss("v",s)+t+Ss("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){const t=e.connectionModel;if(t.type===hd.NEXT_STATEMENT||t.type===hd.PREVIOUS_STATEMENT||t.type===hd.OUTPUT_VALUE&&!e.isDynamicShape)return super.drawConnectionHighlightPath(e);e=t.type===hd.INPUT_VALUE?Is(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):Is(e.width,-e.height/2)+e.shape.pathDown(e.height);const i=t.getSourceBlock();let n,o;return null==(o=(n=i.pathObject).addConnectionHighlight)?void 0:o.call(n,t,e,t.getOffsetInBlock(),i.RTL)}},cm=class extends $u{constructor(e,t,i,n,o,s,r){if(super($u.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",i=Number(io(i)),t=Number(io(t)),isNaN(i)||isNaN(t))throw Error("Height and width values of an image field must cast to numbers.");if(0>=i||0>=t)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new hc(t,i+cm.Y_PADDING),this.imageHeight=i,"function"==typeof o&&(this.clickHandler=o),e!==$u.SKIP_SETUP&&(r?this.configure_(r):(this.flipRtl=!!s,this.altText=io(n)||""),this.setValue(io(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=io(e.alt))}initView(){this.imageElement=ae(ac.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(Ra,"xlink:href",this.value_),this.fieldGroup_&&ce(this.fieldGroup_,"blocklyImageField"),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return"string"!=typeof e?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(Ra,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}isClickable(){return super.isClickable()&&!!this.clickHandler}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(!e.src||!e.width||!e.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(e.src,e.width,e.height,void 0,void 0,void 0,e)}};cm.Y_PADDING=1,ss("field_image",cm),cm.prototype.DEFAULT_VALUE="";var hm=class extends $u{set size_(e){super.size_=e}get size_(){const e=super.size_;return 14>e.width&&(e.width=14),e}constructor(e,t,i){super($u.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper=this.onKeyDownWrapper=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,e!==$u.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),void 0!==e.spellcheck&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new Ou;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot()),this.fieldGroup_&&ce(this.fieldGroup_,"blocklyInputField")}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new Ou;let t;return this.fullBlockClickTarget_=!(null==(t=this.getConstants())||!t.FULL_BLOCK_FIELDS)&&e.isSimpleReporter()}doValueInvalid_(e,t=!0){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.valueWhenEditorWasOpened_,this.sourceBlock_&&ie()&&this.value_!==e&&t&&J(new(re(ia.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,e,this.value_)))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){const e=this.getSourceBlock();if(!e)throw new Ou;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.getColourTertiary())):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let e;return null!=(e=this.getConstants())&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var e=this.htmlInput_;this.isTextValid_?(ue(e,"blocklyInvalidInput"),Rt(e,zc.INVALID,!1)):(ce(e,"blocklyInvalidInput"),Rt(e,zc.INVALID,!0))}if(!(e=this.getSourceBlock()))throw new Ou;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(e,t=!1,i=!0){this.workspace_=this.sourceBlock_.workspace,!t&&this.workspace_.options.modalInputs&&(ha||ra||la)?this.showPromptEditor():this.showInlineEditor(t,i)}showPromptEditor(){jt($l.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),(e=>{null!==e&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)}))}showInlineEditor(e,t){const i=this.getSourceBlock();if(!i)throw new Ou;ao(this,i.RTL,this.widgetDispose_.bind(this),this.workspace_,t),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new Ou;$l.setGroup$$module$build$src$core$events$utils(!0);const t=so();var i=this.getClickTarget_();if(!i)throw Error("A click target has not been set.");ce(i,"blocklyEditing"),(i=document.createElement("input")).className="blocklyHtmlInput",i.setAttribute("spellcheck",this.spellcheck_);const n=this.workspace_.getAbsoluteScale();var o=this.getConstants().FIELD_TEXT_FONTSIZE*n+"pt";return t.style.fontSize=o,i.style.fontSize=o,o=hm.BORDERRADIUS*n+"px",this.isFullBlockField()&&(o=((o=this.getScaledBBox()).bottom-o.top)/2+"px",e=e.getParent()?e.getParent().getColourTertiary():this.sourceBlock_.getColourTertiary(),i.style.border=1*n+"px solid "+e,t.style.borderRadius=o,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*n+"px")),i.style.borderRadius=o,t.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(i),i}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&ie()&&null!==this.valueWhenEditorWasOpened_&&this.valueWhenEditorWasOpened_!==this.value_&&(J(new(re(ia.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),$l.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=so().style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,!(e=this.getClickTarget_()))throw Error("A click target has not been set.");ue(e,"blocklyEditing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper=b(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper=b(e,"input",this,this.onHtmlInputChange)}unbindInputEvents_(){this.onKeyDownWrapper&&(E(this.onKeyDownWrapper),this.onKeyDownWrapper=null),this.onKeyInputWrapper&&(E(this.onKeyInputWrapper),this.onKeyInputWrapper=null)}onHtmlInputKeyDown_(e){if("Enter"===e.key)uo(this),gn();else if("Escape"===e.key)this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),uo(this),gn();else if("Tab"===e.key){var t;e.preventDefault();const i=null==(t=this.workspace_)?void 0:t.getCursor();t=e=>(e instanceof hm||e instanceof ip&&e.isSimpleReporter())&&e!==this.getSourceBlock(),(e=(e=e.shiftKey?null==i?void 0:i.getPreviousNode(this,t,!1):null==i?void 0:i.getNextNode(this,t,!1))instanceof ip&&e.isSimpleReporter()?e.getFields().next().value:e)instanceof hm&&(uo(this),gn(),e.showEditor())}}onHtmlInputChange(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&ie()&&this.value_!==e&&J(new(re(ia.BLOCK_FIELD_INTERMEDIATE_CHANGE))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,t=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,t)}resizeEditor_(){Dt().then((()=>{const e=this.getSourceBlock();if(!e)throw new Ou;const t=so(),i=this.getScaledBBox();t.style.width=i.right-i.left+"px",t.style.height=i.bottom-i.top+"px";const n=i.top;t.style.left=`${e.RTL?i.right-t.offsetWidth:i.left}px`,t.style.top=`${n}px`}))}repositionForWindowResize(){let e;const t=null==(e=this.getSourceBlock())?void 0:e.getRootBlock();return t instanceof ip&&(zs(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),t)||this.resizeEditor_(),!0)}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return`${e}`}getValueFromEditorText_(e){return e}};hm.BORDERRADIUS=4,$l.FieldTextInput$$module$build$src$core$field_textinput=class extends hm{constructor(e,t,i){super(e,t,i)}initView(){super.initView(),this.fieldGroup_&&ce(this.fieldGroup_,"blocklyTextInputField")}doClassValidation_(e){return void 0===e?null:`${e}`}static fromJson(e){return new this(io(e.text),void 0,e)}},ss("field_input",$l.FieldTextInput$$module$build$src$core$field_textinput),$l.FieldTextInput$$module$build$src$core$field_textinput.prototype.DEFAULT_VALUE="",$l.FieldTextInput$$module$build$src$core$field_textinput;var um=class extends Hp{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},dm=class extends rg{constructor(e,t){if(super(e,t),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;t=e.getNextBlock();)e=t;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},pm=class extends Up{constructor(e){super(e),this.width=this.height=0,this.type|=Vp.getType("RIGHT_CONNECTION")}},gm=class extends lg{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},mm=class extends ug{constructor(e,t){super(e,t),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new gm(this.constants_),this.bottomRow=new um(this.constants_),this.isMultiRow=!t.getInputsInline()||t.isCollapsed(),this.hasStatementInput=0<t.statementInputCount,this.rightSide=this.outputConnection?new pm(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,t){return!!t&&(t instanceof Gd||e instanceof zd||t instanceof zd||(e instanceof $l.ValueInput$$module$build$src$core$inputs$value_input||e instanceof Hd||e instanceof Gd)&&(!this.isInline||this.isMultiRow))}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&t&&Vp.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&Vp.isLeftRoundedCorner(e)&&t&&(Vp.isPreviousConnection(t)||Vp.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&Vp.isLeftSquareCorner(e)&&t&&Vp.isHat(t)||e&&Vp.isField(e)&&0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,t){if(Vp.isTopRow(e)&&Vp.isBottomRow(t))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const i=Vp.isInputRow(e)&&e.hasStatement,n=Vp.isInputRow(t)&&t.hasStatement;return n||i?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),n&&i?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):Vp.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):Vp.isBottomRow(t)?this.outputConnection?!t.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(e,t){const i=this.width-this.startX;return Vp.isInputRow(e)&&e.hasStatement||Vp.isInputRow(t)&&t.hasStatement?Math.max(i,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):i}getElemCenterline_(e,t){if(e.hasStatement&&!Vp.isSpacer(t)&&!Vp.isStatementInput(t))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(Vp.isInlineInput(t)){const i=t.connectedBlock;if(i&&i.outputConnection&&i.nextConnection)return e.yPos+i.height/2}return super.getElemCenterline_(e,t)}addInput_(e,t){if((e instanceof Hd||e instanceof Gd)&&t.hasDummyInput&&t.align===$l.Align$$module$build$src$core$inputs$align.LEFT&&e.align===$l.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(t,e);else if(e instanceof zd)return t.elements.push(new dm(this.constants_,e)),t.hasStatement=!0,void(null===t.align&&(t.align=e.align));super.addInput_(e,t)}addAlignmentPadding_(e,t){if(this.rightAlignedDummyInputs.get(e)){let i;for(let t=0;t<e.elements.length;t++){const n=e.elements[t];if(Vp.isSpacer(n)&&(i=n),Vp.isField(n)&&n.parentInput===this.rightAlignedDummyInputs.get(e))break}if(i)return i.width+=t,void(e.width+=t)}super.addAlignmentPadding_(e,t)}adjustXPosition_(){const e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let t=e;for(let o=2;o<this.rows.length-1;o+=2){var i=this.rows[o-1];const s=this.rows[o];var n=this.rows[o+1];if(i=2===o?!!this.topRow.hasPreviousConnection:!!i.followsStatement,n=o+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!n.precedesStatement,Vp.isInputRow(s)&&s.hasStatement){let i,n;s.measure(),t=s.width-(null!=(n=null==(i=s.getLastInput())?void 0:i.width)?n:0)+e}else if(i&&(2===o||n)&&Vp.isInputRow(s)&&!s.hasStatement){n=s.xPos,i=null;for(let e=0;e<s.elements.length;e++){const o=s.elements[e];Vp.isSpacer(o)&&(i=o),!(i&&(Vp.isField(o)||Vp.isInput(o))&&n<t)||Vp.isField(o)&&(o.field instanceof Md||o.field instanceof cm)||(i.width+=t-n),n+=o.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var t=0,i=0;i<this.rows.length;i++){const e=this.rows[i];e.yPos=t,t+=e.height}this.height=t,i=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,t=e.height(i),i=e.width(i),this.outputConnection.height=t,this.outputConnection.width=i,this.outputConnection.startX=i,this.outputConnection.connectionOffsetY=e.connectionOffsetY(t),this.outputConnection.connectionOffsetX=e.connectionOffsetX(i),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=i,this.rightSide.height=t,this.rightSide.width=e,this.rightSide.centerline=t/2,this.rightSide.xPos=this.width+e),this.startX=i,this.width+=i+e,this.widthWithChildren+=i+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,t=0;t<this.rows.length;t++){var i=this.rows[t];if(!Vp.isInputRow(i))continue;e=i.elements[i.elements.length-2];let n=this.getNegativeSpacing_(i.elements[1]),o=this.getNegativeSpacing_(e);e=n+o;const s=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<s&&(n=(e=this.width-s)/2,o=e/2),i.elements.unshift(new Jp(this.constants_,-n)),i.elements.push(new Jp(this.constants_,-o))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,t=0;t<this.rows.length;t++)i=this.rows[t],Vp.isTopOrBottomRow(i)&&(i.elements[1].width-=e),i.width-=e,i.widthWithConnectedBlocks-=e}}getNegativeSpacing_(e){if(!e||!this.outputConnection)return 0;const t=this.outputConnection.width;var i=this.outputConnection.shape.type;const n=this.constants_;if(1<this.inputRows.length)return i===n.SHAPES.ROUND?(i=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,t-(i=this.height/2>i?i:this.height/2)*(1-Math.sin(Math.acos((i-this.constants_.SMALL_PADDING)/i)))):0;if(Vp.isInlineInput(e)){const o=e.connectedBlock;return null==(e=o?o.pathObject.outputShapeType:e.shape.type)||o&&o.outputConnection&&(o.statementInputCount||o.nextConnection)||i===n.SHAPES.HEXAGONAL&&i!==e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][e]}return Vp.isField(e)?i===n.SHAPES.ROUND&&e.field instanceof $l.FieldTextInput$$module$build$src$core$field_textinput?t-2.75*n.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][0]:Vp.isIcon(e)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let n=2;n<this.rows.length-1;n+=2){const o=this.rows[n-1],s=this.rows[n],r=this.rows[n+1];var e=2===n,t=n+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!r.precedesStatement;if(e?this.topRow.hasPreviousConnection:o.followsStatement){var i=s.elements[1];if(i=3===s.elements.length&&i instanceof Xp&&(i.field instanceof Md||i.field instanceof cm),!e&&i)o.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING,s.height-=this.constants_.MEDIUM_PADDING;else if(e||t){if(t){for(e=!1,t=0;t<s.elements.length;t++)if(i=s.elements[t],Vp.isInlineInput(i)&&i.connectedBlock&&!i.connectedBlock.isShadow()&&40<=i.connectedBlock.getHeightWidth().height){e=!0;break}e&&(o.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING)}}else o.height+=this.constants_.SMALL_PADDING}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},bm=class extends dg{constructor(e,t,i){super(e,t,i),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=i}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);const t=e.getParent();e.isShadow()&&t&&this.svgPath.setAttribute("stroke",t.getColourTertiary());for(const e of this.outlines.values())e.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.classList.add("blocklyPathSelected"),ue(this.svgPathSelected,Pa.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),ue(this.svgPathSelected,Pa.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME),this.svgPathSelected.removeAttribute("tabindex"),this.svgPathSelected.removeAttribute("id"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(t?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(const e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,t){(e=this.getOutlinePath(e)).setAttribute("d",t),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,ae(ac.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let t,i;null==(t=this.outlines.get(e))||null==(i=t.parentNode)||i.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},fm=class extends pg{constructor(e){super(e)}makeConstants_(){return new lm}makeRenderInfo_(e){return new mm(this,e)}makeDrawer_(e,t){return new am(e,t)}makePathObject(e,t){return new bm(e,t,this.getConstants())}getConstants(){return this.constants_}};vr("zelos",fm);var Em=class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,t,i){$l.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=i,i.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(t)&&(t.highlight(),this.staticConn=t)}finally{$l.enable$$module$build$src$core$events$utils()}}previewConnection(e,t){if(e!==this.draggedConn||t!==this.staticConn){$l.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.shouldUseMarkerPreview(e,t)&&(this.markerConn=this.previewMarker(e,t)),this.workspace.getRenderer().shouldHighlightConnection(t)&&t.highlight(),this.draggedConn=e,this.staticConn=t}finally{$l.enable$$module$build$src$core$events$utils()}}}shouldUseMarkerPreview(e,t){return t.type===hd.PREVIOUS_STATEMENT||t.type===hd.NEXT_STATEMENT||!(this.workspace.getRenderer()instanceof fm)}previewMarker(e,t){const i=e.getSourceBlock(),n=this.createInsertionMarker(i),o=this.getMatchingConnection(i,n,e);if(!o)return null;n.queueRender(),Mt(),o.connect(t);const s={x:t.x-o.x,y:t.y-o.y},r=o.getOffsetInBlock().clone();return Dt().then((()=>{if(!n.isDeadOrDying()){$l.disable$$module$build$src$core$events$utils();try{null==n||n.positionNearConnection(o,s,r),null==n||n.getSvgRoot().setAttribute("visibility","visible")}finally{$l.enable$$module$build$src$core$events$utils()}}})),o}createInsertionMarker(e){const t=Ci(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!t)throw Error(`Failed to serialize source block. ${e.toDevString()}`);e=Ai(t,this.workspace);for(const t of e.getDescendants(!1))t.setInsertionMarker(!0);return e.initSvg(),e.getSvgRoot().setAttribute("visibility","hidden"),e}getMatchingConnection(e,t,i){if(e=e.getConnections_(!0),t=t.getConnections_(!0),e.length!==t.length)return null;for(let n=0;n<e.length;n++)if(e[n]===i)return t[n];return null}hidePreview(){$l.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{$l.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){const t=e.getSourceBlock(),i=t.outputConnection;let n;if(null!=(n=t.previousConnection)&&n.targetConnection||null!=i&&i.targetConnection)t.unplug(!0);else{let t;null==(t=e.targetBlock())||t.unplug(!1)}t.dispose()}dispose(){this.hidePreview()}};e(Bl.CONNECTION_PREVIEWER,Ll,Em);var ym={};ym.Align=$l.Align$$module$build$src$core$inputs$align,ym.DummyInput=Hd,ym.EndRowInput=Gd,ym.Input=Wd,ym.StatementInput=zd,ym.ValueInput=$l.ValueInput$$module$build$src$core$inputs$value_input,ym.inputTypes=$l.inputTypes$$module$build$src$core$inputs$input_types;var vm=!1;$l.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=Se());var t=[];this.init(e),e=e.getTopBlocks(!0);for(let i,n=0;i=e[n];n++){let e=this.blockToCode(i);Array.isArray(e)&&(e=e[0]),e&&(i.outputConnection&&(e=this.scrubNakedValue(e),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(e=this.injectId(this.STATEMENT_PREFIX,i)+e),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(e+=this.injectId(this.STATEMENT_SUFFIX,i))),t.push(e))}return t=t.join("\n"),(t=(t=(t=this.finish(t)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")}prefixLines(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)}allNestedComments(e){const t=[];e=e.getDescendants(!0);for(let i=0;i<e.length;i++){const n=e[i].getCommentText();n&&t.push(n)}return t.length&&t.push(""),t.join("\n")}blockToCode(e,t){if(!1===this.isInitialized&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var i=this.forBlock[e.type];if("function"!=typeof i)throw Error(`${this.name_} generator does not know how to generate code for block type "${e.type}".`);if(i=i.call(e,e,this),Array.isArray(i)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,i[0],t),i[1]]}if("string"==typeof i)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(i=this.injectId(this.STATEMENT_PREFIX,e)+i),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(i+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,i,t);if(null===i)return"";throw SyntaxError("Invalid code generated: "+i)}valueToCode(e,t,i){if(isNaN(i))throw TypeError("Expecting valid order from block: "+e.type);var n=e.getInputTargetBlock(t);if(!n&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if(!n)return"";if(""===(t=this.blockToCode(n)))return"";if(!Array.isArray(t))throw TypeError(`Expecting tuple from value block: ${n.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(e=t[0],t=t[1],isNaN(t))throw TypeError("Expecting valid order from value block: "+n.type);if(!e)return"";n=!1;var o=Math.floor(i);const s=Math.floor(t);if(o<=s&&(o!==s||0!==o&&99!==o))for(n=!0,o=0;o<this.ORDER_OVERRIDES.length;o++)if(this.ORDER_OVERRIDES[o][0]===i&&this.ORDER_OVERRIDES[o][1]===t){n=!1;break}return n&&(e="("+e+")"),e}statementToCode(e,t){const i=e.getInputTargetBlock(t);if(!i&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if("string"!=typeof(e=this.blockToCode(i)))throw TypeError("Expecting code from statement block: "+(i&&i.type));return e&&(e=this.prefixLines(e,this.INDENT)),e}addLoopTrap(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e}injectId(e,t){return t=t.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+t+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(e,t){if(!this.definitions_[e]){const i=this.nameDB_.getDistinctName(e,$l.NameType$$module$build$src$core$names.PROCEDURE);let n;for(this.functionNames_[e]=i,Array.isArray(t)&&(t=t.join("\n")),t=t.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,i);n!==t;)n=t,t=t.replace(/^(( {2})*) {2}/gm,"$1\0");t=t.replace(/\0/g,this.INDENT),this.definitions_[e]=t}return this.functionNames_[e]}getVariableName(e){return this.getName(e,$l.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,$l.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,t){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(e,t)}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,t,i){return t}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},$l.CodeGenerator$$module$build$src$core$generator;var Cm=class extends wp{constructor(e){super(e)}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),i=t.getScrollMetrics(),n=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.y&&(this.workspace_.scrollY=-(i.top+(i.height-n.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),i=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===Ic.LEFT?e.width:i.width-this.getWidth():this.toolboxPosition_===Ic.LEFT?0:i.width:this.toolboxPosition_===Ic.LEFT?0:i.width+t.left-this.getWidth()}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height;var t=this.getWidth()-this.CORNER_RADIUS;this.setBackgroundPath(t,e.height-2*this.CORNER_RADIUS),e=this.getX(),t=this.getY(),this.positionAt_(this.getWidth(),this.getHeight(),e,t)}}setBackgroundPath(e,t){const i=this.toolboxPosition_===Ic.RIGHT;var n=e+this.CORNER_RADIUS;(n=["M "+(i?n:0)+",0"]).push("h",i?-e:e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("v",Math.max(0,t)),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("h",i?e:-e),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setY(0)}wheel_(e){var t=_(e);if(t.y){const e=this.workspace_.getMetricsManager(),i=e.getScrollMetrics();let n;t=e.getViewMetrics().top-i.top+t.y,null==(n=this.workspace_.scrollbar)||n.setY(t),po(this.workspace_),gn()}e.preventDefault(),e.stopPropagation()}layout_(e){this.workspace_.scale=this.targetWorkspace.scale;var t=this.MARGIN;const i=this.RTL?t:t+this.tabWidth_;for(const n of e)n.getElement().moveBy(i,t),t+=n.getElement().getBoundingRectangle().getHeight()}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<t&&e>-t||e<-180+t||e>180-t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.left;return this.toolboxPosition_===Ic.LEFT?new cc(-1e9,1e9,-1e9,t+e.width):new cc(-1e9,1e9,t,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=this.getContents().reduce(((e,t)=>Math.max(e,t.getElement().getBoundingRectangle().getWidth())),0);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=bc.scrollbarThickness,this.getWidth()!==e){if(this.RTL)for(const t of this.getContents()){const i=t.getElement().getBoundingRectangle().left,n=e/this.workspace_.scale-t.getElement().getBoundingRectangle().getWidth()-this.MARGIN-this.tabWidth_;t.getElement().moveBy(n-i,0)}this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Ic.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};Cm.registryName="verticalFlyout",e(Bl.FLYOUTS_VERTICAL_TOOLBOX,Ll,Cm);var _m=class extends wp{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),i=t.getScrollMetrics(),n=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.x&&(this.workspace_.scrollX=-(i.left+(i.width-n.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),i=e.getViewMetrics();e=e.getToolboxMetrics();const n=this.toolboxPosition_===Ic.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?n?e.height:i.height-this.getHeight():n?0:i.height:n?0:i.height+t.top-this.getHeight()}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,e=e.width-2*this.CORNER_RADIUS;var t=this.getHeight()-this.CORNER_RADIUS;this.setBackgroundPath(e,t),e=this.getX(),t=this.getY(),this.positionAt_(this.getWidth(),this.getHeight(),e,t)}}setBackgroundPath(e,t){const i=this.toolboxPosition_===Ic.TOP,n=["M 0,"+(i?0:this.CORNER_RADIUS)];i?(n.push("h",e+2*this.CORNER_RADIUS),n.push("v",t),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("h",-e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),n.push("h",e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("v",t),n.push("h",-e-2*this.CORNER_RADIUS)),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setX(this.RTL?1/0:0)}wheel_(e){var t=_(e);if(t=t.x||t.y){const e=this.workspace_.getMetricsManager(),i=e.getScrollMetrics();let n;t=e.getViewMetrics().left-i.left+t,null==(n=this.workspace_.scrollbar)||n.setX(t),po(this.workspace_),gn()}e.preventDefault(),e.stopPropagation()}layout_(e){this.workspace_.scale=this.targetWorkspace.scale;const t=this.MARGIN;let i=t+this.tabWidth_;this.RTL&&(e=e.reverse());for(const n of e)e=n.getElement().getBoundingRectangle(),e=this.RTL?i+e.getWidth():i,n.getElement().moveBy(e,t),i+=n.getElement().getBoundingRectangle().getWidth()}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<90+t&&e>90-t||e>-90-t&&e<-90+t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.top;return this.toolboxPosition_===Ic.TOP?new cc(-1e9,t+e.height,-1e9,1e9):new cc(t,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=this.getContents().reduce(((e,t)=>Math.max(e,t.getElement().getBoundingRectangle().getHeight())),0);e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=bc.scrollbarThickness,this.getHeight()!==e&&(this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Ic.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets())}};e(Bl.FLYOUTS_HORIZONTAL_TOOLBOX,Ll,_m);var Tm=class extends fd{constructor(e,t,i,n,o){super($u.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=Tm.dropdownCreate,this.defaultVariableName="string"==typeof e?e:"",this.size_=new hc(0,0),e!==$u.SKIP_SETUP&&(o?this.configure_(o):this.setTypes(i,n),t&&this.setValidator(t))}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new Ou;this.variable||(e=$l.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}initView(){super.initView(),ce(this.fieldGroup_,"blocklyVariableField")}shouldAddBorderRect_(){const e=this.getSourceBlock();if(!e)throw new Ou;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!==e.type)}fromXml(e){var t=this.getSourceBlock();if(!t)throw new Ou;const i=e.getAttribute("id"),n=e.textContent,o=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(t=$l.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,i,n,o),null!==o&&o!==t.getType())throw Error("Serialized variable type with id '"+t.getId()+"' had type "+t.getType()+", and does not match variable field that references it: "+Vo(e)+".");this.setValue(t.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.getName(),this.variable.getType()&&e.setAttribute("variabletype",this.variable.getType()),e}saveState(e){var t=this.saveLegacyState(Tm);return null!==t||(this.initModel(),t={id:this.variable.getId()},e&&(t.name=this.variable.getName(),t.type=this.variable.getType())),t}loadState(e){const t=this.getSourceBlock();if(!t)throw new Ou;this.loadLegacyState(Tm,e)||(e=$l.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.getName():""}getVariable(){return this.variable}getDefaultType(){return this.defaultType}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(null===e)return null;var t=this.getSourceBlock();if(!t)throw new Ou;return(t=$l.getVariable$$module$build$src$core$variables(t.workspace,e))?(t=t.getType(),this.typeIsAllowed(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)}doValueUpdate_(e){const t=this.getSourceBlock();if(!t)throw new Ou;this.variable=$l.getVariable$$module$build$src$core$variables(t.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(e){const t=this.getVariableTypes();if(!t)return!0;for(let i=0;i<t.length;i++)if(e===t[i])return!0;return!1}getVariableTypes(){if(this.variableTypes)return this.variableTypes;if(!this.sourceBlock_||this.sourceBlock_.isDeadOrDying())return[""];let e=this.sourceBlock_.workspace.getVariableMap().getTypes();if(this.sourceBlock_.isInFlyout){const t=this.sourceBlock_.workspace.getPotentialVariableMap();if(!t)return e;e=Array.from(new Set([...e,...t.getTypes()]))}return e}setTypes(e=null,t=""){var i=this.getText();if(Array.isArray(e)){if(0===e.length)throw Error(`'variableTypes' of field variable ${i} was an empty list. If you want to include all variable types, pass 'null' instead.`);i=!1;for(let n=0;n<e.length;n++)e[n]===t&&(i=!0);if(!i)throw Error("Invalid default type '"+t+"' in the definition of a FieldVariable")}else if(null!==e)throw Error(`'variableTypes' was not an array or null in the definition of FieldVariable ${i}`);this.defaultType=t,this.variableTypes=e}refreshVariableName(){this.forceRerender()}onItemSelected_(e,t){if(e=t.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if(e===Bd&&this.variable)return void $l.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);if(e===Pd&&this.variable)return e=this.variable.getWorkspace(),void $l.deleteVariable$$module$build$src$core$variables(e,this.variable,this.sourceBlock_)}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(io(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const e=this.getText();let t=[];var i=this.getSourceBlock();if(i&&!i.isDeadOrDying()){i=i.workspace;const e=this.getVariableTypes();for(let s=0;s<e.length;s++){const r=e[s],l=i.getVariableMap().getVariablesOfType(r);if(t=t.concat(l),i.isFlyout){var n=void 0,o=void 0;t=t.concat(null!=(o=null==(n=i.getPotentialVariableMap())?void 0:n.getVariablesOfType(r))?o:[])}}}for(t.sort(yi),n=[],o=0;o<t.length;o++)n[o]=[t[o].getName(),t[o].getId()];return n.push([$l.Msg$$module$build$src$core$msg.RENAME_VARIABLE,Bd]),$l.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&n.push([$l.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),Pd]),n}};ss("field_variable",Tm);var wm=class extends hm{constructor(e,t,i,n,o,s){super($u.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==$u.SKIP_SETUP&&(s?this.configure_(s):this.setConstraints(t,i,n),this.setValue(e),o&&this.setValidator(o))}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);t.includes("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const i=t.indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}getPrecision(){return this.precision_}doClassValidation_(e){return null===e?null:(e=(e=(e=`${e}`.replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e)?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),null!==this.decimalPlaces&&(e=Number(e.toFixed(this.decimalPlaces))),e))}widgetCreate_(){const e=super.widgetCreate_();return-1/0<this.min_&&(e.min=`${this.min_}`,Rt(e,zc.VALUEMIN,this.min_)),1/0>this.max_&&(e.max=`${this.max_}`,Rt(e,zc.VALUEMAX,this.max_)),e}initView(){super.initView(),this.fieldGroup_&&ce(this.fieldGroup_,"blocklyNumberField")}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}};ss("field_number",wm),wm.prototype.DEFAULT_VALUE=0;var Im=class extends Md{constructor(e,t,i){super(String(null!=e?e:""),t,i),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(io(e.text),void 0,e)}};ss("field_label_serializable",Im);var km=class extends $u{constructor(e,t,i){super($u.SKIP_SETUP),this.SERIALIZABLE=!0,this.value_=this.value_,this.checkChar=km.CHECK_CHAR,e!==$u.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){const e=this.saveLegacyState(km);return null!==e?e:this.getValueBoolean()}initView(){super.initView();const e=this.getTextElement();ce(this.fieldGroup_,"blocklyCheckboxField"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||km.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return!0===e||"TRUE"===e?"TRUE":!1===e||"FALSE"===e?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool(this.value_))}convertValueToBool(e){return"string"==typeof e?"TRUE"===e:!!e}static fromJson(e){return new this(e.checked,void 0,e)}};km.CHECK_CHAR="✓",ss("field_checkbox",km),km.prototype.DEFAULT_VALUE=!1;var xm=class{constructor(e,t){this.draggable=e,this.workspace=t,this.dragTarget=null,this.startLoc=e.getRelativeToSurfaceXY()}onDragStart(e){$l.getGroup$$module$build$src$core$events$utils()||$l.setGroup$$module$build$src$core$events$utils(!0),this.draggable.startDrag(e)}onDrag(e,t){this.moveDraggable(e,t),t=this.getRoot(this.draggable),Ys(t)&&t.setDeleteStyle(this.wouldDeleteDraggable(e,t)),this.updateDragTarget(e)}updateDragTarget(e){e=this.workspace.getDragTarget(e);const t=this.getRoot(this.draggable);if(this.dragTarget!==e){let i;null==(i=this.dragTarget)||i.onDragExit(t),null==e||e.onDragEnter(t)}null==e||e.onDragOver(t),this.dragTarget=e}moveDraggable(e,t){t=this.pixelsToWorkspaceUnits(t),t=lc.sum(this.startLoc,t),this.draggable.drag(t,e)}wouldDeleteDraggable(e,t){return!(!(e=this.workspace.getDragTarget(e))||!this.workspace.getComponentManager().hasCapability(e.id,tc.Capability.DELETE_AREA))&&e.wouldDelete(t)}onDragEnd(e){const t=$l.getGroup$$module$build$src$core$events$utils();var i=this.workspace.getDragTarget(e);const n=this.getRoot(this.draggable);if(i){let e;null==(e=this.dragTarget)||e.onDrop(n)}this.shouldReturnToStart(e,n)&&this.draggable.revertDrag(),(i=Ys(n)&&this.wouldDeleteDraggable(e,n))&&this.draggable instanceof ip&&Ls(this.draggable.getRootBlock()),this.draggable.endDrag(e),i&&Ys(n)&&($l.setGroup$$module$build$src$core$events$utils(t),n.dispose()),$l.setGroup$$module$build$src$core$events$utils(!1),!i&&_e(this.draggable)&&$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.draggable)}getRoot(e){return e instanceof ip?e.getRootBlock():e}shouldReturnToStart(e,t){return!!(e=this.workspace.getDragTarget(e))&&e.shouldPreventMove(t)}pixelsToWorkspaceUnits(e){return e=new lc(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}};e(Bl.BLOCK_DRAGGER,Ll,xm);var Nm={};Nm.BlockDragStrategy=Zd,Nm.BubbleDragStrategy=_d,Nm.CommentDragStrategy=ed,Nm.Dragger=xm;var Sm=class extends Ja{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type=ia.BLOCK_DRAG,e&&(this.blockId=e.id,this.isStart=t,this.blocks=i)}toJson(){const e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Sm)).isStart=e.isStart,t.blockId=e.blockId,t.blocks=e.blocks,t}};e(Bl.EVENT,ia.BLOCK_DRAG,Sm);var Am=class extends Uh{constructor(e,t,i,n){super(e),this.type=ia.BLOCK_FIELD_INTERMEDIATE_CHANGE,this.recordUndo=!1,e&&(this.name=t,this.oldValue=i,this.newValue=n)}toJson(){const e=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Am)).name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name)}};e(Bl.EVENT,ia.BLOCK_FIELD_INTERMEDIATE_CHANGE,Am);var Rm=class extends Uh{constructor(e){super(e),this.type=ia.BLOCK_MOVE,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){const e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Rm)).oldParentId=e.oldParentId,t.oldInputName=e.oldInputName,e.oldCoordinate&&(i=e.oldCoordinate.split(","),t.oldCoordinate=new lc(Number(i[0]),Number(i[1]))),t.newParentId=e.newParentId,t.newInputName=e.newInputName,e.newCoordinate&&(i=e.newCoordinate.split(","),t.newCoordinate=new lc(Number(i[0]),Number(i[1]))),void 0!==e.reason&&(t.reason=e.reason),void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}recordNew(){const e=this.currentLocation();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var t=e.getBlockById(this.blockId);if(!t)throw Error("The block associated with the block move event could not be found");e={};const i=t.getParent();return i?(e.parentId=i.id,(t=i.getInputWithBlock(t))&&(e.inputName=t.name)):e.coordinate=t.getRelativeToSurfaceXY(),e}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&lc.equals(this.oldCoordinate,this.newCoordinate)}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var i=t.getBlockById(this.blockId);if(i){var n=e?this.newParentId:this.oldParentId,o=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,n){var s=t.getBlockById(n);if(!s)return void console.warn("Can't connect to non-existent block: "+n)}if(i.getParent()&&i.unplug(),e)o=i.getRelativeToSurfaceXY(),i.moveBy(e.x-o.x,e.y-o.y,this.reason);else{let e,n;(!(t=i.outputConnection)||i.previousConnection&&i.previousConnection.isConnected())&&(t=i.previousConnection),i=null==(n=t)?void 0:n.type,o?(i=s.getInput(o))&&(e=i.connection):i===hd.PREVIOUS_STATEMENT&&(e=s.nextConnection),e&&t?t.connect(e):console.warn("Can't connect to non-existent input: "+o)}}else console.warn("Can't move non-existent block: "+this.blockId)}};e(Bl.EVENT,ia.BLOCK_MOVE,Rm);var $m,Om=class extends Ja{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type=ia.BUBBLE_OPEN,e&&(this.blockId=e.id,this.isOpen=t,this.bubbleType=i)}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Om)).isOpen=e.isOpen,t.bubbleType=e.bubbleType,t.blockId=e.blockId,t}};(function(e){e.MUTATOR="mutator",e.COMMENT="comment",e.WARNING="warning"})($m||($m={})),e(Bl.EVENT,ia.BUBBLE_OPEN,Om);var Dm={};Dm.BubbleOpen=Om,Dm.BubbleType=$m;var Mm=class extends Ya{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=$l.getGroup$$module$build$src$core$events$utils(),this.recordUndo=Y())}toJson(){const e=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.commentId=this.commentId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Mm)).commentId=e.commentId,t}static CommentCreateDeleteHelper(e,t){const i=e.getEventWorkspace_();if(t){if(!e.json)throw Error("Encountered a comment event without proper json");It(e.json,i)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=i.getCommentById(e.commentId))?t.dispose():console.warn("Can't delete non-existent comment: "+e.commentId)}}},Lm=class extends Mm{constructor(e,t,i){super(e),this.type=ia.COMMENT_CHANGE,e&&(this.oldContents_=void 0===t?"":t,this.newContents_=void 0===i?"":i)}toJson(){const e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Lm)).oldContents_=e.oldContents,t.newContents_=e.newContents,t}isNull(){return this.oldContents_===this.newContents_}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){var i=e?this.newContents_:this.oldContents_;if(void 0===i){if(e)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson")}t.setText(i)}else console.warn("Can't change non-existent comment: "+this.commentId)}};e(Bl.EVENT,ia.COMMENT_CHANGE,Lm);var Bm=class extends Mm{constructor(e,t){super(e),this.newCollapsed=t,this.type=ia.COMMENT_COLLAPSE}toJson(){const e=super.toJson();if(void 0===this.newCollapsed)throw Error("The new collapse value undefined. Either call recordNew, or call fromJson");return e.newCollapsed=this.newCollapsed,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Bm)).newCollapsed=e.newCollapsed,t}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=t.getCommentById(this.commentId))?t.setCollapsed(e?!!this.newCollapsed:!this.newCollapsed):console.warn("Can't collapse or uncollapse non-existent comment: "+this.commentId)}};e(Bl.EVENT,ia.COMMENT_COLLAPSE,Bm);var Pm=class extends Mm{constructor(e){super(e),this.type=ia.COMMENT_CREATE,e&&(this.xml=Oo(e),this.json=wt(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Vo(this.xml),e.json=this.json,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Pm)).xml=$l.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}run(e){Mm.CommentCreateDeleteHelper(this,e)}};e(Bl.EVENT,ia.COMMENT_CREATE,Pm);var Fm=class extends Mm{constructor(e){super(e),this.type=ia.COMMENT_DELETE,e&&(this.xml=Oo(e),this.json=wt(e,{addCoordinates:!0}))}run(e){Mm.CommentCreateDeleteHelper(this,!e)}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Vo(this.xml),e.json=this.json,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Fm)).xml=$l.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}};e(Bl.EVENT,ia.COMMENT_DELETE,Fm);var Vm=class extends Ja{constructor(e,t){super(e?e.workspace.id:void 0),this.type=ia.COMMENT_DRAG,e&&(this.commentId=e.id,this.isStart=t)}toJson(){const e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.isStart=this.isStart,e.commentId=this.commentId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Vm)).isStart=e.isStart,t.commentId=e.commentId,t}};e(Bl.EVENT,ia.COMMENT_DRAG,Vm);var Um=class extends Mm{constructor(e){super(e),this.type=ia.COMMENT_MOVE,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setReason(e){this.reason=e}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){const e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return e.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e}static fromJson(e,t,i){return t=super.fromJson(e,t,null!=i?i:new Um),i=e.oldCoordinate.split(","),t.oldCoordinate_=new lc(Number(i[0]),Number(i[1])),i=e.newCoordinate.split(","),t.newCoordinate_=new lc(Number(i[0]),Number(i[1])),t}isNull(){return lc.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newCoordinate_:this.oldCoordinate_))throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");t.moveTo(e)}else console.warn("Can't move non-existent comment: "+this.commentId)}};e(Bl.EVENT,ia.COMMENT_MOVE,Um);var Wm=class extends Mm{constructor(e){super(e),this.type=ia.COMMENT_RESIZE,e&&(this.oldSize=e.getSize())}recordCurrentSizeAsNewSize(){if(this.newSize)throw Error("Tried to record the new size of a comment on the same event twice.");var e=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(!(e=e.getCommentById(this.commentId)))throw Error("The comment associated with the comment resize event could not be found");this.newSize=e.getSize()}toJson(){const e=super.toJson();if(!this.oldSize)throw Error("The old comment size is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newSize)throw Error("The new comment size is undefined. Either call recordCurrentSizeAsNewSize, or call fromJson");return e.oldWidth=Math.round(this.oldSize.width),e.oldHeight=Math.round(this.oldSize.height),e.newWidth=Math.round(this.newSize.width),e.newHeight=Math.round(this.newSize.height),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Wm)).oldSize=new hc(e.oldWidth,e.oldHeight),t.newSize=new hc(e.newWidth,e.newHeight),t}isNull(){return hc.equals(this.oldSize,this.newSize)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newSize:this.oldSize))throw Error("Either oldSize or newSize is undefined. Either pass a comment to the constructor and call recordCurrentSizeAsNewSize, or call fromJson");t.setSize(e)}else console.warn("Can't resize non-existent comment: "+this.commentId)}};e(Bl.EVENT,ia.COMMENT_RESIZE,Wm);var Hm=class extends Ja{constructor(e,t,i){super(i),this.type=ia.TOOLBOX_ITEM_SELECT,this.oldItem=null!=e?e:void 0,this.newItem=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Hm)).oldItem=e.oldItem,t.newItem=e.newItem,t}};e(Bl.EVENT,ia.TOOLBOX_ITEM_SELECT,Hm);var Gm=class extends Tg{constructor(e,t,i){super(e),this.oldType=t,this.newType=i,this.type=ia.VAR_TYPE_CHANGE}toJson(){const e=super.toJson();if(!this.oldType||!this.newType)throw Error("The variable's types are undefined. Either pass them to the constructor, or call fromJson");return e.oldType=this.oldType,e.newType=this.newType,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Gm)).oldType=e.oldType,t.newType=e.newType,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldType||!this.newType)throw Error("The variable's types are undefined. Either pass them to the constructor, or call fromJson");const i=t.getVariableMap().getVariableById(this.varId);i&&(e?t.getVariableMap().changeVariableType(i,this.newType):t.getVariableMap().changeVariableType(i,this.oldType))}};e(Bl.EVENT,ia.VAR_TYPE_CHANGE,Gm);var zm,jm,Xm,Km,Ym,Jm,qm,Qm,Zm,eb,tb,ib,nb,ob,sb,rb,lb,ab,cb,hb,ub,db,pb,gb,mb,bb=class extends Ya{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=ia.FINISHED_LOADING,this.isBlank=!!e,e&&(this.workspaceId=e.id)}};e(Bl.EVENT,ia.FINISHED_LOADING,bb),$l.BLOCK_CHANGE$$module$build$src$core$events$events=ia.BLOCK_CHANGE,$l.BLOCK_CREATE$$module$build$src$core$events$events=ia.BLOCK_CREATE,$l.BLOCK_DELETE$$module$build$src$core$events$events=ia.BLOCK_DELETE,zm=ia.BLOCK_DRAG,$l.BLOCK_MOVE$$module$build$src$core$events$events=ia.BLOCK_MOVE,jm=ia.BLOCK_FIELD_INTERMEDIATE_CHANGE,Xm=ia.BUBBLE_OPEN,Km=ia.BLOCK_CHANGE,Ym=ia.CLICK,Jm=ia.COMMENT_CHANGE,qm=ia.COMMENT_CREATE,Qm=ia.COMMENT_DELETE,Zm=ia.COMMENT_MOVE,eb=ia.COMMENT_RESIZE,tb=ia.COMMENT_DRAG,ib=ia.BLOCK_CREATE,nb=ia.BLOCK_DELETE,ob=ia.FINISHED_LOADING,sb=ia.BLOCK_MOVE,rb=ia.SELECTED,lb=ia.THEME_CHANGE,ab=ia.TOOLBOX_ITEM_SELECT,cb=ia.TRASHCAN_OPEN,hb=ia.UI,ub=ia.VAR_CREATE,db=ia.VAR_DELETE,pb=ia.VAR_RENAME,gb=ia.VIEWPORT_CHANGE,(mb={}).Abstract=Ya,mb.BLOCK_CHANGE=$l.BLOCK_CHANGE$$module$build$src$core$events$events,mb.BLOCK_CREATE=$l.BLOCK_CREATE$$module$build$src$core$events$events,mb.BLOCK_DELETE=$l.BLOCK_DELETE$$module$build$src$core$events$events,mb.BLOCK_DRAG=zm,mb.BLOCK_FIELD_INTERMEDIATE_CHANGE=jm,mb.BLOCK_MOVE=$l.BLOCK_MOVE$$module$build$src$core$events$events,mb.BUBBLE_OPEN=Xm,mb.BUMP_EVENTS=ma,mb.BlockBase=Uh,mb.BlockChange=Wh,mb.BlockCreate=ld,mb.BlockDelete=gd,mb.BlockDrag=Sm,mb.BlockFieldIntermediateChange=Am,mb.BlockMove=Rm,mb.BubbleOpen=Om,mb.BubbleType=$m,mb.CHANGE=Km,mb.CLICK=Ym,mb.COMMENT_CHANGE=Jm,mb.COMMENT_CREATE=qm,mb.COMMENT_DELETE=Qm,mb.COMMENT_DRAG=tb,mb.COMMENT_MOVE=Zm,mb.COMMENT_RESIZE=eb,mb.CREATE=ib,mb.Click=qa,mb.ClickTarget=Ka,mb.CommentBase=Mm,mb.CommentChange=Lm,mb.CommentCollapse=Bm,mb.CommentCreate=Pm,mb.CommentDelete=Fm,mb.CommentDrag=Vm,mb.CommentMove=Um,mb.CommentResize=Wm,mb.DELETE=nb,mb.FINISHED_LOADING=ob,mb.FinishedLoading=bb,mb.MOVE=sb,mb.SELECTED=rb,mb.Selected=pd,mb.THEME_CHANGE=lb,mb.TOOLBOX_ITEM_SELECT=ab,mb.TRASHCAN_OPEN=cb,mb.ThemeChange=cd,mb.ToolboxItemSelect=Hm,mb.TrashcanOpen=Sg,mb.UI=hb,mb.UiBase=Ja,mb.VAR_CREATE=ub,mb.VAR_DELETE=db,mb.VAR_RENAME=pb,mb.VIEWPORT_CHANGE=gb,mb.VarBase=Tg,mb.VarCreate=wg,mb.VarDelete=kg,mb.VarRename=xg,mb.VarTypeChange=Gm,mb.ViewportChange=ud,mb.clearPendingUndo=te,mb.disable=$l.disable$$module$build$src$core$events$utils,mb.disableOrphans=le,mb.enable=$l.enable$$module$build$src$core$events$utils,mb.filter=ee,mb.fire=J,mb.fromJson=se,mb.get=re,mb.getDescendantIds=oe,mb.getGroup=$l.getGroup$$module$build$src$core$events$utils,mb.getRecordUndo=Y,mb.isEnabled=ie,mb.setGroup=$l.setGroup$$module$build$src$core$events$utils,mb.setRecordUndo=$l.setRecordUndo$$module$build$src$core$events$utils;var fb={};fb.BottomRow=um,fb.ConstantProvider=lm,fb.Drawer=am,fb.PathObject=bm,fb.RenderInfo=mm,fb.Renderer=fm,fb.RightConnectionShape=pm,fb.StatementInput=dm,fb.TopRow=gm,kl();var Eb={};Eb.registerCleanup=ol,Eb.registerCollapse=rl,Eb.registerCollapseExpandBlock=bl,Eb.registerComment=gl,Eb.registerCommentCreate=_l,Eb.registerCommentDelete=vl,Eb.registerCommentDuplicate=Cl,Eb.registerCommentOptions=Il,Eb.registerDefaultOptions=kl,Eb.registerDelete=El,Eb.registerDeleteAll=ul,Eb.registerDisable=fl,Eb.registerDuplicate=pl,Eb.registerExpand=ll,Eb.registerHelp=yl,Eb.registerInline=ml,Eb.registerRedo=nl,Eb.registerUndo=il;var yb={};yb.CommentView=nd,yb.RenderedWorkspaceComment=sd,yb.WorkspaceComment=od;var vb="button",Cb=class{load(e,t){return(e=new ap(t.getWorkspace(),t.targetWorkspace,e,!1)).show(),new sp(e,vb)}gapForItem(e,t){return t}disposeItem(e){(e=e.getElement())instanceof ap&&e.dispose()}getType(){return vb}};e(Bl.FLYOUT_INFLATER,vb,Cb);var _b={};_b.Bubble=Td,_b.MiniWorkspaceBubble=wd,_b.TextBubble=ep,_b.TextInputBubble=Op;var Tb="block",wb=class{constructor(){this.permanentlyDisabledBlocks=new Set,this.listeners=new Map,this.capacityWrapper=this.filterFlyoutBasedOnCapacity.bind(this)}load(e,t){return this.setFlyout(t),(e=this.createBlock(e,t.getWorkspace())).isEnabled()?this.updateStateBasedOnCapacity(e):this.permanentlyDisabledBlocks.add(e),e.getDescendants(!1).forEach((e=>e.isInFlyout=!0)),this.addBlockListeners(e),new sp(e,Tb)}createBlock(e,t){return e.blockxml?(e="string"==typeof e.blockxml?$l.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,t=zo(e,t)):(void 0===e.enabled&&(e.enabled="true"!==e.disabled&&!0!==e.disabled),void 0===e.disabledReasons&&!1===e.enabled&&(e.disabledReasons=[eh]),"x"in e&&delete e.x,"y"in e&&delete e.y,t=Ri(e,t)),t}gapForItem(e,t){let i;return e.gap?i=parseInt(String(e.gap)):e.blockxml&&(e="string"==typeof e.blockxml?$l.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,i=parseInt(e.getAttribute("gap"))),!i||isNaN(i)?t:i}disposeItem(e){(e=e.getElement())instanceof ip&&(this.removeListeners(e.id),e.dispose(!1,!1))}removeListeners(e){let t;(null!=(t=this.listeners.get(e))?t:[]).forEach((e=>E(e))),this.listeners.delete(e)}setFlyout(e){if(this.flyout!==e){if(this.flyout){let e;null==(e=this.flyout.targetWorkspace)||e.removeChangeListener(this.capacityWrapper)}var t;this.flyout=e,null==(t=this.flyout.targetWorkspace)||t.addChangeListener(this.capacityWrapper)}}updateStateBasedOnCapacity(e){let t,i;const n=null==(t=this.flyout)||null==(i=t.targetWorkspace)?void 0:i.isCapacityAvailable(Be(e));for(;e;)e.setDisabledReason(!n,"WORKSPACE_AT_BLOCK_CAPACITY"),e=e.getNextBlock()}addBlockListeners(e){const t=[];t.push(b(e.getSvgRoot(),"pointerdown",e,(t=>{let i,n;const o=null==(i=this.flyout)||null==(n=i.targetWorkspace)?void 0:n.getGesture(t);o&&this.flyout&&(o.setStartBlock(e),o.handleFlyoutStart(t,this.flyout))}))),t.push(f(e.getSvgRoot(),"pointermove",null,(()=>{let t,i;null!=(t=this.flyout)&&null!=(i=t.targetWorkspace)&&i.isDragging()||e.addSelect()}))),t.push(f(e.getSvgRoot(),"pointerleave",null,(()=>{let t,i;null!=(t=this.flyout)&&null!=(i=t.targetWorkspace)&&i.isDragging()||e.removeSelect()}))),this.listeners.set(e.id,t)}filterFlyoutBasedOnCapacity(e){!this.flyout||e&&e.type!==ia.BLOCK_CREATE&&e.type!==ia.BLOCK_DELETE||this.flyout.getWorkspace().getTopBlocks(!1).forEach((e=>{this.permanentlyDisabledBlocks.has(e)||this.updateStateBasedOnCapacity(e)}))}getType(){return Tb}};e(Bl.FLYOUT_INFLATER,Tb,wb);var Ib=class{constructor(){this.curNode=this.colour=null,this.type="marker"}getCurNode(){return this.curNode}setCurNode(e){this.curNode=e}dispose(){this.curNode=null}getSourceBlockFromNode(e){return e instanceof ip?e:e instanceof $u||e instanceof Fd?e.getSourceBlock():null}getSourceBlock(){return this.getSourceBlockFromNode(this.getCurNode())}},kb=class extends Ib{constructor(e){super(),this.workspace=e,this.type="cursor",this.potentialNodes=null}next(){var e=this.getCurNode();return e?((e=this.getNextNode(e,(e=>{let t;return e instanceof ip&&!(null!=(t=e.outputConnection)&&t.targetBlock())}),!0))&&this.setCurNode(e),e):null}in(){var e=this.getCurNode();return e?((e=this.getNextNode(e,(()=>!0),!0))&&this.setCurNode(e),e):null}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode(e,(e=>{let t;return e instanceof ip&&!(null!=(t=e.outputConnection)&&t.targetBlock())}),!0))&&this.setCurNode(e),e):null}out(){var e=this.getCurNode();return e?((e=this.getPreviousNode(e,(()=>!0),!0))&&this.setCurNode(e),e):null}atEndOfLine(){var e=this.getCurNode();return!!e&&this.getNextNode(e,(()=>!0),!0)===this.getNextNode(e,(e=>{let t;return e instanceof ip&&!(null!=(t=e.outputConnection)&&t.targetBlock())}),!0)}getNextNodeImpl(e,t,i=new Set){if(!e||i.has(e))return null;let n=this.workspace.getNavigator().getFirstChild(e)||this.workspace.getNavigator().getNextSibling(e);for(var o=e;o&&!n&&(o=this.workspace.getNavigator().getParent(o));)n=this.workspace.getNavigator().getNextSibling(o);return t(n)?n:n?(i.add(e),this.getNextNodeImpl(n,t,i)):null}getNextNode(e,t,i){return!e||!i&&this.getLastNode()===e?null:this.getNextNodeImpl(e,t)}getPreviousNodeImpl(e,t,i=new Set){if(!e||i.has(e))return null;const n=this.getRightMostChild(this.workspace.getNavigator().getPreviousSibling(e),e)||this.workspace.getNavigator().getParent(e);return t(n)?n:n?(i.add(e),this.getPreviousNodeImpl(n,t,i)):null}getPreviousNode(e,t,i){return!e||!i&&this.getFirstNode()===e?null:this.getPreviousNodeImpl(e,t)}getRightMostChild(e,t){if(!e)return e;let i=this.workspace.getNavigator().getFirstChild(e);if(!i||i===t)return e;for(e=i;e&&e!==t;e=this.workspace.getNavigator().getNextSibling(i))i=e;return this.getRightMostChild(i,t)}preDelete(e){var t,i=this.getCurNode();let n,o;i=i?[i]:[];const s=null!=(o=null==(t=e.previousConnection)?void 0:t.targetConnection)?o:null==(n=e.outputConnection)?void 0:n.targetConnection;s&&i.push(s),(t=e.getNextBlock())&&i.push(t),(e=e.getParent())&&i.push(e),i.push(this.workspace),this.potentialNodes=i}postDelete(){const e=this.potentialNodes;if(this.potentialNodes=null,!e)throw Error("must call preDelete first");for(const t of e){let e;if(null==(e=this.getSourceBlockFromNode(t))||!e.disposed)return void this.setCurNode(t)}throw Error("no valid nodes in this.potentialNodes")}getCurNode(){const e=$l.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode(),t=this.getSourceBlockFromNode(e);return t&&t.workspace===this.workspace&&this.setCurNode(e),super.getCurNode()}setCurNode(e){super.setCurNode(e),_e(e)&&$l.getFocusManager$$module$build$src$core$focus_manager().focusNode(e),e instanceof ip?e.workspace.scrollBoundsIntoView(e.getBoundingRectangleWithoutChildren()):e instanceof $u&&(e=e.getSourceBlock()).workspace.scrollBoundsIntoView(e.getBoundingRectangleWithoutChildren())}getFirstNode(){return this.workspace.getNavigator().getFirstChild(this.workspace)}getLastNode(){const e=this.getFirstNode();return this.getPreviousNode(e,(()=>!0),!0)}};e(Bl.CURSOR,Ll,kb);var xb=class extends ag{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([`${e} .blocklyInsertionMarker>.blocklyPathLight,`,`${e} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},Nb=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+"\n"+this.inlineSteps_}drawTopCorner(e){this.steps_+=ks(e.xPos,this.info_.startY);for(let t,i=0;t=e.elements[i];i++)Vp.isLeftSquareCorner(t)?this.steps_+=this.highlightConstants_.START_POINT:Vp.isLeftRoundedCorner(t)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):Vp.isPreviousConnection(t)?this.steps_+=this.notchPaths_.pathLeft:Vp.isHat(t)?this.steps_+=this.startPaths_.path(this.RTL_):Vp.isSpacer(t)&&0!==t.width&&(this.steps_+=Ss("H",t.xPos+t.width-this.highlightOffset));this.steps_+=Ss("H",e.xPos+e.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+Ss("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){const t=e.getLastInput();if(this.RTL_){const i=e.height-t.connectionHeight;this.steps_+=Is(t.xPos+t.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+Ss("v",i)}else this.steps_+=Is(t.xPos+t.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){const t=e.getLastInput();if(t)if(this.RTL_){const i=e.height-2*this.insideCornerPaths_.height;this.steps_+=Is(t.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+Ss("v",i)+this.insideCornerPaths_.pathBottom(this.RTL_)+xs(e.width-t.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=Is(t.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+xs(e.width-t.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(e){const t=e.xPos+e.width-this.highlightOffset;e instanceof og&&e.followsStatement&&(this.steps_+=Ss("H",t)),this.RTL_&&(this.steps_+=Ss("H",t),e.height>this.highlightOffset&&(this.steps_+=Ss("V",e.yPos+e.height-this.highlightOffset)))}drawBottomRow(e){if(this.RTL_)this.steps_+=Ss("V",e.baseline-this.highlightOffset);else{const t=this.info_.bottomRow.elements[0];Vp.isLeftSquareCorner(t)?this.steps_+=Is(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):Vp.isLeftRoundedCorner(t)&&(this.steps_+=Is(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=Is(this.info_.startX,e):(this.steps_+=Is(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=Ss("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,Vp.isLeftRoundedCorner(e.elements[0])?this.steps_+=Ss("V",this.outsideCornerPaths_.height):this.steps_+=Ss("V",e.capline+this.highlightOffset))}drawInlineInput(e){const t=this.highlightOffset,i=e.xPos+e.connectionWidth;var n=e.centerline-e.height/2;const o=e.width-e.connectionWidth,s=n+t;this.RTL_?(n=e.connectionOffsetY-t,e=e.height-(e.connectionOffsetY+e.connectionHeight)+t,this.inlineSteps_+=Is(i-t,s)+Ss("v",n)+this.puzzleTabPaths_.pathDown(this.RTL_)+Ss("v",e)+Ss("h",o)):this.inlineSteps_+=Is(e.xPos+e.width+t,s)+Ss("v",e.height)+Ss("h",-o)+Is(i,n+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},Sb=class extends hg{constructor(e,t){super(e,t),this.highlighter_=new Nb(t)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const e=this.block_.pathObject;e.setPath(this.outlinePath_+"\n"+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=Ss("H",e.xPos+e.width)+Ss("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let i=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(i*=-1),e.connectionModel.setOffsetInBlock(i,t+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let i=e.xPos+e.statementEdge+t.notchOffset;i=this.info_.RTL?-1*i:i+this.constants_.DARK_PATH_OFFSET,t.connectionModel.setOffsetInBlock(i,e.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let i=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,i=t.xPos;t.connectionModel.setOffsetInBlock((this.info_.RTL?-i:i)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}}},Ab=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=ks(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e+t)-t,n=ks(i,i)+As("a","0 0,0",e,Ts(-i-t,e-i)),o=As("a","0 0,0",e+t,Ts(e+t,e+t)),s=ks(i,-i)+As("a","0 0,0",e+t,Ts(e-i,i+t));return{width:e+t,height:e,pathTop:e=>e?n:"",pathBottom:e=>e?o:s}}makeOutsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e-t)+t,n=ks(i,i)+As("a","0 0,1",e-t,Ts(e-i,-i+t)),o=ks(t,e)+As("a","0 0,1",e-t,Ts(e,-e+t)),s=-i,r=ks(i,s)+As("a","0 0,1",e-t,Ts(-i+t,-s-e));return{height:e,topLeft:e=>e?n:o,bottomLeft:()=>r}}makePuzzleTab(){const e=this.constantProvider.TAB_WIDTH,t=this.constantProvider.TAB_HEIGHT,i=ks(-2,3.4-t)+xs(-.45*e,-2.1),n=Ss("v",2.5)+ks(.97*-e,2.5)+ws("q",[Ts(.05*-e,10),Ts(.3*e,9.5)])+ks(.67*e,-1.9)+Ss("v",2.5),o=Ss("v",-1.5)+ks(-.92*e,-.5)+ws("q",[Ts(-.19*e,-5.5),Ts(0,-11)])+ks(.92*e,1),s=ks(-5,t-.7)+xs(.46*e,-2.1);return{width:e,height:t,pathUp:e=>e?i:o,pathDown:e=>e?n:s}}makeNotch(){return{pathLeft:Ss("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:xs(5.1,2.6)+ks(-10.2,6.8)+xs(5.1,2.6),height:12,width:10.2}}makeStartHat(){const e=this.constantProvider.START_HAT.height,t=ks(25,-8.7)+ws("c",[Ts(29.7,-6.2),Ts(57.2,-.5),Ts(75,8.7)]),i=ws("c",[Ts(17.8,-9.2),Ts(45.3,-14.9),Ts(75,-8.7)])+Is(100.5,e+.5);return{path:e=>e?t:i}}},Rb=class extends qp{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},$b=class extends rg{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},Ob=class extends ug{constructor(e,t){super(e,t),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof zd||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,t){this.isInline&&e instanceof $l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Rb(this.constants_,e)),t.hasInlineInput=!0):e instanceof zd?(t.elements.push(new $b(this.constants_,e)),t.hasStatement=!0):e instanceof $l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new jp(this.constants_,e)),t.hasExternalInput=!0):(e instanceof Hd||e instanceof Gd)&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),this.isInline||null!==t.align||(t.align=e.align)}addElemSpacing_(){let e=!1;for(let t,i=0;t=this.rows[i];i++)t.hasExternalInput&&(e=!0);for(let i,n=0;i=this.rows[n];n++){var t=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new Jp(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let e=0;e<t.length-1;e++){i.elements.push(t[e]);const n=this.getInRowSpacing_(t[e],t[e+1]);i.elements.push(new Jp(this.constants_,n))}i.elements.push(t[t.length-1]),i.endsWithElemSpacer()&&(t=this.getInRowSpacing_(t[t.length-1],null),e&&i.hasDummyInput&&(t+=this.constants_.TAB_WIDTH),i.elements.push(new Jp(this.constants_,t)))}}}getInRowSpacing_(e,t){if(!e)return t&&Vp.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&Vp.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&Vp.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Vp.isInput(e)&&(!t||Vp.isStatementInput(t)))return Vp.isField(e)&&e.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:Vp.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Vp.isHat(e)?this.constants_.NO_PADDING:Vp.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Vp.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Vp.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Vp.isInput(e)&&!t){if(Vp.isExternalInput(e))return this.constants_.NO_PADDING;if(Vp.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Vp.isStatementInput(e))return this.constants_.NO_PADDING}if(!Vp.isInput(e)&&t&&Vp.isInput(t)){if(Vp.isField(e)&&e.isEditable){if(Vp.isInlineInput(t)||Vp.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(Vp.isInlineInput(t)||Vp.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(Vp.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Vp.isIcon(e)&&t&&!Vp.isInput(t))return this.constants_.LARGE_PADDING;if(Vp.isInlineInput(e)&&t&&Vp.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Vp.isLeftSquareCorner(e)&&t){if(Vp.isHat(t))return this.constants_.NO_PADDING;if(Vp.isPreviousConnection(t))return t.notchOffset;if(Vp.isNextConnection(t))return t.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(Vp.isLeftRoundedCorner(e)&&t){if(Vp.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if(Vp.isNextConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return Vp.isField(e)&&t&&Vp.isField(t)&&e.isEditable===t.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING:t&&Vp.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return Vp.isTopRow(e)&&Vp.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Vp.isTopRow(e)||Vp.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(Vp.isSpacer(t))return e.yPos+t.height/2;if(Vp.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,Vp.isNextConnection(t)?e+t.height/2:e-t.height/2;if(Vp.isTopRow(e))return Vp.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return Vp.isField(t)||Vp.isIcon(t)?(i+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(i+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):i=Vp.isInlineInput(t)?i+t.height/2:i+e.height/2,i}alignRowElements_(){if(this.isInline){var e=0,t=new WeakMap,i=null;for(let n,o=this.rows.length-1;n=this.rows[o];o--)t.set(n,e),Vp.isInputRow(n)&&(n.hasStatement&&this.alignStatementRow_(n),i&&i.hasStatement&&n.width<i.width?t.set(n,i.width):e=n.hasStatement?n.width:Math.max(e,n.width),i=n);e=0;for(let n,o=0;n=this.rows[o];o++)n.hasStatement?e=this.getDesiredRowWidth_(n):Vp.isSpacer(n)?n.width=Math.max(e,t.get(n)):(i=n.width,0<(e=Math.max(e,t.get(n))-i)&&this.addAlignmentPadding_(n,e),e=n.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let e=0,t=0;for(let n,o=0;n=this.rows[o];o++){n.yPos=t,n.xPos=this.startX,t+=n.height,e=Math.max(e,n.widthWithConnectedBlocks);var i=t-this.topRow.ascenderHeight;n===this.bottomRow&&i<this.constants_.MIN_BLOCK_HEIGHT&&(i=this.constants_.MIN_BLOCK_HEIGHT-i,this.bottomRow.height+=i,t+=i),this.recordElemPositions_(n)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=t+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},Db=class extends dg{constructor(e,t,i){super(e,t,i),this.constants=i,this.colourDark="#000000",this.svgPathDark=ae(ac.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=ae(ac.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=Qn("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){super.updateHighlighted(e),this.svgPathLight.style.display=e?"none":"inline"}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},Mb=class extends pg{constructor(e){super(e),this.highlightConstants=null}init(e,t){super.init(e,t),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,t,i){super.refreshDom(e,t,i),this.getHighlightConstants().init()}makeConstants_(){return new xb}makeRenderInfo_(e){return new Ob(this,e)}makeDrawer_(e,t){return new Sb(e,t)}makePathObject(e,t){return new Db(e,t,this.getConstants())}makeHighlightConstants_(){return new Ab(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};vr("geras",Mb);var Lb={};Lb.ConstantProvider=xb,Lb.Drawer=Sb,Lb.HighlightConstantProvider=Ab,Lb.Highlighter=Nb,Lb.InlineInput=Rb,Lb.PathObject=Db,Lb.RenderInfo=Ob,Lb.Renderer=Mb,Lb.StatementInput=$b;var Bb=class extends ug{constructor(e,t){super(e,t)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var t=0;t<this.rows.length;t++)if(this.rows[t].hasExternalInput){e=!0;break}for(t=0;t<this.rows.length;t++){const n=this.rows[t];var i=n.elements;if(n.elements=[],n.startsWithElemSpacer()&&n.elements.push(new Jp(this.constants_,this.getInRowSpacing_(null,i[0]))),i.length){for(let e=0;e<i.length-1;e++){n.elements.push(i[e]);const t=this.getInRowSpacing_(i[e],i[e+1]);n.elements.push(new Jp(this.constants_,t))}n.elements.push(i[i.length-1]),n.endsWithElemSpacer()&&(i=this.getInRowSpacing_(i[i.length-1],null),e&&n.hasDummyInput&&(i+=this.constants_.TAB_WIDTH),n.elements.push(new Jp(this.constants_,i)))}}}getInRowSpacing_(e,t){if(!e)return t&&Vp.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&Vp.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&Vp.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Vp.isInput(e)&&!t)return Vp.isField(e)&&e.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:Vp.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Vp.isHat(e)?this.constants_.NO_PADDING:Vp.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Vp.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Vp.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Vp.isInput(e)&&!t){if(Vp.isExternalInput(e))return this.constants_.NO_PADDING;if(Vp.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Vp.isStatementInput(e))return this.constants_.NO_PADDING}if(!Vp.isInput(e)&&t&&Vp.isInput(t)){if(Vp.isField(e)&&e.isEditable){if(Vp.isInlineInput(t)||Vp.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(Vp.isInlineInput(t)||Vp.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(Vp.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Vp.isIcon(e)&&t&&!Vp.isInput(t))return this.constants_.LARGE_PADDING;if(Vp.isInlineInput(e)&&t&&Vp.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Vp.isLeftSquareCorner(e)&&t){if(Vp.isHat(t))return this.constants_.NO_PADDING;if(Vp.isPreviousConnection(t)||Vp.isNextConnection(t))return t.notchOffset}return Vp.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:Vp.isField(e)&&t&&Vp.isField(t)&&e.isEditable===t.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING:t&&Vp.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return Vp.isTopRow(e)&&Vp.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Vp.isTopRow(e)||Vp.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(Vp.isSpacer(t))return e.yPos+t.height/2;if(Vp.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,Vp.isNextConnection(t)?e+t.height/2:e-t.height/2;if(Vp.isTopRow(e))return Vp.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return Vp.isField(t)&&e.hasStatement?i+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):i+e.height/2}finalize_(){let e=0,t=0;for(var i=0;i<this.rows.length;i++){const o=this.rows[i];o.yPos=t,o.xPos=this.startX,t+=o.height,e=Math.max(e,o.widthWithConnectedBlocks);var n=t-this.topRow.ascenderHeight;o===this.bottomRow&&n<this.constants_.MIN_BLOCK_HEIGHT&&(n=this.constants_.MIN_BLOCK_HEIGHT-n,this.bottomRow.height+=n,t+=n),this.recordElemPositions_(o)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline}},Pb=class extends pg{constructor(e){super(e)}makeRenderInfo_(e){return new Bb(this,e)}};vr("thrasos",Pb);var Fb={};Fb.RenderInfo=Bb,Fb.Renderer=Pb;var Vb=new yd("zelos",{colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},{colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}}),Ub={Classic:vd,Zelos:Vb},Wb=class{constructor(e,t,i){this.id_=e.toolboxitemid||T(),this.level_=(this.parent_=i||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=t,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}getFocusableElement(){const e=this.getDiv();if(!e)throw Error("Trying to access toolbox item before DOM is initialized.");if(!(e instanceof HTMLElement))throw Error("Toolbox item div is unexpectedly not an HTML element.");return e}getFocusableTree(){return this.parentToolbox_}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}},Hb=class extends Wb{constructor(e,t,i){super(e,t,i),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),"true"===this.toolboxItemDef_.hidden&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategoryContainer",row:"blocklyToolboxCategory",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyToolboxCategoryIcon",label:"blocklyToolboxCategoryLabel",contents:"blocklyToolboxCategoryGroup",selected:"blocklyToolboxSelected",openicon:"blocklyToolboxCategoryIconOpen",closedicon:"blocklyToolboxCategoryIconClosed"}}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else if(e=e.contents)for(let t=0;t<e.length;t++){const i=e[t];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(i)}}parseCategoryDef_(e){this.name_="name"in e?io(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),At(this.htmlDiv_,Gc.TREEITEM),Rt(this.htmlDiv_,zc.SELECTED,!1),Rt(this.htmlDiv_,zc.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),At(this.iconDom_,Gc.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const e=this.labelDom_.getAttribute("id");return e&&Rt(this.htmlDiv_,zc.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const e=document.createElement("div");e.tabIndex=-1,e.id=this.getId();const t=this.cssConfig_.container;return t&&ce(e,t),e}createRowContainer_(){const e=document.createElement("div");var t=this.cssConfig_.row;return t&&ce(e,t),t=Hb.nestedPadding*this.getLevel()+"px",this.workspace_.RTL?e.style.paddingRight=t:e.style.paddingLeft=t,e}createRowContentsContainer_(){const e=document.createElement("div"),t=this.cssConfig_.rowcontentcontainer;return t&&ce(e,t),e}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&ce(e,t)}return e.style.display="inline-block",e}createLabelDom_(e){const t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=e,(e=this.cssConfig_.label)&&ce(t,e),t}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=Hb.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){const t=e.categorystyle||e.categoryStyle;if((e=e.colour)&&t)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(t)return this.getColourfromStyle(t);if(e)return this.parseColour(e)}return""}getColourfromStyle(e){var t=this.workspace_.getTheme();if(e&&t){if((t=t.categoryStyles[e])&&t.colour)return this.parseColour(t.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour(e){if(null==(e=io(e))||""===e)return"";var t=Number(e);return isNaN(t)?(t=Kn(e))?t:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):Zn(t)}openIcon_(e){if(e){var t=this.cssConfig_.closedicon;t&&he(e,t),(t=this.cssConfig_.openicon)&&ce(e,t)}}closeIcon_(e){if(e){var t=this.cssConfig_.openicon;t&&he(e,t),(t=this.cssConfig_.closedicon)&&ce(e,t)}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(e=e.getParent(),!e.isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){if(this.rowDiv_){var t=this.cssConfig_.selected;if(e){const e=this.parseColour(Hb.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||e,t&&ce(this.rowDiv_,t)}else this.rowDiv_.style.backgroundColor="",t&&ue(this.rowDiv_,t);Rt(this.htmlDiv_,zc.SELECTED,e)}}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",`${e}`),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_="string"==typeof e?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:ut(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){pe(this.htmlDiv_)}};Hb.registrationName="category",Hb.nestedPadding=19,Hb.borderWidth=8,Hb.defaultBackgroundColour="#57e",He('\n.blocklyToolboxCategory:not(.blocklyToolboxSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolbox[layout="h"] .blocklyToolboxCategoryContainer {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolbox[dir="RTL"][layout="h"] .blocklyToolboxCategoryContainer {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyToolboxCategory {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolbox[dir="RTL"] .blocklyToolboxCategory {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyToolboxCategoryIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyToolboxCategoryIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolbox[dir="RTL"] .blocklyToolboxCategoryIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyToolboxSelected>.blocklyToolboxCategoryIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolbox[dir="RTL"] .blocklyToolboxSelected>.blocklyToolboxCategoryIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyToolboxCategoryIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyToolboxSelected>.blocklyToolboxCategoryIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyToolboxCategoryLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyToolboxCategoryLabel {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxSelected .blocklyToolboxCategoryLabel {\n  color: #fff;\n}\n'),e(Bl.TOOLBOX_ITEM,Hb.registrationName,Hb);var Gb=class extends Wb{constructor(e,t){super(e,t),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){const e=document.createElement("div");e.tabIndex=-1,e.id=this.getId();const t=this.cssConfig_.container;return t&&ce(e,t),this.htmlDiv=e}getDiv(){return this.htmlDiv}dispose(){pe(this.htmlDiv)}};Gb.registrationName="sep",He('\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolbox[layout="h"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n'),e(Bl.TOOLBOX_ITEM,Gb.registrationName,Gb);var zb=class extends Hb{constructor(e,t,i){super(e,t,i),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxCategoryGroup",e}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else{const t=e.contents;if(t){this.flyoutItems_=[],e=!0;for(let i=0;i<t.length;i++){const n=t[i];!s(Bl.TOOLBOX_ITEM,n.kind)||n.kind.toLowerCase()===Gb.registrationName&&e?(this.flyoutItems_.push(n),e=!0):(this.createToolboxItem(n),e=!1)}}}}createToolboxItem(e){let t=e.kind;"CATEGORY"===t.toUpperCase()&&gt(e)&&(t=zb.registrationName),e=new(r(Bl.TOOLBOX_ITEM,t))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded("true"===this.toolboxItemDef_.expanded||!0===this.toolboxItemDef_.expanded)}createDom_(){super.createDom_();const e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),At(this.subcategoriesDiv_,Gc.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),Rt(this.htmlDiv_,zc.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&ce(e,t),e.style.visibility="visible"}return e.style.display="inline-block",e}createSubCategoriesDom_(e){const t=document.createElement("div");t.style.display="none";var i=this.cssConfig_.contents;for(i&&ce(t,i),i=0;i<e.length;i++){const n=e[i];n.init();const o=n.getDiv();if(t.appendChild(o),n.getClickTarget){let e;null==(e=n.getClickTarget())||e.setAttribute("id",n.getId())}}return t}setExpanded(e){if(this.expanded_!==e){if(this.expanded_=e)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let e;null==(e=this.parentToolbox_.getFlyout())||e.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}Rt(this.htmlDiv_,zc.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none";const t=this.getChildToolboxItems();for(let i=0;i<t.length;i++)t[i].setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};zb.registrationName="collapsibleCategory",e(Bl.TOOLBOX_ITEM,zb.registrationName,zb);var jb=class extends op{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.height_=this.width_=0,this.flyout=null,this.contents=new Map,this.previouslySelectedItem_=this.selectedItem_=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout=e.options.horizontalLayout,this.RTL=e.options.RTL,this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_;const t=e.getParentSvg();this.flyout=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_);const i=this.flyout.createDom("svg");ce(i,"blocklyToolboxFlyout"),ge(i,t),this.setVisible(!0),this.flyout.init(e),this.render(this.toolboxDef_),(e=e.getThemeManager()).subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:tc.ComponentWeight.TOOLBOX_WEIGHT,capabilities:[tc.Capability.AUTOHIDEABLE,tc.Capability.DELETE_AREA,tc.Capability.DRAG_TARGET]}),$l.getFocusManager$$module$build$src$core$focus_manager().registerTree(this,!0)}createDom_(e){e=e.getParentSvg();const t=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),At(this.contentsDiv_,Gc.TREE),t.appendChild(this.contentsDiv_),e.parentNode.insertBefore(t,e),this.attachEvents_(t,this.contentsDiv_),t}createContainer_(){const e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),ce(e,"blocklyToolbox"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){const e=document.createElement("div");return ce(e,"blocklyToolboxCategoryGroup"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,t){e=b(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),t=b(t,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(t)}onClick_(e){if(v(e)||e.target===this.HtmlDiv)Se().hideChaff(!1);else{var t=e.target.getAttribute("id");t&&(t=this.getToolboxItemById(t)).isSelectable()&&(this.setSelectedItem(t),t.onClick(e)),Se().hideChaff(!0)}d()}onKeyDown_(e){let t=!1;switch(e.key){case"ArrowDown":t=this.selectNext();break;case"ArrowUp":t=this.selectPrevious();break;case"ArrowLeft":t=this.selectParent();break;case"ArrowRight":t=this.selectChild();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),t=!0);break;default:t=!1}!t&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(t=this.selectedItem_.onKeyDown(e)),t&&e.preventDefault()}createFlyout_(){const e=this.workspace_,t=e.copyOptionsForFlyout();return t.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?c(Bl.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):c(Bl.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(t)}render(e){this.toolboxDef_=e,this.contents.forEach((e=>e.dispose())),this.contents.clear(),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(e){const t=document.createDocumentFragment();for(let i=0;i<e.length;i++)this.createToolboxItem(e[i],t);this.contentsDiv_.appendChild(t)}createToolboxItem(e,t){var i=e.kind;"CATEGORY"===i.toUpperCase()&&gt(e)&&(i=zb.registrationName),(i=r(Bl.TOOLBOX_ITEM,i.toLowerCase()))&&((e=new i(e,this)).init(),this.addToolboxItem_(e),(i=e.getDiv())&&t.appendChild(i),e.getClickTarget()&&e.getClickTarget().setAttribute("id",e.getId()))}addToolboxItem_(e){if(this.contents.set(e.getId(),e),e.isCollapsible()){e=e.getChildToolboxItems();for(let t=0;t<e.length;t++)this.addToolboxItem_(e[t])}}getToolboxItems(){return[...this.contents.values()]}addStyle(e){e&&this.HtmlDiv&&ce(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&ue(this.HtmlDiv,e)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var e=this.HtmlDiv.getBoundingClientRect();const t=e.top,i=t+e.height,n=e.left;return e=n+e.width,this.toolboxPosition===Ic.TOP?new cc(-1e7,i,-1e7,1e7):this.toolboxPosition===Ic.BOTTOM?new cc(t,1e7,-1e7,1e7):this.toolboxPosition===Ic.LEFT?new cc(-1e7,1e7,-1e7,e):new cc(-1e7,1e7,n,1e7)}wouldDelete(e){return e instanceof ip?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_(Ys(e)&&e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){const t=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(t):this.removeStyle(t)}getToolboxItemById(e){return this.contents.get(e)||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout}position(){const e=this.workspace_.getMetrics(),t=this.HtmlDiv;t&&(this.horizontalLayout?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===Ic.TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition===Ic.RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth,this.height_=e.viewHeight),this.flyout.position())}handleToolboxItemResize(){const e=this.workspace_;var t=this.HtmlDiv.getBoundingClientRect();const i=this.getFlyout(),n=this.toolboxPosition===Ic.LEFT?e.scrollX+t.width+(null!=i&&i.isVisible()?i.getWidth():0):e.scrollX;t=this.toolboxPosition===Ic.TOP?e.scrollY+t.height+(null!=i&&i.isVisible()?i.getHeight():0):e.scrollY,e.translate(n,t),Le(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){this.contents.forEach((e=>{e.refreshTheme&&e.refreshTheme()}))}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.flyout.autoClose&&this.clearSelection()}setSelectedItem(e){const t=this.selectedItem_;!e&&!t||e&&!Sl(e)||(this.shouldDeselectItem_(t,e)&&null!==t&&this.deselectItem_(t),this.shouldSelectItem_(t,e)&&null!==e&&this.selectItem_(t,e),this.updateFlyout_(t,e),this.fireSelectEvent(t,e))}shouldDeselectItem_(e,t){return null!==e&&(!e.isCollapsible()||e!==t)}shouldSelectItem_(e,t){return null!==t&&t!==e}deselectItem_(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),Rt(this.contentsDiv_,zc.ACTIVEDESCENDANT,"")}selectItem_(e,t){this.selectedItem_=t,this.previouslySelectedItem_=e,t.setSelected(!0),Rt(this.contentsDiv_,zc.ACTIVEDESCENDANT,t.getId())}selectItemByPosition(e){(e=this.getToolboxItems()[e])&&this.setSelectedItem(e)}updateFlyout_(e,t){t&&(e!==t||t.isCollapsible())&&t.getContents().length?(this.flyout.show(t.getContents()),this.flyout.scrollToStart()):this.flyout.hide()}fireSelectEvent(e,t){const i=e&&e.getName();let n=t&&t.getName();e===t&&(n=null),e=new(re(ia.TOOLBOX_ITEM_SELECT))(i,n,this.workspace_.id),J(e)}selectParent(){return!(!this.selectedItem_||(this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),0):!this.selectedItem_.getParent()||!this.selectedItem_.getParent().isSelectable()||(this.setSelectedItem(this.selectedItem_.getParent()),0)))}selectChild(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const e=this.selectedItem_;return e.isExpanded()?this.selectNext():e.toggleExpanded(),!0}selectNext(){if(!this.selectedItem_)return!1;const e=[...this.contents.values()];let t=e.indexOf(this.selectedItem_)+1;if(-1<t&&t<e.length){let i=e[t];for(;i&&!i.isSelectable();)i=e[++t];if(i&&i.isSelectable())return this.setSelectedItem(i),!0}return!1}selectPrevious(){if(!this.selectedItem_)return!1;const e=[...this.contents.values()];let t=e.indexOf(this.selectedItem_)-1;if(-1<t&&t<e.length){let i=e[t];for(;i&&!i.isSelectable();)i=e[--t];if(i&&i.isSelectable())return this.setSelectedItem(i),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout.dispose(),this.contents.forEach((e=>e.dispose()));for(let e=0;e<this.boundEvents_.length;e++)E(this.boundEvents_[e]);this.boundEvents_=[],this.contents.clear(),this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),pe(this.HtmlDiv)),$l.getFocusManager$$module$build$src$core$focus_manager().unregisterTree(this)}getFocusableElement(){if(!this.HtmlDiv)throw Error("Toolbox DOM has not yet been created.");return this.HtmlDiv}getFocusableTree(){return this}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}getRootFocusableNode(){return this}getRestoredFocusableNode(e){if(!e||e===this){let e;return null!=(e=this.getToolboxItems().find((e=>e.isSelectable())))?e:null}return null}getNestedTrees(){return[]}lookUpFocusableNode(e){return this.getToolboxItemById(e)}onTreeFocus(e,t){e!==this?this.getSelectedItem()!==e&&this.setSelectedItem(e):this.clearSelection()}onTreeBlur(e){let t;e&&e===(null==(t=this.flyout)?void 0:t.getWorkspace())||(this.clearSelection(),this.flyout&&er(this.flyout)&&this.flyout.autoHide(!1))}};He('\n.blocklyToolboxDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url("<<<PATH>>>/handclosed.cur"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolbox {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxCategoryGroup {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxCategoryGroup:focus {\n  outline: none;\n}\n'),e(Bl.TOOLBOX,Ll,jb);var Xb=hd.INPUT_VALUE,Kb=hd.OUTPUT_VALUE,Yb=hd.NEXT_STATEMENT,Jb=hd.PREVIOUS_STATEMENT,qb=Ic.TOP,Qb=Ic.BOTTOM,Zb=Ic.LEFT,ef=Ic.RIGHT;yg.prototype.newBlock=function(e,t){return new jd(this,e,t)},Cg.prototype.newBlock=function(e,t){return new ip(this,e,t)},yg.prototype.newComment=function(e){return new od(this,e)},Cg.prototype.newComment=function(e){return new sd(this,e)},Cg.newTrashcan=function(e){return new Rg(e)},wd.prototype.newWorkspaceSvg=function(e){return new Cg(e)},$l.Names$$module$build$src$core$names.prototype.populateProcedures=function(e){e=(e=sr(e))[0].concat(e[1]);for(let t=0;t<e.length;t++)this.getName(e[t][0],$l.Names$$module$build$src$core$names.NameType.PROCEDURE)};var tf={};return tf.Block=jd,tf.BlockFlyoutInflater=wb,tf.BlockNavigationPolicy=pp,tf.BlockSvg=ip,tf.Blocks=Yl,tf.ButtonFlyoutInflater=Cb,tf.COLLAPSED_FIELD_NAME=Zc,tf.COLLAPSED_INPUT_NAME=Qc,tf.COLLAPSE_CHARS=30,tf.CodeGenerator=$l.CodeGenerator$$module$build$src$core$generator,tf.CollapsibleToolboxCategory=zb,tf.ComponentManager=tc,tf.Connection=$d,tf.ConnectionChecker=Eg,tf.ConnectionDB=dd,tf.ConnectionNavigationPolicy=mp,tf.ConnectionType=hd,tf.ContextMenu=Xu,tf.ContextMenuItems=Eb,tf.ContextMenuRegistry=Ku,tf.Css=rc,tf.DELETE_VARIABLE_ID=Pd,tf.DeleteArea=op,tf.DragTarget=np,tf.DropDownDiv=au,tf.Events=mb,tf.Extensions=Sd,tf.Field=$u,tf.FieldCheckbox=km,tf.FieldDropdown=fd,tf.FieldImage=cm,tf.FieldLabel=Md,tf.FieldLabelSerializable=Im,tf.FieldNavigationPolicy=bp,tf.FieldNumber=wm,tf.FieldTextInput=$l.FieldTextInput$$module$build$src$core$field_textinput,tf.FieldVariable=Tm,tf.Flyout=wp,tf.FlyoutButton=ap,tf.FlyoutButtonNavigationPolicy=cp,tf.FlyoutItem=sp,tf.FlyoutMetricsManager=lp,tf.FlyoutNavigationPolicy=hp,tf.FlyoutNavigator=vp,tf.FlyoutSeparator=up,tf.FlyoutSeparatorNavigationPolicy=dp,tf.FocusManager=Pa,tf.FocusableTreeTraverser=La,tf.Generator=$l.CodeGenerator$$module$build$src$core$generator,tf.Gesture=Sp,tf.Grid=Ap,tf.HorizontalFlyout=_m,tf.INPUT_VALUE=Xb,tf.Input=Wd,tf.InsertionMarkerPreviewer=Em,tf.KeyboardNavigationController=Ip,tf.LabelFlyoutInflater=rm,tf.LineCursor=kb,tf.Marker=Ib,tf.MarkerManager=$p,tf.Menu=Jc,tf.MenuItem=Yc,tf.MetricsManager=rp,tf.Msg=$l.Msg$$module$build$src$core$msg,tf.NEXT_STATEMENT=Yb,tf.Names=$l.Names$$module$build$src$core$names,tf.Navigator=yp,tf.OPPOSITE_TYPE=Ld,tf.OUTPUT_VALUE=Kb,tf.Options=Cd,tf.PREVIOUS_STATEMENT=Jb,tf.PROCEDURE_CATEGORY_NAME=Bp,tf.Procedures=Pp,tf.RENAME_VARIABLE_ID=Bd,tf.RenderedConnection=Fd,tf.Scrollbar=bc,tf.ScrollbarPair=Cp,tf.SeparatorFlyoutInflater=Tp,tf.ShortcutItems=Zg,tf.ShortcutRegistry=Ua,tf.TOOLBOX_AT_BOTTOM=Qb,tf.TOOLBOX_AT_LEFT=Zb,tf.TOOLBOX_AT_RIGHT=ef,tf.TOOLBOX_AT_TOP=qb,tf.Theme=yd,tf.ThemeManager=mg,tf.Themes=Ub,tf.Toast=gh,tf.Toolbox=jb,tf.ToolboxCategory=Hb,tf.ToolboxItem=Wb,tf.ToolboxSeparator=Gb,tf.Tooltip=ku,tf.Touch=ta,tf.Trashcan=Rg,tf.UnattachedFieldError=Ou,tf.VARIABLE_CATEGORY_NAME=xh,tf.VARIABLE_DYNAMIC_CATEGORY_NAME=bg,tf.VERSION="12.1.0",tf.VariableMap=Ng,tf.VariableModel=Ig,tf.Variables=Ah,tf.VariablesDynamic=fg,tf.VerticalFlyout=Cm,tf.WidgetDiv=Hu,tf.Workspace=yg,tf.WorkspaceAudio=vg,tf.WorkspaceDragger=Np,tf.WorkspaceNavigationPolicy=Ep,tf.WorkspaceSvg=Cg,tf.Xml=rd,tf.ZoomControls=Bc,tf.blockAnimations=Yd,tf.blockRendering=gg,tf.browserEvents=ga,tf.bubbles=_b,tf.bumpObjects=Qd,tf.clipboard=Yg,tf.comments=yb,tf.common=Xa,tf.config=$l.config$$module$build$src$core$config,tf.constants=th,tf.defineBlocksWithJsonArray=Fe,tf.dialog=Th,tf.dragging=Nm,tf.fieldRegistry=bd,tf.geras=Lb,tf.getFocusManager=$l.getFocusManager$$module$build$src$core$focus_manager,tf.getMainWorkspace=Se,tf.getSelected=Re,tf.hasBubble=Gi,tf.hideChaff=Al,tf.icons=Lp,tf.inject=Jr,tf.inputs=ym,tf.isCopyable=Mr,tf.isDeletable=Ys,tf.isDraggable=Zs,tf.isIcon=Ds,tf.isObservable=or,tf.isPaster=xl,tf.isRenderedElement=Nl,tf.isSelectable=Te,tf.isSerializable=$t,tf.isVariableBackedParameterModel=Qt,tf.keyboardNavigationController=kp,tf.layers=Zu,tf.navigateBlock=Qs,tf.navigateStacks=qs,tf.procedures=Pp,tf.registry=Pl,tf.renderManagement=hh,tf.serialization=om,tf.setLocale=ih,tf.setParentContainer=Me,tf.svgResize=Le,tf.thrasos=Fb,tf.uiPosition=Oc,tf.utils=Rd,tf.zelos=fb,tf.__namespace__=$l,tf})?n.apply(t,[]):n)||(e.exports=o)},975:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function i(e,t){for(var i,n="",o=0,s=-1,r=0,l=0;l<=e.length;++l){if(l<e.length)i=e.charCodeAt(l);else{if(47===i)break;i=47}if(47===i){if(s===l-1||1===r);else if(s!==l-1&&2===r){if(n.length<2||2!==o||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var a=n.lastIndexOf("/");if(a!==n.length-1){-1===a?(n="",o=0):o=(n=n.slice(0,a)).length-1-n.lastIndexOf("/"),s=l,r=0;continue}}else if(2===n.length||1===n.length){n="",o=0,s=l,r=0;continue}t&&(n.length>0?n+="/..":n="..",o=2)}else n.length>0?n+="/"+e.slice(s+1,l):n=e.slice(s+1,l),o=l-s-1;s=l,r=0}else 46===i&&-1!==r?++r:r=-1}return n}var n={resolve:function(){for(var e,n="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var r;s>=0?r=arguments[s]:(void 0===e&&(e=process.cwd()),r=e),t(r),0!==r.length&&(n=r+"/"+n,o=47===r.charCodeAt(0))}return n=i(n,!o),o?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),o=47===e.charCodeAt(e.length-1);return 0!==(e=i(e,!n)).length||n||(e="."),e.length>0&&o&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,i=0;i<arguments.length;++i){var o=arguments[i];t(o),o.length>0&&(void 0===e?e=o:e+="/"+o)}return void 0===e?".":n.normalize(e)},relative:function(e,i){if(t(e),t(i),e===i)return"";if((e=n.resolve(e))===(i=n.resolve(i)))return"";for(var o=1;o<e.length&&47===e.charCodeAt(o);++o);for(var s=e.length,r=s-o,l=1;l<i.length&&47===i.charCodeAt(l);++l);for(var a=i.length-l,c=r<a?r:a,h=-1,u=0;u<=c;++u){if(u===c){if(a>c){if(47===i.charCodeAt(l+u))return i.slice(l+u+1);if(0===u)return i.slice(l+u)}else r>c&&(47===e.charCodeAt(o+u)?h=u:0===u&&(h=0));break}var d=e.charCodeAt(o+u);if(d!==i.charCodeAt(l+u))break;47===d&&(h=u)}var p="";for(u=o+h+1;u<=s;++u)u!==s&&47!==e.charCodeAt(u)||(0===p.length?p+="..":p+="/..");return p.length>0?p+i.slice(l+h):(l+=h,47===i.charCodeAt(l)&&++l,i.slice(l))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var i=e.charCodeAt(0),n=47===i,o=-1,s=!0,r=e.length-1;r>=1;--r)if(47===(i=e.charCodeAt(r))){if(!s){o=r;break}}else s=!1;return-1===o?n?"/":".":n&&1===o?"//":e.slice(0,o)},basename:function(e,i){if(void 0!==i&&"string"!=typeof i)throw new TypeError('"ext" argument must be a string');t(e);var n,o=0,s=-1,r=!0;if(void 0!==i&&i.length>0&&i.length<=e.length){if(i.length===e.length&&i===e)return"";var l=i.length-1,a=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!r){o=n+1;break}}else-1===a&&(r=!1,a=n+1),l>=0&&(c===i.charCodeAt(l)?-1===--l&&(s=n):(l=-1,s=a))}return o===s?s=a:-1===s&&(s=e.length),e.slice(o,s)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!r){o=n+1;break}}else-1===s&&(r=!1,s=n+1);return-1===s?"":e.slice(o,s)},extname:function(e){t(e);for(var i=-1,n=0,o=-1,s=!0,r=0,l=e.length-1;l>=0;--l){var a=e.charCodeAt(l);if(47!==a)-1===o&&(s=!1,o=l+1),46===a?-1===i?i=l:1!==r&&(r=1):-1!==i&&(r=-1);else if(!s){n=l+1;break}}return-1===i||-1===o||0===r||1===r&&i===o-1&&i===n+1?"":e.slice(i,o)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var i=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return i?i===t.root?i+n:i+"/"+n:n}(0,e)},parse:function(e){t(e);var i={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return i;var n,o=e.charCodeAt(0),s=47===o;s?(i.root="/",n=1):n=0;for(var r=-1,l=0,a=-1,c=!0,h=e.length-1,u=0;h>=n;--h)if(47!==(o=e.charCodeAt(h)))-1===a&&(c=!1,a=h+1),46===o?-1===r?r=h:1!==u&&(u=1):-1!==r&&(u=-1);else if(!c){l=h+1;break}return-1===r||-1===a||0===u||1===u&&r===a-1&&r===l+1?-1!==a&&(i.base=i.name=0===l&&s?e.slice(1,a):e.slice(l,a)):(0===l&&s?(i.name=e.slice(1,r),i.base=e.slice(1,a)):(i.name=e.slice(l,r),i.base=e.slice(l,a)),i.ext=e.slice(r,a)),l>0?i.dir=e.slice(0,l-1):s&&(i.dir="/"),i},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.c=t,i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(i.s=25)})();